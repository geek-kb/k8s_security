"use strict";(globalThis.webpackChunkk_8_s_security=globalThis.webpackChunkk_8_s_security||[]).push([[1312],{2866(e,n,t){t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>u,frontMatter:()=>r,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"best_practices/cluster_setup_and_hardening/network_security/cloud_metadata_mitigation","title":"Cloud Metadata Service Mitigation","description":"How to prevent pods from accessing cloud provider metadata services (IMDS) and stealing IAM credentials in Kubernetes.","source":"@site/docs/best_practices/cluster_setup_and_hardening/network_security/cloud_metadata_mitigation.md","sourceDirName":"best_practices/cluster_setup_and_hardening/network_security","slug":"/best_practices/cluster_setup_and_hardening/network_security/cloud_metadata_mitigation","permalink":"/docs/best_practices/cluster_setup_and_hardening/network_security/cloud_metadata_mitigation","draft":false,"unlisted":false,"editUrl":"https://github.com/geek-kb/k8s_security/edit/main/docs/best_practices/cluster_setup_and_hardening/network_security/cloud_metadata_mitigation.md","tags":[{"inline":true,"label":"best-practice","permalink":"/docs/tags/best-practice"},{"inline":true,"label":"mitigation","permalink":"/docs/tags/mitigation"},{"inline":true,"label":"cloud-security","permalink":"/docs/tags/cloud-security"},{"inline":true,"label":"network","permalink":"/docs/tags/network"},{"inline":true,"label":"CKS","permalink":"/docs/tags/cks"}],"version":"current","lastUpdatedBy":"Itai Ganot","lastUpdatedAt":1770102262000,"sidebarPosition":16,"frontMatter":{"sidebar_position":16,"title":"Cloud Metadata Service Mitigation","description":"How to prevent pods from accessing cloud provider metadata services (IMDS) and stealing IAM credentials in Kubernetes.","keywords":["kubernetes cloud security","IMDS mitigation","block metadata service","AWS IMDSv2","GCP workload identity","Azure pod identity","network policy egress","cloud credential protection","kubernetes best practices","CKS"],"tags":["best-practice","mitigation","cloud-security","network","CKS"],"related":["/docs/attack_vectors/cloud_metadata_service_abuse/","/docs/best_practices/cluster_setup_and_hardening/network_security/network_policies/","/docs/best_practices/cluster_setup_and_hardening/network_security/egress_control/","/docs/fundamentals/the_4_c_cloud_native_security/"]},"sidebar":"default","previous":{"title":"Kong","permalink":"/docs/best_practices/cluster_setup_and_hardening/network_security/kong"},"next":{"title":"netchecks","permalink":"/docs/best_practices/cluster_setup_and_hardening/network_security/netchecks"}}');var a=t(4848),i=t(8453);const r={sidebar_position:16,title:"Cloud Metadata Service Mitigation",description:"How to prevent pods from accessing cloud provider metadata services (IMDS) and stealing IAM credentials in Kubernetes.",keywords:["kubernetes cloud security","IMDS mitigation","block metadata service","AWS IMDSv2","GCP workload identity","Azure pod identity","network policy egress","cloud credential protection","kubernetes best practices","CKS"],tags:["best-practice","mitigation","cloud-security","network","CKS"],related:["/docs/attack_vectors/cloud_metadata_service_abuse/","/docs/best_practices/cluster_setup_and_hardening/network_security/network_policies/","/docs/best_practices/cluster_setup_and_hardening/network_security/egress_control/","/docs/fundamentals/the_4_c_cloud_native_security/"]},o="Cloud Metadata Service Mitigation",c={},d=[{value:"1. Block Metadata Access with NetworkPolicies",id:"1-block-metadata-access-with-networkpolicies",level:2},{value:"Example: Deny Metadata Access (Default-Deny Egress)",id:"example-deny-metadata-access-default-deny-egress",level:3},{value:"2. Use IMDSv2 on AWS (Require Session Tokens)",id:"2-use-imdsv2-on-aws-require-session-tokens",level:2},{value:"Example: Enforce IMDSv2 on EKS Node Groups",id:"example-enforce-imdsv2-on-eks-node-groups",level:3},{value:"3. Use GCP Workload Identity",id:"3-use-gcp-workload-identity",level:2},{value:"Example: Enable Workload Identity on GKE",id:"example-enable-workload-identity-on-gke",level:3},{value:"Block Metadata Server on GKE",id:"block-metadata-server-on-gke",level:3},{value:"4. Use Azure Workload Identity",id:"4-use-azure-workload-identity",level:2},{value:"Example: Configure Azure Workload Identity",id:"example-configure-azure-workload-identity",level:3},{value:"5. Use Pod Identity Alternatives (IRSA on EKS)",id:"5-use-pod-identity-alternatives-irsa-on-eks",level:2},{value:"Example: Configure IRSA on EKS",id:"example-configure-irsa-on-eks",level:3},{value:"6. Monitor and Detect Metadata Access",id:"6-monitor-and-detect-metadata-access",level:2},{value:"Example: Falco Rule for Metadata Access",id:"example-falco-rule-for-metadata-access",level:3},{value:"CloudTrail Monitoring (AWS)",id:"cloudtrail-monitoring-aws",level:3},{value:"Summary",id:"summary",level:2},{value:"References",id:"references",level:2}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"cloud-metadata-service-mitigation",children:"Cloud Metadata Service Mitigation"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Required knowledge for the CKS certification."})}),"\n",(0,a.jsxs)(n.p,{children:["Cloud providers expose an Instance Metadata Service (IMDS) at ",(0,a.jsx)(n.code,{children:"169.254.169.254"})," that allows workloads to retrieve temporary IAM credentials. In Kubernetes clusters running on cloud infrastructure, pods can access this service by default, creating a significant privilege escalation risk."]}),"\n",(0,a.jsx)(n.p,{children:"This guide covers techniques to block metadata service access and implement secure alternatives for cloud identity management."}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"1-block-metadata-access-with-networkpolicies",children:"1. Block Metadata Access with NetworkPolicies"}),"\n",(0,a.jsx)(n.p,{children:"The most direct mitigation is to block egress traffic to the metadata service IP address using Kubernetes NetworkPolicies."}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Issue:"})," By default, all pods can reach ",(0,a.jsx)(n.code,{children:"169.254.169.254"}),".",(0,a.jsx)("br",{}),"\n",(0,a.jsx)(n.strong,{children:"Fix:"})," Apply a cluster-wide NetworkPolicy to deny egress to the metadata service."]}),"\n",(0,a.jsx)(n.h3,{id:"example-deny-metadata-access-default-deny-egress",children:"Example: Deny Metadata Access (Default-Deny Egress)"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"apiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: deny-metadata-access\n  namespace: default\nspec:\n  podSelector: {}\n  policyTypes:\n    - Egress\n  egress:\n    - to:\n        - ipBlock:\n            cidr: 0.0.0.0/0\n            except:\n              - 169.254.169.254/32\n"})}),"\n",(0,a.jsx)(n.p,{children:"Apply this policy to every namespace where workloads run:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"for ns in $(kubectl get namespaces -o jsonpath='{.items[*].metadata.name}'); do\n  kubectl apply -n $ns -f deny-metadata-policy.yaml\ndone\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Note:"})," This requires a CNI that supports NetworkPolicies (Calico, Cilium, Weave Net)."]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"2-use-imdsv2-on-aws-require-session-tokens",children:"2. Use IMDSv2 on AWS (Require Session Tokens)"}),"\n",(0,a.jsx)(n.p,{children:"AWS Instance Metadata Service v2 (IMDSv2) requires a session token for all metadata requests, making SSRF-based attacks significantly harder."}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Issue:"})," IMDSv1 allows simple GET requests to retrieve credentials.",(0,a.jsx)("br",{}),"\n",(0,a.jsx)(n.strong,{children:"Fix:"})," Enforce IMDSv2 at the instance level and set a low hop limit."]}),"\n",(0,a.jsx)(n.h3,{id:"example-enforce-imdsv2-on-eks-node-groups",children:"Example: Enforce IMDSv2 on EKS Node Groups"}),"\n",(0,a.jsx)(n.p,{children:"When creating or updating EKS node groups, configure the metadata options:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"aws ec2 modify-instance-metadata-options \\\n  --instance-id i-1234567890abcdef0 \\\n  --http-tokens required \\\n  --http-put-response-hop-limit 1 \\\n  --http-endpoint enabled\n"})}),"\n",(0,a.jsx)(n.p,{children:"For EKS managed node groups via Terraform:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-hcl",children:'resource "aws_eks_node_group" "workers" {\n  # ... other configuration ...\n\n  launch_template {\n    id      = aws_launch_template.eks_nodes.id\n    version = aws_launch_template.eks_nodes.latest_version\n  }\n}\n\nresource "aws_launch_template" "eks_nodes" {\n  name_prefix = "eks-node-"\n\n  metadata_options {\n    http_endpoint               = "enabled"\n    http_tokens                 = "required"  # Enforce IMDSv2\n    http_put_response_hop_limit = 1           # Block container access\n    instance_metadata_tags      = "disabled"\n  }\n}\n'})}),"\n",(0,a.jsxs)(n.p,{children:["Setting ",(0,a.jsx)(n.code,{children:"http_put_response_hop_limit = 1"})," prevents containers from reaching the metadata service because the request must traverse the container network namespace."]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"3-use-gcp-workload-identity",children:"3. Use GCP Workload Identity"}),"\n",(0,a.jsx)(n.p,{children:"On GKE, Workload Identity allows pods to authenticate as Google Cloud service accounts without accessing the node's metadata service."}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Issue:"})," Pods inherit the node's GCE service account credentials via metadata.",(0,a.jsx)("br",{}),"\n",(0,a.jsx)(n.strong,{children:"Fix:"})," Use Workload Identity to bind Kubernetes ServiceAccounts to GCP service accounts."]}),"\n",(0,a.jsx)(n.h3,{id:"example-enable-workload-identity-on-gke",children:"Example: Enable Workload Identity on GKE"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Enable Workload Identity on the cluster:"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"gcloud container clusters update CLUSTER_NAME \\\n  --workload-pool=PROJECT_ID.svc.id.goog\n"})}),"\n",(0,a.jsxs)(n.ol,{start:"2",children:["\n",(0,a.jsx)(n.li,{children:"Create a Kubernetes ServiceAccount:"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: my-app-sa\n  namespace: default\n  annotations:\n    iam.gke.io/gcp-service-account: my-gcp-sa@PROJECT_ID.iam.gserviceaccount.com\n"})}),"\n",(0,a.jsxs)(n.ol,{start:"3",children:["\n",(0,a.jsx)(n.li,{children:"Bind the Kubernetes SA to the GCP service account:"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'gcloud iam service-accounts add-iam-policy-binding \\\n  my-gcp-sa@PROJECT_ID.iam.gserviceaccount.com \\\n  --role roles/iam.workloadIdentityUser \\\n  --member "serviceAccount:PROJECT_ID.svc.id.goog[default/my-app-sa]"\n'})}),"\n",(0,a.jsxs)(n.ol,{start:"4",children:["\n",(0,a.jsx)(n.li,{children:"Use the ServiceAccount in your pod:"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: Pod\nmetadata:\n  name: my-app\nspec:\n  serviceAccountName: my-app-sa\n  containers:\n    - name: app\n      image: my-app:latest\n"})}),"\n",(0,a.jsx)(n.h3,{id:"block-metadata-server-on-gke",children:"Block Metadata Server on GKE"}),"\n",(0,a.jsx)(n.p,{children:"Additionally, block the metadata server at the node level:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"gcloud container clusters update CLUSTER_NAME \\\n  --workload-metadata=GKE_METADATA\n"})}),"\n",(0,a.jsxs)(n.p,{children:["This prevents pods from querying ",(0,a.jsx)(n.code,{children:"169.254.169.254"})," directly."]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"4-use-azure-workload-identity",children:"4. Use Azure Workload Identity"}),"\n",(0,a.jsx)(n.p,{children:"On AKS, Azure Workload Identity provides a secure way for pods to authenticate to Azure services without accessing the node's managed identity."}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Issue:"})," Pods can access the Azure IMDS to retrieve managed identity tokens.",(0,a.jsx)("br",{}),"\n",(0,a.jsx)(n.strong,{children:"Fix:"})," Use Azure Workload Identity with federated credentials."]}),"\n",(0,a.jsx)(n.h3,{id:"example-configure-azure-workload-identity",children:"Example: Configure Azure Workload Identity"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Enable Workload Identity on AKS:"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"az aks update \\\n  --resource-group myResourceGroup \\\n  --name myAKSCluster \\\n  --enable-oidc-issuer \\\n  --enable-workload-identity\n"})}),"\n",(0,a.jsxs)(n.ol,{start:"2",children:["\n",(0,a.jsx)(n.li,{children:"Create an Azure AD application and federated credential:"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'az identity create --name myIdentity --resource-group myResourceGroup\n\naz identity federated-credential create \\\n  --name myFederatedCredential \\\n  --identity-name myIdentity \\\n  --resource-group myResourceGroup \\\n  --issuer "${AKS_OIDC_ISSUER}" \\\n  --subject system:serviceaccount:default:my-app-sa\n'})}),"\n",(0,a.jsxs)(n.ol,{start:"3",children:["\n",(0,a.jsx)(n.li,{children:"Create a Kubernetes ServiceAccount with the identity annotation:"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: my-app-sa\n  namespace: default\n  annotations:\n    azure.workload.identity/client-id: <MANAGED_IDENTITY_CLIENT_ID>\n"})}),"\n",(0,a.jsxs)(n.ol,{start:"4",children:["\n",(0,a.jsx)(n.li,{children:"Deploy pods with the workload identity label:"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'apiVersion: v1\nkind: Pod\nmetadata:\n  name: my-app\n  labels:\n    azure.workload.identity/use: "true"\nspec:\n  serviceAccountName: my-app-sa\n  containers:\n    - name: app\n      image: my-app:latest\n'})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"5-use-pod-identity-alternatives-irsa-on-eks",children:"5. Use Pod Identity Alternatives (IRSA on EKS)"}),"\n",(0,a.jsx)(n.p,{children:"AWS IAM Roles for Service Accounts (IRSA) provides fine-grained IAM permissions to individual pods without using the node's IAM role."}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Issue:"})," All pods on a node share the node's IAM permissions.",(0,a.jsx)("br",{}),"\n",(0,a.jsx)(n.strong,{children:"Fix:"})," Use IRSA to assign specific IAM roles to Kubernetes ServiceAccounts."]}),"\n",(0,a.jsx)(n.h3,{id:"example-configure-irsa-on-eks",children:"Example: Configure IRSA on EKS"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Create an IAM OIDC provider for your cluster:"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"eksctl utils associate-iam-oidc-provider \\\n  --cluster my-cluster \\\n  --approve\n"})}),"\n",(0,a.jsxs)(n.ol,{start:"2",children:["\n",(0,a.jsx)(n.li,{children:"Create an IAM role with a trust policy for the ServiceAccount:"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"eksctl create iamserviceaccount \\\n  --name my-app-sa \\\n  --namespace default \\\n  --cluster my-cluster \\\n  --role-name my-app-role \\\n  --attach-policy-arn arn:aws:iam::aws:policy/AmazonS3ReadOnlyAccess \\\n  --approve\n"})}),"\n",(0,a.jsxs)(n.ol,{start:"3",children:["\n",(0,a.jsx)(n.li,{children:"Use the ServiceAccount in your pod:"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: Pod\nmetadata:\n  name: my-app\nspec:\n  serviceAccountName: my-app-sa\n  containers:\n    - name: app\n      image: my-app:latest\n"})}),"\n",(0,a.jsx)(n.p,{children:"The pod receives credentials via a projected token, not through the metadata service."}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"6-monitor-and-detect-metadata-access",children:"6. Monitor and Detect Metadata Access"}),"\n",(0,a.jsx)(n.p,{children:"Even with preventive controls, monitoring for metadata access attempts helps detect misconfigurations or attacks."}),"\n",(0,a.jsx)(n.h3,{id:"example-falco-rule-for-metadata-access",children:"Example: Falco Rule for Metadata Access"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'- rule: Detect Metadata Service Access\n  desc: Detect attempts to access cloud metadata service\n  condition: >\n    evt.type in (connect, sendto) and\n    fd.sip = "169.254.169.254" and\n    container and\n    not k8s.ns.name in (kube-system)\n  output: >\n    Metadata service access detected\n    (user=%user.name command=%proc.cmdline container=%container.name\n    namespace=%k8s.ns.name pod=%k8s.pod.name)\n  priority: WARNING\n  tags: [network, mitre_credential_access, cloud]\n'})}),"\n",(0,a.jsx)(n.h3,{id:"cloudtrail-monitoring-aws",children:"CloudTrail Monitoring (AWS)"}),"\n",(0,a.jsx)(n.p,{children:"Monitor for unusual credential usage patterns:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Look for AssumeRole events in the past hour\naws cloudtrail lookup-events \\\n  --lookup-attributes AttributeKey=EventName,AttributeValue=AssumeRole \\\n  --start-time \"$(date -u -v-1H +%Y-%m-%dT%H:%M:%SZ 2>/dev/null || date -u -d '1 hour ago' +%Y-%m-%dT%H:%M:%SZ)\"\n"})}),"\n",(0,a.jsxs)(n.p,{children:["This command works on both macOS (",(0,a.jsx)(n.code,{children:"-v-1H"}),") and Linux (",(0,a.jsx)(n.code,{children:"-d '1 hour ago'"}),")."]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,a.jsx)(n.p,{children:"To prevent cloud metadata service abuse in Kubernetes:"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Control"}),(0,a.jsx)(n.th,{children:"AWS"}),(0,a.jsx)(n.th,{children:"GCP"}),(0,a.jsx)(n.th,{children:"Azure"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.strong,{children:"Block via NetworkPolicy"})}),(0,a.jsx)(n.td,{children:"Yes"}),(0,a.jsx)(n.td,{children:"Yes"}),(0,a.jsx)(n.td,{children:"Yes"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.strong,{children:"Require token-based IMDS"})}),(0,a.jsx)(n.td,{children:"IMDSv2 with hop limit 1"}),(0,a.jsx)(n.td,{children:"N/A"}),(0,a.jsx)(n.td,{children:"N/A"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.strong,{children:"Workload Identity"})}),(0,a.jsx)(n.td,{children:"IRSA"}),(0,a.jsx)(n.td,{children:"Workload Identity"}),(0,a.jsx)(n.td,{children:"Workload Identity"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.strong,{children:"Block at node level"})}),(0,a.jsx)(n.td,{children:"Hop limit"}),(0,a.jsx)(n.td,{children:"GKE_METADATA"}),(0,a.jsx)(n.td,{children:"N/A"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.strong,{children:"Monitoring"})}),(0,a.jsx)(n.td,{children:"CloudTrail"}),(0,a.jsx)(n.td,{children:"Cloud Audit Logs"}),(0,a.jsx)(n.td,{children:"Azure Monitor"})]})]})]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Defense in depth approach:"})}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["Apply NetworkPolicies to block egress to ",(0,a.jsx)(n.code,{children:"169.254.169.254"})]}),"\n",(0,a.jsx)(n.li,{children:"Use cloud-native workload identity (IRSA, GCP Workload Identity, Azure Workload Identity)"}),"\n",(0,a.jsx)(n.li,{children:"Configure IMDSv2 with hop limit 1 on AWS"}),"\n",(0,a.jsx)(n.li,{children:"Monitor for metadata access attempts with Falco and cloud audit logs"}),"\n",(0,a.jsx)(n.li,{children:"Apply least-privilege IAM policies to workload identities"}),"\n"]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,a.jsx)(n.p,{children:"This article is based on information from the following official sources:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/configuring-instance-metadata-service.html",children:"Use IMDSv2"})," - AWS Documentation"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"https://cloud.google.com/kubernetes-engine/docs/concepts/workload-identity",children:"Workload Identity"})," - Google Cloud Documentation"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/aks/workload-identity-overview",children:"Azure Workload Identity"})," - Microsoft Azure Documentation"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts.html",children:"IAM Roles for Service Accounts"})," - AWS EKS Documentation"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"https://kubernetes.io/docs/concepts/services-networking/network-policies/",children:"Network Policies"})," - Kubernetes Documentation"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}},8453(e,n,t){t.d(n,{R:()=>r,x:()=>o});var s=t(6540);const a={},i=s.createContext(a);function r(e){const n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);