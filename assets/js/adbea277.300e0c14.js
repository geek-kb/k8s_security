"use strict";(globalThis.webpackChunkk_8_s_security=globalThis.webpackChunkk_8_s_security||[]).push([[7220],{1593(e,n,s){s.r(n),s.d(n,{assets:()=>r,contentTitle:()=>l,default:()=>d,frontMatter:()=>t,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"best-practices/cluster-setup-and-hardening/configuration-validation/cnspec","title":"cnspec","description":"cnspec is a cloud-native security scanner from Mondoo that assesses Kubernetes clusters, containers, and infrastructure against security policies and compliance frameworks.","source":"@site/docs/best-practices/cluster-setup-and-hardening/configuration-validation/cnspec.md","sourceDirName":"best-practices/cluster-setup-and-hardening/configuration-validation","slug":"/best-practices/cluster-setup-and-hardening/configuration-validation/cnspec","permalink":"/kubernetes-security/best-practices/cluster-setup-and-hardening/configuration-validation/cnspec","draft":false,"unlisted":false,"editUrl":"https://github.com/geek-kb/k8s_security/edit/main/docs/best-practices/cluster-setup-and-hardening/configuration-validation/cnspec.md","tags":[{"inline":true,"label":"tool","permalink":"/kubernetes-security/tags/tool"},{"inline":true,"label":"configuration-validation","permalink":"/kubernetes-security/tags/configuration-validation"},{"inline":true,"label":"compliance","permalink":"/kubernetes-security/tags/compliance"},{"inline":true,"label":"CKS","permalink":"/kubernetes-security/tags/cks"}],"version":"current","lastUpdatedBy":"Itai Ganot","lastUpdatedAt":1771236448000,"sidebarPosition":8,"frontMatter":{"sidebar_position":8,"title":"cnspec","description":"cnspec is a cloud-native security scanner from Mondoo that assesses Kubernetes clusters, containers, and infrastructure against security policies and compliance frameworks.","keywords":["kubernetes security tool","cnspec","mondoo","security scanning","compliance","vulnerability assessment","policy as code","cloud security","container security","CKS"],"tags":["tool","configuration-validation","compliance","CKS"],"related":["/kubernetes-security/best-practices/cluster-setup-and-hardening/configuration-validation/kubescape/","/kubernetes-security/best-practices/cluster-setup-and-hardening/cis/cis-benchmark-kube-bench/","/kubernetes-security/best-practices/supply-chain-security/supply-chain-best-practices/"]},"sidebar":"default","previous":{"title":"Checkov","permalink":"/kubernetes-security/best-practices/cluster-setup-and-hardening/configuration-validation/checkov"},"next":{"title":"kube-scan","permalink":"/kubernetes-security/best-practices/cluster-setup-and-hardening/configuration-validation/kube-scan"}}');var c=s(4848),a=s(8453);const t={sidebar_position:8,title:"cnspec",description:"cnspec is a cloud-native security scanner from Mondoo that assesses Kubernetes clusters, containers, and infrastructure against security policies and compliance frameworks.",keywords:["kubernetes security tool","cnspec","mondoo","security scanning","compliance","vulnerability assessment","policy as code","cloud security","container security","CKS"],tags:["tool","configuration-validation","compliance","CKS"],related:["/kubernetes-security/best-practices/cluster-setup-and-hardening/configuration-validation/kubescape/","/kubernetes-security/best-practices/cluster-setup-and-hardening/cis/cis-benchmark-kube-bench/","/kubernetes-security/best-practices/supply-chain-security/supply-chain-best-practices/"]},l="cnspec",r={},o=[{value:"Use Cases",id:"use-cases",level:2},{value:"Installation",id:"installation",level:2},{value:"Using Package Manager",id:"using-package-manager",level:3},{value:"Using Docker",id:"using-docker",level:3},{value:"Scanning Kubernetes",id:"scanning-kubernetes",level:2},{value:"Scan a Running Cluster",id:"scan-a-running-cluster",level:3},{value:"Scan with Specific Kubeconfig",id:"scan-with-specific-kubeconfig",level:3},{value:"Scan Specific Namespace",id:"scan-specific-namespace",level:3},{value:"Scan Kubernetes Manifest Files",id:"scan-kubernetes-manifest-files",level:3},{value:"Scan with Custom Policy",id:"scan-with-custom-policy",level:3},{value:"Scanning Container Images",id:"scanning-container-images",level:2},{value:"Scan a Container Image",id:"scan-a-container-image",level:3},{value:"Scan Multiple Images",id:"scan-multiple-images",level:3},{value:"Scan Image from Registry",id:"scan-image-from-registry",level:3},{value:"Built-in Policies",id:"built-in-policies",level:2},{value:"List Available Policies",id:"list-available-policies",level:3},{value:"Scan Against CIS Kubernetes Benchmark",id:"scan-against-cis-kubernetes-benchmark",level:3},{value:"Scan Against NSA Kubernetes Hardening Guide",id:"scan-against-nsa-kubernetes-hardening-guide",level:3},{value:"Custom Policies with MQL",id:"custom-policies-with-mql",level:2},{value:"Example Policy File (my-policy.mql.yaml)",id:"example-policy-file-my-policymqlyaml",level:3},{value:"Apply Custom Policy",id:"apply-custom-policy",level:3},{value:"Output Formats",id:"output-formats",level:2},{value:"JSON Output",id:"json-output",level:3},{value:"YAML Output",id:"yaml-output",level:3},{value:"JUnit Output (for CI/CD)",id:"junit-output-for-cicd",level:3},{value:"SARIF Output (for GitHub Security)",id:"sarif-output-for-github-security",level:3},{value:"CI/CD Integration",id:"cicd-integration",level:2},{value:"GitHub Actions Example",id:"github-actions-example",level:3},{value:"GitLab CI Example",id:"gitlab-ci-example",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"References",id:"references",level:2}];function u(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.header,{children:(0,c.jsx)(n.h1,{id:"cnspec",children:"cnspec"})}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.strong,{children:"cnspec"})," is an open-source cloud-native security scanner developed by Mondoo. It assesses Kubernetes clusters, container images, infrastructure configurations, and cloud resources against security policies and compliance frameworks. cnspec uses a policy-as-code approach with MQL (Mondoo Query Language) to define security checks."]}),"\n",(0,c.jsx)(n.p,{children:"The tool supports multiple targets including Kubernetes manifests, running clusters, container images, cloud platforms (AWS, GCP, Azure), and operating systems."}),"\n",(0,c.jsx)(n.hr,{}),"\n",(0,c.jsx)(n.h2,{id:"use-cases",children:"Use Cases"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"Scan Kubernetes clusters for security misconfigurations."}),"\n",(0,c.jsx)(n.li,{children:"Assess container images for vulnerabilities and hardening issues."}),"\n",(0,c.jsx)(n.li,{children:"Evaluate compliance against CIS Benchmarks, SOC 2, PCI-DSS, and other frameworks."}),"\n",(0,c.jsx)(n.li,{children:"Integrate security scanning into CI/CD pipelines."}),"\n",(0,c.jsx)(n.li,{children:"Audit cloud infrastructure (AWS, GCP, Azure) alongside Kubernetes."}),"\n"]}),"\n",(0,c.jsx)(n.hr,{}),"\n",(0,c.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,c.jsx)(n.h3,{id:"using-package-manager",children:"Using Package Manager"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:'# macOS\nbrew install mondoolabs/mondoo/cnspec\n\n# Linux (via script)\nbash -c "$(curl -sSL https://install.mondoo.com/sh)"\n'})}),"\n",(0,c.jsx)(n.h3,{id:"using-docker",children:"Using Docker"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"docker run --rm mondoo/cnspec scan local\n"})}),"\n",(0,c.jsx)(n.hr,{}),"\n",(0,c.jsx)(n.h2,{id:"scanning-kubernetes",children:"Scanning Kubernetes"}),"\n",(0,c.jsx)(n.h3,{id:"scan-a-running-cluster",children:"Scan a Running Cluster"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"cnspec scan k8s\n"})}),"\n",(0,c.jsx)(n.h3,{id:"scan-with-specific-kubeconfig",children:"Scan with Specific Kubeconfig"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"cnspec scan k8s --kubeconfig ~/.kube/config\n"})}),"\n",(0,c.jsx)(n.h3,{id:"scan-specific-namespace",children:"Scan Specific Namespace"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"cnspec scan k8s --namespace production\n"})}),"\n",(0,c.jsx)(n.h3,{id:"scan-kubernetes-manifest-files",children:"Scan Kubernetes Manifest Files"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"cnspec scan k8s --path ./manifests/\n"})}),"\n",(0,c.jsx)(n.h3,{id:"scan-with-custom-policy",children:"Scan with Custom Policy"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"cnspec scan k8s --policy-bundle my-policies.mql.yaml\n"})}),"\n",(0,c.jsx)(n.hr,{}),"\n",(0,c.jsx)(n.h2,{id:"scanning-container-images",children:"Scanning Container Images"}),"\n",(0,c.jsx)(n.h3,{id:"scan-a-container-image",children:"Scan a Container Image"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"cnspec scan container image nginx:latest\n"})}),"\n",(0,c.jsx)(n.h3,{id:"scan-multiple-images",children:"Scan Multiple Images"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"cnspec scan container image alpine:3.18 ubuntu:22.04 python:3.11\n"})}),"\n",(0,c.jsx)(n.h3,{id:"scan-image-from-registry",children:"Scan Image from Registry"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"cnspec scan container image gcr.io/my-project/my-app:v1.2.3\n"})}),"\n",(0,c.jsx)(n.hr,{}),"\n",(0,c.jsx)(n.h2,{id:"built-in-policies",children:"Built-in Policies"}),"\n",(0,c.jsx)(n.p,{children:"cnspec includes policies for various compliance frameworks:"}),"\n",(0,c.jsx)(n.h3,{id:"list-available-policies",children:"List Available Policies"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"cnspec policy list\n"})}),"\n",(0,c.jsx)(n.h3,{id:"scan-against-cis-kubernetes-benchmark",children:"Scan Against CIS Kubernetes Benchmark"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"cnspec scan k8s --policy mondoo-kubernetes-security\n"})}),"\n",(0,c.jsx)(n.h3,{id:"scan-against-nsa-kubernetes-hardening-guide",children:"Scan Against NSA Kubernetes Hardening Guide"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"cnspec scan k8s --policy nsa-cisa-kubernetes-hardening\n"})}),"\n",(0,c.jsx)(n.hr,{}),"\n",(0,c.jsx)(n.h2,{id:"custom-policies-with-mql",children:"Custom Policies with MQL"}),"\n",(0,c.jsx)(n.p,{children:"Create custom security policies using Mondoo Query Language:"}),"\n",(0,c.jsx)(n.h3,{id:"example-policy-file-my-policymqlyaml",children:"Example Policy File (my-policy.mql.yaml)"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-yaml",children:"policies:\n  - uid: my-k8s-security-policy\n    name: My Kubernetes Security Policy\n    version: 1.0.0\n    groups:\n      - title: Pod Security\n        checks:\n          - uid: no-privileged-containers\n            title: Containers should not run as privileged\n            mql: |\n              k8s.pods.all(\n                containers.all(\n                  securityContext.privileged != true\n                )\n              )\n          - uid: no-host-network\n            title: Pods should not use host network\n            mql: |\n              k8s.pods.all(\n                spec.hostNetwork != true\n              )\n          - uid: resource-limits-set\n            title: Containers must have resource limits\n            mql: |\n              k8s.pods.all(\n                containers.all(\n                  resources.limits != empty\n                )\n              )\n"})}),"\n",(0,c.jsx)(n.h3,{id:"apply-custom-policy",children:"Apply Custom Policy"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"cnspec scan k8s --policy-bundle my-policy.mql.yaml\n"})}),"\n",(0,c.jsx)(n.hr,{}),"\n",(0,c.jsx)(n.h2,{id:"output-formats",children:"Output Formats"}),"\n",(0,c.jsx)(n.h3,{id:"json-output",children:"JSON Output"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"cnspec scan k8s -o json > results.json\n"})}),"\n",(0,c.jsx)(n.h3,{id:"yaml-output",children:"YAML Output"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"cnspec scan k8s -o yaml > results.yaml\n"})}),"\n",(0,c.jsx)(n.h3,{id:"junit-output-for-cicd",children:"JUnit Output (for CI/CD)"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"cnspec scan k8s -o junit > results.xml\n"})}),"\n",(0,c.jsx)(n.h3,{id:"sarif-output-for-github-security",children:"SARIF Output (for GitHub Security)"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"cnspec scan k8s -o sarif > results.sarif\n"})}),"\n",(0,c.jsx)(n.hr,{}),"\n",(0,c.jsx)(n.h2,{id:"cicd-integration",children:"CI/CD Integration"}),"\n",(0,c.jsx)(n.h3,{id:"github-actions-example",children:"GitHub Actions Example"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-yaml",children:'name: Security Scan\non: [push, pull_request]\n\njobs:\n  cnspec-scan:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n      \n      - name: Install cnspec\n        run: bash -c "$(curl -sSL https://install.mondoo.com/sh)"\n      \n      - name: Scan Kubernetes manifests\n        run: cnspec scan k8s --path ./kubernetes/ -o sarif > results.sarif\n      \n      - name: Upload results to GitHub Security\n        uses: github/codeql-action/upload-sarif@v2\n        with:\n          sarif_file: results.sarif\n'})}),"\n",(0,c.jsx)(n.h3,{id:"gitlab-ci-example",children:"GitLab CI Example"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-yaml",children:"cnspec-scan:\n  stage: security\n  image: mondoo/cnspec:latest\n  script:\n    - cnspec scan k8s --path ./manifests/ --score-threshold 80\n  artifacts:\n    reports:\n      junit: results.xml\n"})}),"\n",(0,c.jsx)(n.hr,{}),"\n",(0,c.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Integrate early:"})," Scan manifests during development, not just at deployment."]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Use score thresholds:"})," Fail builds when security score drops below acceptable levels."]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Create custom policies:"})," Extend built-in policies with organization-specific requirements."]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Scan regularly:"})," Run periodic scans against production clusters to detect drift."]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Combine with vulnerability scanning:"})," Use cnspec alongside image vulnerability scanners."]}),"\n"]}),"\n",(0,c.jsx)(n.hr,{}),"\n",(0,c.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,c.jsx)(n.p,{children:"This article is based on information from the following official sources:"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.a,{href:"https://mondoo.com/docs/cnspec/",children:"cnspec Documentation"})," - Mondoo"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.a,{href:"https://github.com/mondoohq/cnspec",children:"cnspec GitHub Repository"})," - GitHub"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.a,{href:"https://mondoo.com/docs/mql/",children:"Mondoo Query Language Reference"})," - Mondoo"]}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(u,{...e})}):u(e)}},8453(e,n,s){s.d(n,{R:()=>t,x:()=>l});var i=s(6540);const c={},a=i.createContext(c);function t(e){const n=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:t(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);