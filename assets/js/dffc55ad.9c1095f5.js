"use strict";(globalThis.webpackChunkk_8_s_security=globalThis.webpackChunkk_8_s_security||[]).push([[7017],{8453(e,t,r){r.d(t,{R:()=>c,x:()=>l});var n=r(6540);const s={},a=n.createContext(s);function c(e){const t=n.useContext(a);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),n.createElement(a.Provider,{value:t},e.children)}},8840(e,t,r){r.r(t),r.d(t,{assets:()=>i,contentTitle:()=>l,default:()=>u,frontMatter:()=>c,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"best_practices/cluster_setup_and_hardening/secrets_management/kubernetes_external_secrets","title":"Kubernetes External Secrets","description":"Kubernetes External Secrets Operator synchronizes secrets from external providers like AWS Secrets Manager, HashiCorp Vault, and Azure Key Vault into Kubernetes.","source":"@site/docs/best_practices/cluster_setup_and_hardening/secrets_management/kubernetes_external_secrets.md","sourceDirName":"best_practices/cluster_setup_and_hardening/secrets_management","slug":"/best_practices/cluster_setup_and_hardening/secrets_management/kubernetes_external_secrets","permalink":"/docs/best_practices/cluster_setup_and_hardening/secrets_management/kubernetes_external_secrets","draft":false,"unlisted":false,"editUrl":"https://github.com/geek-kb/k8s_security/edit/main/docs/best_practices/cluster_setup_and_hardening/secrets_management/kubernetes_external_secrets.md","tags":[{"inline":true,"label":"tool","permalink":"/docs/tags/tool"},{"inline":true,"label":"secrets-management","permalink":"/docs/tags/secrets-management"},{"inline":true,"label":"CKS","permalink":"/docs/tags/cks"}],"version":"current","lastUpdatedBy":"Itai Ganot","lastUpdatedAt":1771232119000,"sidebarPosition":4,"frontMatter":{"sidebar_position":4,"title":"Kubernetes External Secrets","description":"Kubernetes External Secrets Operator synchronizes secrets from external providers like AWS Secrets Manager, HashiCorp Vault, and Azure Key Vault into Kubernetes.","keywords":["kubernetes security tool","external secrets","secrets management","AWS secrets manager","hashicorp vault","azure key vault","secret synchronization","kubernetes secrets","CKS"],"tags":["tool","secrets-management","CKS"],"related":["/docs/best_practices/cluster_setup_and_hardening/secrets_management/vault_secrets_operator/","/docs/best_practices/cluster_setup_and_hardening/secrets_management/sealed_secrets/","/docs/best_practices/cluster_setup_and_hardening/secrets_management/insecure_secrets_management_mitigation/"]},"sidebar":"default","previous":{"title":"Mozilla SOPS","permalink":"/docs/best_practices/cluster_setup_and_hardening/secrets_management/mozilla_sops"},"next":{"title":"Vault Secrets Operator","permalink":"/docs/best_practices/cluster_setup_and_hardening/secrets_management/vault_secrets_operator"}}');var s=r(4848),a=r(8453);const c={sidebar_position:4,title:"Kubernetes External Secrets",description:"Kubernetes External Secrets Operator synchronizes secrets from external providers like AWS Secrets Manager, HashiCorp Vault, and Azure Key Vault into Kubernetes.",keywords:["kubernetes security tool","external secrets","secrets management","AWS secrets manager","hashicorp vault","azure key vault","secret synchronization","kubernetes secrets","CKS"],tags:["tool","secrets-management","CKS"],related:["/docs/best_practices/cluster_setup_and_hardening/secrets_management/vault_secrets_operator/","/docs/best_practices/cluster_setup_and_hardening/secrets_management/sealed_secrets/","/docs/best_practices/cluster_setup_and_hardening/secrets_management/insecure_secrets_management_mitigation/"]},l="Kubernetes External Secrets",i={},d=[{value:"Supported Providers",id:"supported-providers",level:2},{value:"Installation",id:"installation",level:2},{value:"Using Helm",id:"using-helm",level:3},{value:"Using kubectl",id:"using-kubectl",level:3},{value:"Core Concepts",id:"core-concepts",level:2},{value:"SecretStore",id:"secretstore",level:3},{value:"ClusterSecretStore",id:"clustersecretstore",level:3},{value:"ExternalSecret",id:"externalsecret",level:3},{value:"Provider Configuration Examples",id:"provider-configuration-examples",level:2},{value:"AWS Secrets Manager",id:"aws-secrets-manager",level:3},{value:"HashiCorp Vault",id:"hashicorp-vault",level:3},{value:"Azure Key Vault",id:"azure-key-vault",level:3},{value:"GCP Secret Manager",id:"gcp-secret-manager",level:3},{value:"Advanced Features",id:"advanced-features",level:2},{value:"Secret Templates",id:"secret-templates",level:3},{value:"Refresh Intervals",id:"refresh-intervals",level:3},{value:"Data From Multiple Keys",id:"data-from-multiple-keys",level:3},{value:"Security Best Practices",id:"security-best-practices",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Check ExternalSecret Status",id:"check-externalsecret-status",level:3},{value:"View Operator Logs",id:"view-operator-logs",level:3},{value:"Verify Synced Secret",id:"verify-synced-secret",level:3},{value:"References",id:"references",level:2}];function o(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"kubernetes-external-secrets",children:"Kubernetes External Secrets"})}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"External Secrets Operator"})," (ESO) is a Kubernetes operator that synchronizes secrets from external secret management systems into Kubernetes Secrets. It supports multiple backends including AWS Secrets Manager, HashiCorp Vault, Azure Key Vault, GCP Secret Manager, and many others."]}),"\n",(0,s.jsx)(t.p,{children:"This approach centralizes secret management in enterprise-grade secret stores while making secrets available to Kubernetes workloads through the native Secret API."}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsx)(t.h2,{id:"supported-providers",children:"Supported Providers"}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Provider"}),(0,s.jsx)(t.th,{children:"Description"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"AWS Secrets Manager"}),(0,s.jsx)(t.td,{children:"AWS managed secrets service"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"AWS Parameter Store"}),(0,s.jsx)(t.td,{children:"AWS Systems Manager Parameter Store"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"HashiCorp Vault"}),(0,s.jsx)(t.td,{children:"Self-hosted or HCP Vault"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Azure Key Vault"}),(0,s.jsx)(t.td,{children:"Azure managed secrets service"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"GCP Secret Manager"}),(0,s.jsx)(t.td,{children:"Google Cloud secrets service"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Akeyless"}),(0,s.jsx)(t.td,{children:"Akeyless Vaultless Platform"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"1Password"}),(0,s.jsx)(t.td,{children:"1Password secrets automation"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Doppler"}),(0,s.jsx)(t.td,{children:"Doppler SecretOps platform"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"GitLab"}),(0,s.jsx)(t.td,{children:"GitLab CI/CD variables"})]})]})]}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsx)(t.h2,{id:"installation",children:"Installation"}),"\n",(0,s.jsx)(t.h3,{id:"using-helm",children:"Using Helm"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"helm repo add external-secrets https://charts.external-secrets.io\nhelm install external-secrets external-secrets/external-secrets \\\n  --namespace external-secrets \\\n  --create-namespace\n"})}),"\n",(0,s.jsx)(t.h3,{id:"using-kubectl",children:"Using kubectl"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"kubectl apply -f https://raw.githubusercontent.com/external-secrets/external-secrets/main/deploy/crds/bundle.yaml\nkubectl apply -f https://raw.githubusercontent.com/external-secrets/external-secrets/main/deploy/install.yaml\n"})}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsx)(t.h2,{id:"core-concepts",children:"Core Concepts"}),"\n",(0,s.jsx)(t.h3,{id:"secretstore",children:"SecretStore"}),"\n",(0,s.jsx)(t.p,{children:"Defines how to connect to a secret provider (namespace-scoped):"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-yaml",children:"apiVersion: external-secrets.io/v1beta1\nkind: SecretStore\nmetadata:\n  name: aws-secrets-manager\n  namespace: production\nspec:\n  provider:\n    aws:\n      service: SecretsManager\n      region: us-west-2\n      auth:\n        secretRef:\n          accessKeyIDSecretRef:\n            name: aws-credentials\n            key: access-key\n          secretAccessKeySecretRef:\n            name: aws-credentials\n            key: secret-key\n"})}),"\n",(0,s.jsx)(t.h3,{id:"clustersecretstore",children:"ClusterSecretStore"}),"\n",(0,s.jsx)(t.p,{children:"Cluster-wide secret store available to all namespaces:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-yaml",children:'apiVersion: external-secrets.io/v1beta1\nkind: ClusterSecretStore\nmetadata:\n  name: vault-backend\nspec:\n  provider:\n    vault:\n      server: "https://vault.example.com"\n      path: "secret"\n      version: "v2"\n      auth:\n        kubernetes:\n          mountPath: "kubernetes"\n          role: "external-secrets"\n'})}),"\n",(0,s.jsx)(t.h3,{id:"externalsecret",children:"ExternalSecret"}),"\n",(0,s.jsx)(t.p,{children:"Defines which secrets to sync:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-yaml",children:"apiVersion: external-secrets.io/v1beta1\nkind: ExternalSecret\nmetadata:\n  name: database-credentials\n  namespace: production\nspec:\n  refreshInterval: 1h\n  secretStoreRef:\n    name: aws-secrets-manager\n    kind: SecretStore\n  target:\n    name: database-secret\n    creationPolicy: Owner\n  data:\n    - secretKey: username\n      remoteRef:\n        key: production/database\n        property: username\n    - secretKey: password\n      remoteRef:\n        key: production/database\n        property: password\n"})}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsx)(t.h2,{id:"provider-configuration-examples",children:"Provider Configuration Examples"}),"\n",(0,s.jsx)(t.h3,{id:"aws-secrets-manager",children:"AWS Secrets Manager"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-yaml",children:"apiVersion: external-secrets.io/v1beta1\nkind: SecretStore\nmetadata:\n  name: aws-secretsmanager\nspec:\n  provider:\n    aws:\n      service: SecretsManager\n      region: us-west-2\n      auth:\n        jwt:\n          serviceAccountRef:\n            name: external-secrets-sa\n---\napiVersion: external-secrets.io/v1beta1\nkind: ExternalSecret\nmetadata:\n  name: api-keys\nspec:\n  secretStoreRef:\n    name: aws-secretsmanager\n    kind: SecretStore\n  target:\n    name: api-keys\n  data:\n    - secretKey: api-key\n      remoteRef:\n        key: production/api-keys\n        property: api-key\n"})}),"\n",(0,s.jsx)(t.h3,{id:"hashicorp-vault",children:"HashiCorp Vault"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-yaml",children:'apiVersion: external-secrets.io/v1beta1\nkind: SecretStore\nmetadata:\n  name: vault-backend\nspec:\n  provider:\n    vault:\n      server: "https://vault.example.com"\n      path: "secret"\n      version: "v2"\n      auth:\n        kubernetes:\n          mountPath: "kubernetes"\n          role: "external-secrets"\n          serviceAccountRef:\n            name: external-secrets\n---\napiVersion: external-secrets.io/v1beta1\nkind: ExternalSecret\nmetadata:\n  name: vault-secret\nspec:\n  secretStoreRef:\n    name: vault-backend\n    kind: SecretStore\n  target:\n    name: my-secret\n  data:\n    - secretKey: password\n      remoteRef:\n        key: secret/data/myapp\n        property: password\n'})}),"\n",(0,s.jsx)(t.h3,{id:"azure-key-vault",children:"Azure Key Vault"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-yaml",children:'apiVersion: external-secrets.io/v1beta1\nkind: SecretStore\nmetadata:\n  name: azure-keyvault\nspec:\n  provider:\n    azurekv:\n      vaultUrl: "https://my-keyvault.vault.azure.net"\n      authType: ManagedIdentity\n      identityId: "client-id-of-managed-identity"\n---\napiVersion: external-secrets.io/v1beta1\nkind: ExternalSecret\nmetadata:\n  name: azure-secret\nspec:\n  secretStoreRef:\n    name: azure-keyvault\n    kind: SecretStore\n  target:\n    name: my-azure-secret\n  data:\n    - secretKey: connection-string\n      remoteRef:\n        key: database-connection-string\n'})}),"\n",(0,s.jsx)(t.h3,{id:"gcp-secret-manager",children:"GCP Secret Manager"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-yaml",children:"apiVersion: external-secrets.io/v1beta1\nkind: SecretStore\nmetadata:\n  name: gcp-secretmanager\nspec:\n  provider:\n    gcpsm:\n      projectID: my-gcp-project\n      auth:\n        workloadIdentity:\n          clusterLocation: us-central1\n          clusterName: my-cluster\n          serviceAccountRef:\n            name: external-secrets-sa\n---\napiVersion: external-secrets.io/v1beta1\nkind: ExternalSecret\nmetadata:\n  name: gcp-secret\nspec:\n  secretStoreRef:\n    name: gcp-secretmanager\n    kind: SecretStore\n  target:\n    name: my-gcp-secret\n  data:\n    - secretKey: api-key\n      remoteRef:\n        key: api-key\n        version: latest\n"})}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsx)(t.h2,{id:"advanced-features",children:"Advanced Features"}),"\n",(0,s.jsx)(t.h3,{id:"secret-templates",children:"Secret Templates"}),"\n",(0,s.jsx)(t.p,{children:"Transform secrets during synchronization:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-yaml",children:'apiVersion: external-secrets.io/v1beta1\nkind: ExternalSecret\nmetadata:\n  name: templated-secret\nspec:\n  secretStoreRef:\n    name: vault-backend\n    kind: SecretStore\n  target:\n    name: database-url\n    template:\n      type: Opaque\n      data:\n        DATABASE_URL: "postgresql://{{ .username }}:{{ .password }}@db.example.com:5432/mydb"\n  data:\n    - secretKey: username\n      remoteRef:\n        key: secret/data/database\n        property: username\n    - secretKey: password\n      remoteRef:\n        key: secret/data/database\n        property: password\n'})}),"\n",(0,s.jsx)(t.h3,{id:"refresh-intervals",children:"Refresh Intervals"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-yaml",children:"spec:\n  refreshInterval: 15m  # Sync every 15 minutes\n"})}),"\n",(0,s.jsx)(t.h3,{id:"data-from-multiple-keys",children:"Data From Multiple Keys"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-yaml",children:"spec:\n  dataFrom:\n    - extract:\n        key: production/all-secrets\n"})}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsx)(t.h2,{id:"security-best-practices",children:"Security Best Practices"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Use workload identity:"})," Prefer Kubernetes service account authentication over static credentials."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Scope SecretStores:"})," Use namespace-scoped SecretStore instead of ClusterSecretStore when possible."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Enable audit logging:"})," Track secret access in both Kubernetes and the external provider."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Set appropriate refresh intervals:"})," Balance security (frequent rotation) with provider API limits."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Use RBAC:"})," Restrict which namespaces can reference ClusterSecretStores."]}),"\n"]}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsx)(t.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,s.jsx)(t.h3,{id:"check-externalsecret-status",children:"Check ExternalSecret Status"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"kubectl get externalsecret database-credentials -n production\nkubectl describe externalsecret database-credentials -n production\n"})}),"\n",(0,s.jsx)(t.h3,{id:"view-operator-logs",children:"View Operator Logs"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"kubectl logs -n external-secrets -l app.kubernetes.io/name=external-secrets\n"})}),"\n",(0,s.jsx)(t.h3,{id:"verify-synced-secret",children:"Verify Synced Secret"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"kubectl get secret database-secret -n production -o yaml\n"})}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsx)(t.h2,{id:"references",children:"References"}),"\n",(0,s.jsx)(t.p,{children:"This article is based on information from the following official sources:"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.a,{href:"https://external-secrets.io/",children:"External Secrets Operator Documentation"})," - External Secrets"]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.a,{href:"https://github.com/external-secrets/external-secrets",children:"External Secrets GitHub Repository"})," - GitHub"]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.a,{href:"https://docs.aws.amazon.com/secretsmanager/",children:"AWS Secrets Manager"})," - AWS Documentation"]}),"\n"]})]})}function u(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}}}]);