"use strict";(self.webpackChunkk_8_s_security=self.webpackChunkk_8_s_security||[]).push([[7272],{78:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"k8s_security_basics/attack_vectors_examples/exposed_dashboard","title":"Exposed Kubernetes Dashboard","description":"Exploiting an exposed Kubernetes Dashboard and implementing best practices to secure dashboard access.","source":"@site/docs/k8s_security_basics/attack_vectors_examples/exposed_dashboard.md","sourceDirName":"k8s_security_basics/attack_vectors_examples","slug":"/k8s_security_basics/attack_vectors_examples/exposed_dashboard","permalink":"/k8s_security/docs/k8s_security_basics/attack_vectors_examples/exposed_dashboard","draft":false,"unlisted":false,"editUrl":"https://github.com/geek-kb/k8s_security/edit/main/docs/k8s_security_basics/attack_vectors_examples/exposed_dashboard.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"Exposed Kubernetes Dashboard","description":"Exploiting an exposed Kubernetes Dashboard and implementing best practices to secure dashboard access."},"sidebar":"tutorialSidebar","previous":{"title":"Compromised API Server","permalink":"/k8s_security/docs/k8s_security_basics/attack_vectors_examples/compromised_api_server"},"next":{"title":"Privileged Containers","permalink":"/k8s_security/docs/k8s_security_basics/attack_vectors_examples/privileged_containers"}}');var t=n(4848),i=n(8453);const a={sidebar_position:2,title:"Exposed Kubernetes Dashboard",description:"Exploiting an exposed Kubernetes Dashboard and implementing best practices to secure dashboard access."},o="Exposed Kubernetes Dashboard",c={},d=[{value:"\ud83d\udea9 Exploitation Steps: Exposed Dashboard",id:"-exploitation-steps-exposed-dashboard",level:2},{value:"1. Access the Dashboard Without Authentication",id:"1-access-the-dashboard-without-authentication",level:3},{value:"2. Execute Commands in the Cluster",id:"2-execute-commands-in-the-cluster",level:3},{value:"3. Create a New Admin User",id:"3-create-a-new-admin-user",level:3},{value:"\u2705 Result",id:"-result",level:3},{value:"\ud83d\udee1\ufe0f Mitigation Techniques and Fixes",id:"\ufe0f-mitigation-techniques-and-fixes",level:2},{value:"1. Avoid Exposing the Dashboard Publicly",id:"1-avoid-exposing-the-dashboard-publicly",level:3},{value:"\u2705 Secure Access with Port Forwarding",id:"-secure-access-with-port-forwarding",level:4},{value:"2. Enforce Authentication",id:"2-enforce-authentication",level:3},{value:"\u2705 Enable Authentication via Service Account Token",id:"-enable-authentication-via-service-account-token",level:4},{value:"3. Restrict Dashboard Privileges",id:"3-restrict-dashboard-privileges",level:3},{value:"\u2705 Create a Restricted Role for the Dashboard",id:"-create-a-restricted-role-for-the-dashboard",level:4},{value:"\u2705 Key Takeaway",id:"-key-takeaway",level:2}];function l(e){const s={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.header,{children:(0,t.jsx)(s.h1,{id:"exposed-kubernetes-dashboard",children:"Exposed Kubernetes Dashboard"})}),"\n",(0,t.jsxs)(s.p,{children:["The ",(0,t.jsx)(s.strong,{children:"Kubernetes Dashboard"})," is a powerful tool for ",(0,t.jsx)(s.strong,{children:"managing Kubernetes clusters"}),", but if ",(0,t.jsx)(s.strong,{children:"improperly secured"}),", it can become a significant ",(0,t.jsx)(s.strong,{children:"attack vector"}),". An ",(0,t.jsx)(s.strong,{children:"exposed dashboard"})," with ",(0,t.jsx)(s.strong,{children:"admin privileges"})," and ",(0,t.jsx)(s.strong,{children:"no authentication"})," can allow an attacker to ",(0,t.jsx)(s.strong,{children:"gain full control"})," over the cluster."]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h2,{id:"-exploitation-steps-exposed-dashboard",children:"\ud83d\udea9 Exploitation Steps: Exposed Dashboard"}),"\n",(0,t.jsxs)(s.p,{children:["An attacker scans for an ",(0,t.jsx)(s.strong,{children:"open Kubernetes Dashboard"})," using a ",(0,t.jsx)(s.strong,{children:"port scan"}),":"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"nmap -p 30000-32767 <cluster-ip>\n"})}),"\n",(0,t.jsx)(s.h3,{id:"1-access-the-dashboard-without-authentication",children:"1. Access the Dashboard Without Authentication"}),"\n",(0,t.jsxs)(s.p,{children:["The ",(0,t.jsx)(s.strong,{children:"attacker"})," finds the ",(0,t.jsx)(s.strong,{children:"dashboard"})," on a ",(0,t.jsx)(s.strong,{children:"NodePort"})," and ",(0,t.jsx)(s.strong,{children:"opens it"})," in a ",(0,t.jsx)(s.strong,{children:"browser"}),":"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"http://<cluster-ip>:<node-port>/\n"})}),"\n",(0,t.jsx)(s.h3,{id:"2-execute-commands-in-the-cluster",children:"2. Execute Commands in the Cluster"}),"\n",(0,t.jsxs)(s.p,{children:["The ",(0,t.jsx)(s.strong,{children:"attacker"})," uses the ",(0,t.jsx)(s.strong,{children:"dashboard's terminal"})," to ",(0,t.jsx)(s.strong,{children:"execute commands"})," in a ",(0,t.jsx)(s.strong,{children:"privileged pod"}),":"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"kubectl exec -it privileged-pod -- /bin/sh\n"})}),"\n",(0,t.jsx)(s.h3,{id:"3-create-a-new-admin-user",children:"3. Create a New Admin User"}),"\n",(0,t.jsxs)(s.p,{children:["The ",(0,t.jsx)(s.strong,{children:"attacker"})," creates a ",(0,t.jsx)(s.strong,{children:"new admin ServiceAccount"})," and ",(0,t.jsx)(s.strong,{children:"binds it"})," to the ",(0,t.jsx)(s.strong,{children:"cluster-admin role"}),":"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-yaml",children:"apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: attacker-admin\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: attacker-admin-binding\nsubjects:\n- kind: ServiceAccount\n  name: attacker-admin\n  namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: cluster-admin\n  apiGroup: rbac.authorization.k8s.io\n"})}),"\n",(0,t.jsx)(s.h3,{id:"-result",children:"\u2705 Result"}),"\n",(0,t.jsxs)(s.p,{children:["The attacker gains ",(0,t.jsx)(s.strong,{children:"admin access"})," to the cluster, allowing them to ",(0,t.jsx)(s.strong,{children:"deploy malicious workloads"}),", ",(0,t.jsx)(s.strong,{children:"exfiltrate data"}),", or ",(0,t.jsx)(s.strong,{children:"destroy resources"}),"."]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h2,{id:"\ufe0f-mitigation-techniques-and-fixes",children:"\ud83d\udee1\ufe0f Mitigation Techniques and Fixes"}),"\n",(0,t.jsx)(s.h3,{id:"1-avoid-exposing-the-dashboard-publicly",children:"1. Avoid Exposing the Dashboard Publicly"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Issue:"})," Dashboard is accessible without authentication over a ",(0,t.jsx)(s.strong,{children:"NodePort"}),"."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Fix:"})," Use a ",(0,t.jsx)(s.strong,{children:"secure network proxy"})," or ",(0,t.jsx)(s.strong,{children:"port-forwarding"})," instead."]}),"\n"]}),"\n",(0,t.jsx)(s.h4,{id:"-secure-access-with-port-forwarding",children:"\u2705 Secure Access with Port Forwarding"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"kubectl proxy\n# Access the dashboard securely\nhttp://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/\n"})}),"\n",(0,t.jsx)(s.h3,{id:"2-enforce-authentication",children:"2. Enforce Authentication"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Issue:"})," The dashboard ",(0,t.jsx)(s.strong,{children:"does not require login"}),", allowing ",(0,t.jsx)(s.strong,{children:"unauthorized access"}),"."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Fix:"})," Enable ",(0,t.jsx)(s.strong,{children:"token-based authentication"})," and ",(0,t.jsx)(s.strong,{children:"disable guest access"}),"."]}),"\n"]}),"\n",(0,t.jsx)(s.h4,{id:"-enable-authentication-via-service-account-token",children:"\u2705 Enable Authentication via Service Account Token"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"kubectl create serviceaccount dashboard-admin -n kube-system\nkubectl create clusterrolebinding dashboard-admin-binding \\\n  --clusterrole=cluster-admin \\\n  --serviceaccount=kube-system:dashboard-admin\nkubectl get secrets -n kube-system | grep dashboard-admin\nkubectl describe secret <dashboard-admin-token> -n kube-system\n"})}),"\n",(0,t.jsx)(s.h3,{id:"3-restrict-dashboard-privileges",children:"3. Restrict Dashboard Privileges"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Issue:"})," Dashboard runs with ",(0,t.jsx)(s.strong,{children:"cluster-admin privileges"}),", exposing the ",(0,t.jsx)(s.strong,{children:"entire cluster"})," to risk."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Fix:"})," Limit the ",(0,t.jsx)(s.strong,{children:"ServiceAccount permissions"})," using ",(0,t.jsx)(s.strong,{children:"RBAC"}),"."]}),"\n"]}),"\n",(0,t.jsx)(s.h4,{id:"-create-a-restricted-role-for-the-dashboard",children:"\u2705 Create a Restricted Role for the Dashboard"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-yaml",children:'apiVersion: rbac.authorization.k8s.io/v1\nkind: Role\nmetadata:\n  name: restricted-dashboard-role\n  namespace: kube-system\nrules:\n- apiGroups: [""]\n  resources: ["pods", "services"]\n  verbs: ["get", "list"]\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: RoleBinding\nmetadata:\n  name: restricted-dashboard-binding\n  namespace: kube-system\nsubjects:\n- kind: ServiceAccount\n  name: dashboard\n  namespace: kube-system\nroleRef:\n  kind: Role\n  name: restricted-dashboard-role\n  apiGroup: rbac.authorization.k8s.io\n'})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h2,{id:"-key-takeaway",children:"\u2705 Key Takeaway"}),"\n",(0,t.jsxs)(s.p,{children:["To secure the ",(0,t.jsx)(s.strong,{children:"Kubernetes Dashboard"}),":"]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Never expose"})," the dashboard ",(0,t.jsx)(s.strong,{children:"directly to the internet"}),"."]}),"\n",(0,t.jsxs)(s.li,{children:["Always ",(0,t.jsx)(s.strong,{children:"enforce authentication"})," using ",(0,t.jsx)(s.strong,{children:"Service Account tokens"}),"."]}),"\n",(0,t.jsxs)(s.li,{children:["Apply ",(0,t.jsx)(s.strong,{children:"principle of least privilege"})," by assigning ",(0,t.jsx)(s.strong,{children:"restricted roles"})," to the dashboard."]}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>a,x:()=>o});var r=n(6540);const t={},i=r.createContext(t);function a(e){const s=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),r.createElement(i.Provider,{value:s},e.children)}}}]);