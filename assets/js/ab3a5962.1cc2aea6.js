"use strict";(globalThis.webpackChunkk_8_s_security=globalThis.webpackChunkk_8_s_security||[]).push([[2216],{5008(e,a,n){n.r(a),n.d(a,{assets:()=>l,contentTitle:()=>c,default:()=>d,frontMatter:()=>i,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"best-practices/cluster-setup-and-hardening/rbac-and-identity/audit2rbac","title":"audit2rbac","description":"audit2rbac automatically generates RBAC policies from Kubernetes audit logs, enabling precise least-privilege configurations based on actual API usage.","source":"@site/docs/best-practices/cluster-setup-and-hardening/rbac-and-identity/audit2rbac.md","sourceDirName":"best-practices/cluster-setup-and-hardening/rbac-and-identity","slug":"/best-practices/cluster-setup-and-hardening/rbac-and-identity/audit2rbac","permalink":"/kubernetes-security/best-practices/cluster-setup-and-hardening/rbac-and-identity/audit2rbac","draft":false,"unlisted":false,"editUrl":"https://github.com/geek-kb/k8s_security/edit/main/docs/best-practices/cluster-setup-and-hardening/rbac-and-identity/audit2rbac.md","tags":[{"inline":true,"label":"tool","permalink":"/kubernetes-security/tags/tool"},{"inline":true,"label":"rbac","permalink":"/kubernetes-security/tags/rbac"},{"inline":true,"label":"authorization","permalink":"/kubernetes-security/tags/authorization"},{"inline":true,"label":"CKS","permalink":"/kubernetes-security/tags/cks"}],"version":"current","lastUpdatedBy":"Itai Ganot","lastUpdatedAt":1771236448000,"sidebarPosition":14,"frontMatter":{"sidebar_position":14,"title":"audit2rbac","description":"audit2rbac automatically generates RBAC policies from Kubernetes audit logs, enabling precise least-privilege configurations based on actual API usage.","keywords":["kubernetes security tool","audit2rbac","RBAC generation","audit logs","least privilege","kubernetes RBAC","access control","policy generation","CKS"],"tags":["tool","rbac","authorization","CKS"],"related":["/kubernetes-security/best-practices/cluster-setup-and-hardening/rbac-and-identity/insecure-rbac-permissions-mitigation/","/kubernetes-security/fundamentals/authorization/rbac/","/kubernetes-security/attack-vectors/insecure-rbac-permissions/"]},"sidebar":"default","previous":{"title":"Securing Debug Container Access","permalink":"/kubernetes-security/best-practices/cluster-setup-and-hardening/rbac-and-identity/debug-container-security"},"next":{"title":"kubectl-who-can","permalink":"/kubernetes-security/best-practices/cluster-setup-and-hardening/rbac-and-identity/kubectl-who-can"}}');var t=n(4848),r=n(8453);const i={sidebar_position:14,title:"audit2rbac",description:"audit2rbac automatically generates RBAC policies from Kubernetes audit logs, enabling precise least-privilege configurations based on actual API usage.",keywords:["kubernetes security tool","audit2rbac","RBAC generation","audit logs","least privilege","kubernetes RBAC","access control","policy generation","CKS"],tags:["tool","rbac","authorization","CKS"],related:["/kubernetes-security/best-practices/cluster-setup-and-hardening/rbac-and-identity/insecure-rbac-permissions-mitigation/","/kubernetes-security/fundamentals/authorization/rbac/","/kubernetes-security/attack-vectors/insecure-rbac-permissions/"]},c="audit2rbac",l={},o=[{value:"Use Cases",id:"use-cases",level:2},{value:"Installation",id:"installation",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Audit Policy Example",id:"audit-policy-example",level:3},{value:"Usage Examples",id:"usage-examples",level:2},{value:"Generate RBAC for a Service Account",id:"generate-rbac-for-a-service-account",level:3},{value:"Generate ClusterRole for a User",id:"generate-clusterrole-for-a-user",level:3},{value:"Output to File",id:"output-to-file",level:3},{value:"Generate Namespace-Scoped Role",id:"generate-namespace-scoped-role",level:3},{value:"Example Output",id:"example-output",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"Limitations",id:"limitations",level:2},{value:"References",id:"references",level:2}];function u(e){const a={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(a.header,{children:(0,t.jsx)(a.h1,{id:"audit2rbac",children:"audit2rbac"})}),"\n",(0,t.jsxs)(a.p,{children:[(0,t.jsx)(a.strong,{children:"audit2rbac"})," is an open-source tool that automatically generates Kubernetes RBAC policies based on actual API server audit logs. Instead of manually crafting Role and ClusterRole resources, audit2rbac analyzes recorded API requests to produce minimal, least-privilege RBAC configurations that match real-world usage patterns."]}),"\n",(0,t.jsx)(a.p,{children:"This approach eliminates guesswork when defining permissions and ensures that generated policies grant only the access that was actually needed during the observed period."}),"\n",(0,t.jsx)(a.hr,{}),"\n",(0,t.jsx)(a.h2,{id:"use-cases",children:"Use Cases"}),"\n",(0,t.jsxs)(a.ul,{children:["\n",(0,t.jsx)(a.li,{children:"Generate RBAC policies for service accounts based on their actual API usage."}),"\n",(0,t.jsx)(a.li,{children:"Migrate from overly permissive RBAC configurations to least-privilege policies."}),"\n",(0,t.jsx)(a.li,{children:"Audit existing workloads to understand their true permission requirements."}),"\n",(0,t.jsx)(a.li,{children:"Create baseline RBAC policies during development and testing phases."}),"\n",(0,t.jsx)(a.li,{children:"Validate that workloads are not requesting more permissions than they use."}),"\n"]}),"\n",(0,t.jsx)(a.hr,{}),"\n",(0,t.jsx)(a.h2,{id:"installation",children:"Installation"}),"\n",(0,t.jsx)(a.p,{children:"Install audit2rbac from the official GitHub releases:"}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-bash",children:"# Download the latest release (Linux/amd64)\ncurl -L https://github.com/liggitt/audit2rbac/releases/download/v0.9.0/audit2rbac-linux-amd64.tar.gz | tar xz\nchmod +x audit2rbac\nsudo mv audit2rbac /usr/local/bin/\n"})}),"\n",(0,t.jsx)(a.p,{children:"For macOS:"}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-bash",children:"curl -L https://github.com/liggitt/audit2rbac/releases/download/v0.9.0/audit2rbac-darwin-amd64.tar.gz | tar xz\nchmod +x audit2rbac\nsudo mv audit2rbac /usr/local/bin/\n"})}),"\n",(0,t.jsx)(a.hr,{}),"\n",(0,t.jsx)(a.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,t.jsx)(a.p,{children:"audit2rbac requires Kubernetes API server audit logging to be enabled. Configure the API server with an audit policy:"}),"\n",(0,t.jsx)(a.h3,{id:"audit-policy-example",children:"Audit Policy Example"}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-yaml",children:'apiVersion: audit.k8s.io/v1\nkind: Policy\nrules:\n  - level: RequestResponse\n    users: ["system:serviceaccount:*:*"]\n    verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]\n    resources:\n      - group: ""\n        resources: ["*"]\n      - group: "apps"\n        resources: ["*"]\n'})}),"\n",(0,t.jsx)(a.p,{children:"Enable audit logging on the API server:"}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-bash",children:"--audit-policy-file=/etc/kubernetes/audit-policy.yaml\n--audit-log-path=/var/log/kubernetes/audit.log\n--audit-log-maxage=30\n--audit-log-maxbackup=10\n--audit-log-maxsize=100\n"})}),"\n",(0,t.jsx)(a.hr,{}),"\n",(0,t.jsx)(a.h2,{id:"usage-examples",children:"Usage Examples"}),"\n",(0,t.jsx)(a.h3,{id:"generate-rbac-for-a-service-account",children:"Generate RBAC for a Service Account"}),"\n",(0,t.jsx)(a.p,{children:"Analyze audit logs and generate RBAC for a specific service account:"}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-bash",children:"audit2rbac --filename=/var/log/kubernetes/audit.log \\\n  --serviceaccount=my-namespace:my-service-account\n"})}),"\n",(0,t.jsx)(a.h3,{id:"generate-clusterrole-for-a-user",children:"Generate ClusterRole for a User"}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-bash",children:"audit2rbac --filename=/var/log/kubernetes/audit.log \\\n  --user=jane@example.com\n"})}),"\n",(0,t.jsx)(a.h3,{id:"output-to-file",children:"Output to File"}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-bash",children:"audit2rbac --filename=/var/log/kubernetes/audit.log \\\n  --serviceaccount=production:app-sa \\\n  > generated-rbac.yaml\n"})}),"\n",(0,t.jsx)(a.h3,{id:"generate-namespace-scoped-role",children:"Generate Namespace-Scoped Role"}),"\n",(0,t.jsx)(a.p,{children:"By default, audit2rbac generates ClusterRoles. To generate namespace-scoped Roles:"}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-bash",children:"audit2rbac --filename=/var/log/kubernetes/audit.log \\\n  --serviceaccount=my-namespace:my-sa \\\n  --generate-kind=Role \\\n  --generate-name=my-sa-role\n"})}),"\n",(0,t.jsx)(a.hr,{}),"\n",(0,t.jsx)(a.h2,{id:"example-output",children:"Example Output"}),"\n",(0,t.jsx)(a.p,{children:"Running audit2rbac produces RBAC manifests ready for deployment:"}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-yaml",children:'apiVersion: rbac.authorization.k8s.io/v1\nkind: Role\nmetadata:\n  name: my-sa-role\n  namespace: my-namespace\nrules:\n  - apiGroups: [""]\n    resources: ["configmaps"]\n    verbs: ["get", "list"]\n  - apiGroups: [""]\n    resources: ["secrets"]\n    resourceNames: ["my-secret"]\n    verbs: ["get"]\n  - apiGroups: ["apps"]\n    resources: ["deployments"]\n    verbs: ["get", "list", "watch"]\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: RoleBinding\nmetadata:\n  name: my-sa-role-binding\n  namespace: my-namespace\nsubjects:\n  - kind: ServiceAccount\n    name: my-sa\n    namespace: my-namespace\nroleRef:\n  kind: Role\n  name: my-sa-role\n  apiGroup: rbac.authorization.k8s.io\n'})}),"\n",(0,t.jsx)(a.hr,{}),"\n",(0,t.jsx)(a.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,t.jsxs)(a.ul,{children:["\n",(0,t.jsxs)(a.li,{children:[(0,t.jsx)(a.strong,{children:"Collect sufficient audit data:"})," Run audit2rbac against logs that cover all expected workload operations, including startup, steady-state, and edge cases."]}),"\n",(0,t.jsxs)(a.li,{children:[(0,t.jsx)(a.strong,{children:"Review generated policies:"})," Always review generated RBAC before applying to production to ensure no unexpected permissions are included."]}),"\n",(0,t.jsxs)(a.li,{children:[(0,t.jsx)(a.strong,{children:"Use resource names when possible:"})," audit2rbac can generate rules with specific ",(0,t.jsx)(a.code,{children:"resourceNames"})," for finer-grained access control."]}),"\n",(0,t.jsxs)(a.li,{children:[(0,t.jsx)(a.strong,{children:"Iterate over time:"})," Regenerate policies periodically as workload requirements evolve."]}),"\n",(0,t.jsxs)(a.li,{children:[(0,t.jsx)(a.strong,{children:"Combine with policy enforcement:"})," Use generated policies alongside tools like OPA Gatekeeper or Kyverno to enforce RBAC best practices."]}),"\n"]}),"\n",(0,t.jsx)(a.hr,{}),"\n",(0,t.jsx)(a.h2,{id:"limitations",children:"Limitations"}),"\n",(0,t.jsxs)(a.ul,{children:["\n",(0,t.jsx)(a.li,{children:"Requires audit logging to be enabled on the Kubernetes API server."}),"\n",(0,t.jsx)(a.li,{children:"Only captures API requests that occurred during the audit period."}),"\n",(0,t.jsx)(a.li,{children:"Does not account for future permission requirements or code changes."}),"\n",(0,t.jsx)(a.li,{children:"Generated policies reflect observed behavior, which may include unnecessary access patterns."}),"\n"]}),"\n",(0,t.jsx)(a.hr,{}),"\n",(0,t.jsx)(a.h2,{id:"references",children:"References"}),"\n",(0,t.jsx)(a.p,{children:"This article is based on information from the following official sources:"}),"\n",(0,t.jsxs)(a.ol,{children:["\n",(0,t.jsxs)(a.li,{children:[(0,t.jsx)(a.a,{href:"https://github.com/liggitt/audit2rbac",children:"audit2rbac GitHub Repository"})," - GitHub"]}),"\n",(0,t.jsxs)(a.li,{children:[(0,t.jsx)(a.a,{href:"https://kubernetes.io/docs/tasks/debug/debug-cluster/audit/",children:"Auditing"})," - Kubernetes Documentation"]}),"\n",(0,t.jsxs)(a.li,{children:[(0,t.jsx)(a.a,{href:"https://kubernetes.io/docs/reference/access-authn-authz/rbac/",children:"Using RBAC Authorization"})," - Kubernetes Documentation"]}),"\n"]})]})}function d(e={}){const{wrapper:a}={...(0,r.R)(),...e.components};return a?(0,t.jsx)(a,{...e,children:(0,t.jsx)(u,{...e})}):u(e)}},8453(e,a,n){n.d(a,{R:()=>i,x:()=>c});var s=n(6540);const t={},r=s.createContext(t);function i(e){const a=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(a):{...a,...e}},[a,e])}function c(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),s.createElement(r.Provider,{value:a},e.children)}}}]);