"use strict";(self.webpackChunkk_8_s_security=self.webpackChunkk_8_s_security||[]).push([[8167],{2891:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>c,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"cluster_setup_and_hardening/k8s_security_primitives/certificates","title":"Certificates","description":"Understand the role of certificates in Kubernetes, including client certificates, server certificates, and automating certificate management with Cert-Manager.","source":"@site/docs/cluster_setup_and_hardening/k8s_security_primitives/certificates.md","sourceDirName":"cluster_setup_and_hardening/k8s_security_primitives","slug":"/cluster_setup_and_hardening/k8s_security_primitives/certificates","permalink":"/k8s_security/docs/cluster_setup_and_hardening/k8s_security_primitives/certificates","draft":false,"unlisted":false,"editUrl":"https://github.com/geek-kb/k8s_security/edit/main/docs/cluster_setup_and_hardening/k8s_security_primitives/certificates.md","tags":[],"version":"current","frontMatter":{"title":"Certificates","description":"Understand the role of certificates in Kubernetes, including client certificates, server certificates, and automating certificate management with Cert-Manager."},"sidebar":"tutorialSidebar","previous":{"title":"Admission Controllers","permalink":"/k8s_security/docs/cluster_setup_and_hardening/k8s_security_primitives/admission_controllers"},"next":{"title":"Kubelet Security","permalink":"/k8s_security/docs/cluster_setup_and_hardening/kubelet_security"}}');var i=s(4848),t=s(8453);const c={title:"Certificates",description:"Understand the role of certificates in Kubernetes, including client certificates, server certificates, and automating certificate management with Cert-Manager."},a=void 0,l={},d=[{value:"Introduction",id:"introduction",level:2},{value:"What Are Certificates in Kubernetes?",id:"what-are-certificates-in-kubernetes",level:2},{value:"Common Use Cases for Certificates in Kubernetes",id:"common-use-cases-for-certificates-in-kubernetes",level:2},{value:"Types of Certificates in Kubernetes",id:"types-of-certificates-in-kubernetes",level:2},{value:"1. Client Certificates",id:"1-client-certificates",level:3},{value:"Use Cases for Client Certificates",id:"use-cases-for-client-certificates",level:4},{value:"Generating a Client Certificate",id:"generating-a-client-certificate",level:4},{value:"Key Differences Between Client and User Certificates",id:"key-differences-between-client-and-user-certificates",level:4},{value:"Cross-Reference",id:"cross-reference",level:4},{value:"2. Server Certificates",id:"2-server-certificates",level:3},{value:"3. TLS Certificates for Ingress Controllers",id:"3-tls-certificates-for-ingress-controllers",level:3},{value:"4. Service Account Tokens vs. Certificates",id:"4-service-account-tokens-vs-certificates",level:3},{value:"Automating Certificate Management with Cert-Manager",id:"automating-certificate-management-with-cert-manager",level:2},{value:"Installation",id:"installation",level:3},{value:"Create a Self-Signed Issuer",id:"create-a-self-signed-issuer",level:3},{value:"Requesting a Certificate",id:"requesting-a-certificate",level:3},{value:"Best Practices for Managing Certificates",id:"best-practices-for-managing-certificates",level:2},{value:"Conclusion",id:"conclusion",level:2}];function o(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,i.jsx)(n.p,{children:"Certificates play a critical role in Kubernetes security by enabling secure communication between various components of a Kubernetes cluster. They are primarily used for authenticating system components and services, ensuring data confidentiality, integrity, and authentication within the cluster."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"what-are-certificates-in-kubernetes",children:"What Are Certificates in Kubernetes?"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Certificates"})," in Kubernetes are ",(0,i.jsx)(n.strong,{children:"digital certificates"})," used to secure ",(0,i.jsx)(n.strong,{children:"communications"})," between ",(0,i.jsx)(n.strong,{children:"components"}),", enable ",(0,i.jsx)(n.strong,{children:"TLS encryption"}),", and facilitate ",(0,i.jsx)(n.strong,{children:"authentication"}),". Certificates ensure the ",(0,i.jsx)(n.strong,{children:"confidentiality"}),", ",(0,i.jsx)(n.strong,{children:"integrity"}),", and ",(0,i.jsx)(n.strong,{children:"authentication"})," of data ",(0,i.jsx)(n.strong,{children:"in transit"})," within the Kubernetes cluster."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"common-use-cases-for-certificates-in-kubernetes",children:"Common Use Cases for Certificates in Kubernetes"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Securing Kubernetes API Server Communication:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"mTLS (Mutual TLS)"})," between ",(0,i.jsx)(n.strong,{children:"API server"})," and ",(0,i.jsx)(n.strong,{children:"Kubelets"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Intra-Cluster Communication:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Enable ",(0,i.jsx)(n.strong,{children:"mTLS"})," between ",(0,i.jsx)(n.strong,{children:"pods"})," and ",(0,i.jsx)(n.strong,{children:"services"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Ingress TLS/SSL Certificates:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Secure ",(0,i.jsx)(n.strong,{children:"external access"})," through ",(0,i.jsx)(n.strong,{children:"Ingress Controllers"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Authentication:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Generate ",(0,i.jsx)(n.strong,{children:"X.509 certificates"})," for ",(0,i.jsx)(n.strong,{children:"user authentication"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"types-of-certificates-in-kubernetes",children:"Types of Certificates in Kubernetes"}),"\n",(0,i.jsx)(n.h3,{id:"1-client-certificates",children:"1. Client Certificates"}),"\n",(0,i.jsx)(n.p,{children:"Client certificates are essential for secure communication between Kubernetes components. They provide mutual authentication, enabling the API server and internal services to verify each other's identities."}),"\n",(0,i.jsx)(n.h4,{id:"use-cases-for-client-certificates",children:"Use Cases for Client Certificates"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"System Component Authentication:"})," Establish secure connections between API servers, kubelets, and other internal services."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Service-to-Service Communication:"})," Secure communication within the cluster for services that require API access."]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"generating-a-client-certificate",children:"Generating a Client Certificate"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'openssl req -new -newkey rsa:2048 -nodes -keyout user.key -out user.csr -subj "/CN=example-user"\n\nopenssl x509 -req -in user.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out user.crt -days 365\n'})}),"\n",(0,i.jsx)(n.h4,{id:"key-differences-between-client-and-user-certificates",children:"Key Differences Between Client and User Certificates"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Certificate Type"}),(0,i.jsx)(n.th,{children:"Purpose"}),(0,i.jsx)(n.th,{children:"Example Use Case"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Client Certificate"}),(0,i.jsx)(n.td,{children:"Component-to-component authentication"}),(0,i.jsx)(n.td,{children:"API Server to Kubelet communication"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"User Certificate"}),(0,i.jsx)(n.td,{children:"API access for external users"}),(0,i.jsxs)(n.td,{children:["Developer access via ",(0,i.jsx)(n.code,{children:"kubectl"})]})]})]})]}),"\n",(0,i.jsx)(n.h4,{id:"cross-reference",children:"Cross-Reference"}),"\n",(0,i.jsxs)(n.p,{children:["For a detailed guide on issuing a certificate for a Kubernetes user, refer to the ",(0,i.jsx)(n.a,{href:"https://geek-kb.github.io/k8s_security/guides/certificates/issue_certificate_for_k8s_user/",children:"Issuing a Certificate for a User"}),"."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"2-server-certificates",children:"2. Server Certificates"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Secures ",(0,i.jsx)(n.strong,{children:"server endpoints"})," with ",(0,i.jsx)(n.strong,{children:"TLS encryption"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Commonly used for the ",(0,i.jsx)(n.strong,{children:"API server"}),", ",(0,i.jsx)(n.strong,{children:"Kubelets"}),", and ",(0,i.jsx)(n.strong,{children:"webhooks"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# Create a server certificate for the API server\nopenssl req -new -key apiserver.key -out apiserver.csr -subj "/CN=kube-apiserver"\n\n# Sign with the Kubernetes Certificate Authority (CA)\nopenssl x509 -req -in apiserver.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out apiserver.crt -days 365\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"3-tls-certificates-for-ingress-controllers",children:"3. TLS Certificates for Ingress Controllers"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Used to secure ",(0,i.jsx)(n.strong,{children:"Ingress traffic"})," using ",(0,i.jsx)(n.strong,{children:"HTTPS"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Automate with ",(0,i.jsx)(n.strong,{children:"Cert-Manager"})," and ",(0,i.jsx)(n.strong,{children:"Let's Encrypt"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"# Example: Issuing a TLS Certificate with Cert-Manager\napiVersion: cert-manager.io/v1\nkind: Certificate\nmetadata:\n  name: example-cert\n  namespace: default\nspec:\n  secretName: example-cert-tls\n  issuerRef:\n    name: letsencrypt-issuer\n    kind: ClusterIssuer\n  dnsNames:\n    - example.com\n    - www.example.com\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"4-service-account-tokens-vs-certificates",children:"4. Service Account Tokens vs. Certificates"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:(0,i.jsx)(n.strong,{children:"Feature"})}),(0,i.jsx)(n.th,{children:(0,i.jsx)(n.strong,{children:"Service Account Token"})}),(0,i.jsx)(n.th,{children:(0,i.jsx)(n.strong,{children:"Certificate"})})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Use Case"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Pod authentication"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"User and server authentication"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Renewal"})}),(0,i.jsx)(n.td,{children:"Automatic"}),(0,i.jsxs)(n.td,{children:["Requires ",(0,i.jsx)(n.strong,{children:"manual"})," or ",(0,i.jsx)(n.strong,{children:"automated rotation"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Security"})}),(0,i.jsxs)(n.td,{children:["Token-based ",(0,i.jsx)(n.strong,{children:"JWT"})]}),(0,i.jsxs)(n.td,{children:["Encrypted ",(0,i.jsx)(n.strong,{children:"X.509 certificates"})]})]})]})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"automating-certificate-management-with-cert-manager",children:"Automating Certificate Management with Cert-Manager"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Cert-Manager"})," is a ",(0,i.jsx)(n.strong,{children:"Kubernetes add-on"})," that automates the ",(0,i.jsx)(n.strong,{children:"creation"}),", ",(0,i.jsx)(n.strong,{children:"renewal"}),", and ",(0,i.jsx)(n.strong,{children:"management"})," of certificates."]}),"\n",(0,i.jsx)(n.h3,{id:"installation",children:"Installation"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/v1.9.1/cert-manager.yaml\n"})}),"\n",(0,i.jsx)(n.h3,{id:"create-a-self-signed-issuer",children:"Create a Self-Signed Issuer"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"apiVersion: cert-manager.io/v1\nkind: Issuer\nmetadata:\n  name: selfsigned-issuer\n  namespace: default\nspec:\n  selfSigned: {}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"requesting-a-certificate",children:"Requesting a Certificate"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"apiVersion: cert-manager.io/v1\nkind: Certificate\nmetadata:\n  name: selfsigned-cert\nspec:\n  secretName: selfsigned-cert-tls\n  duration: 90d\n  renewBefore: 30d\n  commonName: example.com\n  dnsNames:\n    - example.com\n  issuerRef:\n    name: selfsigned-issuer\n    kind: Issuer\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"best-practices-for-managing-certificates",children:"Best Practices for Managing Certificates"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Automate Renewal:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Use ",(0,i.jsx)(n.strong,{children:"Cert-Manager"})," to avoid ",(0,i.jsx)(n.strong,{children:"expired certificates"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Enforce TLS Everywhere:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Enable ",(0,i.jsx)(n.strong,{children:"TLS"})," for all ",(0,i.jsx)(n.strong,{children:"internal"})," and ",(0,i.jsx)(n.strong,{children:"external communications"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Rotate Certificates Regularly:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Automate with ",(0,i.jsx)(n.strong,{children:"cert-manager"})," or ",(0,i.jsx)(n.strong,{children:"kubeadm cert renew"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Monitor Certificate Expiry:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Set up ",(0,i.jsx)(n.strong,{children:"alerts"})," for ",(0,i.jsx)(n.strong,{children:"expiring certificates"})," using ",(0,i.jsx)(n.strong,{children:"Prometheus"})," or ",(0,i.jsx)(n.strong,{children:"Grafana"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,i.jsxs)(n.p,{children:["Certificates are a ",(0,i.jsx)(n.strong,{children:"core primitive"})," in Kubernetes security, providing ",(0,i.jsx)(n.strong,{children:"encryption"})," and ",(0,i.jsx)(n.strong,{children:"authentication"})," for ",(0,i.jsx)(n.strong,{children:"API server communications"}),", ",(0,i.jsx)(n.strong,{children:"Ingress traffic"}),", and ",(0,i.jsx)(n.strong,{children:"internal service interactions"}),". Implementing certificates with tools like ",(0,i.jsx)(n.strong,{children:"Cert-Manager"})," ensures your ",(0,i.jsx)(n.strong,{children:"cluster remains secure"})," and ",(0,i.jsx)(n.strong,{children:"compliant"})," with ",(0,i.jsx)(n.strong,{children:"best practices"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["For more advanced scenarios, including ",(0,i.jsx)(n.strong,{children:"mTLS setup"})," between services or using ",(0,i.jsx)(n.strong,{children:"Cert-Manager"})," for dynamic certificate management, refer to the additional ",(0,i.jsx)(n.a,{href:"../../../../guides/intro/",children:"How-To Guides"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>a});var r=s(6540);const i={},t=r.createContext(i);function c(e){const n=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);