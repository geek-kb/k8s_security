"use strict";(self.webpackChunkk_8_s_security=self.webpackChunkk_8_s_security||[]).push([[3281],{1512:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>u,frontMatter:()=>l,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"cluster_setup_and_hardening/kubelet_security","title":"Kubelet Security","description":"\ud83d\udccc Introduction","source":"@site/docs/cluster_setup_and_hardening/kubelet_security.md","sourceDirName":"cluster_setup_and_hardening","slug":"/cluster_setup_and_hardening/kubelet_security","permalink":"/k8s_security/docs/cluster_setup_and_hardening/kubelet_security","draft":false,"unlisted":false,"editUrl":"https://github.com/geek-kb/k8s_security/edit/main/docs/cluster_setup_and_hardening/kubelet_security.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"title":"Kubelet Security","sidebar_position":5},"sidebar":"tutorialSidebar","previous":{"title":"Certificates","permalink":"/k8s_security/docs/cluster_setup_and_hardening/k8s_security_primitives/certificates"}}');var r=s(4848),i=s(8453);const l={title:"Kubelet Security",sidebar_position:5},o="Kubelet Security",c={},a=[{value:"\ud83d\udccc <strong>Introduction</strong>",id:"-introduction",level:2},{value:"\ud83d\udd10 <strong>Why Kubelet Security Matters?</strong>",id:"-why-kubelet-security-matters",level:2},{value:"\u2705 <strong>Kubelet Security Best Practices (CKS)</strong>",id:"-kubelet-security-best-practices-cks",level:2},{value:"1. <strong>Secure Kubelet Communication</strong>",id:"1-secure-kubelet-communication",level:3},{value:"2. <strong>Enable Authentication and Authorization</strong>",id:"2-enable-authentication-and-authorization",level:3},{value:"3. <strong>Disable Anonymous Access</strong>",id:"3-disable-anonymous-access",level:3},{value:"4. <strong>Restrict Kubelet API Access</strong>",id:"4-restrict-kubelet-api-access",level:3},{value:"5. <strong>Enforce Pod Security Standards</strong>",id:"5-enforce-pod-security-standards",level:3},{value:"6. <strong>Limit Kubelet Permissions</strong>",id:"6-limit-kubelet-permissions",level:3},{value:"7. <strong>Regularly Update and Patch the Kubelet</strong>",id:"7-regularly-update-and-patch-the-kubelet",level:3},{value:"\ud83d\udee0\ufe0f <strong>Additional Security Features</strong>",id:"\ufe0f-additional-security-features",level:2},{value:"1. <strong>Pod Security Admission (PSA)</strong>",id:"1-pod-security-admission-psa",level:3},{value:"2. <strong>Audit Logs</strong>",id:"2-audit-logs",level:3},{value:"3. <strong>Limit Resource Consumption</strong>",id:"3-limit-resource-consumption",level:3},{value:"\ud83e\udde0 <strong>Key Takeaways</strong>",id:"-key-takeaways",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"kubelet-security",children:"Kubelet Security"})}),"\n",(0,r.jsxs)(n.h2,{id:"-introduction",children:["\ud83d\udccc ",(0,r.jsx)(n.strong,{children:"Introduction"})]}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.strong,{children:"Kubelet"})," is a critical component of a ",(0,r.jsx)(n.strong,{children:"Kubernetes node"}),", responsible for managing containers and ensuring that the desired ",(0,r.jsx)(n.strong,{children:"containers"})," are running. Due to its powerful control over ",(0,r.jsx)(n.strong,{children:"containers"}),", securing the ",(0,r.jsx)(n.strong,{children:"Kubelet"})," is paramount to maintaining the overall security of the ",(0,r.jsx)(n.strong,{children:"Kubernetes cluster"}),"."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.h2,{id:"-why-kubelet-security-matters",children:["\ud83d\udd10 ",(0,r.jsx)(n.strong,{children:"Why Kubelet Security Matters?"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Node Compromise Risk:"})," The Kubelet has direct access to ",(0,r.jsx)(n.strong,{children:"container runtimes"}),", posing a potential risk if not properly secured."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Cluster-wide Impact:"})," A compromised Kubelet can lead to unauthorized access to ",(0,r.jsx)(n.strong,{children:"pods"}),", ",(0,r.jsx)(n.strong,{children:"secrets"}),", and other cluster resources."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"API Access Control:"})," Kubelets have access to the ",(0,r.jsx)(n.strong,{children:"Kubernetes API"}),", and improper configurations could lead to an ",(0,r.jsx)(n.strong,{children:"elevated attack surface"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.h2,{id:"-kubelet-security-best-practices-cks",children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Kubelet Security Best Practices (CKS)"})]}),"\n",(0,r.jsxs)(n.h3,{id:"1-secure-kubelet-communication",children:["1. ",(0,r.jsx)(n.strong,{children:"Secure Kubelet Communication"})]}),"\n",(0,r.jsxs)(n.p,{children:["Ensure all communications to and from the ",(0,r.jsx)(n.strong,{children:"Kubelet"})," are ",(0,r.jsx)(n.strong,{children:"encrypted"})," using ",(0,r.jsx)(n.strong,{children:"TLS certificates"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"# Example Kubelet TLS Configuration\n--tls-cert-file=/var/lib/kubelet/pki/kubelet.crt\n--tls-private-key-file=/var/lib/kubelet/pki/kubelet.key\n--client-ca-file=/var/lib/kubernetes/pki/ca.crt\n"})}),"\n",(0,r.jsxs)(n.h3,{id:"2-enable-authentication-and-authorization",children:["2. ",(0,r.jsx)(n.strong,{children:"Enable Authentication and Authorization"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Authentication:"})," Require ",(0,r.jsx)(n.strong,{children:"client certificates"})," to authenticate to the Kubelet API."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Authorization:"})," Use ",(0,r.jsx)(n.strong,{children:"Node Authorization"})," and ",(0,r.jsx)(n.strong,{children:"Webhook Authorization"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"# Kubelet Authentication and Authorization\n--authorization-mode=Webhook\n--authentication-token-webhook=true\n--client-ca-file=/var/lib/kubernetes/pki/ca.crt\n"})}),"\n",(0,r.jsxs)(n.h3,{id:"3-disable-anonymous-access",children:["3. ",(0,r.jsx)(n.strong,{children:"Disable Anonymous Access"})]}),"\n",(0,r.jsxs)(n.p,{children:["Prevent unauthorized users from accessing the ",(0,r.jsx)(n.strong,{children:"Kubelet API"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"--anonymous-auth=false\n"})}),"\n",(0,r.jsxs)(n.h3,{id:"4-restrict-kubelet-api-access",children:["4. ",(0,r.jsx)(n.strong,{children:"Restrict Kubelet API Access"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Limit the ",(0,r.jsx)(n.strong,{children:"Kubelet API"})," exposure to ",(0,r.jsx)(n.strong,{children:"localhost"})," or the ",(0,r.jsx)(n.strong,{children:"internal network"})," only."]}),"\n",(0,r.jsxs)(n.li,{children:["Use ",(0,r.jsx)(n.strong,{children:"firewalls"})," or ",(0,r.jsx)(n.strong,{children:"network policies"})," to restrict ",(0,r.jsx)(n.strong,{children:"external access"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"--address=127.0.0.1\n--read-only-port=0\n"})}),"\n",(0,r.jsxs)(n.h3,{id:"5-enforce-pod-security-standards",children:["5. ",(0,r.jsx)(n.strong,{children:"Enforce Pod Security Standards"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Use ",(0,r.jsx)(n.strong,{children:"Pod Security Policies (PSP)"})," or ",(0,r.jsx)(n.strong,{children:"Pod Security Admission"})," to prevent ",(0,r.jsx)(n.strong,{children:"privileged containers"})," or ",(0,r.jsx)(n.strong,{children:"hostPath mounts"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'# Example Pod Security Policy\napiVersion: policy/v1beta1\nkind: PodSecurityPolicy\nmetadata:\n  name: restricted-psp\nspec:\n  privileged: false\n  volumes:\n    - "configMap"\n    - "emptyDir"\n  runAsUser:\n    rule: "MustRunAsNonRoot"\n'})}),"\n",(0,r.jsxs)(n.h3,{id:"6-limit-kubelet-permissions",children:["6. ",(0,r.jsx)(n.strong,{children:"Limit Kubelet Permissions"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["The ",(0,r.jsx)(n.strong,{children:"Kubelet"})," should not run as ",(0,r.jsx)(n.strong,{children:"root"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Set up ",(0,r.jsx)(n.strong,{children:"Role-Based Access Control (RBAC)"})," rules to minimize ",(0,r.jsx)(n.strong,{children:"API permissions"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'# Example RBAC for Kubelet\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: kubelet-read-only\nrules:\n  - apiGroups: [""]\n    resources: ["pods", "nodes"]\n    verbs: ["get", "list"]\n'})}),"\n",(0,r.jsxs)(n.h3,{id:"7-regularly-update-and-patch-the-kubelet",children:["7. ",(0,r.jsx)(n.strong,{children:"Regularly Update and Patch the Kubelet"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Apply ",(0,r.jsx)(n.strong,{children:"security patches"})," and keep the ",(0,r.jsx)(n.strong,{children:"Kubelet"})," updated to mitigate ",(0,r.jsx)(n.strong,{children:"known vulnerabilities"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Use tools like ",(0,r.jsx)(n.strong,{children:"kured"})," (Kubernetes Reboot Daemon) for ",(0,r.jsx)(n.strong,{children:"automated node reboots"})," when needed."]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.h2,{id:"\ufe0f-additional-security-features",children:["\ud83d\udee0\ufe0f ",(0,r.jsx)(n.strong,{children:"Additional Security Features"})]}),"\n",(0,r.jsxs)(n.h3,{id:"1-pod-security-admission-psa",children:["1. ",(0,r.jsx)(n.strong,{children:"Pod Security Admission (PSA)"})]}),"\n",(0,r.jsxs)(n.p,{children:["Use ",(0,r.jsx)(n.strong,{children:"Pod Security Admission"})," to replace the deprecated ",(0,r.jsx)(n.strong,{children:"Pod Security Policies (PSP)"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'# Example PSA Configuration\napiVersion: v1\nkind: Namespace\nmetadata:\n  name: restricted\n  labels:\n    pod-security.kubernetes.io/enforce: "restricted"\n    pod-security.kubernetes.io/audit: "restricted"\n    pod-security.kubernetes.io/warn: "restricted"\n'})}),"\n",(0,r.jsxs)(n.h3,{id:"2-audit-logs",children:["2. ",(0,r.jsx)(n.strong,{children:"Audit Logs"})]}),"\n",(0,r.jsxs)(n.p,{children:["Enable ",(0,r.jsx)(n.strong,{children:"Kubelet auditing"})," to monitor ",(0,r.jsx)(n.strong,{children:"API requests"})," and detect ",(0,r.jsx)(n.strong,{children:"suspicious activities"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"--audit-log-path=/var/log/kubelet-audit.log\n--audit-policy-file=/etc/kubernetes/audit-policy.yaml\n"})}),"\n",(0,r.jsxs)(n.h3,{id:"3-limit-resource-consumption",children:["3. ",(0,r.jsx)(n.strong,{children:"Limit Resource Consumption"})]}),"\n",(0,r.jsxs)(n.p,{children:["Set ",(0,r.jsx)(n.strong,{children:"resource limits"})," on the ",(0,r.jsx)(n.strong,{children:"Kubelet"})," to prevent ",(0,r.jsx)(n.strong,{children:"resource exhaustion attacks"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"--kube-reserved=cpu=200m,memory=512Mi,ephemeral-storage=1Gi\n--system-reserved=cpu=100m,memory=256Mi,ephemeral-storage=1Gi\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.h2,{id:"-key-takeaways",children:["\ud83e\udde0 ",(0,r.jsx)(n.strong,{children:"Key Takeaways"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Securing the ",(0,r.jsx)(n.strong,{children:"Kubelet"})," is crucial for maintaining the ",(0,r.jsx)(n.strong,{children:"integrity"})," and ",(0,r.jsx)(n.strong,{children:"security"})," of the ",(0,r.jsx)(n.strong,{children:"Kubernetes cluster"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Follow ",(0,r.jsx)(n.strong,{children:"CKS best practices"})," by enabling ",(0,r.jsx)(n.strong,{children:"authentication"}),", ",(0,r.jsx)(n.strong,{children:"authorization"}),", and ",(0,r.jsx)(n.strong,{children:"audit logs"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Regularly ",(0,r.jsx)(n.strong,{children:"update"})," and ",(0,r.jsx)(n.strong,{children:"monitor"})," the ",(0,r.jsx)(n.strong,{children:"Kubelet"})," to prevent ",(0,r.jsx)(n.strong,{children:"exploitation"})," of known vulnerabilities."]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>o});var t=s(6540);const r={},i=t.createContext(r);function l(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);