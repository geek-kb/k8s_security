"use strict";(globalThis.webpackChunkk_8_s_security=globalThis.webpackChunkk_8_s_security||[]).push([[5705],{5508(e,t,n){n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>c,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"best-practices/cluster-setup-and-hardening/secrets-management/vault-secrets-operator","title":"Vault Secrets Operator","description":"Vault Secrets Operator is HashiCorp\'s official Kubernetes operator for synchronizing secrets from Vault into Kubernetes Secrets.","source":"@site/docs/best-practices/cluster-setup-and-hardening/secrets-management/vault-secrets-operator.md","sourceDirName":"best-practices/cluster-setup-and-hardening/secrets-management","slug":"/best-practices/cluster-setup-and-hardening/secrets-management/vault-secrets-operator","permalink":"/kubernetes-security/best-practices/cluster-setup-and-hardening/secrets-management/vault-secrets-operator","draft":false,"unlisted":false,"editUrl":"https://github.com/geek-kb/k8s_security/edit/main/docs/best-practices/cluster-setup-and-hardening/secrets-management/vault-secrets-operator.md","tags":[{"inline":true,"label":"tool","permalink":"/kubernetes-security/tags/tool"},{"inline":true,"label":"secrets-management","permalink":"/kubernetes-security/tags/secrets-management"},{"inline":true,"label":"CKS","permalink":"/kubernetes-security/tags/cks"}],"version":"current","lastUpdatedBy":"Itai Ganot","lastUpdatedAt":1771236448000,"sidebarPosition":5,"frontMatter":{"sidebar_position":5,"title":"Vault Secrets Operator","description":"Vault Secrets Operator is HashiCorp\'s official Kubernetes operator for synchronizing secrets from Vault into Kubernetes Secrets.","keywords":["kubernetes security tool","vault secrets operator","hashicorp vault","secrets management","secret synchronization","kubernetes secrets","vault integration","CKS"],"tags":["tool","secrets-management","CKS"],"related":["/kubernetes-security/best-practices/cluster-setup-and-hardening/secrets-management/kubernetes-external-secrets/","/kubernetes-security/best-practices/cluster-setup-and-hardening/secrets-management/sealed-secrets/","/kubernetes-security/best-practices/cluster-setup-and-hardening/secrets-management/insecure-secrets-management-mitigation/"]},"sidebar":"default","previous":{"title":"Kubernetes External Secrets","permalink":"/kubernetes-security/best-practices/cluster-setup-and-hardening/secrets-management/kubernetes-external-secrets"},"next":{"title":"Securing ImagePullSecrets","permalink":"/kubernetes-security/best-practices/cluster-setup-and-hardening/secrets-management/imagepullsecrets-security"}}');var a=n(4848),r=n(8453);const c={sidebar_position:5,title:"Vault Secrets Operator",description:"Vault Secrets Operator is HashiCorp's official Kubernetes operator for synchronizing secrets from Vault into Kubernetes Secrets.",keywords:["kubernetes security tool","vault secrets operator","hashicorp vault","secrets management","secret synchronization","kubernetes secrets","vault integration","CKS"],tags:["tool","secrets-management","CKS"],related:["/kubernetes-security/best-practices/cluster-setup-and-hardening/secrets-management/kubernetes-external-secrets/","/kubernetes-security/best-practices/cluster-setup-and-hardening/secrets-management/sealed-secrets/","/kubernetes-security/best-practices/cluster-setup-and-hardening/secrets-management/insecure-secrets-management-mitigation/"]},i="Vault Secrets Operator",l={},o=[{value:"Key Features",id:"key-features",level:2},{value:"Installation",id:"installation",level:2},{value:"Using Helm",id:"using-helm",level:3},{value:"Configuration Values",id:"configuration-values",level:3},{value:"Core Concepts",id:"core-concepts",level:2},{value:"VaultConnection",id:"vaultconnection",level:3},{value:"VaultAuth",id:"vaultauth",level:3},{value:"VaultStaticSecret",id:"vaultstaticsecret",level:3},{value:"VaultDynamicSecret",id:"vaultdynamicsecret",level:3},{value:"VaultPKISecret",id:"vaultpkisecret",level:3},{value:"Vault Configuration",id:"vault-configuration",level:2},{value:"Enable Kubernetes Auth",id:"enable-kubernetes-auth",level:3},{value:"Create Vault Role",id:"create-vault-role",level:3},{value:"Create Vault Policy",id:"create-vault-policy",level:3},{value:"Usage Examples",id:"usage-examples",level:2},{value:"Static Secret Synchronization",id:"static-secret-synchronization",level:3},{value:"Dynamic AWS Credentials",id:"dynamic-aws-credentials",level:3},{value:"Automatic TLS Certificate",id:"automatic-tls-certificate",level:3},{value:"Secret Transformation",id:"secret-transformation",level:2},{value:"Monitoring",id:"monitoring",level:2},{value:"Check VaultStaticSecret Status",id:"check-vaultstaticsecret-status",level:3},{value:"View Operator Logs",id:"view-operator-logs",level:3},{value:"Prometheus Metrics",id:"prometheus-metrics",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Comparison: VSO vs Vault Agent Sidecar",id:"comparison-vso-vs-vault-agent-sidecar",level:2},{value:"References",id:"references",level:2}];function u(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.header,{children:(0,a.jsx)(t.h1,{id:"vault-secrets-operator",children:"Vault Secrets Operator"})}),"\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.strong,{children:"Vault Secrets Operator"})," (VSO) is HashiCorp's official Kubernetes operator for synchronizing secrets from HashiCorp Vault into Kubernetes Secrets. It provides deep integration with Vault's features including dynamic secrets, automatic secret rotation, and Vault's audit capabilities."]}),"\n",(0,a.jsx)(t.p,{children:"VSO is designed as the successor to the Vault Agent Sidecar Injector, offering a more Kubernetes-native approach to secret management."}),"\n",(0,a.jsx)(t.hr,{}),"\n",(0,a.jsx)(t.h2,{id:"key-features",children:"Key Features"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Native Kubernetes integration"})," using Custom Resources."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Automatic secret synchronization"})," from Vault to Kubernetes Secrets."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Dynamic secret support"})," with automatic rotation."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"PKI certificate management"})," with automatic renewal."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Vault Enterprise features"})," support (namespaces, KMIP)."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Kubernetes authentication"})," using service accounts."]}),"\n"]}),"\n",(0,a.jsx)(t.hr,{}),"\n",(0,a.jsx)(t.h2,{id:"installation",children:"Installation"}),"\n",(0,a.jsx)(t.h3,{id:"using-helm",children:"Using Helm"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"helm repo add hashicorp https://helm.releases.hashicorp.com\nhelm install vault-secrets-operator hashicorp/vault-secrets-operator \\\n  --namespace vault-secrets-operator-system \\\n  --create-namespace\n"})}),"\n",(0,a.jsx)(t.h3,{id:"configuration-values",children:"Configuration Values"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-yaml",children:'# values.yaml\ndefaultVaultConnection:\n  enabled: true\n  address: "https://vault.example.com"\n  skipTLSVerify: false\n\ncontroller:\n  replicas: 2\n  \ndefaultAuthMethod:\n  enabled: true\n  method: kubernetes\n  mount: kubernetes\n  kubernetes:\n    role: vault-secrets-operator\n    serviceAccount: default\n'})}),"\n",(0,a.jsx)(t.hr,{}),"\n",(0,a.jsx)(t.h2,{id:"core-concepts",children:"Core Concepts"}),"\n",(0,a.jsx)(t.h3,{id:"vaultconnection",children:"VaultConnection"}),"\n",(0,a.jsx)(t.p,{children:"Defines how to connect to a Vault server:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-yaml",children:"apiVersion: secrets.hashicorp.com/v1beta1\nkind: VaultConnection\nmetadata:\n  name: vault-connection\n  namespace: vault-secrets-operator-system\nspec:\n  address: https://vault.example.com\n  skipTLSVerify: false\n  caCertSecretRef: vault-ca-cert\n"})}),"\n",(0,a.jsx)(t.h3,{id:"vaultauth",children:"VaultAuth"}),"\n",(0,a.jsx)(t.p,{children:"Defines authentication method to Vault:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-yaml",children:"apiVersion: secrets.hashicorp.com/v1beta1\nkind: VaultAuth\nmetadata:\n  name: vault-auth\n  namespace: production\nspec:\n  method: kubernetes\n  mount: kubernetes\n  kubernetes:\n    role: app-role\n    serviceAccount: app-sa\n    audiences:\n      - vault\n  vaultConnectionRef: vault-connection\n"})}),"\n",(0,a.jsx)(t.h3,{id:"vaultstaticsecret",children:"VaultStaticSecret"}),"\n",(0,a.jsx)(t.p,{children:"Synchronizes static KV secrets:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-yaml",children:"apiVersion: secrets.hashicorp.com/v1beta1\nkind: VaultStaticSecret\nmetadata:\n  name: database-creds\n  namespace: production\nspec:\n  vaultAuthRef: vault-auth\n  mount: secret\n  type: kv-v2\n  path: production/database\n  destination:\n    name: database-secret\n    create: true\n  refreshAfter: 30s\n"})}),"\n",(0,a.jsx)(t.h3,{id:"vaultdynamicsecret",children:"VaultDynamicSecret"}),"\n",(0,a.jsx)(t.p,{children:"Synchronizes dynamic secrets with automatic rotation:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-yaml",children:"apiVersion: secrets.hashicorp.com/v1beta1\nkind: VaultDynamicSecret\nmetadata:\n  name: aws-creds\n  namespace: production\nspec:\n  vaultAuthRef: vault-auth\n  mount: aws\n  path: creds/my-role\n  destination:\n    name: aws-credentials\n    create: true\n  renewalPercent: 67\n"})}),"\n",(0,a.jsx)(t.h3,{id:"vaultpkisecret",children:"VaultPKISecret"}),"\n",(0,a.jsx)(t.p,{children:"Manages PKI certificates:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-yaml",children:"apiVersion: secrets.hashicorp.com/v1beta1\nkind: VaultPKISecret\nmetadata:\n  name: app-tls\n  namespace: production\nspec:\n  vaultAuthRef: vault-auth\n  mount: pki\n  role: app-role\n  commonName: app.example.com\n  altNames:\n    - app.production.svc.cluster.local\n  ttl: 24h\n  destination:\n    name: app-tls-secret\n    create: true\n  expiryOffset: 1h\n"})}),"\n",(0,a.jsx)(t.hr,{}),"\n",(0,a.jsx)(t.h2,{id:"vault-configuration",children:"Vault Configuration"}),"\n",(0,a.jsx)(t.h3,{id:"enable-kubernetes-auth",children:"Enable Kubernetes Auth"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:'# Enable Kubernetes auth method\nvault auth enable kubernetes\n\n# Configure Kubernetes auth\nvault write auth/kubernetes/config \\\n  kubernetes_host="https://$KUBERNETES_HOST:443" \\\n  kubernetes_ca_cert=@/var/run/secrets/kubernetes.io/serviceaccount/ca.crt\n'})}),"\n",(0,a.jsx)(t.h3,{id:"create-vault-role",children:"Create Vault Role"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"vault write auth/kubernetes/role/app-role \\\n  bound_service_account_names=app-sa \\\n  bound_service_account_namespaces=production \\\n  policies=app-policy \\\n  ttl=1h\n"})}),"\n",(0,a.jsx)(t.h3,{id:"create-vault-policy",children:"Create Vault Policy"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-hcl",children:'# app-policy.hcl\npath "secret/data/production/*" {\n  capabilities = ["read"]\n}\n\npath "aws/creds/my-role" {\n  capabilities = ["read"]\n}\n\npath "pki/issue/app-role" {\n  capabilities = ["create", "update"]\n}\n'})}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"vault policy write app-policy app-policy.hcl\n"})}),"\n",(0,a.jsx)(t.hr,{}),"\n",(0,a.jsx)(t.h2,{id:"usage-examples",children:"Usage Examples"}),"\n",(0,a.jsx)(t.h3,{id:"static-secret-synchronization",children:"Static Secret Synchronization"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-yaml",children:"# Store a secret in Vault\n# vault kv put secret/production/database username=admin password=secret123\n\napiVersion: secrets.hashicorp.com/v1beta1\nkind: VaultStaticSecret\nmetadata:\n  name: database-secret\n  namespace: production\nspec:\n  vaultAuthRef: vault-auth\n  mount: secret\n  type: kv-v2\n  path: production/database\n  destination:\n    name: db-credentials\n    create: true\n    labels:\n      app: myapp\n    annotations:\n      managed-by: vault-secrets-operator\n  refreshAfter: 60s\n"})}),"\n",(0,a.jsx)(t.h3,{id:"dynamic-aws-credentials",children:"Dynamic AWS Credentials"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-yaml",children:'apiVersion: secrets.hashicorp.com/v1beta1\nkind: VaultDynamicSecret\nmetadata:\n  name: aws-creds\n  namespace: production\nspec:\n  vaultAuthRef: vault-auth\n  mount: aws\n  path: creds/s3-readonly\n  destination:\n    name: aws-credentials\n    create: true\n    transformation:\n      excludeRaw: true\n      templates:\n        AWS_ACCESS_KEY_ID:\n          text: "{{ .Secrets.access_key }}"\n        AWS_SECRET_ACCESS_KEY:\n          text: "{{ .Secrets.secret_key }}"\n  renewalPercent: 67\n'})}),"\n",(0,a.jsx)(t.h3,{id:"automatic-tls-certificate",children:"Automatic TLS Certificate"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-yaml",children:"apiVersion: secrets.hashicorp.com/v1beta1\nkind: VaultPKISecret\nmetadata:\n  name: nginx-tls\n  namespace: production\nspec:\n  vaultAuthRef: vault-auth\n  mount: pki\n  role: web-server\n  commonName: nginx.production.svc.cluster.local\n  altNames:\n    - nginx.example.com\n  ipSans:\n    - 10.0.0.100\n  ttl: 720h\n  destination:\n    name: nginx-tls-secret\n    create: true\n    type: kubernetes.io/tls\n  expiryOffset: 24h\n"})}),"\n",(0,a.jsx)(t.hr,{}),"\n",(0,a.jsx)(t.h2,{id:"secret-transformation",children:"Secret Transformation"}),"\n",(0,a.jsx)(t.p,{children:"Transform secrets during synchronization:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-yaml",children:'spec:\n  destination:\n    name: transformed-secret\n    transformation:\n      excludeRaw: true\n      excludes:\n        - internal_key\n      templates:\n        FORMATTED_URL:\n          text: "postgresql://{{ .Secrets.username }}:{{ .Secrets.password }}@db:5432/mydb"\n'})}),"\n",(0,a.jsx)(t.hr,{}),"\n",(0,a.jsx)(t.h2,{id:"monitoring",children:"Monitoring"}),"\n",(0,a.jsx)(t.h3,{id:"check-vaultstaticsecret-status",children:"Check VaultStaticSecret Status"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"kubectl get vaultstaticsecret -n production\nkubectl describe vaultstaticsecret database-secret -n production\n"})}),"\n",(0,a.jsx)(t.h3,{id:"view-operator-logs",children:"View Operator Logs"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"kubectl logs -n vault-secrets-operator-system -l app.kubernetes.io/name=vault-secrets-operator\n"})}),"\n",(0,a.jsx)(t.h3,{id:"prometheus-metrics",children:"Prometheus Metrics"}),"\n",(0,a.jsxs)(t.p,{children:["VSO exposes metrics at ",(0,a.jsx)(t.code,{children:"/metrics"}),":"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-yaml",children:"apiVersion: monitoring.coreos.com/v1\nkind: ServiceMonitor\nmetadata:\n  name: vault-secrets-operator\nspec:\n  selector:\n    matchLabels:\n      app.kubernetes.io/name: vault-secrets-operator\n  endpoints:\n    - port: metrics\n"})}),"\n",(0,a.jsx)(t.hr,{}),"\n",(0,a.jsx)(t.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Use Kubernetes authentication:"})," Avoid static tokens; use service account authentication."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Scope roles narrowly:"})," Grant minimum necessary permissions in Vault policies."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Enable audit logging:"})," Configure Vault audit logging for compliance and troubleshooting."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Set appropriate refresh intervals:"})," Balance security needs with Vault API load."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Use dynamic secrets:"})," Prefer dynamic secrets over static when supported by the target system."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Implement rotation:"})," Configure ",(0,a.jsx)(t.code,{children:"renewalPercent"})," for automatic credential rotation before expiry."]}),"\n"]}),"\n",(0,a.jsx)(t.hr,{}),"\n",(0,a.jsx)(t.h2,{id:"comparison-vso-vs-vault-agent-sidecar",children:"Comparison: VSO vs Vault Agent Sidecar"}),"\n",(0,a.jsxs)(t.table,{children:[(0,a.jsx)(t.thead,{children:(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.th,{children:"Feature"}),(0,a.jsx)(t.th,{children:"Vault Secrets Operator"}),(0,a.jsx)(t.th,{children:"Vault Agent Sidecar"})]})}),(0,a.jsxs)(t.tbody,{children:[(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:"Architecture"}),(0,a.jsx)(t.td,{children:"Centralized operator"}),(0,a.jsx)(t.td,{children:"Per-pod sidecar"})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:"Resource usage"}),(0,a.jsx)(t.td,{children:"Lower (shared operator)"}),(0,a.jsx)(t.td,{children:"Higher (sidecar per pod)"})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:"Secret delivery"}),(0,a.jsx)(t.td,{children:"Kubernetes Secrets"}),(0,a.jsx)(t.td,{children:"Files in shared volume"})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:"Dynamic secrets"}),(0,a.jsx)(t.td,{children:"Native support"}),(0,a.jsx)(t.td,{children:"Template rendering"})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:"Certificate management"}),(0,a.jsx)(t.td,{children:"VaultPKISecret CRD"}),(0,a.jsx)(t.td,{children:"Agent templates"})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:"Kubernetes native"}),(0,a.jsx)(t.td,{children:"Yes (CRDs)"}),(0,a.jsx)(t.td,{children:"No"})]})]})]}),"\n",(0,a.jsx)(t.hr,{}),"\n",(0,a.jsx)(t.h2,{id:"references",children:"References"}),"\n",(0,a.jsx)(t.p,{children:"This article is based on information from the following official sources:"}),"\n",(0,a.jsxs)(t.ol,{children:["\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.a,{href:"https://developer.hashicorp.com/vault/docs/platform/k8s/vso",children:"Vault Secrets Operator Documentation"})," - HashiCorp"]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.a,{href:"https://github.com/hashicorp/vault-secrets-operator",children:"Vault Secrets Operator GitHub Repository"})," - HashiCorp"]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.a,{href:"https://developer.hashicorp.com/vault/docs/auth/kubernetes",children:"Vault Kubernetes Auth Method"})," - HashiCorp"]}),"\n"]})]})}function d(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(u,{...e})}):u(e)}},8453(e,t,n){n.d(t,{R:()=>c,x:()=>i});var s=n(6540);const a={},r=s.createContext(a);function c(e){const t=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:c(e.components),s.createElement(r.Provider,{value:t},e.children)}}}]);