"use strict";(globalThis.webpackChunkk_8_s_security=globalThis.webpackChunkk_8_s_security||[]).push([[635],{8453(e,i,n){n.d(i,{R:()=>a,x:()=>l});var s=n(6540);const t={},r=s.createContext(t);function a(e){const i=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function l(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),s.createElement(r.Provider,{value:i},e.children)}},9890(e,i,n){n.r(i),n.d(i,{assets:()=>c,contentTitle:()=>l,default:()=>u,frontMatter:()=>a,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"best-practices/supply-chain-security/kubei","title":"Kubei","description":"Kubei is a Kubernetes runtime vulnerability scanner that identifies vulnerabilities in container images across your cluster in real-time.","source":"@site/docs/best-practices/supply-chain-security/kubei.md","sourceDirName":"best-practices/supply-chain-security","slug":"/best-practices/supply-chain-security/kubei","permalink":"/kubernetes-security/best-practices/supply-chain-security/kubei","draft":false,"unlisted":false,"editUrl":"https://github.com/geek-kb/k8s_security/edit/main/docs/best-practices/supply-chain-security/kubei.md","tags":[{"inline":true,"label":"tool","permalink":"/kubernetes-security/tags/tool"},{"inline":true,"label":"supply-chain","permalink":"/kubernetes-security/tags/supply-chain"},{"inline":true,"label":"vulnerability-scanning","permalink":"/kubernetes-security/tags/vulnerability-scanning"},{"inline":true,"label":"CKS","permalink":"/kubernetes-security/tags/cks"}],"version":"current","lastUpdatedBy":"Itai Ganot","lastUpdatedAt":1771236448000,"sidebarPosition":9,"frontMatter":{"sidebar_position":9,"title":"Kubei","description":"Kubei is a Kubernetes runtime vulnerability scanner that identifies vulnerabilities in container images across your cluster in real-time.","keywords":["kubernetes security tool","kubei","vulnerability scanner","container security","image scanning","runtime scanning","CVE detection","kubernetes security","CKS"],"tags":["tool","supply-chain","vulnerability-scanning","CKS"],"related":["/kubernetes-security/best-practices/monitoring-logging-and-runtime-security/trivy/","/kubernetes-security/best-practices/supply-chain-security/supply-chain-best-practices/","/kubernetes-security/best-practices/supply-chain-security/trivy-operator/"]},"sidebar":"default","previous":{"title":"KBOM","permalink":"/kubernetes-security/best-practices/supply-chain-security/kbom"},"next":{"title":"Trivy Operator","permalink":"/kubernetes-security/best-practices/supply-chain-security/trivy-operator"}}');var t=n(4848),r=n(8453);const a={sidebar_position:9,title:"Kubei",description:"Kubei is a Kubernetes runtime vulnerability scanner that identifies vulnerabilities in container images across your cluster in real-time.",keywords:["kubernetes security tool","kubei","vulnerability scanner","container security","image scanning","runtime scanning","CVE detection","kubernetes security","CKS"],tags:["tool","supply-chain","vulnerability-scanning","CKS"],related:["/kubernetes-security/best-practices/monitoring-logging-and-runtime-security/trivy/","/kubernetes-security/best-practices/supply-chain-security/supply-chain-best-practices/","/kubernetes-security/best-practices/supply-chain-security/trivy-operator/"]},l="Kubei",c={},o=[{value:"Key Features",id:"key-features",level:2},{value:"Installation",id:"installation",level:2},{value:"Using kubectl",id:"using-kubectl",level:3},{value:"Using Helm",id:"using-helm",level:3},{value:"Customized Deployment",id:"customized-deployment",level:3},{value:"Access the Dashboard",id:"access-the-dashboard",level:2},{value:"Port Forward",id:"port-forward",level:3},{value:"Expose via Ingress",id:"expose-via-ingress",level:3},{value:"Scanning Process",id:"scanning-process",level:2},{value:"1. Image Discovery",id:"1-image-discovery",level:3},{value:"2. Vulnerability Analysis",id:"2-vulnerability-analysis",level:3},{value:"3. Results Aggregation",id:"3-results-aggregation",level:3},{value:"Configuration Options",id:"configuration-options",level:2},{value:"Environment Variables",id:"environment-variables",level:3},{value:"Registry Authentication",id:"registry-authentication",level:3},{value:"API Usage",id:"api-usage",level:2},{value:"Get Scan Status",id:"get-scan-status",level:3},{value:"Trigger a Scan",id:"trigger-a-scan",level:3},{value:"Get Vulnerabilities",id:"get-vulnerabilities",level:3},{value:"Get Vulnerabilities by Severity",id:"get-vulnerabilities-by-severity",level:3},{value:"Get Image Report",id:"get-image-report",level:3},{value:"Example Vulnerability Report",id:"example-vulnerability-report",level:2},{value:"Filtering and Policies",id:"filtering-and-policies",level:2},{value:"Ignore Specific Vulnerabilities",id:"ignore-specific-vulnerabilities",level:3},{value:"Namespace Filtering",id:"namespace-filtering",level:3},{value:"CI/CD Integration",id:"cicd-integration",level:2},{value:"GitHub Actions",id:"github-actions",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Limitations",id:"limitations",level:2},{value:"References",id:"references",level:2}];function d(e){const i={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.header,{children:(0,t.jsx)(i.h1,{id:"kubei",children:"Kubei"})}),"\n",(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.strong,{children:"Kubei"})," is a Kubernetes runtime vulnerability scanner developed by Portshift (now part of Cisco). It scans container images deployed in your cluster to identify known vulnerabilities (CVEs) in real-time. Unlike CI/CD-time scanning, Kubei provides continuous visibility into what is actually running in production."]}),"\n",(0,t.jsx)(i.p,{children:"Kubei deploys a scanner pod that analyzes images from your cluster's container registry and reports findings through a web dashboard."}),"\n",(0,t.jsx)(i.hr,{}),"\n",(0,t.jsx)(i.h2,{id:"key-features",children:"Key Features"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Runtime image scanning"})," of deployed containers."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Automatic discovery"})," of all images in the cluster."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"CVE database"})," integration for vulnerability detection."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Web dashboard"})," for visualization and reporting."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"CI/CD integration"})," via API."]}),"\n"]}),"\n",(0,t.jsx)(i.hr,{}),"\n",(0,t.jsx)(i.h2,{id:"installation",children:"Installation"}),"\n",(0,t.jsx)(i.h3,{id:"using-kubectl",children:"Using kubectl"}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-bash",children:"kubectl apply -f https://raw.githubusercontent.com/Portshift/kubei/master/deploy/kubei.yaml\n"})}),"\n",(0,t.jsx)(i.h3,{id:"using-helm",children:"Using Helm"}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-bash",children:"helm repo add kubei https://portshift.github.io/kubei\nhelm install kubei kubei/kubei --namespace kubei --create-namespace\n"})}),"\n",(0,t.jsx)(i.h3,{id:"customized-deployment",children:"Customized Deployment"}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-yaml",children:'apiVersion: v1\nkind: Namespace\nmetadata:\n  name: kubei\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: kubei\n  namespace: kubei\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: kubei\n  template:\n    metadata:\n      labels:\n        app: kubei\n    spec:\n      serviceAccountName: kubei\n      containers:\n        - name: kubei\n          image: portshift/kubei:latest\n          ports:\n            - containerPort: 8080\n          env:\n            - name: SCANNER_IMAGE\n              value: "portshift/kubei-scanner:latest"\n            - name: SCAN_INTERVAL\n              value: "24h"\n            - name: SEVERITY_THRESHOLD\n              value: "HIGH"\n          volumeMounts:\n            - name: docker-config\n              mountPath: /root/.docker\n              readOnly: true\n      volumes:\n        - name: docker-config\n          secret:\n            secretName: registry-credentials\n            optional: true\n'})}),"\n",(0,t.jsx)(i.hr,{}),"\n",(0,t.jsx)(i.h2,{id:"access-the-dashboard",children:"Access the Dashboard"}),"\n",(0,t.jsx)(i.h3,{id:"port-forward",children:"Port Forward"}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-bash",children:"kubectl port-forward -n kubei svc/kubei 8080:8080\n"})}),"\n",(0,t.jsxs)(i.p,{children:["Access the dashboard at ",(0,t.jsx)(i.code,{children:"http://localhost:8080"})]}),"\n",(0,t.jsx)(i.h3,{id:"expose-via-ingress",children:"Expose via Ingress"}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-yaml",children:"apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: kubei\n  namespace: kubei\nspec:\n  rules:\n    - host: kubei.example.com\n      http:\n        paths:\n          - path: /\n            pathType: Prefix\n            backend:\n              service:\n                name: kubei\n                port:\n                  number: 8080\n"})}),"\n",(0,t.jsx)(i.hr,{}),"\n",(0,t.jsx)(i.h2,{id:"scanning-process",children:"Scanning Process"}),"\n",(0,t.jsx)(i.h3,{id:"1-image-discovery",children:"1. Image Discovery"}),"\n",(0,t.jsx)(i.p,{children:"Kubei automatically discovers all container images running in the cluster:"}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{children:"Images discovered:\n- nginx:1.25.3 (10 pods)\n- redis:7.2.3 (3 pods)\n- my-app:v1.2.3 (5 pods)\n"})}),"\n",(0,t.jsx)(i.h3,{id:"2-vulnerability-analysis",children:"2. Vulnerability Analysis"}),"\n",(0,t.jsx)(i.p,{children:"Each image is scanned against vulnerability databases:"}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{children:"Image: nginx:1.25.3\nTotal Vulnerabilities: 15\n- Critical: 0\n- High: 2\n- Medium: 8\n- Low: 5\n"})}),"\n",(0,t.jsx)(i.h3,{id:"3-results-aggregation",children:"3. Results Aggregation"}),"\n",(0,t.jsx)(i.p,{children:"Findings are aggregated at namespace and cluster levels."}),"\n",(0,t.jsx)(i.hr,{}),"\n",(0,t.jsx)(i.h2,{id:"configuration-options",children:"Configuration Options"}),"\n",(0,t.jsx)(i.h3,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,t.jsxs)(i.table,{children:[(0,t.jsx)(i.thead,{children:(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.th,{children:"Variable"}),(0,t.jsx)(i.th,{children:"Description"}),(0,t.jsx)(i.th,{children:"Default"})]})}),(0,t.jsxs)(i.tbody,{children:[(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.td,{children:"SCAN_INTERVAL"}),(0,t.jsx)(i.td,{children:"Time between full cluster scans"}),(0,t.jsx)(i.td,{children:"24h"})]}),(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.td,{children:"SEVERITY_THRESHOLD"}),(0,t.jsx)(i.td,{children:"Minimum severity to report"}),(0,t.jsx)(i.td,{children:"MEDIUM"})]}),(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.td,{children:"SCANNER_IMAGE"}),(0,t.jsx)(i.td,{children:"Scanner sidecar image"}),(0,t.jsxs)(i.td,{children:["portshift/kubei-scanner",":latest"]})]}),(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.td,{children:"CONCURRENT_SCANS"}),(0,t.jsx)(i.td,{children:"Number of parallel scans"}),(0,t.jsx)(i.td,{children:"3"})]}),(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.td,{children:"IGNORE_NAMESPACES"}),(0,t.jsx)(i.td,{children:"Namespaces to skip"}),(0,t.jsx)(i.td,{children:"kube-system"})]})]})]}),"\n",(0,t.jsx)(i.h3,{id:"registry-authentication",children:"Registry Authentication"}),"\n",(0,t.jsx)(i.p,{children:"For private registries, create a secret:"}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-bash",children:"kubectl create secret docker-registry registry-credentials \\\n  --namespace kubei \\\n  --docker-server=my-registry.example.com \\\n  --docker-username=user \\\n  --docker-password=password\n"})}),"\n",(0,t.jsx)(i.hr,{}),"\n",(0,t.jsx)(i.h2,{id:"api-usage",children:"API Usage"}),"\n",(0,t.jsx)(i.h3,{id:"get-scan-status",children:"Get Scan Status"}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-bash",children:"curl http://localhost:8080/api/v1/scan/status\n"})}),"\n",(0,t.jsx)(i.h3,{id:"trigger-a-scan",children:"Trigger a Scan"}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-bash",children:"curl -X POST http://localhost:8080/api/v1/scan/start\n"})}),"\n",(0,t.jsx)(i.h3,{id:"get-vulnerabilities",children:"Get Vulnerabilities"}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-bash",children:"curl http://localhost:8080/api/v1/vulnerabilities\n"})}),"\n",(0,t.jsx)(i.h3,{id:"get-vulnerabilities-by-severity",children:"Get Vulnerabilities by Severity"}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-bash",children:'curl "http://localhost:8080/api/v1/vulnerabilities?severity=critical,high"\n'})}),"\n",(0,t.jsx)(i.h3,{id:"get-image-report",children:"Get Image Report"}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-bash",children:'curl "http://localhost:8080/api/v1/images/nginx:1.25.3/vulnerabilities"\n'})}),"\n",(0,t.jsx)(i.hr,{}),"\n",(0,t.jsx)(i.h2,{id:"example-vulnerability-report",children:"Example Vulnerability Report"}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-json",children:'{\n  "image": "nginx:1.25.3",\n  "scannedAt": "2024-01-15T10:30:00Z",\n  "vulnerabilities": [\n    {\n      "id": "CVE-2023-44487",\n      "severity": "HIGH",\n      "package": "nghttp2",\n      "installedVersion": "1.51.0",\n      "fixedVersion": "1.57.0",\n      "description": "HTTP/2 Rapid Reset Attack",\n      "links": [\n        "https://nvd.nist.gov/vuln/detail/CVE-2023-44487"\n      ]\n    }\n  ],\n  "summary": {\n    "critical": 0,\n    "high": 2,\n    "medium": 8,\n    "low": 5\n  }\n}\n'})}),"\n",(0,t.jsx)(i.hr,{}),"\n",(0,t.jsx)(i.h2,{id:"filtering-and-policies",children:"Filtering and Policies"}),"\n",(0,t.jsx)(i.h3,{id:"ignore-specific-vulnerabilities",children:"Ignore Specific Vulnerabilities"}),"\n",(0,t.jsx)(i.p,{children:"Create an ignore list for accepted risks:"}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-yaml",children:"apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: kubei-config\n  namespace: kubei\ndata:\n  ignore-vulnerabilities: |\n    - CVE-2023-1234\n    - CVE-2023-5678\n"})}),"\n",(0,t.jsx)(i.h3,{id:"namespace-filtering",children:"Namespace Filtering"}),"\n",(0,t.jsx)(i.p,{children:"Scan only specific namespaces:"}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-yaml",children:'env:\n  - name: TARGET_NAMESPACES\n    value: "production,staging"\n'})}),"\n",(0,t.jsx)(i.hr,{}),"\n",(0,t.jsx)(i.h2,{id:"cicd-integration",children:"CI/CD Integration"}),"\n",(0,t.jsx)(i.h3,{id:"github-actions",children:"GitHub Actions"}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-yaml",children:'name: Image Security Gate\non:\n  deployment:\n\njobs:\n  check-vulnerabilities:\n    runs-on: ubuntu-latest\n    steps:\n      - name: Check image vulnerabilities\n        run: |\n          VULNS=$(curl -s "http://kubei.example.com/api/v1/images/${{ env.IMAGE }}/vulnerabilities")\n          CRITICAL=$(echo $VULNS | jq \'.summary.critical\')\n          if [ "$CRITICAL" -gt 0 ]; then\n            echo "Critical vulnerabilities found!"\n            exit 1\n          fi\n'})}),"\n",(0,t.jsx)(i.hr,{}),"\n",(0,t.jsx)(i.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Scan continuously:"})," Enable automatic periodic scanning to catch new CVEs."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Set severity thresholds:"})," Alert on critical and high severity findings."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Integrate with CI/CD:"})," Block deployments of images with critical vulnerabilities."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Update regularly:"})," Keep Kubei and its vulnerability database current."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Review ignored CVEs:"})," Periodically review the ignore list for accepted risks."]}),"\n"]}),"\n",(0,t.jsx)(i.hr,{}),"\n",(0,t.jsx)(i.h2,{id:"limitations",children:"Limitations"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Scans container images, not application code."}),"\n",(0,t.jsx)(i.li,{children:"Requires registry access for private images."}),"\n",(0,t.jsx)(i.li,{children:"Does not provide runtime behavior analysis."}),"\n",(0,t.jsx)(i.li,{children:"Vulnerability database coverage depends on upstream sources."}),"\n"]}),"\n",(0,t.jsx)(i.hr,{}),"\n",(0,t.jsx)(i.h2,{id:"references",children:"References"}),"\n",(0,t.jsx)(i.p,{children:"This article is based on information from the following official sources:"}),"\n",(0,t.jsxs)(i.ol,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.a,{href:"https://github.com/Portshift/kubei",children:"Kubei GitHub Repository"})," - Portshift/Cisco"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.a,{href:"https://cve.mitre.org/",children:"CVE Database"})," - MITRE"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.a,{href:"https://kubernetes.io/docs/concepts/security/",children:"Container Security Best Practices"})," - Kubernetes Documentation"]}),"\n"]})]})}function u(e={}){const{wrapper:i}={...(0,r.R)(),...e.components};return i?(0,t.jsx)(i,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}}}]);