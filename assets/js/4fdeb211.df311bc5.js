"use strict";(globalThis.webpackChunkk_8_s_security=globalThis.webpackChunkk_8_s_security||[]).push([[858],{632(e,t,s){s.r(t),s.d(t,{assets:()=>o,contentTitle:()=>a,default:()=>u,frontMatter:()=>i,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"attack-vectors/unrestricted-etcd-access","title":"Unrestricted etcd Access","description":"How attackers exploit unrestricted access to etcd to retrieve Kubernetes secrets and take control of the cluster.","source":"@site/docs/attack-vectors/unrestricted-etcd-access.md","sourceDirName":"attack-vectors","slug":"/attack-vectors/unrestricted-etcd-access","permalink":"/kubernetes-security/attack-vectors/unrestricted-etcd-access","draft":false,"unlisted":false,"editUrl":"https://github.com/geek-kb/k8s_security/edit/main/docs/attack-vectors/unrestricted-etcd-access.md","tags":[{"inline":true,"label":"attack-vector","permalink":"/kubernetes-security/tags/attack-vector"},{"inline":true,"label":"etcd","permalink":"/kubernetes-security/tags/etcd"},{"inline":true,"label":"control-plane","permalink":"/kubernetes-security/tags/control-plane"},{"inline":true,"label":"secrets","permalink":"/kubernetes-security/tags/secrets"},{"inline":true,"label":"CKS","permalink":"/kubernetes-security/tags/cks"}],"version":"current","lastUpdatedBy":"Itai Ganot","lastUpdatedAt":1771236448000,"sidebarPosition":7,"frontMatter":{"sidebar_position":7,"title":"Unrestricted etcd Access","description":"How attackers exploit unrestricted access to etcd to retrieve Kubernetes secrets and take control of the cluster.","keywords":["kubernetes security","etcd security","etcd access","secrets exposure","cluster compromise","etcd encryption","control plane security","kubernetes secrets","etcd vulnerability","CKS"],"tags":["attack-vector","etcd","control-plane","secrets","CKS"],"related":["/kubernetes-security/best-practices/cluster-setup-and-hardening/control-plane-security/etcd-security-mitigation/","/kubernetes-security/attack-vectors/insecure-secrets-management/","/kubernetes-security/best-practices/cluster-setup-and-hardening/secrets-management/sealed-secrets/","/kubernetes-security/best-practices/cluster-setup-and-hardening/cis/cis-benchmark-for-k8s/"]},"sidebar":"default","previous":{"title":"Supply Chain Attacks","permalink":"/kubernetes-security/attack-vectors/supply-chain-attacks"},"next":{"title":"Insecure RBAC Permissions","permalink":"/kubernetes-security/attack-vectors/insecure-rbac-permissions"}}');var c=s(4848),n=s(8453);const i={sidebar_position:7,title:"Unrestricted etcd Access",description:"How attackers exploit unrestricted access to etcd to retrieve Kubernetes secrets and take control of the cluster.",keywords:["kubernetes security","etcd security","etcd access","secrets exposure","cluster compromise","etcd encryption","control plane security","kubernetes secrets","etcd vulnerability","CKS"],tags:["attack-vector","etcd","control-plane","secrets","CKS"],related:["/kubernetes-security/best-practices/cluster-setup-and-hardening/control-plane-security/etcd-security-mitigation/","/kubernetes-security/attack-vectors/insecure-secrets-management/","/kubernetes-security/best-practices/cluster-setup-and-hardening/secrets-management/sealed-secrets/","/kubernetes-security/best-practices/cluster-setup-and-hardening/cis/cis-benchmark-for-k8s/"]},a="Unrestricted etcd Access",o={},l=[{value:"Exploitation Steps",id:"exploitation-steps",level:2},{value:"1. Scan for Open etcd Endpoints",id:"1-scan-for-open-etcd-endpoints",level:3},{value:"2. Enumerate etcd Keys",id:"2-enumerate-etcd-keys",level:3},{value:"3. Extract Kubernetes Secrets",id:"3-extract-kubernetes-secrets",level:3},{value:"4. Modify Cluster Configuration",id:"4-modify-cluster-configuration",level:3},{value:"Result",id:"result",level:3},{value:"Mitigation",id:"mitigation",level:2},{value:"References",id:"references",level:2}];function d(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,n.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(t.header,{children:(0,c.jsx)(t.h1,{id:"unrestricted-etcd-access",children:"Unrestricted etcd Access"})}),"\n",(0,c.jsxs)(t.p,{children:[(0,c.jsx)(t.strong,{children:"etcd"})," is the key-value store that holds all Kubernetes cluster data, including ",(0,c.jsx)(t.strong,{children:"secrets, configuration, and state"}),". If exposed or misconfigured, it becomes a high-value target for attackers who can ",(0,c.jsx)(t.strong,{children:"retrieve credentials, modify cluster settings, or delete critical resources"}),"."]}),"\n",(0,c.jsx)(t.hr,{}),"\n",(0,c.jsx)(t.h2,{id:"exploitation-steps",children:"Exploitation Steps"}),"\n",(0,c.jsxs)(t.p,{children:["An attacker targets an unprotected ",(0,c.jsx)(t.code,{children:"etcd"})," endpoint to access or manipulate cluster-wide data."]}),"\n",(0,c.jsx)(t.h3,{id:"1-scan-for-open-etcd-endpoints",children:"1. Scan for Open etcd Endpoints"}),"\n",(0,c.jsxs)(t.p,{children:["The attacker scans the network to locate accessible etcd instances (port ",(0,c.jsx)(t.code,{children:"2379"}),"):"]}),"\n",(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-bash",children:"nmap -p 2379 --open <cluster-ip-range>\n"})}),"\n",(0,c.jsxs)(t.p,{children:["If port ",(0,c.jsx)(t.code,{children:"2379"})," is exposed, the attacker targets it for further exploitation."]}),"\n",(0,c.jsx)(t.hr,{}),"\n",(0,c.jsx)(t.h3,{id:"2-enumerate-etcd-keys",children:"2. Enumerate etcd Keys"}),"\n",(0,c.jsx)(t.p,{children:"Without authentication or TLS, the attacker can query the keyspace:"}),"\n",(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-bash",children:"ETCDCTL_API=3 etcdctl --endpoints=<etcd-ip>:2379 get / --prefix --keys-only\n"})}),"\n",(0,c.jsxs)(t.p,{children:["This reveals the structure and contents of etcd, including keys under ",(0,c.jsx)(t.code,{children:"/registry/"})," that store Kubernetes resources."]}),"\n",(0,c.jsx)(t.hr,{}),"\n",(0,c.jsx)(t.h3,{id:"3-extract-kubernetes-secrets",children:"3. Extract Kubernetes Secrets"}),"\n",(0,c.jsx)(t.p,{children:"The attacker dumps secrets directly from etcd:"}),"\n",(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-bash",children:"ETCDCTL_API=3 etcdctl --endpoints=<etcd-ip>:2379 get /registry/secrets --prefix\n"})}),"\n",(0,c.jsx)(t.p,{children:"This includes service account tokens, API keys, kubeconfig files, and other sensitive credentials."}),"\n",(0,c.jsx)(t.hr,{}),"\n",(0,c.jsx)(t.h3,{id:"4-modify-cluster-configuration",children:"4. Modify Cluster Configuration"}),"\n",(0,c.jsx)(t.p,{children:"With write access, the attacker injects new configuration or escalates privileges:"}),"\n",(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-bash",children:'ETCDCTL_API=3 etcdctl --endpoints=<etcd-ip>:2379 put /registry/rbac/rolebindings/cluster-admin \'{"user": "attacker", "role": "cluster-admin"}\'\n'})}),"\n",(0,c.jsxs)(t.p,{children:["This effectively grants ",(0,c.jsx)(t.code,{children:"cluster-admin"})," rights to any user they choose."]}),"\n",(0,c.jsx)(t.hr,{}),"\n",(0,c.jsx)(t.h3,{id:"result",children:"Result"}),"\n",(0,c.jsx)(t.p,{children:"The attacker achieves full compromise of the Kubernetes cluster by:"}),"\n",(0,c.jsxs)(t.ul,{children:["\n",(0,c.jsx)(t.li,{children:"Extracting sensitive secrets"}),"\n",(0,c.jsx)(t.li,{children:"Gaining persistent admin access"}),"\n",(0,c.jsx)(t.li,{children:"Modifying or deleting critical cluster resources"}),"\n"]}),"\n",(0,c.jsxs)(t.p,{children:["If etcd is not protected, the ",(0,c.jsx)(t.strong,{children:"entire cluster is at risk"}),"."]}),"\n",(0,c.jsx)(t.hr,{}),"\n",(0,c.jsx)(t.h2,{id:"mitigation",children:"Mitigation"}),"\n",(0,c.jsxs)(t.p,{children:["\u27a1 ",(0,c.jsx)(t.a,{href:"/kubernetes-security/best-practices/cluster-setup-and-hardening/control-plane-security/etcd-security-mitigation",children:"Securing etcd in Kubernetes"})]}),"\n",(0,c.jsx)(t.hr,{}),"\n",(0,c.jsx)(t.h2,{id:"references",children:"References"}),"\n",(0,c.jsx)(t.p,{children:"This article is based on information from the following official sources:"}),"\n",(0,c.jsxs)(t.ol,{children:["\n",(0,c.jsxs)(t.li,{children:[(0,c.jsx)(t.a,{href:"https://kubernetes.io/docs/tasks/administer-cluster/configure-upgrade-etcd/",children:"Operating etcd clusters for Kubernetes"})," - Kubernetes Documentation"]}),"\n",(0,c.jsxs)(t.li,{children:[(0,c.jsx)(t.a,{href:"https://etcd.io/docs/v3.5/op-guide/security/",children:"etcd Security Model"})," - etcd Documentation"]}),"\n",(0,c.jsxs)(t.li,{children:[(0,c.jsx)(t.a,{href:"https://www.cisecurity.org/benchmark/kubernetes",children:"CIS Kubernetes Benchmark"})," - Center for Internet Security"]}),"\n"]})]})}function u(e={}){const{wrapper:t}={...(0,n.R)(),...e.components};return t?(0,c.jsx)(t,{...e,children:(0,c.jsx)(d,{...e})}):d(e)}},8453(e,t,s){s.d(t,{R:()=>i,x:()=>a});var r=s(6540);const c={},n=r.createContext(c);function i(e){const t=r.useContext(n);return r.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:i(e.components),r.createElement(n.Provider,{value:t},e.children)}}}]);