"use strict";(globalThis.webpackChunkk_8_s_security=globalThis.webpackChunkk_8_s_security||[]).push([[4805],{8165(e,o,n){n.r(o),n.d(o,{assets:()=>h,contentTitle:()=>a,default:()=>d,frontMatter:()=>s,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"fundamentals/authorization/webhook_authorization","title":"Webhook Authorization","description":"Required knowledge for the CKS certification.","source":"@site/docs/fundamentals/authorization/webhook_authorization.md","sourceDirName":"fundamentals/authorization","slug":"/fundamentals/authorization/webhook_authorization","permalink":"/docs/fundamentals/authorization/webhook_authorization","draft":false,"unlisted":false,"editUrl":"https://github.com/geek-kb/k8s_security/edit/main/docs/fundamentals/authorization/webhook_authorization.md","tags":[],"version":"current","lastUpdatedBy":"Itai Ganot","lastUpdatedAt":1765581437000,"sidebarPosition":4,"frontMatter":{"title":"Webhook Authorization","sidebar_position":4,"keywords":["kubernetes webhook authorization","authorization webhook","external authorization","webhook authorizer","kubernetes authorization","access control webhook","authorization modes","kubernetes security","CKS"]},"sidebar":"default","previous":{"title":"Node Authorization","permalink":"/docs/fundamentals/authorization/node_authorization"},"next":{"title":"Section Introduction","permalink":"/docs/attack_vectors/intro"}}');var t=n(4848),r=n(8453);const s={title:"Webhook Authorization",sidebar_position:4,keywords:["kubernetes webhook authorization","authorization webhook","external authorization","webhook authorizer","kubernetes authorization","access control webhook","authorization modes","kubernetes security","CKS"]},a="Webhook Authorization in Kubernetes",h={},l=[{value:"What is Webhook Authorization?",id:"what-is-webhook-authorization",level:2},{value:"How Does Webhook Authorization Work?",id:"how-does-webhook-authorization-work",level:2},{value:"Enabling Webhook Authorization",id:"enabling-webhook-authorization",level:2},{value:"Example Webhook Configuration",id:"example-webhook-configuration",level:3},{value:"Webhook Authorization Request and Response",id:"webhook-authorization-request-and-response",level:2},{value:"Request Example",id:"request-example",level:3},{value:"Response Example",id:"response-example",level:3},{value:"Best Practices for Webhook Authorization",id:"best-practices-for-webhook-authorization",level:2},{value:"When to Use Webhook Authorization",id:"when-to-use-webhook-authorization",level:2},{value:"Conclusion: Flexibility and Control with Webhook Authorization",id:"conclusion-flexibility-and-control-with-webhook-authorization",level:2}];function c(e){const o={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.header,{children:(0,t.jsx)(o.h1,{id:"webhook-authorization-in-kubernetes",children:"Webhook Authorization in Kubernetes"})}),"\n",(0,t.jsx)(o.p,{children:(0,t.jsx)(o.strong,{children:"Required knowledge for the CKS certification."})}),"\n",(0,t.jsx)(o.h2,{id:"what-is-webhook-authorization",children:"What is Webhook Authorization?"}),"\n",(0,t.jsxs)(o.p,{children:[(0,t.jsx)(o.strong,{children:"Webhook Authorization"})," allows Kubernetes to ",(0,t.jsx)(o.strong,{children:"delegate authorization decisions"})," to an ",(0,t.jsx)(o.strong,{children:"external service"})," via a ",(0,t.jsx)(o.strong,{children:"webhook"}),". It is ideal for ",(0,t.jsx)(o.strong,{children:"custom authorization scenarios"})," that go beyond the capabilities of ",(0,t.jsx)(o.strong,{children:"RBAC"})," and ",(0,t.jsx)(o.strong,{children:"Node Authorization"}),"."]}),"\n",(0,t.jsx)(o.hr,{}),"\n",(0,t.jsx)(o.h2,{id:"how-does-webhook-authorization-work",children:"How Does Webhook Authorization Work?"}),"\n",(0,t.jsxs)(o.ol,{children:["\n",(0,t.jsxs)(o.li,{children:[(0,t.jsx)(o.strong,{children:"Request Handling:"})," When a ",(0,t.jsx)(o.strong,{children:"request"})," is made to the ",(0,t.jsx)(o.strong,{children:"API server"}),", it is sent to the ",(0,t.jsx)(o.strong,{children:"Webhook service"}),"."]}),"\n",(0,t.jsxs)(o.li,{children:[(0,t.jsx)(o.strong,{children:"Decision Making:"})," The ",(0,t.jsx)(o.strong,{children:"Webhook service"})," evaluates the request against ",(0,t.jsx)(o.strong,{children:"custom policies"}),"."]}),"\n",(0,t.jsxs)(o.li,{children:[(0,t.jsx)(o.strong,{children:"Response:"})," The service returns an ",(0,t.jsx)(o.strong,{children:"ALLOW"})," or ",(0,t.jsx)(o.strong,{children:"DENY"})," decision to the ",(0,t.jsx)(o.strong,{children:"API server"}),"."]}),"\n"]}),"\n",(0,t.jsx)(o.hr,{}),"\n",(0,t.jsx)(o.h2,{id:"enabling-webhook-authorization",children:"Enabling Webhook Authorization"}),"\n",(0,t.jsxs)(o.p,{children:["To enable ",(0,t.jsx)(o.strong,{children:"Webhook Authorization"}),", configure the ",(0,t.jsx)(o.strong,{children:"API server"})," with the appropriate ",(0,t.jsx)(o.strong,{children:"flags"}),":"]}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-bash",children:"kube-apiserver \\\n  --authorization-mode=Webhook,RBAC \\\n  --authorization-webhook-config-file=/etc/kubernetes/webhook-config.yaml\n"})}),"\n",(0,t.jsx)(o.h3,{id:"example-webhook-configuration",children:"Example Webhook Configuration"}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-yaml",children:"apiVersion: v1\nkind: Config\nclusters:\n  - name: webhook-authz\n    cluster:\n      server: https://authz.example.com/authorize\n      certificate-authority: /path/to/ca.crt\nusers:\n  - name: webhook-authz\ncontexts:\n  - name: webhook-authz\n    context:\n      cluster: webhook-authz\n      user: webhook-authz\ncurrent-context: webhook-authz\n"})}),"\n",(0,t.jsx)(o.hr,{}),"\n",(0,t.jsx)(o.h2,{id:"webhook-authorization-request-and-response",children:"Webhook Authorization Request and Response"}),"\n",(0,t.jsx)(o.h3,{id:"request-example",children:"Request Example"}),"\n",(0,t.jsxs)(o.p,{children:["The ",(0,t.jsx)(o.strong,{children:"API server"})," sends a ",(0,t.jsx)(o.strong,{children:"JSON request"})," to the ",(0,t.jsx)(o.strong,{children:"webhook"})," service:"]}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-json",children:'{\n  "apiVersion": "authorization.k8s.io/v1",\n  "kind": "SubjectAccessReview",\n  "spec": {\n    "user": "jane.doe",\n    "groups": ["dev-team"],\n    "resourceAttributes": {\n      "namespace": "default",\n      "verb": "get",\n      "resource": "pods"\n    }\n  }\n}\n'})}),"\n",(0,t.jsx)(o.h3,{id:"response-example",children:"Response Example"}),"\n",(0,t.jsxs)(o.p,{children:["The ",(0,t.jsx)(o.strong,{children:"webhook service"})," returns ",(0,t.jsx)(o.strong,{children:"ALLOW"})," or ",(0,t.jsx)(o.strong,{children:"DENY"}),":"]}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-json",children:'{\n  "apiVersion": "authorization.k8s.io/v1",\n  "kind": "SubjectAccessReview",\n  "status": {\n    "allowed": true,\n    "reason": "User is authorized to get pods in the default namespace"\n  }\n}\n'})}),"\n",(0,t.jsx)(o.hr,{}),"\n",(0,t.jsx)(o.h2,{id:"best-practices-for-webhook-authorization",children:"Best Practices for Webhook Authorization"}),"\n",(0,t.jsxs)(o.ol,{children:["\n",(0,t.jsxs)(o.li,{children:[(0,t.jsx)(o.strong,{children:"Secure Webhook Communication:"}),"\nUse ",(0,t.jsx)(o.strong,{children:"HTTPS"})," with ",(0,t.jsx)(o.strong,{children:"mutual TLS"})," to secure communications between the ",(0,t.jsx)(o.strong,{children:"API server"})," and the ",(0,t.jsx)(o.strong,{children:"Webhook service"}),".",(0,t.jsx)("br",{})]}),"\n",(0,t.jsxs)(o.li,{children:[(0,t.jsx)(o.strong,{children:"Implement High Availability:"}),"\nEnsure the ",(0,t.jsx)(o.strong,{children:"Webhook service"})," is ",(0,t.jsx)(o.strong,{children:"highly available"})," to avoid ",(0,t.jsx)(o.strong,{children:"authorization disruptions"}),".",(0,t.jsx)("br",{})]}),"\n",(0,t.jsxs)(o.li,{children:[(0,t.jsx)(o.strong,{children:"Timeouts and Failures:"}),"\nConfigure ",(0,t.jsx)(o.strong,{children:"timeouts"})," and ",(0,t.jsx)(o.strong,{children:"failure policies"})," to handle ",(0,t.jsx)(o.strong,{children:"webhook unavailability"})," gracefully.",(0,t.jsx)("br",{})]}),"\n"]}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-yaml",children:"failurePolicy: Ignore\ntimeoutSeconds: 5\n"})}),"\n",(0,t.jsxs)(o.ol,{start:"4",children:["\n",(0,t.jsxs)(o.li,{children:[(0,t.jsx)(o.strong,{children:"Logging and Auditing:"}),"\nEnable ",(0,t.jsx)(o.strong,{children:"logging"})," on the ",(0,t.jsx)(o.strong,{children:"Webhook service"})," to ",(0,t.jsx)(o.strong,{children:"audit authorization decisions"}),".",(0,t.jsx)("br",{})]}),"\n"]}),"\n",(0,t.jsx)(o.hr,{}),"\n",(0,t.jsx)(o.h2,{id:"when-to-use-webhook-authorization",children:"When to Use Webhook Authorization"}),"\n",(0,t.jsxs)(o.ul,{children:["\n",(0,t.jsxs)(o.li,{children:["When ",(0,t.jsx)(o.strong,{children:"RBAC"})," and ",(0,t.jsx)(o.strong,{children:"ABAC"})," do not meet specific ",(0,t.jsx)(o.strong,{children:"authorization requirements"}),".",(0,t.jsx)("br",{})]}),"\n",(0,t.jsxs)(o.li,{children:["To ",(0,t.jsx)(o.strong,{children:"integrate external systems"})," with ",(0,t.jsx)(o.strong,{children:"custom business logic"}),".",(0,t.jsx)("br",{})]}),"\n",(0,t.jsxs)(o.li,{children:["When using ",(0,t.jsx)(o.strong,{children:"dynamic policies"})," that need to be ",(0,t.jsx)(o.strong,{children:"centrally managed"}),".",(0,t.jsx)("br",{})]}),"\n"]}),"\n",(0,t.jsx)(o.hr,{}),"\n",(0,t.jsx)(o.h2,{id:"conclusion-flexibility-and-control-with-webhook-authorization",children:"Conclusion: Flexibility and Control with Webhook Authorization"}),"\n",(0,t.jsxs)(o.p,{children:[(0,t.jsx)(o.strong,{children:"Webhook Authorization"})," offers ",(0,t.jsx)(o.strong,{children:"flexibility"})," by allowing ",(0,t.jsx)(o.strong,{children:"custom authorization logic"})," via ",(0,t.jsx)(o.strong,{children:"external services"}),". It is particularly useful in ",(0,t.jsx)(o.strong,{children:"enterprise environments"})," with ",(0,t.jsx)(o.strong,{children:"complex authorization requirements"})," that need to integrate with ",(0,t.jsx)(o.strong,{children:"external identity or policy services"}),"."]})]})}function d(e={}){const{wrapper:o}={...(0,r.R)(),...e.components};return o?(0,t.jsx)(o,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},8453(e,o,n){n.d(o,{R:()=>s,x:()=>a});var i=n(6540);const t={},r=i.createContext(t);function s(e){const o=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(o):{...o,...e}},[o,e])}function a(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),i.createElement(r.Provider,{value:o},e.children)}}}]);