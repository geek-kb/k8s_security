"use strict";(self.webpackChunkk_8_s_security=self.webpackChunkk_8_s_security||[]).push([[1046],{2128:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>i,metadata:()=>n,toc:()=>o});const n=JSON.parse('{"id":"best_practices/cluster_setup_and_hardening/control_plane_security/etcd_security_mitigation","title":"Securing etcd in Kubernetes","description":"Best practices for securing etcd, Kubernetes\' key-value store, to prevent unauthorized access and data compromise.","source":"@site/docs/best_practices/cluster_setup_and_hardening/control_plane_security/etcd_security_mitigation.md","sourceDirName":"best_practices/cluster_setup_and_hardening/control_plane_security","slug":"/best_practices/cluster_setup_and_hardening/control_plane_security/etcd_security_mitigation","permalink":"/k8s_security/docs/best_practices/cluster_setup_and_hardening/control_plane_security/etcd_security_mitigation","draft":false,"unlisted":false,"editUrl":"https://github.com/geek-kb/k8s_security/edit/main/docs/best_practices/cluster_setup_and_hardening/control_plane_security/etcd_security_mitigation.md","tags":[],"version":"current","lastUpdatedBy":"Itai Ganot","lastUpdatedAt":1742746202000,"sidebarPosition":1,"frontMatter":{"sidebar_position":1,"title":"Securing etcd in Kubernetes","description":"Best practices for securing etcd, Kubernetes\' key-value store, to prevent unauthorized access and data compromise."},"sidebar":"default","previous":{"title":"Securing Kubernetes Admission Controllers","permalink":"/k8s_security/docs/best_practices/cluster_setup_and_hardening/api_server_security/misconfigured_admission_controllers_mitigation"},"next":{"title":"Section Introduction","permalink":"/k8s_security/docs/best_practices/cluster_setup_and_hardening/network_security/intro"}}');var c=s(4848),r=s(8453);const i={sidebar_position:1,title:"Securing etcd in Kubernetes",description:"Best practices for securing etcd, Kubernetes' key-value store, to prevent unauthorized access and data compromise."},a="Securing etcd in Kubernetes",l={},o=[{value:"1. Enable TLS Encryption for etcd Communication",id:"1-enable-tls-encryption-for-etcd-communication",level:2},{value:"Secure etcd with TLS",id:"secure-etcd-with-tls",level:3},{value:"Why It Matters",id:"why-it-matters",level:3},{value:"2. Restrict Access to etcd",id:"2-restrict-access-to-etcd",level:2},{value:"Configure etcd to Listen Only on Secure Interfaces",id:"configure-etcd-to-listen-only-on-secure-interfaces",level:3},{value:"Why It Matters",id:"why-it-matters-1",level:3},{value:"3. Enforce Authentication and Role-Based Access Control (RBAC)",id:"3-enforce-authentication-and-role-based-access-control-rbac",level:2},{value:"Secure etcd with Authentication",id:"secure-etcd-with-authentication",level:3},{value:"Why It Matters",id:"why-it-matters-2",level:3},{value:"4. Secure etcd Backups",id:"4-secure-etcd-backups",level:2},{value:"Backup etcd with Encryption",id:"backup-etcd-with-encryption",level:3},{value:"Why It Matters",id:"why-it-matters-3",level:3},{value:"5. Isolate etcd from Untrusted Networks",id:"5-isolate-etcd-from-untrusted-networks",level:2},{value:"Block External etcd Access with iptables",id:"block-external-etcd-access-with-iptables",level:3},{value:"Why It Matters",id:"why-it-matters-4",level:3},{value:"Conclusion",id:"conclusion",level:2}];function d(e){const t={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(t.header,{children:(0,c.jsx)(t.h1,{id:"securing-etcd-in-kubernetes",children:"Securing etcd in Kubernetes"})}),"\n",(0,c.jsxs)(t.p,{children:[(0,c.jsx)(t.strong,{children:"etcd"})," is the ",(0,c.jsx)(t.strong,{children:"backbone of a Kubernetes cluster"}),", storing all cluster configuration data, including ",(0,c.jsx)(t.strong,{children:"secrets, RBAC policies, and workload definitions"}),". If etcd is ",(0,c.jsx)(t.strong,{children:"left unsecured"}),", attackers can extract sensitive data or modify cluster settings to gain full control over Kubernetes."]}),"\n",(0,c.jsx)(t.hr,{}),"\n",(0,c.jsx)(t.h2,{id:"1-enable-tls-encryption-for-etcd-communication",children:"1. Enable TLS Encryption for etcd Communication"}),"\n",(0,c.jsxs)(t.p,{children:[(0,c.jsx)(t.strong,{children:"Issue:"})," Unencrypted etcd traffic exposes sensitive data.",(0,c.jsx)("br",{}),"\n",(0,c.jsx)(t.strong,{children:"Fix:"})," Use ",(0,c.jsx)(t.strong,{children:"TLS certificates"})," to encrypt client-server communication."]}),"\n",(0,c.jsx)(t.h3,{id:"secure-etcd-with-tls",children:"Secure etcd with TLS"}),"\n",(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-bash",children:"etcd --cert-file=/etc/kubernetes/pki/etcd/server.crt \\\n     --key-file=/etc/kubernetes/pki/etcd/server.key \\\n     --trusted-ca-file=/etc/kubernetes/pki/etcd/ca.crt\n"})}),"\n",(0,c.jsx)(t.h3,{id:"why-it-matters",children:"Why It Matters"}),"\n",(0,c.jsxs)(t.ul,{children:["\n",(0,c.jsxs)(t.li,{children:[(0,c.jsx)(t.strong,{children:"Prevents"})," attackers from intercepting sensitive etcd data.",(0,c.jsx)("br",{})]}),"\n",(0,c.jsxs)(t.li,{children:[(0,c.jsx)(t.strong,{children:"Ensures"})," all etcd traffic is encrypted and authenticated."]}),"\n"]}),"\n",(0,c.jsx)(t.hr,{}),"\n",(0,c.jsx)(t.h2,{id:"2-restrict-access-to-etcd",children:"2. Restrict Access to etcd"}),"\n",(0,c.jsxs)(t.p,{children:[(0,c.jsx)(t.strong,{children:"Issue:"})," If etcd is publicly accessible, attackers can retrieve cluster data.",(0,c.jsx)("br",{}),"\n",(0,c.jsx)(t.strong,{children:"Fix:"})," Restrict etcd access to ",(0,c.jsx)(t.strong,{children:"control plane nodes only"}),"."]}),"\n",(0,c.jsx)(t.h3,{id:"configure-etcd-to-listen-only-on-secure-interfaces",children:"Configure etcd to Listen Only on Secure Interfaces"}),"\n",(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-bash",children:"etcd --listen-client-urls=https://127.0.0.1:2379\n"})}),"\n",(0,c.jsx)(t.h3,{id:"why-it-matters-1",children:"Why It Matters"}),"\n",(0,c.jsxs)(t.ul,{children:["\n",(0,c.jsxs)(t.li,{children:[(0,c.jsx)(t.strong,{children:"Blocks"})," remote access to etcd from unauthorized users.",(0,c.jsx)("br",{})]}),"\n",(0,c.jsxs)(t.li,{children:[(0,c.jsx)(t.strong,{children:"Limits"})," exposure to internal Kubernetes components only."]}),"\n"]}),"\n",(0,c.jsx)(t.hr,{}),"\n",(0,c.jsx)(t.h2,{id:"3-enforce-authentication-and-role-based-access-control-rbac",children:"3. Enforce Authentication and Role-Based Access Control (RBAC)"}),"\n",(0,c.jsxs)(t.p,{children:[(0,c.jsx)(t.strong,{children:"Issue:"})," Default etcd configurations may allow unauthenticated access.",(0,c.jsx)("br",{}),"\n",(0,c.jsx)(t.strong,{children:"Fix:"})," Enable ",(0,c.jsx)(t.strong,{children:"client authentication"})," and restrict permissions."]}),"\n",(0,c.jsx)(t.h3,{id:"secure-etcd-with-authentication",children:"Secure etcd with Authentication"}),"\n",(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-bash",children:"etcd --auth-token=simple\n"})}),"\n",(0,c.jsx)(t.p,{children:"Restrict who can query etcd with RBAC:"}),"\n",(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-yaml",children:'kind: ClusterRole\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: etcd-reader\nrules:\n  - apiGroups: [""]\n    resources: ["secrets"]\n    verbs: ["get", "list"]\n'})}),"\n",(0,c.jsx)(t.h3,{id:"why-it-matters-2",children:"Why It Matters"}),"\n",(0,c.jsxs)(t.ul,{children:["\n",(0,c.jsxs)(t.li,{children:[(0,c.jsx)(t.strong,{children:"Prevents"})," unauthorized users from accessing etcd.",(0,c.jsx)("br",{})]}),"\n",(0,c.jsxs)(t.li,{children:[(0,c.jsx)(t.strong,{children:"Ensures"})," that only authenticated Kubernetes components can query etcd."]}),"\n"]}),"\n",(0,c.jsx)(t.hr,{}),"\n",(0,c.jsx)(t.h2,{id:"4-secure-etcd-backups",children:"4. Secure etcd Backups"}),"\n",(0,c.jsxs)(t.p,{children:[(0,c.jsx)(t.strong,{children:"Issue:"})," Backups of etcd may contain plaintext secrets.",(0,c.jsx)("br",{}),"\n",(0,c.jsx)(t.strong,{children:"Fix:"})," Encrypt and store etcd backups securely."]}),"\n",(0,c.jsx)(t.h3,{id:"backup-etcd-with-encryption",children:"Backup etcd with Encryption"}),"\n",(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-bash",children:"ETCDCTL_API=3 etcdctl snapshot save /backups/etcd-snapshot.db\nopenssl enc -aes-256-cbc -salt -in /backups/etcd-snapshot.db -out /backups/etcd-snapshot.enc\n"})}),"\n",(0,c.jsx)(t.h3,{id:"why-it-matters-3",children:"Why It Matters"}),"\n",(0,c.jsxs)(t.ul,{children:["\n",(0,c.jsxs)(t.li,{children:[(0,c.jsx)(t.strong,{children:"Prevents"})," stolen backups from exposing cluster secrets.",(0,c.jsx)("br",{})]}),"\n",(0,c.jsxs)(t.li,{children:[(0,c.jsx)(t.strong,{children:"Ensures"})," sensitive data remains encrypted at rest."]}),"\n"]}),"\n",(0,c.jsx)(t.hr,{}),"\n",(0,c.jsx)(t.h2,{id:"5-isolate-etcd-from-untrusted-networks",children:"5. Isolate etcd from Untrusted Networks"}),"\n",(0,c.jsxs)(t.p,{children:[(0,c.jsx)(t.strong,{children:"Issue:"})," If etcd is exposed externally, it becomes a high-value target.",(0,c.jsx)("br",{}),"\n",(0,c.jsx)(t.strong,{children:"Fix:"})," Use ",(0,c.jsx)(t.strong,{children:"firewall rules"})," to block external access."]}),"\n",(0,c.jsx)(t.h3,{id:"block-external-etcd-access-with-iptables",children:"Block External etcd Access with iptables"}),"\n",(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-bash",children:"iptables -A INPUT -p tcp --dport 2379 -s 10.0.0.0/24 -j ACCEPT\niptables -A INPUT -p tcp --dport 2379 -j DROP\n"})}),"\n",(0,c.jsx)(t.h3,{id:"why-it-matters-4",children:"Why It Matters"}),"\n",(0,c.jsxs)(t.ul,{children:["\n",(0,c.jsxs)(t.li,{children:[(0,c.jsx)(t.strong,{children:"Prevents"})," attackers from directly accessing etcd.",(0,c.jsx)("br",{})]}),"\n",(0,c.jsxs)(t.li,{children:[(0,c.jsx)(t.strong,{children:"Limits"})," network access to trusted control plane nodes."]}),"\n"]}),"\n",(0,c.jsx)(t.hr,{}),"\n",(0,c.jsx)(t.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,c.jsxs)(t.p,{children:[(0,c.jsx)(t.strong,{children:"Securing etcd"})," is essential for ",(0,c.jsx)(t.strong,{children:"protecting cluster secrets, RBAC policies, and workload configurations"}),". By ",(0,c.jsx)(t.strong,{children:"enabling TLS, restricting access, enforcing authentication, securing backups, and isolating etcd from external networks"}),", you can ",(0,c.jsx)(t.strong,{children:"prevent unauthorized access and maintain Kubernetes integrity"}),"."]})]})}function u(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,c.jsx)(t,{...e,children:(0,c.jsx)(d,{...e})}):d(e)}},8453:(e,t,s)=>{s.d(t,{R:()=>i,x:()=>a});var n=s(6540);const c={},r=n.createContext(c);function i(e){const t=n.useContext(r);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:i(e.components),n.createElement(r.Provider,{value:t},e.children)}}}]);