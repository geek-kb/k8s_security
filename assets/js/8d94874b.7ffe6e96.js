"use strict";(globalThis.webpackChunkk_8_s_security=globalThis.webpackChunkk_8_s_security||[]).push([[2997],{4510(e,n,i){i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>d,frontMatter:()=>a,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"best-practices/supply-chain-security/trivy-operator","title":"Trivy Operator","description":"Trivy Operator provides Kubernetes-native security scanning by automatically scanning workloads for vulnerabilities, misconfigurations, secrets, and RBAC issues.","source":"@site/docs/best-practices/supply-chain-security/trivy-operator.md","sourceDirName":"best-practices/supply-chain-security","slug":"/best-practices/supply-chain-security/trivy-operator","permalink":"/kubernetes-security/best-practices/supply-chain-security/trivy-operator","draft":false,"unlisted":false,"editUrl":"https://github.com/geek-kb/k8s_security/edit/main/docs/best-practices/supply-chain-security/trivy-operator.md","tags":[{"inline":true,"label":"tool","permalink":"/kubernetes-security/tags/tool"},{"inline":true,"label":"supply-chain","permalink":"/kubernetes-security/tags/supply-chain"},{"inline":true,"label":"vulnerability-scanning","permalink":"/kubernetes-security/tags/vulnerability-scanning"},{"inline":true,"label":"runtime-security","permalink":"/kubernetes-security/tags/runtime-security"},{"inline":true,"label":"CKS","permalink":"/kubernetes-security/tags/cks"}],"version":"current","lastUpdatedBy":"Itai Ganot","lastUpdatedAt":1771236448000,"sidebarPosition":10,"frontMatter":{"sidebar_position":10,"title":"Trivy Operator","description":"Trivy Operator provides Kubernetes-native security scanning by automatically scanning workloads for vulnerabilities, misconfigurations, secrets, and RBAC issues.","keywords":["kubernetes security tool","trivy operator","vulnerability scanning","kubernetes native","aqua security","container security","misconfiguration","compliance","CKS"],"tags":["tool","supply-chain","vulnerability-scanning","runtime-security","CKS"],"related":["/kubernetes-security/best-practices/monitoring-logging-and-runtime-security/trivy/","/kubernetes-security/best-practices/supply-chain-security/supply-chain-best-practices/","/kubernetes-security/best-practices/supply-chain-security/kubei/"]},"sidebar":"default","previous":{"title":"Kubei","permalink":"/kubernetes-security/best-practices/supply-chain-security/kubei"},"next":{"title":"Tools","permalink":"/kubernetes-security/tools/intro"}}');var t=i(4848),s=i(8453);const a={sidebar_position:10,title:"Trivy Operator",description:"Trivy Operator provides Kubernetes-native security scanning by automatically scanning workloads for vulnerabilities, misconfigurations, secrets, and RBAC issues.",keywords:["kubernetes security tool","trivy operator","vulnerability scanning","kubernetes native","aqua security","container security","misconfiguration","compliance","CKS"],tags:["tool","supply-chain","vulnerability-scanning","runtime-security","CKS"],related:["/kubernetes-security/best-practices/monitoring-logging-and-runtime-security/trivy/","/kubernetes-security/best-practices/supply-chain-security/supply-chain-best-practices/","/kubernetes-security/best-practices/supply-chain-security/kubei/"]},l="Trivy Operator",c={},o=[{value:"Key Features",id:"key-features",level:2},{value:"Installation",id:"installation",level:2},{value:"Using Helm",id:"using-helm",level:3},{value:"Using kubectl",id:"using-kubectl",level:3},{value:"Custom Resource Definitions",id:"custom-resource-definitions",level:2},{value:"VulnerabilityReport",id:"vulnerabilityreport",level:3},{value:"ConfigAuditReport",id:"configauditreport",level:3},{value:"ExposedSecretReport",id:"exposedsecretreport",level:3},{value:"RbacAssessmentReport",id:"rbacassessmentreport",level:3},{value:"Querying Results",id:"querying-results",level:2},{value:"List All Vulnerability Reports",id:"list-all-vulnerability-reports",level:3},{value:"Get Detailed Report",id:"get-detailed-report",level:3},{value:"Find Critical Vulnerabilities",id:"find-critical-vulnerabilities",level:3},{value:"List ConfigAudit Failures",id:"list-configaudit-failures",level:3},{value:"Export All Reports",id:"export-all-reports",level:3},{value:"Configuration",id:"configuration",level:2},{value:"Helm Values",id:"helm-values",level:3},{value:"ConfigMap Configuration",id:"configmap-configuration",level:3},{value:"Integration",id:"integration",level:2},{value:"Prometheus Metrics",id:"prometheus-metrics",level:3},{value:"Alert on Critical Vulnerabilities",id:"alert-on-critical-vulnerabilities",level:3},{value:"kubectl Plugin",id:"kubectl-plugin",level:3},{value:"Compliance Scanning",id:"compliance-scanning",level:2},{value:"Enable CIS Benchmark Scans",id:"enable-cis-benchmark-scans",level:3},{value:"View Compliance Reports",id:"view-compliance-reports",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Comparison with Standalone Trivy",id:"comparison-with-standalone-trivy",level:2},{value:"References",id:"references",level:2}];function u(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"trivy-operator",children:"Trivy Operator"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Trivy Operator"})," is a Kubernetes-native security tool that continuously runs security scans by leveraging Trivy. It automatically discovers workloads and stores scan results as Kubernetes Custom Resources, making security findings accessible through the Kubernetes API and kubectl."]}),"\n",(0,t.jsx)(n.p,{children:"Unlike standalone Trivy, the operator integrates directly into the Kubernetes lifecycle, scanning new deployments automatically and providing a unified view of cluster security posture."}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"key-features",children:"Key Features"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Automatic scanning"})," of deployed workloads."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Vulnerability detection"})," in container images."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Misconfiguration scanning"})," of Kubernetes resources."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Secret detection"})," in container images and configs."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"RBAC assessment"})," for role security risks."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Compliance reporting"})," against CIS benchmarks."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Kubernetes-native"})," results stored as CRDs."]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,t.jsx)(n.h3,{id:"using-helm",children:"Using Helm"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"helm repo add aqua https://aquasecurity.github.io/helm-charts/\nhelm repo update\nhelm install trivy-operator aqua/trivy-operator \\\n  --namespace trivy-system \\\n  --create-namespace\n"})}),"\n",(0,t.jsx)(n.h3,{id:"using-kubectl",children:"Using kubectl"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl apply -f https://raw.githubusercontent.com/aquasecurity/trivy-operator/main/deploy/static/trivy-operator.yaml\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"custom-resource-definitions",children:"Custom Resource Definitions"}),"\n",(0,t.jsx)(n.p,{children:"Trivy Operator creates several CRDs to store scan results:"}),"\n",(0,t.jsx)(n.h3,{id:"vulnerabilityreport",children:"VulnerabilityReport"}),"\n",(0,t.jsx)(n.p,{children:"Stores container image vulnerability findings:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'apiVersion: aquasecurity.github.io/v1alpha1\nkind: VulnerabilityReport\nmetadata:\n  name: deployment-nginx-nginx\n  namespace: production\nspec:\n  scanner:\n    name: Trivy\n    version: 0.45.0\n  registry:\n    server: docker.io\n  artifact:\n    repository: library/nginx\n    tag: 1.25.3\n  summary:\n    criticalCount: 0\n    highCount: 2\n    mediumCount: 15\n    lowCount: 8\n  vulnerabilities:\n    - vulnerabilityID: CVE-2023-44487\n      severity: HIGH\n      resource: nghttp2\n      installedVersion: "1.51.0"\n      fixedVersion: "1.57.0"\n'})}),"\n",(0,t.jsx)(n.h3,{id:"configauditreport",children:"ConfigAuditReport"}),"\n",(0,t.jsx)(n.p,{children:"Stores Kubernetes misconfiguration findings:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"apiVersion: aquasecurity.github.io/v1alpha1\nkind: ConfigAuditReport\nmetadata:\n  name: deployment-nginx\n  namespace: production\nspec:\n  scanner:\n    name: Trivy\n    version: 0.45.0\n  summary:\n    criticalCount: 1\n    highCount: 3\n    mediumCount: 5\n    lowCount: 2\n  checks:\n    - checkID: KSV001\n      title: Container runs as root\n      severity: MEDIUM\n      category: Kubernetes Security Check\n      success: false\n"})}),"\n",(0,t.jsx)(n.h3,{id:"exposedsecretreport",children:"ExposedSecretReport"}),"\n",(0,t.jsx)(n.p,{children:"Stores detected secrets in images:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"apiVersion: aquasecurity.github.io/v1alpha1\nkind: ExposedSecretReport\nmetadata:\n  name: deployment-nginx-nginx\n  namespace: production\nspec:\n  secrets:\n    - target: /app/.env\n      ruleID: aws-access-key-id\n      title: AWS Access Key ID\n      severity: CRITICAL\n"})}),"\n",(0,t.jsx)(n.h3,{id:"rbacassessmentreport",children:"RbacAssessmentReport"}),"\n",(0,t.jsx)(n.p,{children:"Stores RBAC security assessment:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"apiVersion: aquasecurity.github.io/v1alpha1\nkind: RbacAssessmentReport\nmetadata:\n  name: role-admin-role\n  namespace: production\nspec:\n  checks:\n    - checkID: KSV041\n      title: Role permits wildcard verb\n      severity: HIGH\n      success: false\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"querying-results",children:"Querying Results"}),"\n",(0,t.jsx)(n.h3,{id:"list-all-vulnerability-reports",children:"List All Vulnerability Reports"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl get vulnerabilityreports -A\n"})}),"\n",(0,t.jsx)(n.h3,{id:"get-detailed-report",children:"Get Detailed Report"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl describe vulnerabilityreport deployment-nginx-nginx -n production\n"})}),"\n",(0,t.jsx)(n.h3,{id:"find-critical-vulnerabilities",children:"Find Critical Vulnerabilities"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl get vulnerabilityreports -A -o json | \\\n  jq '.items[] | select(.report.summary.criticalCount > 0) | .metadata.name'\n"})}),"\n",(0,t.jsx)(n.h3,{id:"list-configaudit-failures",children:"List ConfigAudit Failures"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl get configauditreports -A -o json | \\\n  jq '.items[] | select(.report.summary.criticalCount > 0) | {name: .metadata.name, namespace: .metadata.namespace}'\n"})}),"\n",(0,t.jsx)(n.h3,{id:"export-all-reports",children:"Export All Reports"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl get vulnerabilityreports -A -o yaml > vulnerability-reports.yaml\nkubectl get configauditreports -A -o yaml > config-audit-reports.yaml\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,t.jsx)(n.h3,{id:"helm-values",children:"Helm Values"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'# values.yaml\ntrivy:\n  severity: CRITICAL,HIGH,MEDIUM\n  ignoreUnfixed: true\n  timeout: 10m0s\n  \noperator:\n  scanJobTimeout: 5m\n  scanJobsConcurrentLimit: 10\n  vulnerabilityScannerEnabled: true\n  configAuditScannerEnabled: true\n  rbacAssessmentScannerEnabled: true\n  exposedSecretScannerEnabled: true\n\ncompliance:\n  cron: "0 */6 * * *"  # Every 6 hours\n'})}),"\n",(0,t.jsx)(n.h3,{id:"configmap-configuration",children:"ConfigMap Configuration"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: trivy-operator\n  namespace: trivy-system\ndata:\n  trivy.severity: CRITICAL,HIGH,MEDIUM\n  trivy.ignoreUnfixed: "true"\n  scanJob.podTemplateLabels: "app=trivy-scan"\n  vulnerabilityReports.scanner: Trivy\n'})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"integration",children:"Integration"}),"\n",(0,t.jsx)(n.h3,{id:"prometheus-metrics",children:"Prometheus Metrics"}),"\n",(0,t.jsx)(n.p,{children:"Trivy Operator exposes Prometheus metrics:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"apiVersion: monitoring.coreos.com/v1\nkind: ServiceMonitor\nmetadata:\n  name: trivy-operator\n  namespace: trivy-system\nspec:\n  selector:\n    matchLabels:\n      app.kubernetes.io/name: trivy-operator\n  endpoints:\n    - port: metrics\n"})}),"\n",(0,t.jsx)(n.h3,{id:"alert-on-critical-vulnerabilities",children:"Alert on Critical Vulnerabilities"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'apiVersion: monitoring.coreos.com/v1\nkind: PrometheusRule\nmetadata:\n  name: trivy-operator-alerts\n  namespace: trivy-system\nspec:\n  groups:\n    - name: trivy-operator\n      rules:\n        - alert: CriticalVulnerabilityDetected\n          expr: trivy_vulnerability_info{severity="Critical"} > 0\n          for: 5m\n          labels:\n            severity: critical\n          annotations:\n            summary: "Critical vulnerability detected in {{ $labels.image_name }}"\n'})}),"\n",(0,t.jsx)(n.h3,{id:"kubectl-plugin",children:"kubectl Plugin"}),"\n",(0,t.jsx)(n.p,{children:"Install the Trivy kubectl plugin for easier querying:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl krew install trivy-operator\n\n# View vulnerabilities\nkubectl trivy-operator vulnerabilities\n\n# View config audit\nkubectl trivy-operator configaudits\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"compliance-scanning",children:"Compliance Scanning"}),"\n",(0,t.jsx)(n.h3,{id:"enable-cis-benchmark-scans",children:"Enable CIS Benchmark Scans"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'# In Helm values\ncompliance:\n  cron: "0 */6 * * *"\n  reportType: "summary"\n  specs:\n    - k8s-cis\n'})}),"\n",(0,t.jsx)(n.h3,{id:"view-compliance-reports",children:"View Compliance Reports"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl get clustercompliancereports\nkubectl describe clustercompliancereport k8s-cis\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Enable all scanners:"})," Use vulnerability, config audit, RBAC, and secret scanning together."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Set severity thresholds:"})," Focus alerts on critical and high severity findings."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Monitor metrics:"})," Integrate with Prometheus for visibility and alerting."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Regular rescans:"})," Configure periodic rescanning to catch newly disclosed CVEs."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Automate remediation:"})," Use results to drive automated patching workflows."]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"comparison-with-standalone-trivy",children:"Comparison with Standalone Trivy"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Feature"}),(0,t.jsx)(n.th,{children:"Trivy CLI"}),(0,t.jsx)(n.th,{children:"Trivy Operator"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"CI/CD integration"}),(0,t.jsx)(n.td,{children:"Primary use case"}),(0,t.jsx)(n.td,{children:"Supplementary"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Runtime scanning"}),(0,t.jsx)(n.td,{children:"Manual"}),(0,t.jsx)(n.td,{children:"Automatic"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Results storage"}),(0,t.jsx)(n.td,{children:"Files/stdout"}),(0,t.jsx)(n.td,{children:"Kubernetes CRDs"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"kubectl integration"}),(0,t.jsx)(n.td,{children:"No"}),(0,t.jsx)(n.td,{children:"Yes"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Continuous monitoring"}),(0,t.jsx)(n.td,{children:"Requires scripting"}),(0,t.jsx)(n.td,{children:"Built-in"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Cluster-wide view"}),(0,t.jsx)(n.td,{children:"Manual aggregation"}),(0,t.jsx)(n.td,{children:"Automatic"})]})]})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,t.jsx)(n.p,{children:"This article is based on information from the following official sources:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://aquasecurity.github.io/trivy-operator/",children:"Trivy Operator Documentation"})," - Aqua Security"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://github.com/aquasecurity/trivy-operator",children:"Trivy Operator GitHub Repository"})," - Aqua Security"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://www.cisecurity.org/benchmark/kubernetes",children:"CIS Kubernetes Benchmark"})," - CIS"]}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(u,{...e})}):u(e)}},8453(e,n,i){i.d(n,{R:()=>a,x:()=>l});var r=i(6540);const t={},s=r.createContext(t);function a(e){const n=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);