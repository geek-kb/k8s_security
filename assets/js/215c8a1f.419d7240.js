"use strict";(globalThis.webpackChunkk_8_s_security=globalThis.webpackChunkk_8_s_security||[]).push([[6656],{649(e,n,i){i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>u,frontMatter:()=>a,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"best_practices/monitoring_logging_and_runtime_security/trivy","title":"Trivy","description":"Overview, usage, and best practices for using Trivy to scan container images, file systems, and Kubernetes resources for vulnerabilities.","source":"@site/docs/best_practices/monitoring_logging_and_runtime_security/trivy.md","sourceDirName":"best_practices/monitoring_logging_and_runtime_security","slug":"/best_practices/monitoring_logging_and_runtime_security/trivy","permalink":"/docs/best_practices/monitoring_logging_and_runtime_security/trivy","draft":false,"unlisted":false,"editUrl":"https://github.com/geek-kb/k8s_security/edit/main/docs/best_practices/monitoring_logging_and_runtime_security/trivy.md","tags":[],"version":"current","lastUpdatedBy":"Itai Ganot","lastUpdatedAt":1765581437000,"sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"Trivy","description":"Overview, usage, and best practices for using Trivy to scan container images, file systems, and Kubernetes resources for vulnerabilities.","keywords":["kubernetes security tool","trivy","vulnerability scanning","container scanning","image scanning","SBOM","security scanning","aqua security","CVE detection","CKS"]},"sidebar":"default","previous":{"title":"Introduction","permalink":"/docs/best_practices/monitoring_logging_and_runtime_security/intro"},"next":{"title":"Grype","permalink":"/docs/best_practices/monitoring_logging_and_runtime_security/grype"}}');var r=i(4848),t=i(8453);const a={sidebar_position:2,title:"Trivy",description:"Overview, usage, and best practices for using Trivy to scan container images, file systems, and Kubernetes resources for vulnerabilities.",keywords:["kubernetes security tool","trivy","vulnerability scanning","container scanning","image scanning","SBOM","security scanning","aqua security","CVE detection","CKS"]},c="Trivy",o={},l=[{value:"Why Use Trivy",id:"why-use-trivy",level:2},{value:"Basic Usage",id:"basic-usage",level:2},{value:"1. Scan a Docker Image",id:"1-scan-a-docker-image",level:3},{value:"2. Scan Kubernetes Cluster (Runtime)",id:"2-scan-kubernetes-cluster-runtime",level:3},{value:"3. Scan a Kubernetes YAML Manifest",id:"3-scan-a-kubernetes-yaml-manifest",level:3},{value:"4. Scan a Local Filesystem",id:"4-scan-a-local-filesystem",level:3},{value:"5. Generate SBOM (Software Bill of Materials)",id:"5-generate-sbom-software-bill-of-materials",level:3},{value:"6. Generate SBOM with SPDX Format",id:"6-generate-sbom-with-spdx-format",level:3},{value:"7. Scan with VEX Document (Enhanced in v1.34)",id:"7-scan-with-vex-document-enhanced-in-v134",level:3},{value:"8. Enhanced Kubernetes Scanning with Pod-Level Resources",id:"8-enhanced-kubernetes-scanning-with-pod-level-resources",level:3},{value:"9. Verify Signed Artifacts with Sigstore",id:"9-verify-signed-artifacts-with-sigstore",level:3},{value:"10. Generate Comprehensive SBOM for Kubernetes Workloads",id:"10-generate-comprehensive-sbom-for-kubernetes-workloads",level:3},{value:"Integrating Trivy into CI/CD",id:"integrating-trivy-into-cicd",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"Enhanced SBOM and VEX Workflow",id:"enhanced-sbom-and-vex-workflow",level:3},{value:"Resources",id:"resources",level:2}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"trivy",children:"Trivy"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Required knowledge for the CKS certification."})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Trivy"})," is a comprehensive and easy-to-use ",(0,r.jsx)(n.strong,{children:"vulnerability scanner"})," for containers, Kubernetes, IaC (Infrastructure as Code), file systems, and Git repositories. It helps identify security risks across different stages of the development lifecycle and is widely adopted in Kubernetes environments."]}),"\n",(0,r.jsxs)(n.p,{children:["It is an ",(0,r.jsx)(n.strong,{children:"open-source tool"})," maintained by ",(0,r.jsx)(n.strong,{children:"Aqua Security"}),", with a strong community and extensive documentation."]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"CKS v1.34 Update:"})," Trivy has been updated with ",(0,r.jsx)(n.strong,{children:"enhanced SBOM scanning capabilities"})," including native support for VEX (Vulnerability Exploitability eXchange) documents, improved CycloneDX and SPDX generation, and integration with Kubernetes v1.34 Pod-Level Resources metadata."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Trivy supports scanning for:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"OS packages and software dependencies"}),"\n",(0,r.jsx)(n.li,{children:"Misconfigurations in Dockerfiles, Kubernetes manifests, Terraform, and more"}),"\n",(0,r.jsx)(n.li,{children:"Sensitive information like secrets embedded in files"}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"SBOM (Software Bill of Materials) generation with VEX support"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"VEX document validation and consumption"})}),"\n",(0,r.jsx)(n.li,{children:"Kubernetes cluster scanning (runtime) with enhanced resource awareness"}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Supply chain artifact verification with Sigstore integration"})}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"why-use-trivy",children:"Why Use Trivy"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Lightweight and fast"}),"\n",(0,r.jsx)(n.li,{children:"Minimal configuration required"}),"\n",(0,r.jsx)(n.li,{children:"Integrates easily with CI/CD pipelines"}),"\n",(0,r.jsx)(n.li,{children:"Supports a wide range of scanning targets (images, filesystems, repos, K8s, etc.)"}),"\n",(0,r.jsx)(n.li,{children:"Actively maintained and community-supported"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"basic-usage",children:"Basic Usage"}),"\n",(0,r.jsx)(n.h3,{id:"1-scan-a-docker-image",children:"1. Scan a Docker Image"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"trivy image nginx:latest\n"})}),"\n",(0,r.jsx)(n.p,{children:"This command scans the image for vulnerabilities in installed packages and application dependencies."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"2-scan-kubernetes-cluster-runtime",children:"2. Scan Kubernetes Cluster (Runtime)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"trivy k8s cluster\n"})}),"\n",(0,r.jsx)(n.p,{children:"This scans running resources and their configurations in the cluster."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"3-scan-a-kubernetes-yaml-manifest",children:"3. Scan a Kubernetes YAML Manifest"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"trivy config ./manifests/\n"})}),"\n",(0,r.jsx)(n.p,{children:"This helps detect misconfigurations in YAML files before deployment."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"4-scan-a-local-filesystem",children:"4. Scan a Local Filesystem"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"trivy fs /path/to/code\n"})}),"\n",(0,r.jsx)(n.p,{children:"This scans source code and files for secrets or vulnerabilities."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"5-generate-sbom-software-bill-of-materials",children:"5. Generate SBOM (Software Bill of Materials)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"trivy image --format cyclonedx --output sbom.json my-app:1.0.0\n"})}),"\n",(0,r.jsx)(n.p,{children:"Generate an SBOM in CycloneDX format for compliance or auditing."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"6-generate-sbom-with-spdx-format",children:"6. Generate SBOM with SPDX Format"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"trivy image --format spdx-json --output sbom.spdx.json my-app:1.0.0\n"})}),"\n",(0,r.jsx)(n.p,{children:"SPDX format is widely used for supply chain security and compliance."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"7-scan-with-vex-document-enhanced-in-v134",children:"7. Scan with VEX Document (Enhanced in v1.34)"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"VEX (Vulnerability Exploitability eXchange)"})," documents provide information about whether vulnerabilities are actually exploitable in your specific context."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Generate VEX document\ntrivy image --format openvex --output vex.json my-app:1.0.0\n\n# Scan image using VEX to filter false positives\ntrivy image --vex vex.json my-app:1.0.0\n"})}),"\n",(0,r.jsx)(n.p,{children:"This filters out vulnerabilities that are documented as non-exploitable in your environment, reducing false positive noise."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"8-enhanced-kubernetes-scanning-with-pod-level-resources",children:"8. Enhanced Kubernetes Scanning with Pod-Level Resources"}),"\n",(0,r.jsx)(n.p,{children:"Scan Kubernetes clusters with awareness of Pod-Level Resources (v1.34 feature):"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Scan cluster including Pod-level resource configurations\ntrivy k8s cluster --report all --include-resources\n\n# Scan specific namespace\ntrivy k8s --namespace production --report summary\n\n# Export findings as JSON for integration\ntrivy k8s cluster --format json --output k8s-scan-results.json\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"9-verify-signed-artifacts-with-sigstore",children:"9. Verify Signed Artifacts with Sigstore"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Scan and verify image signature using Cosign\ntrivy image --format table --scanners vuln,config \\\n  --image-config-scanners config \\\n  ghcr.io/aquasecurity/trivy:latest\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"10-generate-comprehensive-sbom-for-kubernetes-workloads",children:"10. Generate Comprehensive SBOM for Kubernetes Workloads"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Generate SBOM for all images in a namespace\nkubectl get pods -n production -o json | \\\n  jq -r '.items[].spec.containers[].image' | \\\n  sort -u | \\\n  while read image; do\n    echo \"Generating SBOM for $image\"\n    trivy image --format spdx-json \\\n      --output \"sbom-$(echo $image | tr ':/' '_').json\" \\\n      \"$image\"\n  done\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"integrating-trivy-into-cicd",children:"Integrating Trivy into CI/CD"}),"\n",(0,r.jsx)(n.p,{children:"Trivy can be embedded into CI pipelines to fail builds on vulnerability thresholds."}),"\n",(0,r.jsx)(n.p,{children:"Example with GitHub Actions:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'- name: Scan Docker image with Trivy\n  uses: aquasecurity/trivy-action@master\n  with:\n    image-ref: "nginx:latest"\n    format: "table"\n    exit-code: "1"\n    severity: "CRITICAL,HIGH"\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Run Trivy scans at each stage of your CI/CD pipeline (code \u2192 image \u2192 deployment)"}),"\n",(0,r.jsxs)(n.li,{children:["Use severity filters (",(0,r.jsx)(n.code,{children:"--severity"}),") to control what triggers failures"]}),"\n",(0,r.jsxs)(n.li,{children:["Enable and regularly run ",(0,r.jsx)(n.strong,{children:"Kubernetes runtime scans"})," in production clusters"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Generate and maintain SBOMs"})," for all production images using CycloneDX or SPDX formats"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Use VEX documents"})," to document non-exploitable vulnerabilities and reduce false positives"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Verify artifact signatures"})," using Sigstore/Cosign integration before deployment"]}),"\n",(0,r.jsxs)(n.li,{children:["Use ",(0,r.jsx)(n.code,{children:"--ignore-unfixed"})," to reduce noise from known but unfixed issues"]}),"\n",(0,r.jsx)(n.li,{children:"Pair Trivy with tools like Kyverno or Gatekeeper to enforce policies based on scan results"}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Scan for supply chain risks"})," including unsigned dependencies and unverified artifacts"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Monitor Pod-Level Resource configurations"})," in Kubernetes v1.34+ for security misconfigurations"]}),"\n",(0,r.jsx)(n.li,{children:"Periodically update the vulnerability database with:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"trivy image --download-db-only\n"})}),"\n",(0,r.jsx)(n.h3,{id:"enhanced-sbom-and-vex-workflow",children:"Enhanced SBOM and VEX Workflow"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Generate SBOM during build"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"trivy image --format spdx-json --output sbom.spdx.json myapp:v1.0.0\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Create VEX document"})," for known non-exploitable vulnerabilities:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"trivy image --format openvex --output vex.json myapp:v1.0.0\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Scan with VEX filtering"})," to reduce false positives:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"trivy image --vex vex.json --severity CRITICAL,HIGH myapp:v1.0.0\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Store SBOMs in artifact repository"})," for compliance and audit trails"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Continuously rescan"})," stored SBOMs for newly discovered vulnerabilities:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"trivy sbom sbom.spdx.json\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"resources",children:"Resources"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Official Documentation"}),": ",(0,r.jsx)(n.a,{href:"https://aquasecurity.github.io/trivy",children:"https://aquasecurity.github.io/trivy"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"GitHub Repository"}),": ",(0,r.jsx)(n.a,{href:"https://github.com/aquasecurity/trivy",children:"https://github.com/aquasecurity/trivy"})]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.p,{children:"Trivy helps enforce runtime security posture and supports vulnerability management and visibility across Kubernetes environments."})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453(e,n,i){i.d(n,{R:()=>a,x:()=>c});var s=i(6540);const r={},t=s.createContext(r);function a(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);