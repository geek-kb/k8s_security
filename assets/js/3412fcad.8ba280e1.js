"use strict";(globalThis.webpackChunkk_8_s_security=globalThis.webpackChunkk_8_s_security||[]).push([[9941],{8453(e,n,i){i.d(n,{R:()=>a,x:()=>c});var s=i(6540);const t={},r=s.createContext(t);function a(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),s.createElement(r.Provider,{value:n},e.children)}},9479(e,n,i){i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"best-practices/monitoring-logging-and-runtime-security/threatmapper","title":"Deepfence ThreatMapper","description":"Deepfence ThreatMapper is a runtime vulnerability scanner that discovers threats across Kubernetes clusters, VMs, containers, and serverless environments.","source":"@site/docs/best-practices/monitoring-logging-and-runtime-security/threatmapper.md","sourceDirName":"best-practices/monitoring-logging-and-runtime-security","slug":"/best-practices/monitoring-logging-and-runtime-security/threatmapper","permalink":"/kubernetes-security/best-practices/monitoring-logging-and-runtime-security/threatmapper","draft":false,"unlisted":false,"editUrl":"https://github.com/geek-kb/k8s_security/edit/main/docs/best-practices/monitoring-logging-and-runtime-security/threatmapper.md","tags":[{"inline":true,"label":"tool","permalink":"/kubernetes-security/tags/tool"},{"inline":true,"label":"runtime-security","permalink":"/kubernetes-security/tags/runtime-security"},{"inline":true,"label":"vulnerability-scanning","permalink":"/kubernetes-security/tags/vulnerability-scanning"},{"inline":true,"label":"CKS","permalink":"/kubernetes-security/tags/cks"}],"version":"current","lastUpdatedBy":"Itai Ganot","lastUpdatedAt":1771236448000,"sidebarPosition":9,"frontMatter":{"sidebar_position":9,"title":"Deepfence ThreatMapper","description":"Deepfence ThreatMapper is a runtime vulnerability scanner that discovers threats across Kubernetes clusters, VMs, containers, and serverless environments.","keywords":["kubernetes security tool","threatmapper","deepfence","runtime security","vulnerability scanning","threat detection","container security","cloud security","runtime protection","CKS"],"tags":["tool","runtime-security","vulnerability-scanning","CKS"],"related":["/kubernetes-security/best-practices/monitoring-logging-and-runtime-security/falco/","/kubernetes-security/best-practices/monitoring-logging-and-runtime-security/trivy/","/kubernetes-security/best-practices/supply-chain-security/supply-chain-best-practices/"]},"sidebar":"default","previous":{"title":"Tracee","permalink":"/kubernetes-security/best-practices/monitoring-logging-and-runtime-security/tracee"},"next":{"title":"kubectl-dig","permalink":"/kubernetes-security/best-practices/monitoring-logging-and-runtime-security/kubectl-dig"}}');var t=i(4848),r=i(8453);const a={sidebar_position:9,title:"Deepfence ThreatMapper",description:"Deepfence ThreatMapper is a runtime vulnerability scanner that discovers threats across Kubernetes clusters, VMs, containers, and serverless environments.",keywords:["kubernetes security tool","threatmapper","deepfence","runtime security","vulnerability scanning","threat detection","container security","cloud security","runtime protection","CKS"],tags:["tool","runtime-security","vulnerability-scanning","CKS"],related:["/kubernetes-security/best-practices/monitoring-logging-and-runtime-security/falco/","/kubernetes-security/best-practices/monitoring-logging-and-runtime-security/trivy/","/kubernetes-security/best-practices/supply-chain-security/supply-chain-best-practices/"]},c="Deepfence ThreatMapper",l={},o=[{value:"Key Features",id:"key-features",level:2},{value:"Architecture",id:"architecture",level:2},{value:"Management Console",id:"management-console",level:3},{value:"ThreatMapper Sensors",id:"threatmapper-sensors",level:3},{value:"Backend Services",id:"backend-services",level:3},{value:"Installation",id:"installation",level:2},{value:"Deploy Management Console",id:"deploy-management-console",level:3},{value:"Deploy on Kubernetes (Helm)",id:"deploy-on-kubernetes-helm",level:3},{value:"Deploy Sensors on Kubernetes",id:"deploy-sensors-on-kubernetes",level:3},{value:"Deploy Sensors (kubectl)",id:"deploy-sensors-kubectl",level:3},{value:"Vulnerability Scanning",id:"vulnerability-scanning",level:2},{value:"Start a Vulnerability Scan",id:"start-a-vulnerability-scan",level:3},{value:"CLI Scanning",id:"cli-scanning",level:3},{value:"Scan Output",id:"scan-output",level:3},{value:"Secret Scanning",id:"secret-scanning",level:2},{value:"Enable Secret Scanning",id:"enable-secret-scanning",level:3},{value:"Compliance Scanning",id:"compliance-scanning",level:2},{value:"Available Compliance Frameworks",id:"available-compliance-frameworks",level:3},{value:"Run Compliance Check",id:"run-compliance-check",level:3},{value:"Attack Path Analysis",id:"attack-path-analysis",level:2},{value:"Integration",id:"integration",level:2},{value:"CI/CD Pipeline Integration",id:"cicd-pipeline-integration",level:3},{value:"Webhook Notifications",id:"webhook-notifications",level:3},{value:"API Access",id:"api-access",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"References",id:"references",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"deepfence-threatmapper",children:"Deepfence ThreatMapper"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Deepfence ThreatMapper"})," is an open-source platform for runtime vulnerability management and threat detection across Kubernetes clusters, virtual machines, containers, and serverless environments. It provides continuous visibility into security posture by scanning running workloads for vulnerabilities, secrets, and misconfigurations."]}),"\n",(0,t.jsx)(n.p,{children:"ThreatMapper correlates findings across your infrastructure to prioritize the most critical threats based on runtime context and attack paths."}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"key-features",children:"Key Features"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Vulnerability scanning"})," of running containers and hosts."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Secret scanning"})," to detect exposed credentials and API keys."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Compliance posture"})," assessment against CIS benchmarks."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Attack path visualization"})," showing how threats can propagate."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Multi-cloud support"})," for AWS, GCP, Azure, and on-premises."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Runtime threat detection"})," using eBPF-based sensors."]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"architecture",children:"Architecture"}),"\n",(0,t.jsx)(n.p,{children:"ThreatMapper consists of:"}),"\n",(0,t.jsx)(n.h3,{id:"management-console",children:"Management Console"}),"\n",(0,t.jsx)(n.p,{children:"Web-based UI for visualization, configuration, and reporting."}),"\n",(0,t.jsx)(n.h3,{id:"threatmapper-sensors",children:"ThreatMapper Sensors"}),"\n",(0,t.jsx)(n.p,{children:"Lightweight agents deployed as DaemonSets on Kubernetes nodes that collect data and perform scans."}),"\n",(0,t.jsx)(n.h3,{id:"backend-services",children:"Backend Services"}),"\n",(0,t.jsx)(n.p,{children:"Storage, correlation, and analysis engines (typically deployed via Docker Compose or Helm)."}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,t.jsx)(n.h3,{id:"deploy-management-console",children:"Deploy Management Console"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Clone the repository\ngit clone https://github.com/deepfence/ThreatMapper.git\ncd ThreatMapper/deployment-scripts/docker-compose\n\n# Start the console\ndocker-compose up -d\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Access the console at ",(0,t.jsx)(n.code,{children:"https://localhost:443"})]}),"\n",(0,t.jsx)(n.h3,{id:"deploy-on-kubernetes-helm",children:"Deploy on Kubernetes (Helm)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"helm repo add deepfence https://deepfence-helm-charts.s3.amazonaws.com/threatmapper\nhelm install threatmapper-console deepfence/deepfence-console --namespace deepfence --create-namespace\n"})}),"\n",(0,t.jsx)(n.h3,{id:"deploy-sensors-on-kubernetes",children:"Deploy Sensors on Kubernetes"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"helm install threatmapper-agent deepfence/deepfence-agent \\\n  --namespace deepfence \\\n  --set managementConsoleUrl=<console-ip> \\\n  --set deepfenceKey=<your-api-key>\n"})}),"\n",(0,t.jsx)(n.h3,{id:"deploy-sensors-kubectl",children:"Deploy Sensors (kubectl)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'apiVersion: apps/v1\nkind: DaemonSet\nmetadata:\n  name: deepfence-agent\n  namespace: deepfence\nspec:\n  selector:\n    matchLabels:\n      app: deepfence-agent\n  template:\n    metadata:\n      labels:\n        app: deepfence-agent\n    spec:\n      hostPID: true\n      hostNetwork: true\n      containers:\n        - name: deepfence-agent\n          image: deepfenceio/deepfence_agent_ce:latest\n          securityContext:\n            privileged: true\n          env:\n            - name: MGMT_CONSOLE_URL\n              value: "<console-ip>"\n            - name: DEEPFENCE_KEY\n              value: "<your-api-key>"\n            - name: USER_DEFINED_TAGS\n              value: "environment:production"\n          volumeMounts:\n            - name: docker-sock\n              mountPath: /var/run/docker.sock\n            - name: containerd-sock\n              mountPath: /run/containerd/containerd.sock\n      volumes:\n        - name: docker-sock\n          hostPath:\n            path: /var/run/docker.sock\n        - name: containerd-sock\n          hostPath:\n            path: /run/containerd/containerd.sock\n'})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"vulnerability-scanning",children:"Vulnerability Scanning"}),"\n",(0,t.jsx)(n.h3,{id:"start-a-vulnerability-scan",children:"Start a Vulnerability Scan"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Navigate to the ThreatMapper console."}),"\n",(0,t.jsxs)(n.li,{children:["Select ",(0,t.jsx)(n.strong,{children:"Topology"})," to view your infrastructure."]}),"\n",(0,t.jsx)(n.li,{children:"Select a container, image, or host."}),"\n",(0,t.jsxs)(n.li,{children:["Click ",(0,t.jsx)(n.strong,{children:"Start Vulnerability Scan"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"cli-scanning",children:"CLI Scanning"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Scan a container image\ndocker run -it --rm \\\n  -v /var/run/docker.sock:/var/run/docker.sock \\\n  deepfenceio/deepfence_package_scanner_ce:latest \\\n  --image-name nginx:latest\n"})}),"\n",(0,t.jsx)(n.h3,{id:"scan-output",children:"Scan Output"}),"\n",(0,t.jsx)(n.p,{children:"Results include:"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Field"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"CVE ID"}),(0,t.jsx)(n.td,{children:"Vulnerability identifier"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Severity"}),(0,t.jsx)(n.td,{children:"Critical, High, Medium, Low"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Package"}),(0,t.jsx)(n.td,{children:"Affected package name and version"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Fix Version"}),(0,t.jsx)(n.td,{children:"Version with the fix (if available)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"CVSS Score"}),(0,t.jsx)(n.td,{children:"Numerical severity score"})]})]})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"secret-scanning",children:"Secret Scanning"}),"\n",(0,t.jsx)(n.p,{children:"ThreatMapper detects exposed secrets including:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"API keys and tokens"}),"\n",(0,t.jsx)(n.li,{children:"AWS/GCP/Azure credentials"}),"\n",(0,t.jsx)(n.li,{children:"SSH private keys"}),"\n",(0,t.jsx)(n.li,{children:"Database passwords"}),"\n",(0,t.jsx)(n.li,{children:"TLS certificates and keys"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"enable-secret-scanning",children:"Enable Secret Scanning"}),"\n",(0,t.jsxs)(n.p,{children:["Secret scanning runs alongside vulnerability scans. Enable in the console under ",(0,t.jsx)(n.strong,{children:"Settings > Scan Options"}),"."]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"compliance-scanning",children:"Compliance Scanning"}),"\n",(0,t.jsx)(n.h3,{id:"available-compliance-frameworks",children:"Available Compliance Frameworks"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"CIS Kubernetes Benchmark"}),"\n",(0,t.jsx)(n.li,{children:"CIS Docker Benchmark"}),"\n",(0,t.jsx)(n.li,{children:"HIPAA"}),"\n",(0,t.jsx)(n.li,{children:"PCI-DSS"}),"\n",(0,t.jsx)(n.li,{children:"SOC 2"}),"\n",(0,t.jsx)(n.li,{children:"GDPR"}),"\n",(0,t.jsx)(n.li,{children:"NIST"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"run-compliance-check",children:"Run Compliance Check"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Navigate to ",(0,t.jsx)(n.strong,{children:"Compliance"})," in the console."]}),"\n",(0,t.jsx)(n.li,{children:"Select the target (cluster, host, or container)."}),"\n",(0,t.jsx)(n.li,{children:"Choose the compliance framework."}),"\n",(0,t.jsx)(n.li,{children:"Start the compliance scan."}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"attack-path-analysis",children:"Attack Path Analysis"}),"\n",(0,t.jsx)(n.p,{children:"ThreatMapper correlates vulnerabilities and misconfigurations to visualize attack paths:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Entry points:"})," Exposed services, vulnerable containers."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Lateral movement:"})," Container-to-container communication."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Targets:"})," Sensitive data, secrets, privileged workloads."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"The attack path view helps prioritize remediation by showing which vulnerabilities pose the greatest risk."}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"integration",children:"Integration"}),"\n",(0,t.jsx)(n.h3,{id:"cicd-pipeline-integration",children:"CI/CD Pipeline Integration"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# In your CI pipeline\ndocker run -it --rm \\\n  deepfenceio/deepfence_package_scanner_ce:latest \\\n  --image-name $IMAGE_NAME \\\n  --fail-on-count 1 \\\n  --fail-on-severity critical\n"})}),"\n",(0,t.jsx)(n.h3,{id:"webhook-notifications",children:"Webhook Notifications"}),"\n",(0,t.jsx)(n.p,{children:"Configure webhooks in the console to send alerts to:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Slack"}),"\n",(0,t.jsx)(n.li,{children:"PagerDuty"}),"\n",(0,t.jsx)(n.li,{children:"Splunk"}),"\n",(0,t.jsx)(n.li,{children:"Elasticsearch"}),"\n",(0,t.jsx)(n.li,{children:"Custom HTTP endpoints"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"api-access",children:"API Access"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'# Get vulnerabilities via API\ncurl -X GET "https://<console>/deepfence/v1.5/vulnerabilities" \\\n  -H "Authorization: Bearer <api-key>" \\\n  -H "Content-Type: application/json"\n'})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Deploy sensors cluster-wide:"})," Ensure all nodes have ThreatMapper sensors for complete visibility."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Schedule regular scans:"})," Configure automated scanning to detect new vulnerabilities."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Prioritize by attack path:"})," Focus on vulnerabilities that are reachable from external exposure."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Integrate with ticketing:"})," Connect to Jira or similar systems for vulnerability tracking."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Use tagging:"})," Tag workloads by environment and team for organized reporting."]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,t.jsx)(n.p,{children:"This article is based on information from the following official sources:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://github.com/deepfence/ThreatMapper",children:"Deepfence ThreatMapper GitHub Repository"})," - Deepfence"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://community.deepfence.io/docs/threatmapper/",children:"ThreatMapper Documentation"})," - Deepfence"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://www.cisecurity.org/benchmark/kubernetes",children:"CIS Kubernetes Benchmark"})," - CIS"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}}}]);