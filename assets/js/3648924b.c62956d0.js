"use strict";(self.webpackChunkk_8_s_security=self.webpackChunkk_8_s_security||[]).push([[8519],{8453:(e,s,n)=>{n.d(s,{R:()=>o,x:()=>l});var t=n(6540);const i={},r=t.createContext(i);function o(e){const s=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),t.createElement(r.Provider,{value:s},e.children)}},9814:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>l,default:()=>u,frontMatter:()=>o,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"best_practices/monitoring_logging_and_runtime_security/kubectl_snoop","title":"kubectl-snoop","description":"kubectl-snoop is a diagnostic tool for inspecting Kubernetes API server calls made by other clients in real time.","source":"@site/docs/best_practices/monitoring_logging_and_runtime_security/kubectl_snoop.md","sourceDirName":"best_practices/monitoring_logging_and_runtime_security","slug":"/best_practices/monitoring_logging_and_runtime_security/kubectl_snoop","permalink":"/docs/best_practices/monitoring_logging_and_runtime_security/kubectl_snoop","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedBy":"Itai Ganot","lastUpdatedAt":1742842158000,"sidebarPosition":6,"frontMatter":{"title":"kubectl-snoop","description":"kubectl-snoop is a diagnostic tool for inspecting Kubernetes API server calls made by other clients in real time.","sidebar_position":6}}');var i=n(4848),r=n(8453);const o={title:"kubectl-snoop",description:"kubectl-snoop is a diagnostic tool for inspecting Kubernetes API server calls made by other clients in real time.",sidebar_position:6},l="kubectl-snoop",c={},a=[{value:"Usage",id:"usage",level:2},{value:"1. Install",id:"1-install",level:3},{value:"2. Example: Trace API Server Calls on a Node",id:"2-example-trace-api-server-calls-on-a-node",level:3},{value:"3. Debug Access Patterns or RBAC Issues",id:"3-debug-access-patterns-or-rbac-issues",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Resources",id:"resources",level:2}];function d(e){const s={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"kubectl-snoop",children:"kubectl-snoop"})}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"kubectl-snoop"})," is a diagnostic tool for Kubernetes that ",(0,i.jsx)(s.strong,{children:"monitors and inspects API server traffic"})," in real time. It shows which users or processes are calling the Kubernetes API and what operations they\u2019re performing."]}),"\n",(0,i.jsxs)(s.p,{children:["This tool is especially helpful for ",(0,i.jsx)(s.strong,{children:"troubleshooting, auditing access patterns"}),", and ",(0,i.jsx)(s.strong,{children:"debugging RBAC permissions or controller behaviors"}),"."]}),"\n",(0,i.jsxs)(s.p,{children:["It works by creating a privileged pod on a target node and attaching to the kube-apiserver\u2019s audit logs (or eBPF syscall tracing, depending on version). It is mostly used in ",(0,i.jsx)(s.strong,{children:"development, test, or controlled environments"})," due to the elevated permissions it requires."]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"usage",children:"Usage"}),"\n",(0,i.jsx)(s.h3,{id:"1-install",children:"1. Install"}),"\n",(0,i.jsx)(s.p,{children:"Clone the GitHub repository or download the binary:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"git clone https://github.com/eldadru/ksniff\ncd kubectl-snoop\ngo build -o kubectl-snoop main.go\n"})}),"\n",(0,i.jsx)(s.p,{children:"Or use a containerized version:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"kubectl run --rm -i --tty snoop --image=eldadru/kubectl-snoop -- /snoop\n"})}),"\n",(0,i.jsxs)(s.blockquote,{children:["\n",(0,i.jsxs)(s.p,{children:["You can also use ",(0,i.jsx)(s.code,{children:"kubectl krew"}),":"]}),"\n"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"kubectl krew install snoop\n"})}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h3,{id:"2-example-trace-api-server-calls-on-a-node",children:"2. Example: Trace API Server Calls on a Node"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"kubectl snoop <node-name>\n"})}),"\n",(0,i.jsx)(s.p,{children:"This will launch a pod on the specified node and output real-time information such as:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"USER                 METHOD   RESOURCE    VERB      NAMESPACE    NAME\nsystem:kubelet       PATCH    nodes       status    -            ip-10-0-0-1\ndeveloper@example    GET      pods        get       dev          app-pod-123\n"})}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h3,{id:"3-debug-access-patterns-or-rbac-issues",children:"3. Debug Access Patterns or RBAC Issues"}),"\n",(0,i.jsx)(s.p,{children:"You can observe which identities are making specific API calls, making it easier to detect:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Misconfigured controllers"}),"\n",(0,i.jsx)(s.li,{children:"Unexpected access attempts"}),"\n",(0,i.jsx)(s.li,{children:"Failing workloads due to permission issues"}),"\n"]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Use only in secure, isolated environments"})," (snoop creates privileged pods)."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Don\u2019t run in production clusters without tight RBAC controls"}),"."]}),"\n",(0,i.jsxs)(s.li,{children:["Combine with ",(0,i.jsx)(s.strong,{children:"audit logging"})," for persistent record-keeping."]}),"\n",(0,i.jsxs)(s.li,{children:["Use it to ",(0,i.jsx)(s.strong,{children:"validate RBAC bindings"})," and investigate unusual access behavior."]}),"\n",(0,i.jsx)(s.li,{children:"Rotate and clean up temporary privileged pods created by the tool."}),"\n"]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"resources",children:"Resources"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"GitHub Repository:"})," ",(0,i.jsx)(s.a,{href:"https://github.com/eldadru/kubectl-snoop",children:"https://github.com/eldadru/kubectl-snoop"})]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Krew Plugin Index:"})," ",(0,i.jsx)(s.a,{href:"https://krew.sigs.k8s.io/plugins/snoop",children:"https://krew.sigs.k8s.io/plugins/snoop"})]}),"\n"]})]})}function u(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}}}]);