"use strict";(globalThis.webpackChunkk_8_s_security=globalThis.webpackChunkk_8_s_security||[]).push([[9617],{8453(e,s,n){n.d(s,{R:()=>r,x:()=>a});var i=n(6540);const c={},t=i.createContext(c);function r(e){const s=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:r(e.components),i.createElement(t.Provider,{value:s},e.children)}},8808(e,s,n){n.r(s),n.d(s,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"best_practices/cluster_setup_and_hardening/rbac_and_identity/kubectl_who_can","title":"kubectl-who-can","description":"kubectl-who-can shows which subjects have RBAC permissions to perform specific actions on Kubernetes resources, helping identify privilege distribution.","source":"@site/docs/best_practices/cluster_setup_and_hardening/rbac_and_identity/kubectl_who_can.md","sourceDirName":"best_practices/cluster_setup_and_hardening/rbac_and_identity","slug":"/best_practices/cluster_setup_and_hardening/rbac_and_identity/kubectl_who_can","permalink":"/docs/best_practices/cluster_setup_and_hardening/rbac_and_identity/kubectl_who_can","draft":false,"unlisted":false,"editUrl":"https://github.com/geek-kb/k8s_security/edit/main/docs/best_practices/cluster_setup_and_hardening/rbac_and_identity/kubectl_who_can.md","tags":[{"inline":true,"label":"tool","permalink":"/docs/tags/tool"},{"inline":true,"label":"rbac","permalink":"/docs/tags/rbac"},{"inline":true,"label":"authorization","permalink":"/docs/tags/authorization"},{"inline":true,"label":"CKS","permalink":"/docs/tags/cks"}],"version":"current","lastUpdatedBy":"Itai Ganot","lastUpdatedAt":1771232119000,"sidebarPosition":15,"frontMatter":{"sidebar_position":15,"title":"kubectl-who-can","description":"kubectl-who-can shows which subjects have RBAC permissions to perform specific actions on Kubernetes resources, helping identify privilege distribution.","keywords":["kubernetes security tool","kubectl-who-can","RBAC analysis","permission audit","kubernetes authorization","access control","security audit","privilege review","CKS"],"tags":["tool","rbac","authorization","CKS"],"related":["/docs/best_practices/cluster_setup_and_hardening/rbac_and_identity/insecure_rbac_permissions_mitigation/","/docs/fundamentals/authorization/rbac/","/docs/attack_vectors/insecure_rbac_permissions/"]},"sidebar":"default","previous":{"title":"audit2rbac","permalink":"/docs/best_practices/cluster_setup_and_hardening/rbac_and_identity/audit2rbac"},"next":{"title":"rakkess","permalink":"/docs/best_practices/cluster_setup_and_hardening/rbac_and_identity/rakkess"}}');var c=n(4848),t=n(8453);const r={sidebar_position:15,title:"kubectl-who-can",description:"kubectl-who-can shows which subjects have RBAC permissions to perform specific actions on Kubernetes resources, helping identify privilege distribution.",keywords:["kubernetes security tool","kubectl-who-can","RBAC analysis","permission audit","kubernetes authorization","access control","security audit","privilege review","CKS"],tags:["tool","rbac","authorization","CKS"],related:["/docs/best_practices/cluster_setup_and_hardening/rbac_and_identity/insecure_rbac_permissions_mitigation/","/docs/fundamentals/authorization/rbac/","/docs/attack_vectors/insecure_rbac_permissions/"]},a="kubectl-who-can",l={},d=[{value:"Use Cases",id:"use-cases",level:2},{value:"Installation",id:"installation",level:2},{value:"Usage Examples",id:"usage-examples",level:2},{value:"Check Who Can Delete Pods",id:"check-who-can-delete-pods",level:3},{value:"Check Who Can Create Secrets in a Namespace",id:"check-who-can-create-secrets-in-a-namespace",level:3},{value:"Check Who Can Exec into Pods",id:"check-who-can-exec-into-pods",level:3},{value:"Check Who Can Access a Specific Resource",id:"check-who-can-access-a-specific-resource",level:3},{value:"Check Cluster-Wide Permissions",id:"check-cluster-wide-permissions",level:3},{value:"Output as JSON",id:"output-as-json",level:3},{value:"Understanding the Output",id:"understanding-the-output",level:2},{value:"Common Audit Queries",id:"common-audit-queries",level:2},{value:"Identify Cluster Admins",id:"identify-cluster-admins",level:3},{value:"Find Who Can Modify RBAC",id:"find-who-can-modify-rbac",level:3},{value:"Check Dangerous Pod Permissions",id:"check-dangerous-pod-permissions",level:3},{value:"Find Who Can Access Secrets",id:"find-who-can-access-secrets",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"References",id:"references",level:2}];function o(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(s.header,{children:(0,c.jsx)(s.h1,{id:"kubectl-who-can",children:"kubectl-who-can"})}),"\n",(0,c.jsxs)(s.p,{children:[(0,c.jsx)(s.strong,{children:"kubectl-who-can"})," is a kubectl plugin that shows which users, groups, and service accounts have RBAC permissions to perform a given action on a Kubernetes resource. It helps security teams audit privilege distribution and identify subjects with potentially dangerous permissions."]}),"\n",(0,c.jsx)(s.p,{children:'This tool answers questions like "Who can delete pods in the production namespace?" or "Which service accounts can create secrets cluster-wide?"'}),"\n",(0,c.jsx)(s.hr,{}),"\n",(0,c.jsx)(s.h2,{id:"use-cases",children:"Use Cases"}),"\n",(0,c.jsxs)(s.ul,{children:["\n",(0,c.jsx)(s.li,{children:"Audit RBAC configurations to identify over-privileged subjects."}),"\n",(0,c.jsx)(s.li,{children:"Investigate security incidents by determining who had access to specific resources."}),"\n",(0,c.jsx)(s.li,{children:"Validate that least-privilege principles are being followed."}),"\n",(0,c.jsx)(s.li,{children:"Review permissions before granting new roles or bindings."}),"\n",(0,c.jsx)(s.li,{children:"Document access controls for compliance requirements."}),"\n"]}),"\n",(0,c.jsx)(s.hr,{}),"\n",(0,c.jsx)(s.h2,{id:"installation",children:"Installation"}),"\n",(0,c.jsx)(s.p,{children:"Install kubectl-who-can using krew (the kubectl plugin manager):"}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-bash",children:"kubectl krew install who-can\n"})}),"\n",(0,c.jsx)(s.p,{children:"Or download directly from GitHub releases:"}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-bash",children:"curl -LO https://github.com/aquasecurity/kubectl-who-can/releases/download/v0.4.0/kubectl-who-can_linux_amd64.tar.gz\ntar xzf kubectl-who-can_linux_amd64.tar.gz\nchmod +x kubectl-who-can\nsudo mv kubectl-who-can /usr/local/bin/\n"})}),"\n",(0,c.jsx)(s.hr,{}),"\n",(0,c.jsx)(s.h2,{id:"usage-examples",children:"Usage Examples"}),"\n",(0,c.jsx)(s.h3,{id:"check-who-can-delete-pods",children:"Check Who Can Delete Pods"}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-bash",children:"kubectl who-can delete pods\n"})}),"\n",(0,c.jsx)(s.p,{children:"Example output:"}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{children:"ROLEBINDING                             NAMESPACE   SUBJECT             TYPE            SA-NAMESPACE\nadmin-binding                           default     admin-user          User\ndeveloper-binding                       default     developer-group     Group\nCLUSTERROLEBINDING                      SUBJECT                         TYPE            SA-NAMESPACE\ncluster-admin                           system:masters                  Group\n"})}),"\n",(0,c.jsx)(s.h3,{id:"check-who-can-create-secrets-in-a-namespace",children:"Check Who Can Create Secrets in a Namespace"}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-bash",children:"kubectl who-can create secrets -n production\n"})}),"\n",(0,c.jsx)(s.h3,{id:"check-who-can-exec-into-pods",children:"Check Who Can Exec into Pods"}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-bash",children:"kubectl who-can create pods/exec\n"})}),"\n",(0,c.jsx)(s.h3,{id:"check-who-can-access-a-specific-resource",children:"Check Who Can Access a Specific Resource"}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-bash",children:"kubectl who-can get secrets/my-secret -n my-namespace\n"})}),"\n",(0,c.jsx)(s.h3,{id:"check-cluster-wide-permissions",children:"Check Cluster-Wide Permissions"}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-bash",children:"kubectl who-can delete nodes --all-namespaces\n"})}),"\n",(0,c.jsx)(s.h3,{id:"output-as-json",children:"Output as JSON"}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-bash",children:"kubectl who-can delete pods -o json\n"})}),"\n",(0,c.jsx)(s.hr,{}),"\n",(0,c.jsx)(s.h2,{id:"understanding-the-output",children:"Understanding the Output"}),"\n",(0,c.jsx)(s.p,{children:"The output is organized into two sections:"}),"\n",(0,c.jsxs)(s.p,{children:[(0,c.jsx)(s.strong,{children:"RoleBindings:"})," Shows namespace-scoped bindings that grant the permission."]}),"\n",(0,c.jsxs)(s.table,{children:[(0,c.jsx)(s.thead,{children:(0,c.jsxs)(s.tr,{children:[(0,c.jsx)(s.th,{children:"Column"}),(0,c.jsx)(s.th,{children:"Description"})]})}),(0,c.jsxs)(s.tbody,{children:[(0,c.jsxs)(s.tr,{children:[(0,c.jsx)(s.td,{children:"ROLEBINDING"}),(0,c.jsx)(s.td,{children:"Name of the RoleBinding"})]}),(0,c.jsxs)(s.tr,{children:[(0,c.jsx)(s.td,{children:"NAMESPACE"}),(0,c.jsx)(s.td,{children:"Namespace where the binding applies"})]}),(0,c.jsxs)(s.tr,{children:[(0,c.jsx)(s.td,{children:"SUBJECT"}),(0,c.jsx)(s.td,{children:"User, Group, or ServiceAccount name"})]}),(0,c.jsxs)(s.tr,{children:[(0,c.jsx)(s.td,{children:"TYPE"}),(0,c.jsx)(s.td,{children:"Subject type (User, Group, ServiceAccount)"})]}),(0,c.jsxs)(s.tr,{children:[(0,c.jsx)(s.td,{children:"SA-NAMESPACE"}),(0,c.jsx)(s.td,{children:"Namespace of ServiceAccount (if applicable)"})]})]})]}),"\n",(0,c.jsxs)(s.p,{children:[(0,c.jsx)(s.strong,{children:"ClusterRoleBindings:"})," Shows cluster-wide bindings that grant the permission."]}),"\n",(0,c.jsxs)(s.table,{children:[(0,c.jsx)(s.thead,{children:(0,c.jsxs)(s.tr,{children:[(0,c.jsx)(s.th,{children:"Column"}),(0,c.jsx)(s.th,{children:"Description"})]})}),(0,c.jsxs)(s.tbody,{children:[(0,c.jsxs)(s.tr,{children:[(0,c.jsx)(s.td,{children:"CLUSTERROLEBINDING"}),(0,c.jsx)(s.td,{children:"Name of the ClusterRoleBinding"})]}),(0,c.jsxs)(s.tr,{children:[(0,c.jsx)(s.td,{children:"SUBJECT"}),(0,c.jsx)(s.td,{children:"User, Group, or ServiceAccount name"})]}),(0,c.jsxs)(s.tr,{children:[(0,c.jsx)(s.td,{children:"TYPE"}),(0,c.jsx)(s.td,{children:"Subject type"})]}),(0,c.jsxs)(s.tr,{children:[(0,c.jsx)(s.td,{children:"SA-NAMESPACE"}),(0,c.jsx)(s.td,{children:"Namespace of ServiceAccount (if applicable)"})]})]})]}),"\n",(0,c.jsx)(s.hr,{}),"\n",(0,c.jsx)(s.h2,{id:"common-audit-queries",children:"Common Audit Queries"}),"\n",(0,c.jsx)(s.h3,{id:"identify-cluster-admins",children:"Identify Cluster Admins"}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-bash",children:"kubectl who-can '*' '*'\n"})}),"\n",(0,c.jsx)(s.h3,{id:"find-who-can-modify-rbac",children:"Find Who Can Modify RBAC"}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-bash",children:"kubectl who-can create clusterrolebindings\nkubectl who-can create rolebindings\n"})}),"\n",(0,c.jsx)(s.h3,{id:"check-dangerous-pod-permissions",children:"Check Dangerous Pod Permissions"}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-bash",children:"# Who can run privileged pods\nkubectl who-can create pods\n\n# Who can exec into pods\nkubectl who-can create pods/exec\n\n# Who can attach to pods\nkubectl who-can create pods/attach\n"})}),"\n",(0,c.jsx)(s.h3,{id:"find-who-can-access-secrets",children:"Find Who Can Access Secrets"}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-bash",children:"kubectl who-can get secrets --all-namespaces\nkubectl who-can list secrets --all-namespaces\n"})}),"\n",(0,c.jsx)(s.hr,{}),"\n",(0,c.jsx)(s.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,c.jsxs)(s.ul,{children:["\n",(0,c.jsxs)(s.li,{children:[(0,c.jsx)(s.strong,{children:"Run periodic audits:"})," Schedule regular who-can queries to detect permission drift."]}),"\n",(0,c.jsxs)(s.li,{children:[(0,c.jsx)(s.strong,{children:"Focus on dangerous verbs:"})," Prioritize auditing ",(0,c.jsx)(s.code,{children:"create"}),", ",(0,c.jsx)(s.code,{children:"delete"}),", ",(0,c.jsx)(s.code,{children:"update"}),", and ",(0,c.jsx)(s.code,{children:"patch"})," permissions over ",(0,c.jsx)(s.code,{children:"get"}),", ",(0,c.jsx)(s.code,{children:"list"}),", and ",(0,c.jsx)(s.code,{children:"watch"}),"."]}),"\n",(0,c.jsxs)(s.li,{children:[(0,c.jsx)(s.strong,{children:"Check sensitive resources:"})," Regularly audit access to secrets, configmaps, RBAC resources, and pod execution capabilities."]}),"\n",(0,c.jsxs)(s.li,{children:[(0,c.jsx)(s.strong,{children:"Document findings:"})," Export results as JSON for compliance documentation and historical comparison."]}),"\n",(0,c.jsxs)(s.li,{children:[(0,c.jsx)(s.strong,{children:"Combine with other tools:"})," Use alongside audit2rbac and rakkess for comprehensive RBAC analysis."]}),"\n"]}),"\n",(0,c.jsx)(s.hr,{}),"\n",(0,c.jsx)(s.h2,{id:"references",children:"References"}),"\n",(0,c.jsx)(s.p,{children:"This article is based on information from the following official sources:"}),"\n",(0,c.jsxs)(s.ol,{children:["\n",(0,c.jsxs)(s.li,{children:[(0,c.jsx)(s.a,{href:"https://github.com/aquasecurity/kubectl-who-can",children:"kubectl-who-can GitHub Repository"})," - Aqua Security"]}),"\n",(0,c.jsxs)(s.li,{children:[(0,c.jsx)(s.a,{href:"https://kubernetes.io/docs/reference/access-authn-authz/rbac/",children:"Using RBAC Authorization"})," - Kubernetes Documentation"]}),"\n",(0,c.jsxs)(s.li,{children:[(0,c.jsx)(s.a,{href:"https://kubernetes.io/docs/tasks/extend-kubectl/kubectl-plugins/",children:"Extend kubectl with plugins"})," - Kubernetes Documentation"]}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,c.jsx)(s,{...e,children:(0,c.jsx)(o,{...e})}):o(e)}}}]);