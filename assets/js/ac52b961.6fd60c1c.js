"use strict";(globalThis.webpackChunkk_8_s_security=globalThis.webpackChunkk_8_s_security||[]).push([[2066],{8081(e,s,n){n.r(s),n.d(s,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>c,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"best-practices/supply-chain-security/supply-chain-best-practices","title":"Supply Chain Security Best Practices","description":"Best practices for securing the Kubernetes software supply chain, including image signing, dependency verification, Helm security, and CI/CD hardening.","source":"@site/docs/best-practices/supply-chain-security/supply-chain-best-practices.md","sourceDirName":"best-practices/supply-chain-security","slug":"/best-practices/supply-chain-security/supply-chain-best-practices","permalink":"/kubernetes-security/best-practices/supply-chain-security/supply-chain-best-practices","draft":false,"unlisted":false,"editUrl":"https://github.com/geek-kb/k8s_security/edit/main/docs/best-practices/supply-chain-security/supply-chain-best-practices.md","tags":[],"version":"current","lastUpdatedBy":"Itai Ganot","lastUpdatedAt":1771236448000,"sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"Supply Chain Security Best Practices","description":"Best practices for securing the Kubernetes software supply chain, including image signing, dependency verification, Helm security, and CI/CD hardening.","keywords":["kubernetes security best practices","supply chain security","software supply chain","container image security","SBOM","image signing","cosign","CI/CD security","helm security","dependency verification","CKS"]},"sidebar":"default","previous":{"title":"Introduction","permalink":"/kubernetes-security/best-practices/supply-chain-security/intro"},"next":{"title":"Syft","permalink":"/kubernetes-security/best-practices/supply-chain-security/syft"}}');var r=n(4848),t=n(8453);const c={sidebar_position:2,title:"Supply Chain Security Best Practices",description:"Best practices for securing the Kubernetes software supply chain, including image signing, dependency verification, Helm security, and CI/CD hardening.",keywords:["kubernetes security best practices","supply chain security","software supply chain","container image security","SBOM","image signing","cosign","CI/CD security","helm security","dependency verification","CKS"]},l="Supply Chain Security Best Practices",a={},o=[{value:"1. Use Trusted and Signed Container Images",id:"1-use-trusted-and-signed-container-images",level:2},{value:"Secure Image Policy with Sigstore Cosign",id:"secure-image-policy-with-sigstore-cosign",level:3},{value:"Why It Matters",id:"why-it-matters",level:3},{value:"2. Scan Images for Vulnerabilities",id:"2-scan-images-for-vulnerabilities",level:2},{value:"Example Using Trivy",id:"example-using-trivy",level:3},{value:"Why It Matters",id:"why-it-matters-1",level:3},{value:"3. Lock Dependencies to Verified Versions",id:"3-lock-dependencies-to-verified-versions",level:2},{value:"Secure Dependency Management",id:"secure-dependency-management",level:3},{value:"Why It Matters",id:"why-it-matters-2",level:3},{value:"4. Secure CI/CD Pipelines",id:"4-secure-cicd-pipelines",level:2},{value:"Harden CI/CD Secrets",id:"harden-cicd-secrets",level:3},{value:"Restrict GitHub Actions Workflow Permissions",id:"restrict-github-actions-workflow-permissions",level:3},{value:"Why It Matters",id:"why-it-matters-3",level:3},{value:"5. Secure Helm Chart Deployments",id:"5-secure-helm-chart-deployments",level:2},{value:"5.1 Verify Helm Chart Provenance",id:"51-verify-helm-chart-provenance",level:3},{value:"5.2 Restrict External Helm Repositories",id:"52-restrict-external-helm-repositories",level:3},{value:"5.3 Restrict Helm Values with Admission Controllers",id:"53-restrict-helm-values-with-admission-controllers",level:3},{value:"5.4 Prevent Persistent Backdoors in Helm Hooks",id:"54-prevent-persistent-backdoors-in-helm-hooks",level:3},{value:"Why It Matters",id:"why-it-matters-4",level:3},{value:"6. Enforce Kubernetes Admission Controls",id:"6-enforce-kubernetes-admission-controls",level:2},{value:"Example: Restrict Untrusted Registries",id:"example-restrict-untrusted-registries",level:3},{value:"Why It Matters",id:"why-it-matters-5",level:3},{value:"Conclusion",id:"conclusion",level:2},{value:"References",id:"references",level:2}];function d(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.header,{children:(0,r.jsx)(s.h1,{id:"supply-chain-security-best-practices",children:"Supply Chain Security Best Practices"})}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Supply chain attacks"})," target ",(0,r.jsx)(s.strong,{children:"container images, dependencies, CI/CD pipelines, and Helm charts"})," to inject malicious code into Kubernetes workloads. ",(0,r.jsx)(s.strong,{children:"Securing the Kubernetes supply chain"})," helps prevent ",(0,r.jsx)(s.strong,{children:"unauthorized code execution, privilege escalation, and data exfiltration"}),"."]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"1-use-trusted-and-signed-container-images",children:"1. Use Trusted and Signed Container Images"}),"\n",(0,r.jsxs)(s.p,{children:["Using unverified images increases the risk of ",(0,r.jsx)(s.strong,{children:"malware, backdoors, and privilege escalation"}),"."]}),"\n",(0,r.jsx)(s.h3,{id:"secure-image-policy-with-sigstore-cosign",children:"Secure Image Policy with Sigstore Cosign"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"cosign sign --key cosign.key myregistry.com/my-app:latest\n"})}),"\n",(0,r.jsx)(s.p,{children:"Enforce signed images in Kubernetes:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:'apiVersion: policy.sigstore.dev/v1alpha1\nkind: ClusterImagePolicy\nmetadata:\n  name: enforce-signed-images\nspec:\n  images:\n    - glob: "myregistry.com/*"\n  authorities:\n    - key:\n        data: <public-key>\n'})}),"\n",(0,r.jsx)(s.h3,{id:"why-it-matters",children:"Why It Matters"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Prevents"})," running untrusted or tampered images.",(0,r.jsx)("br",{})]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Ensures"})," images are from verified sources."]}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"2-scan-images-for-vulnerabilities",children:"2. Scan Images for Vulnerabilities"}),"\n",(0,r.jsxs)(s.p,{children:["Before deployment, scan images for known ",(0,r.jsx)(s.strong,{children:"CVE vulnerabilities"}),"."]}),"\n",(0,r.jsx)(s.h3,{id:"example-using-trivy",children:"Example Using Trivy"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"trivy image myregistry.com/my-app:latest\n"})}),"\n",(0,r.jsx)(s.h3,{id:"why-it-matters-1",children:"Why It Matters"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Identifies"})," critical vulnerabilities before deployment.",(0,r.jsx)("br",{})]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Prevents"})," exploitation of outdated software packages."]}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"3-lock-dependencies-to-verified-versions",children:"3. Lock Dependencies to Verified Versions"}),"\n",(0,r.jsxs)(s.p,{children:["Using unverified dependencies allows ",(0,r.jsx)(s.strong,{children:"supply chain poisoning"})," via compromised libraries."]}),"\n",(0,r.jsx)(s.h3,{id:"secure-dependency-management",children:"Secure Dependency Management"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["Use ",(0,r.jsx)(s.strong,{children:"checksums"})," to validate dependencies:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"go mod verify\n"})}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:"Pin dependencies in package managers:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-json",children:'"dependencies": {\n  "express": "4.17.1"\n}\n'})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"why-it-matters-2",children:"Why It Matters"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Prevents"})," dependency hijacking.",(0,r.jsx)("br",{})]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Ensures"})," only verified versions are used."]}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"4-secure-cicd-pipelines",children:"4. Secure CI/CD Pipelines"}),"\n",(0,r.jsxs)(s.p,{children:["Compromised CI/CD pipelines allow attackers to ",(0,r.jsx)(s.strong,{children:"modify deployments and inject malicious code"}),"."]}),"\n",(0,r.jsx)(s.h3,{id:"harden-cicd-secrets",children:"Harden CI/CD Secrets"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Store secrets securely in ",(0,r.jsx)(s.strong,{children:"Vault"})," or ",(0,r.jsx)(s.strong,{children:"Kubernetes Secrets"}),"."]}),"\n",(0,r.jsxs)(s.li,{children:["Use ",(0,r.jsx)(s.strong,{children:"short-lived, scoped credentials"}),"."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Disable plaintext secret storage"})," in CI/CD logs."]}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"restrict-github-actions-workflow-permissions",children:"Restrict GitHub Actions Workflow Permissions"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:"permissions:\n  contents: read\n  id-token: write\n"})}),"\n",(0,r.jsx)(s.h3,{id:"why-it-matters-3",children:"Why It Matters"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Prevents"})," unauthorized CI/CD modifications.",(0,r.jsx)("br",{})]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Reduces"})," risk of secret leakage."]}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"5-secure-helm-chart-deployments",children:"5. Secure Helm Chart Deployments"}),"\n",(0,r.jsxs)(s.p,{children:["Helm charts can introduce ",(0,r.jsx)(s.strong,{children:"misconfigurations, backdoors, or excessive privileges"})," if not properly validated."]}),"\n",(0,r.jsx)(s.h3,{id:"51-verify-helm-chart-provenance",children:"5.1 Verify Helm Chart Provenance"}),"\n",(0,r.jsxs)(s.p,{children:["Ensure charts are ",(0,r.jsx)(s.strong,{children:"signed and verified"})," before deployment:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"helm package my-chart --sign --key my-signing-key\nhelm verify my-chart-1.0.0.tgz\n"})}),"\n",(0,r.jsx)(s.h3,{id:"52-restrict-external-helm-repositories",children:"5.2 Restrict External Helm Repositories"}),"\n",(0,r.jsxs)(s.p,{children:["Avoid untrusted Helm repositories by defining ",(0,r.jsx)(s.strong,{children:"allowed sources"}),":"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:'apiVersion: constraints.gatekeeper.sh/v1beta1\nkind: K8sAllowedRepos\nmetadata:\n  name: restrict-helm-registries\nspec:\n  match:\n    kinds:\n      - apiGroups: [""]\n        kinds: ["Pod"]\n  parameters:\n    repos:\n      - "oci://mytrustedhelmrepo.com"\n'})}),"\n",(0,r.jsx)(s.h3,{id:"53-restrict-helm-values-with-admission-controllers",children:"5.3 Restrict Helm Values with Admission Controllers"}),"\n",(0,r.jsxs)(s.p,{children:["Block privileged workloads using ",(0,r.jsx)(s.strong,{children:"Gatekeeper and OPA policies"}),":"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:"apiVersion: constraints.gatekeeper.sh/v1beta1\nkind: K8sPSPRestricted\nmetadata:\n  name: deny-privileged-pods\nspec:\n  parameters:\n    privileged: false\n"})}),"\n",(0,r.jsx)(s.h3,{id:"54-prevent-persistent-backdoors-in-helm-hooks",children:"5.4 Prevent Persistent Backdoors in Helm Hooks"}),"\n",(0,r.jsxs)(s.p,{children:["Helm hooks can be exploited to maintain persistence even after uninstallation. Ensure ",(0,r.jsx)(s.strong,{children:"post-delete hooks"})," do not introduce unauthorized resources:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:'hooks:\n  post-delete:\n    - exec:\n        command:\n          [\n            "/bin/sh",\n            "-c",\n            "kubectl delete deployment --all -n malicious-namespace",\n          ]\n'})}),"\n",(0,r.jsxs)(s.p,{children:["Use ",(0,r.jsx)(s.strong,{children:"Kubernetes Policy Controllers"})," to detect persistent workloads."]}),"\n",(0,r.jsx)(s.h3,{id:"why-it-matters-4",children:"Why It Matters"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Prevents"})," unauthorized or tampered Helm charts from deploying.",(0,r.jsx)("br",{})]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Enforces"})," security best practices for Helm-based deployments.",(0,r.jsx)("br",{})]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Reduces"})," the risk of privilege escalation and persistent backdoors."]}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"6-enforce-kubernetes-admission-controls",children:"6. Enforce Kubernetes Admission Controls"}),"\n",(0,r.jsxs)(s.p,{children:["Use ",(0,r.jsx)(s.strong,{children:"Admission Controllers"})," to block insecure deployments."]}),"\n",(0,r.jsx)(s.h3,{id:"example-restrict-untrusted-registries",children:"Example: Restrict Untrusted Registries"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:'apiVersion: constraints.gatekeeper.sh/v1beta1\nkind: K8sAllowedRepos\nmetadata:\n  name: restrict-registries\nspec:\n  match:\n    kinds:\n      - apiGroups: [""]\n        kinds: ["Pod"]\n  parameters:\n    repos:\n      - "myregistry.com"\n'})}),"\n",(0,r.jsx)(s.h3,{id:"why-it-matters-5",children:"Why It Matters"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Blocks"})," untrusted images from running.",(0,r.jsx)("br",{})]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Enforces"})," security policies at deployment time."]}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Securing the Kubernetes supply chain"})," requires ",(0,r.jsx)(s.strong,{children:"signed images, dependency verification, Helm security enforcement, CI/CD hardening, and policy enforcement"}),". By following these best practices, organizations can ",(0,r.jsx)(s.strong,{children:"mitigate supply chain attacks and prevent unauthorized access"}),"."]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"references",children:"References"}),"\n",(0,r.jsx)(s.p,{children:"This article is based on information from the following official sources:"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.a,{href:"https://docs.sigstore.dev/cosign/signing/overview/",children:"Cosign Overview"})," - Sigstore Documentation"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.a,{href:"https://helm.sh/docs/topics/provenance/",children:"Helm Provenance and Integrity"})," - Helm Documentation"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.a,{href:"https://open-policy-agent.github.io/gatekeeper/website/docs/",children:"OPA Gatekeeper"})," - Open Policy Agent Documentation"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.a,{href:"https://kubernetes.io/docs/concepts/security/supply-chain-security/",children:"Supply Chain Security Best Practices"})," - Kubernetes Documentation"]}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453(e,s,n){n.d(s,{R:()=>c,x:()=>l});var i=n(6540);const r={},t=i.createContext(r);function c(e){const s=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),i.createElement(t.Provider,{value:s},e.children)}}}]);