"use strict";(self.webpackChunkk_8_s_security=self.webpackChunkk_8_s_security||[]).push([[1558],{8453:(e,s,i)=>{i.d(s,{R:()=>a,x:()=>c});var n=i(6540);const r={},t=n.createContext(r);function a(e){const s=n.useContext(t);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),n.createElement(t.Provider,{value:s},e.children)}},8480:(e,s,i)=>{i.r(s),i.d(s,{assets:()=>o,contentTitle:()=>c,default:()=>p,frontMatter:()=>a,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"k8s_security_basics/attack_vectors_examples/compromised_api_server","title":"Compromised API Server","description":"Exploiting Kubernetes API server vulnerabilities and best practices for securing API endpoints.","source":"@site/docs/k8s_security_basics/attack_vectors_examples/compromised_api_server.md","sourceDirName":"k8s_security_basics/attack_vectors_examples","slug":"/k8s_security_basics/attack_vectors_examples/compromised_api_server","permalink":"/k8s_security/docs/k8s_security_basics/attack_vectors_examples/compromised_api_server","draft":false,"unlisted":false,"editUrl":"https://github.com/geek-kb/k8s_security/edit/main/docs/k8s_security_basics/attack_vectors_examples/compromised_api_server.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"title":"Compromised API Server","description":"Exploiting Kubernetes API server vulnerabilities and best practices for securing API endpoints."},"sidebar":"tutorialSidebar","previous":{"title":"Common Attack Vectors Examples","permalink":"/k8s_security/docs/category/common-attack-vectors-examples"},"next":{"title":"Exposed Kubernetes Dashboard","permalink":"/k8s_security/docs/k8s_security_basics/attack_vectors_examples/exposed_dashboard"}}');var r=i(4848),t=i(8453);const a={sidebar_position:1,title:"Compromised API Server",description:"Exploiting Kubernetes API server vulnerabilities and best practices for securing API endpoints."},c="Compromised API Server",o={},l=[{value:"\ud83d\udea9 Exploitation Steps: Exposed API Endpoints",id:"-exploitation-steps-exposed-api-endpoints",level:2},{value:"1. Access API Server Without Authentication",id:"1-access-api-server-without-authentication",level:3},{value:"2. Delete Critical Resources",id:"2-delete-critical-resources",level:3},{value:"\u2705 Result",id:"-result",level:3},{value:"\ud83d\udee1\ufe0f Mitigation Techniques and Fixes",id:"\ufe0f-mitigation-techniques-and-fixes",level:2},{value:"1. Restrict API Access",id:"1-restrict-api-access",level:3},{value:"\u2705 Firewall Rule Example",id:"-firewall-rule-example",level:4},{value:"2. Enable Authentication",id:"2-enable-authentication",level:3},{value:"\u2705 Enforcing Authentication via RBAC",id:"-enforcing-authentication-via-rbac",level:4},{value:"3. Use Network Policies",id:"3-use-network-policies",level:3},{value:"\u2705 Example Network Policy to Restrict API Server Access",id:"-example-network-policy-to-restrict-api-server-access",level:4},{value:"\u2705 Key Takeaway",id:"-key-takeaway",level:2}];function d(e){const s={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.header,{children:(0,r.jsx)(s.h1,{id:"compromised-api-server",children:"Compromised API Server"})}),"\n",(0,r.jsxs)(s.p,{children:["A ",(0,r.jsx)(s.strong,{children:"compromised API server"})," can provide attackers with ",(0,r.jsx)(s.strong,{children:"unauthorized access"})," to your ",(0,r.jsx)(s.strong,{children:"Kubernetes cluster"}),", allowing them to ",(0,r.jsx)(s.strong,{children:"view"}),", ",(0,r.jsx)(s.strong,{children:"modify"}),", or ",(0,r.jsx)(s.strong,{children:"delete resources"}),". This type of attack can lead to severe disruptions, including unauthorized data exposure, service downtime, and potential breaches of sensitive environments."]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"-exploitation-steps-exposed-api-endpoints",children:"\ud83d\udea9 Exploitation Steps: Exposed API Endpoints"}),"\n",(0,r.jsx)(s.p,{children:"An attacker identifies an exposed API server using a port scan:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"nmap -p 6443 <cluster-ip>\n"})}),"\n",(0,r.jsx)(s.h3,{id:"1-access-api-server-without-authentication",children:"1. Access API Server Without Authentication"}),"\n",(0,r.jsx)(s.p,{children:"The attacker tries to list all pods using a curl request:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"curl -k https://<api-server-ip>:6443/api/v1/pods\n"})}),"\n",(0,r.jsx)(s.h3,{id:"2-delete-critical-resources",children:"2. Delete Critical Resources"}),"\n",(0,r.jsx)(s.p,{children:"The attacker attempts to delete a specific pod:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"curl -k -X DELETE https://<api-server-ip>:6443/api/v1/namespaces/default/pods/victim-pod\n"})}),"\n",(0,r.jsx)(s.h3,{id:"-result",children:"\u2705 Result"}),"\n",(0,r.jsx)(s.p,{children:"The attacker can delete pods, causing service disruptions and potentially leading to a Denial of Service (DoS)."}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"\ufe0f-mitigation-techniques-and-fixes",children:"\ud83d\udee1\ufe0f Mitigation Techniques and Fixes"}),"\n",(0,r.jsx)(s.h3,{id:"1-restrict-api-access",children:"1. Restrict API Access"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Issue:"})," Publicly exposed API server allows unauthorized access."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Fix:"})," Use firewalls or private networking to limit access."]}),"\n"]}),"\n",(0,r.jsx)(s.h4,{id:"-firewall-rule-example",children:"\u2705 Firewall Rule Example"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"# Allow access to the API server only from a specific IP range\niptables -A INPUT -p tcp -s <trusted-ip-range> --dport 6443 -j ACCEPT\niptables -A INPUT -p tcp --dport 6443 -j DROP\n"})}),"\n",(0,r.jsx)(s.h3,{id:"2-enable-authentication",children:"2. Enable Authentication"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Issue:"})," Lack of authentication enables any user to access the API server."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Fix:"})," Implement Role-Based Access Control (RBAC) and use API server tokens for secure access."]}),"\n"]}),"\n",(0,r.jsx)(s.h4,{id:"-enforcing-authentication-via-rbac",children:"\u2705 Enforcing Authentication via RBAC"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:'apiVersion: rbac.authorization.k8s.io/v1\nkind: Role\nmetadata:\n  namespace: default\n  name: pod-reader\nrules:\n- apiGroups: [""]\n  resources: ["pods"]\n  verbs: ["get", "list"]\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: RoleBinding\nmetadata:\n  name: read-pods\n  namespace: default\nsubjects:\n- kind: User\n  name: "api-user"\n  apiGroup: rbac.authorization.k8s.io\nroleRef:\n  kind: Role\n  name: pod-reader\n  apiGroup: rbac.authorization.k8s.io\n'})}),"\n",(0,r.jsx)(s.h3,{id:"3-use-network-policies",children:"3. Use Network Policies"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Issue:"})," External access to the API server is not restricted."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Fix:"})," Block external access using Kubernetes Network Policies."]}),"\n"]}),"\n",(0,r.jsx)(s.h4,{id:"-example-network-policy-to-restrict-api-server-access",children:"\u2705 Example Network Policy to Restrict API Server Access"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:"apiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: restrict-api-access\n  namespace: default\nspec:\n  podSelector:\n    matchLabels:\n      component: kube-apiserver\n  policyTypes:\n    - Ingress\n  ingress:\n    - from:\n        - podSelector:\n            matchLabels:\n              role: internal\n"})}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"-key-takeaway",children:"\u2705 Key Takeaway"}),"\n",(0,r.jsx)(s.p,{children:"To prevent unauthorized access to your Kubernetes API server, ensure that:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["API server access is ",(0,r.jsx)(s.strong,{children:"restricted"})," through ",(0,r.jsx)(s.strong,{children:"networking controls"}),"."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Authentication and authorization"})," are enforced using ",(0,r.jsx)(s.strong,{children:"RBAC"}),"."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Network policies"})," are implemented to block ",(0,r.jsx)(s.strong,{children:"unwanted traffic"})," to the ",(0,r.jsx)(s.strong,{children:"API server"}),"."]}),"\n"]})]})}function p(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);