"use strict";(globalThis.webpackChunkk_8_s_security=globalThis.webpackChunkk_8_s_security||[]).push([[2540],{2114(e,i,s){s.r(i),s.d(i,{assets:()=>d,contentTitle:()=>c,default:()=>u,frontMatter:()=>a,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"best_practices/cluster_setup_and_hardening/rbac_and_identity/kubernetes_rbac_audit","title":"kubernetes-rbac-audit","description":"kubernetes-rbac-audit is an auditing tool that analyzes RBAC configurations to identify risky permissions and potential security misconfigurations.","source":"@site/docs/best_practices/cluster_setup_and_hardening/rbac_and_identity/kubernetes_rbac_audit.md","sourceDirName":"best_practices/cluster_setup_and_hardening/rbac_and_identity","slug":"/best_practices/cluster_setup_and_hardening/rbac_and_identity/kubernetes_rbac_audit","permalink":"/docs/best_practices/cluster_setup_and_hardening/rbac_and_identity/kubernetes_rbac_audit","draft":false,"unlisted":false,"editUrl":"https://github.com/geek-kb/k8s_security/edit/main/docs/best_practices/cluster_setup_and_hardening/rbac_and_identity/kubernetes_rbac_audit.md","tags":[{"inline":true,"label":"tool","permalink":"/docs/tags/tool"},{"inline":true,"label":"rbac","permalink":"/docs/tags/rbac"},{"inline":true,"label":"authorization","permalink":"/docs/tags/authorization"},{"inline":true,"label":"CKS","permalink":"/docs/tags/cks"}],"version":"current","lastUpdatedBy":"Itai Ganot","lastUpdatedAt":1771232119000,"sidebarPosition":19,"frontMatter":{"sidebar_position":19,"title":"kubernetes-rbac-audit","description":"kubernetes-rbac-audit is an auditing tool that analyzes RBAC configurations to identify risky permissions and potential security misconfigurations.","keywords":["kubernetes security tool","kubernetes-rbac-audit","RBAC security","permission audit","privilege escalation detection","kubernetes authorization","security audit","risky permissions","CKS"],"tags":["tool","rbac","authorization","CKS"],"related":["/docs/best_practices/cluster_setup_and_hardening/rbac_and_identity/insecure_rbac_permissions_mitigation/","/docs/fundamentals/authorization/rbac/","/docs/attack_vectors/insecure_rbac_permissions/"]},"sidebar":"default","previous":{"title":"kubectl-bindrole","permalink":"/docs/best_practices/cluster_setup_and_hardening/rbac_and_identity/kubectl_bindrole"},"next":{"title":"kube2iam","permalink":"/docs/best_practices/cluster_setup_and_hardening/rbac_and_identity/kube2iam"}}');var n=s(4848),r=s(8453);const a={sidebar_position:19,title:"kubernetes-rbac-audit",description:"kubernetes-rbac-audit is an auditing tool that analyzes RBAC configurations to identify risky permissions and potential security misconfigurations.",keywords:["kubernetes security tool","kubernetes-rbac-audit","RBAC security","permission audit","privilege escalation detection","kubernetes authorization","security audit","risky permissions","CKS"],tags:["tool","rbac","authorization","CKS"],related:["/docs/best_practices/cluster_setup_and_hardening/rbac_and_identity/insecure_rbac_permissions_mitigation/","/docs/fundamentals/authorization/rbac/","/docs/attack_vectors/insecure_rbac_permissions/"]},c="kubernetes-rbac-audit",d={},l=[{value:"Use Cases",id:"use-cases",level:2},{value:"Installation",id:"installation",level:2},{value:"Usage Examples",id:"usage-examples",level:2},{value:"Audit Current Cluster",id:"audit-current-cluster",level:3},{value:"Using Docker",id:"using-docker",level:3},{value:"Audit Specific Namespace",id:"audit-specific-namespace",level:3},{value:"Output to JSON",id:"output-to-json",level:3},{value:"Risk Categories Detected",id:"risk-categories-detected",level:2},{value:"Critical Risks",id:"critical-risks",level:3},{value:"High Risks",id:"high-risks",level:3},{value:"Medium Risks",id:"medium-risks",level:3},{value:"Example Output",id:"example-output",level:2},{value:"CI/CD Integration",id:"cicd-integration",level:2},{value:"GitHub Actions Example",id:"github-actions-example",level:3},{value:"GitLab CI Example",id:"gitlab-ci-example",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"References",id:"references",level:2}];function o(e){const i={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.header,{children:(0,n.jsx)(i.h1,{id:"kubernetes-rbac-audit",children:"kubernetes-rbac-audit"})}),"\n",(0,n.jsxs)(i.p,{children:[(0,n.jsx)(i.strong,{children:"kubernetes-rbac-audit"})," is a security auditing tool that analyzes Kubernetes RBAC configurations to identify risky permissions, potential privilege escalation paths, and security misconfigurations. It examines Roles, ClusterRoles, RoleBindings, and ClusterRoleBindings to detect permissions that could be exploited by attackers."]}),"\n",(0,n.jsx)(i.p,{children:"The tool focuses on identifying dangerous permission combinations that are commonly targeted in Kubernetes attacks."}),"\n",(0,n.jsx)(i.hr,{}),"\n",(0,n.jsx)(i.h2,{id:"use-cases",children:"Use Cases"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:"Identify overly permissive RBAC configurations."}),"\n",(0,n.jsx)(i.li,{children:"Detect potential privilege escalation paths."}),"\n",(0,n.jsx)(i.li,{children:"Audit RBAC before and after changes."}),"\n",(0,n.jsx)(i.li,{children:"Generate security reports for compliance."}),"\n",(0,n.jsx)(i.li,{children:"Integrate into CI/CD pipelines to prevent risky RBAC deployments."}),"\n"]}),"\n",(0,n.jsx)(i.hr,{}),"\n",(0,n.jsx)(i.h2,{id:"installation",children:"Installation"}),"\n",(0,n.jsx)(i.p,{children:"Clone the repository and install dependencies:"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-bash",children:"git clone https://github.com/cyberark/kubernetes-rbac-audit.git\ncd kubernetes-rbac-audit\npip install -r requirements.txt\n"})}),"\n",(0,n.jsx)(i.p,{children:"Or run using Docker:"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-bash",children:"docker pull cyberark/kubernetes-rbac-audit\n"})}),"\n",(0,n.jsx)(i.hr,{}),"\n",(0,n.jsx)(i.h2,{id:"usage-examples",children:"Usage Examples"}),"\n",(0,n.jsx)(i.h3,{id:"audit-current-cluster",children:"Audit Current Cluster"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-bash",children:"# Export RBAC configuration\nkubectl get roles,rolebindings,clusterroles,clusterrolebindings -A -o yaml > rbac.yaml\n\n# Run the audit\npython rbac-audit.py -f rbac.yaml\n"})}),"\n",(0,n.jsx)(i.h3,{id:"using-docker",children:"Using Docker"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-bash",children:"kubectl get roles,rolebindings,clusterroles,clusterrolebindings -A -o yaml | \\\n  docker run -i cyberark/kubernetes-rbac-audit\n"})}),"\n",(0,n.jsx)(i.h3,{id:"audit-specific-namespace",children:"Audit Specific Namespace"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-bash",children:"kubectl get roles,rolebindings -n production -o yaml > production-rbac.yaml\npython rbac-audit.py -f production-rbac.yaml\n"})}),"\n",(0,n.jsx)(i.h3,{id:"output-to-json",children:"Output to JSON"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-bash",children:"python rbac-audit.py -f rbac.yaml --json > audit-results.json\n"})}),"\n",(0,n.jsx)(i.hr,{}),"\n",(0,n.jsx)(i.h2,{id:"risk-categories-detected",children:"Risk Categories Detected"}),"\n",(0,n.jsx)(i.p,{children:"kubernetes-rbac-audit identifies several categories of risky permissions:"}),"\n",(0,n.jsx)(i.h3,{id:"critical-risks",children:"Critical Risks"}),"\n",(0,n.jsxs)(i.table,{children:[(0,n.jsx)(i.thead,{children:(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.th,{children:"Permission"}),(0,n.jsx)(i.th,{children:"Risk"})]})}),(0,n.jsxs)(i.tbody,{children:[(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:"secrets: get/list"})}),(0,n.jsx)(i.td,{children:"Access to all secrets including tokens and credentials"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:"pods/exec: create"})}),(0,n.jsx)(i.td,{children:"Execute commands in any pod"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:"pods: create"})}),(0,n.jsx)(i.td,{children:"Create pods with mounted secrets or host paths"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:"rolebindings: create"})}),(0,n.jsx)(i.td,{children:"Bind any role to self for privilege escalation"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:"clusterrolebindings: create"})}),(0,n.jsx)(i.td,{children:"Cluster-wide privilege escalation"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsxs)(i.td,{children:[(0,n.jsx)(i.code,{children:"*: *"})," (wildcard)"]}),(0,n.jsx)(i.td,{children:"Full administrative access"})]})]})]}),"\n",(0,n.jsx)(i.h3,{id:"high-risks",children:"High Risks"}),"\n",(0,n.jsxs)(i.table,{children:[(0,n.jsx)(i.thead,{children:(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.th,{children:"Permission"}),(0,n.jsx)(i.th,{children:"Risk"})]})}),(0,n.jsxs)(i.tbody,{children:[(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:"secrets: watch"})}),(0,n.jsx)(i.td,{children:"Monitor secret changes in real-time"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:"pods/attach: create"})}),(0,n.jsx)(i.td,{children:"Attach to running containers"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:"serviceaccounts/token: create"})}),(0,n.jsx)(i.td,{children:"Generate tokens for any service account"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:"nodes/proxy: create"})}),(0,n.jsx)(i.td,{children:"Access kubelet API through API server"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:"persistentvolumes: create"})}),(0,n.jsx)(i.td,{children:"Mount arbitrary host paths"})]})]})]}),"\n",(0,n.jsx)(i.h3,{id:"medium-risks",children:"Medium Risks"}),"\n",(0,n.jsxs)(i.table,{children:[(0,n.jsx)(i.thead,{children:(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.th,{children:"Permission"}),(0,n.jsx)(i.th,{children:"Risk"})]})}),(0,n.jsxs)(i.tbody,{children:[(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:"pods: delete"})}),(0,n.jsx)(i.td,{children:"Denial of service by deleting workloads"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:"configmaps: update"})}),(0,n.jsx)(i.td,{children:"Modify application configurations"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:"services: create"})}),(0,n.jsx)(i.td,{children:"Create services for traffic interception"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:"endpoints: update"})}),(0,n.jsx)(i.td,{children:"Redirect service traffic"})]})]})]}),"\n",(0,n.jsx)(i.hr,{}),"\n",(0,n.jsx)(i.h2,{id:"example-output",children:"Example Output"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{children:"=== CRITICAL RISKS ===\n\nSubject: system:serviceaccount:default:admin-sa\nRoles: admin-role\nRisky Permissions:\n  - secrets: [get, list, watch] - Can access all secrets in namespace\n  - pods/exec: [create] - Can execute commands in pods\n  - rolebindings: [create] - Can escalate privileges\n\nSubject: developer-group (Group)\nRoles: developer-role\nRisky Permissions:\n  - pods: [create] - Can create pods with security risks\n\n=== HIGH RISKS ===\n\nSubject: system:serviceaccount:monitoring:prometheus\nRoles: prometheus-role\nRisky Permissions:\n  - nodes/metrics: [get] - Can access node metrics\n\n=== SUMMARY ===\nCritical: 2\nHigh: 1\nMedium: 5\nTotal subjects audited: 45\n"})}),"\n",(0,n.jsx)(i.hr,{}),"\n",(0,n.jsx)(i.h2,{id:"cicd-integration",children:"CI/CD Integration"}),"\n",(0,n.jsx)(i.p,{children:"Integrate kubernetes-rbac-audit into CI/CD pipelines to prevent risky RBAC changes:"}),"\n",(0,n.jsx)(i.h3,{id:"github-actions-example",children:"GitHub Actions Example"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-yaml",children:"name: RBAC Audit\non:\n  pull_request:\n    paths:\n      - 'kubernetes/rbac/**'\n\njobs:\n  audit:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n      - name: Run RBAC Audit\n        run: |\n          pip install pyyaml\n          git clone https://github.com/cyberark/kubernetes-rbac-audit.git\n          python kubernetes-rbac-audit/rbac-audit.py -f kubernetes/rbac/*.yaml --exit-code\n"})}),"\n",(0,n.jsx)(i.h3,{id:"gitlab-ci-example",children:"GitLab CI Example"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-yaml",children:"rbac-audit:\n  stage: security\n  image: python:3.9\n  script:\n    - pip install pyyaml\n    - git clone https://github.com/cyberark/kubernetes-rbac-audit.git\n    - python kubernetes-rbac-audit/rbac-audit.py -f manifests/rbac/*.yaml --exit-code\n  only:\n    changes:\n      - manifests/rbac/**\n"})}),"\n",(0,n.jsx)(i.hr,{}),"\n",(0,n.jsx)(i.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Run before applying RBAC changes:"})," Audit new RBAC configurations before deploying to production."]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Integrate into CI/CD:"})," Automatically block PRs that introduce risky permissions."]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Schedule regular audits:"})," Run periodic audits to detect configuration drift."]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Review critical findings immediately:"})," Critical and high-risk findings should be addressed promptly."]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Combine with runtime monitoring:"})," Use Falco or similar tools to detect RBAC exploitation attempts."]}),"\n"]}),"\n",(0,n.jsx)(i.hr,{}),"\n",(0,n.jsx)(i.h2,{id:"references",children:"References"}),"\n",(0,n.jsx)(i.p,{children:"This article is based on information from the following official sources:"}),"\n",(0,n.jsxs)(i.ol,{children:["\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.a,{href:"https://github.com/cyberark/kubernetes-rbac-audit",children:"kubernetes-rbac-audit GitHub Repository"})," - CyberArk"]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.a,{href:"https://kubernetes.io/docs/reference/access-authn-authz/rbac/",children:"Using RBAC Authorization"})," - Kubernetes Documentation"]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.a,{href:"https://kubernetes.io/docs/concepts/security/",children:"Securing Kubernetes Clusters"})," - Kubernetes Documentation"]}),"\n"]})]})}function u(e={}){const{wrapper:i}={...(0,r.R)(),...e.components};return i?(0,n.jsx)(i,{...e,children:(0,n.jsx)(o,{...e})}):o(e)}},8453(e,i,s){s.d(i,{R:()=>a,x:()=>c});var t=s(6540);const n={},r=t.createContext(n);function a(e){const i=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function c(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:a(e.components),t.createElement(r.Provider,{value:i},e.children)}}}]);