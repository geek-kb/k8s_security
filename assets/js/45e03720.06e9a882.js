"use strict";(globalThis.webpackChunkk_8_s_security=globalThis.webpackChunkk_8_s_security||[]).push([[5865],{590(e,s,n){n.r(s),n.d(s,{assets:()=>o,contentTitle:()=>l,default:()=>u,frontMatter:()=>a,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"best-practices/cluster-setup-and-hardening/pod-security/kube-psp-advisor","title":"kube-psp-advisor","description":"kube-psp-advisor generates Pod Security Policies and Pod Security Standards based on the actual security requirements of running workloads.","source":"@site/docs/best-practices/cluster-setup-and-hardening/pod-security/kube-psp-advisor.md","sourceDirName":"best-practices/cluster-setup-and-hardening/pod-security","slug":"/best-practices/cluster-setup-and-hardening/pod-security/kube-psp-advisor","permalink":"/kubernetes-security/best-practices/cluster-setup-and-hardening/pod-security/kube-psp-advisor","draft":false,"unlisted":false,"editUrl":"https://github.com/geek-kb/k8s_security/edit/main/docs/best-practices/cluster-setup-and-hardening/pod-security/kube-psp-advisor.md","tags":[{"inline":true,"label":"tool","permalink":"/kubernetes-security/tags/tool"},{"inline":true,"label":"pod-security","permalink":"/kubernetes-security/tags/pod-security"},{"inline":true,"label":"policy-generation","permalink":"/kubernetes-security/tags/policy-generation"},{"inline":true,"label":"CKS","permalink":"/kubernetes-security/tags/cks"}],"version":"current","lastUpdatedBy":"Itai Ganot","lastUpdatedAt":1771236448000,"sidebarPosition":12,"frontMatter":{"sidebar_position":12,"title":"kube-psp-advisor","description":"kube-psp-advisor generates Pod Security Policies and Pod Security Standards based on the actual security requirements of running workloads.","keywords":["kubernetes security tool","kube-psp-advisor","pod security policy","pod security standards","PSP","PSS","workload analysis","security policy generation","CKS"],"tags":["tool","pod-security","policy-generation","CKS"],"related":["/kubernetes-security/best-practices/cluster-setup-and-hardening/pod-security/pod-security-standards/","/kubernetes-security/attack-vectors/privileged-container-escape/","/kubernetes-security/best-practices/cluster-setup-and-hardening/pod-security/seccomp-in-pods/"]},"sidebar":"default","previous":{"title":"Securing Persistent Volumes","permalink":"/kubernetes-security/best-practices/cluster-setup-and-hardening/pod-security/persistent-volume-security"},"next":{"title":"Securing RBAC Permissions","permalink":"/kubernetes-security/best-practices/cluster-setup-and-hardening/rbac-and-identity/insecure-rbac-permissions-mitigation"}}');var t=n(4848),r=n(8453);const a={sidebar_position:12,title:"kube-psp-advisor",description:"kube-psp-advisor generates Pod Security Policies and Pod Security Standards based on the actual security requirements of running workloads.",keywords:["kubernetes security tool","kube-psp-advisor","pod security policy","pod security standards","PSP","PSS","workload analysis","security policy generation","CKS"],tags:["tool","pod-security","policy-generation","CKS"],related:["/kubernetes-security/best-practices/cluster-setup-and-hardening/pod-security/pod-security-standards/","/kubernetes-security/attack-vectors/privileged-container-escape/","/kubernetes-security/best-practices/cluster-setup-and-hardening/pod-security/seccomp-in-pods/"]},l="kube-psp-advisor",o={},d=[{value:"Use Cases",id:"use-cases",level:2},{value:"Installation",id:"installation",level:2},{value:"Using kubectl krew",id:"using-kubectl-krew",level:3},{value:"Using Go",id:"using-go",level:3},{value:"From GitHub Releases",id:"from-github-releases",level:3},{value:"Basic Usage",id:"basic-usage",level:2},{value:"Analyze a Namespace",id:"analyze-a-namespace",level:3},{value:"Analyze the Entire Cluster",id:"analyze-the-entire-cluster",level:3},{value:"Generate Pod Security Policy",id:"generate-pod-security-policy",level:3},{value:"Generate Pod Security Standards Report",id:"generate-pod-security-standards-report",level:3},{value:"Example Output",id:"example-output",level:2},{value:"PSP Recommendation",id:"psp-recommendation",level:3},{value:"PSS Recommendation",id:"pss-recommendation",level:3},{value:"Understanding the Analysis",id:"understanding-the-analysis",level:2},{value:"Security Context Analysis",id:"security-context-analysis",level:3},{value:"Volume Analysis",id:"volume-analysis",level:3},{value:"Capability Analysis",id:"capability-analysis",level:3},{value:"Migration Planning",id:"migration-planning",level:2},{value:"From Privileged to Restricted",id:"from-privileged-to-restricted",level:3},{value:"Remediation Recommendations",id:"remediation-recommendations",level:3},{value:"Per-Workload Analysis",id:"per-workload-analysis",level:2},{value:"Analyze Specific Deployment",id:"analyze-specific-deployment",level:3},{value:"Output",id:"output",level:3},{value:"CI/CD Integration",id:"cicd-integration",level:2},{value:"Validate Workloads Against PSS",id:"validate-workloads-against-pss",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Limitations",id:"limitations",level:2},{value:"References",id:"references",level:2}];function c(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.header,{children:(0,t.jsx)(s.h1,{id:"kube-psp-advisor",children:"kube-psp-advisor"})}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"kube-psp-advisor"})," is a tool that analyzes running Kubernetes workloads and generates recommended Pod Security Policies (PSP) or Pod Security Standards (PSS) based on actual security requirements. Instead of starting with overly permissive or restrictive policies, it examines what workloads actually need and generates the minimal policy to allow them."]}),"\n",(0,t.jsx)(s.p,{children:"While PodSecurityPolicy is deprecated in Kubernetes 1.25+, kube-psp-advisor can also generate Pod Security Standards recommendations for the newer Pod Security Admission controller."}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h2,{id:"use-cases",children:"Use Cases"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Generate baseline security policies based on actual workload requirements."}),"\n",(0,t.jsx)(s.li,{children:"Migrate from permissive policies to least-privilege configurations."}),"\n",(0,t.jsx)(s.li,{children:"Understand what security permissions workloads actually use."}),"\n",(0,t.jsx)(s.li,{children:"Plan migration from PSP to Pod Security Admission."}),"\n",(0,t.jsx)(s.li,{children:"Audit workloads against desired security standards."}),"\n"]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h2,{id:"installation",children:"Installation"}),"\n",(0,t.jsx)(s.h3,{id:"using-kubectl-krew",children:"Using kubectl krew"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"kubectl krew install advise-psp\n"})}),"\n",(0,t.jsx)(s.h3,{id:"using-go",children:"Using Go"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"go install github.com/sysdiglabs/kube-psp-advisor@latest\n"})}),"\n",(0,t.jsx)(s.h3,{id:"from-github-releases",children:"From GitHub Releases"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"curl -LO https://github.com/sysdiglabs/kube-psp-advisor/releases/download/v1.0.0/kube-psp-advisor_linux_amd64.tar.gz\ntar xzf kube-psp-advisor_linux_amd64.tar.gz\nchmod +x kube-psp-advisor\nsudo mv kube-psp-advisor /usr/local/bin/\n"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h2,{id:"basic-usage",children:"Basic Usage"}),"\n",(0,t.jsx)(s.h3,{id:"analyze-a-namespace",children:"Analyze a Namespace"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"kubectl advise-psp inspect --namespace production\n"})}),"\n",(0,t.jsx)(s.h3,{id:"analyze-the-entire-cluster",children:"Analyze the Entire Cluster"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"kubectl advise-psp inspect\n"})}),"\n",(0,t.jsx)(s.h3,{id:"generate-pod-security-policy",children:"Generate Pod Security Policy"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"kubectl advise-psp inspect --namespace production --report=psp\n"})}),"\n",(0,t.jsx)(s.h3,{id:"generate-pod-security-standards-report",children:"Generate Pod Security Standards Report"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"kubectl advise-psp inspect --namespace production --report=pss\n"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h2,{id:"example-output",children:"Example Output"}),"\n",(0,t.jsx)(s.h3,{id:"psp-recommendation",children:"PSP Recommendation"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-yaml",children:"# Generated by kube-psp-advisor\napiVersion: policy/v1beta1\nkind: PodSecurityPolicy\nmetadata:\n  name: production-psp\nspec:\n  privileged: false\n  allowPrivilegeEscalation: false\n  \n  # Required for nginx pods\n  hostNetwork: false\n  hostIPC: false\n  hostPID: false\n  \n  runAsUser:\n    rule: MustRunAsNonRoot\n    \n  seLinux:\n    rule: RunAsAny\n    \n  fsGroup:\n    rule: RunAsAny\n    \n  supplementalGroups:\n    rule: RunAsAny\n    \n  volumes:\n    - configMap\n    - emptyDir\n    - secret\n    - persistentVolumeClaim\n    \n  # Capabilities analysis\n  allowedCapabilities: []\n  requiredDropCapabilities:\n    - ALL\n    \n  # Detected hostPath requirements\n  allowedHostPaths: []\n"})}),"\n",(0,t.jsx)(s.h3,{id:"pss-recommendation",children:"PSS Recommendation"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"Pod Security Standards Report for namespace: production\n========================================================\n\nRecommended Level: restricted\n\nWorkload Analysis:\n- Total Pods: 15\n- Compliant with 'restricted': 12\n- Compliant with 'baseline': 3\n- Require 'privileged': 0\n\nNon-compliant workloads (baseline):\n- deployment/logging-agent\n  Issues:\n  - Uses hostPath volume\n  - Requires NET_ADMIN capability\n  \n- daemonset/monitoring\n  Issues:\n  - Runs as root (UID 0)\n  \nRecommendations:\n1. Apply 'restricted' level to production namespace\n2. Add exemptions for: logging-agent, monitoring\n3. Or modify workloads to be compliant\n"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h2,{id:"understanding-the-analysis",children:"Understanding the Analysis"}),"\n",(0,t.jsx)(s.h3,{id:"security-context-analysis",children:"Security Context Analysis"}),"\n",(0,t.jsx)(s.p,{children:"kube-psp-advisor examines:"}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Field"}),(0,t.jsx)(s.th,{children:"What It Checks"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"privileged"}),(0,t.jsx)(s.td,{children:"Whether pods need privileged mode"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"capabilities"}),(0,t.jsx)(s.td,{children:"What Linux capabilities are required"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"runAsUser"}),(0,t.jsx)(s.td,{children:"User ID requirements"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"runAsGroup"}),(0,t.jsx)(s.td,{children:"Group ID requirements"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"fsGroup"}),(0,t.jsx)(s.td,{children:"Filesystem group requirements"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"volumes"}),(0,t.jsx)(s.td,{children:"Volume types used"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"hostPath"}),(0,t.jsx)(s.td,{children:"Host filesystem mounts"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"hostNetwork"}),(0,t.jsx)(s.td,{children:"Host network usage"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"hostPID"}),(0,t.jsx)(s.td,{children:"Host PID namespace"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"hostIPC"}),(0,t.jsx)(s.td,{children:"Host IPC namespace"})]})]})]}),"\n",(0,t.jsx)(s.h3,{id:"volume-analysis",children:"Volume Analysis"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"Volume Types Detected:\n- configMap (12 pods)\n- secret (10 pods)\n- emptyDir (8 pods)\n- persistentVolumeClaim (3 pods)\n- hostPath (1 pod) [!]\n"})}),"\n",(0,t.jsx)(s.h3,{id:"capability-analysis",children:"Capability Analysis"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"Capabilities Analysis:\n- Pods dropping ALL capabilities: 10\n- Pods with default capabilities: 4\n- Pods adding capabilities: 1\n  - logging-agent: NET_ADMIN, NET_RAW\n"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h2,{id:"migration-planning",children:"Migration Planning"}),"\n",(0,t.jsx)(s.h3,{id:"from-privileged-to-restricted",children:"From Privileged to Restricted"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"# Step 1: Analyze current state\nkubectl advise-psp inspect --report=pss\n\n# Step 2: Identify non-compliant workloads\nkubectl advise-psp inspect --report=pss --output=json | jq '.non_compliant[]'\n\n# Step 3: Generate remediation plan\nkubectl advise-psp inspect --report=remediation\n"})}),"\n",(0,t.jsx)(s.h3,{id:"remediation-recommendations",children:"Remediation Recommendations"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-yaml",children:"# Remediation for: deployment/app\n# Current: baseline level required\n# Target: restricted level\n\n# Change 1: Remove root user requirement\nspec:\n  containers:\n    - securityContext:\n        runAsNonRoot: true\n        runAsUser: 1000  # Add non-root user\n\n# Change 2: Drop all capabilities\n        capabilities:\n          drop:\n            - ALL\n\n# Change 3: Enable read-only root filesystem\n        readOnlyRootFilesystem: true\n"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h2,{id:"per-workload-analysis",children:"Per-Workload Analysis"}),"\n",(0,t.jsx)(s.h3,{id:"analyze-specific-deployment",children:"Analyze Specific Deployment"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"kubectl advise-psp inspect --namespace production --name deployment/my-app\n"})}),"\n",(0,t.jsx)(s.h3,{id:"output",children:"Output"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"Workload: deployment/my-app\nNamespace: production\n\nSecurity Requirements:\n- privileged: false\n- hostNetwork: false\n- hostPID: false\n- hostIPC: false\n- capabilities: NET_BIND_SERVICE (required for port 80)\n- runAsUser: 1000\n- runAsGroup: 1000\n- fsGroup: 2000\n- volumes: configMap, secret, emptyDir\n\nRecommended PSS Level: restricted (with capability exemption)\n\nMinimal PSP:\n  spec:\n    privileged: false\n    allowedCapabilities:\n      - NET_BIND_SERVICE\n    requiredDropCapabilities:\n      - ALL\n    runAsUser:\n      rule: MustRunAsNonRoot\n    volumes:\n      - configMap\n      - secret\n      - emptyDir\n"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h2,{id:"cicd-integration",children:"CI/CD Integration"}),"\n",(0,t.jsx)(s.h3,{id:"validate-workloads-against-pss",children:"Validate Workloads Against PSS"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-yaml",children:'name: Security Policy Check\non: [push]\n\njobs:\n  psp-check:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n      \n      - name: Install kube-psp-advisor\n        run: |\n          curl -LO https://github.com/sysdiglabs/kube-psp-advisor/releases/latest/download/kube-psp-advisor_linux_amd64.tar.gz\n          tar xzf kube-psp-advisor_linux_amd64.tar.gz\n          \n      - name: Check manifests\n        run: |\n          ./kube-psp-advisor inspect --source=file --path=./kubernetes/\n          \n      - name: Fail if privileged required\n        run: |\n          RESULT=$(./kube-psp-advisor inspect --source=file --path=./kubernetes/ --output=json)\n          PRIVILEGED=$(echo $RESULT | jq \'.requires_privileged\')\n          if [ "$PRIVILEGED" == "true" ]; then\n            echo "Workloads require privileged mode!"\n            exit 1\n          fi\n'})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Analyze before restricting:"})," Understand what workloads need before applying policies."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Start with baseline:"})," Use baseline level first, then move to restricted."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Use exemptions sparingly:"})," Grant exemptions only to workloads that truly need them."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Automate analysis:"})," Run kube-psp-advisor in CI/CD to catch policy violations early."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Document exceptions:"})," Keep records of why specific workloads need elevated permissions."]}),"\n"]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h2,{id:"limitations",children:"Limitations"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Cannot detect runtime-only security requirements."}),"\n",(0,t.jsx)(s.li,{children:"Based on current workload configuration, not future needs."}),"\n",(0,t.jsx)(s.li,{children:"PodSecurityPolicy output is for legacy clusters only."}),"\n",(0,t.jsx)(s.li,{children:"Does not account for operator-deployed workloads that may change."}),"\n"]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h2,{id:"references",children:"References"}),"\n",(0,t.jsx)(s.p,{children:"This article is based on information from the following official sources:"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.a,{href:"https://github.com/sysdiglabs/kube-psp-advisor",children:"kube-psp-advisor GitHub Repository"})," - Sysdig"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.a,{href:"https://kubernetes.io/docs/concepts/security/pod-security-standards/",children:"Pod Security Standards"})," - Kubernetes Documentation"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.a,{href:"https://kubernetes.io/docs/concepts/security/pod-security-admission/",children:"Pod Security Admission"})," - Kubernetes Documentation"]}),"\n"]})]})}function u(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},8453(e,s,n){n.d(s,{R:()=>a,x:()=>l});var i=n(6540);const t={},r=i.createContext(t);function a(e){const s=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),i.createElement(r.Provider,{value:s},e.children)}}}]);