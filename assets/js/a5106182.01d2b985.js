"use strict";(globalThis.webpackChunkk_8_s_security=globalThis.webpackChunkk_8_s_security||[]).push([[6047],{7046(e,i,n){n.r(i),n.d(i,{assets:()=>a,contentTitle:()=>l,default:()=>u,frontMatter:()=>r,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"best_practices/monitoring_logging_and_runtime_security/kubectl_dig","title":"kubectl-dig","description":"kubectl-dig provides deep visibility into Kubernetes cluster activity using eBPF-based tracing, enabling real-time analysis of system calls and network traffic.","source":"@site/docs/best_practices/monitoring_logging_and_runtime_security/kubectl_dig.md","sourceDirName":"best_practices/monitoring_logging_and_runtime_security","slug":"/best_practices/monitoring_logging_and_runtime_security/kubectl_dig","permalink":"/docs/best_practices/monitoring_logging_and_runtime_security/kubectl_dig","draft":false,"unlisted":false,"editUrl":"https://github.com/geek-kb/k8s_security/edit/main/docs/best_practices/monitoring_logging_and_runtime_security/kubectl_dig.md","tags":[{"inline":true,"label":"tool","permalink":"/docs/tags/tool"},{"inline":true,"label":"runtime-security","permalink":"/docs/tags/runtime-security"},{"inline":true,"label":"debugging","permalink":"/docs/tags/debugging"},{"inline":true,"label":"CKS","permalink":"/docs/tags/cks"}],"version":"current","lastUpdatedBy":"Itai Ganot","lastUpdatedAt":1771232119000,"sidebarPosition":10,"frontMatter":{"sidebar_position":10,"title":"kubectl-dig","description":"kubectl-dig provides deep visibility into Kubernetes cluster activity using eBPF-based tracing, enabling real-time analysis of system calls and network traffic.","keywords":["kubernetes security tool","kubectl-dig","eBPF","kubernetes tracing","system call monitoring","network visibility","container debugging","security analysis","CKS"],"tags":["tool","runtime-security","debugging","CKS"],"related":["/docs/best_practices/monitoring_logging_and_runtime_security/tetragon/","/docs/best_practices/monitoring_logging_and_runtime_security/kubectl_trace/","/docs/best_practices/monitoring_logging_and_runtime_security/falco/"]},"sidebar":"default","previous":{"title":"Deepfence ThreatMapper","permalink":"/docs/best_practices/monitoring_logging_and_runtime_security/threatmapper"},"next":{"title":"Introduction","permalink":"/docs/best_practices/supply_chain_security/intro"}}');var s=n(4848),c=n(8453);const r={sidebar_position:10,title:"kubectl-dig",description:"kubectl-dig provides deep visibility into Kubernetes cluster activity using eBPF-based tracing, enabling real-time analysis of system calls and network traffic.",keywords:["kubernetes security tool","kubectl-dig","eBPF","kubernetes tracing","system call monitoring","network visibility","container debugging","security analysis","CKS"],tags:["tool","runtime-security","debugging","CKS"],related:["/docs/best_practices/monitoring_logging_and_runtime_security/tetragon/","/docs/best_practices/monitoring_logging_and_runtime_security/kubectl_trace/","/docs/best_practices/monitoring_logging_and_runtime_security/falco/"]},l="kubectl-dig",a={},o=[{value:"Use Cases",id:"use-cases",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Installation",id:"installation",level:2},{value:"Using krew",id:"using-krew",level:3},{value:"Manual Installation",id:"manual-installation",level:3},{value:"Usage Examples",id:"usage-examples",level:2},{value:"Trace a Pod",id:"trace-a-pod",level:3},{value:"Trace System Calls",id:"trace-system-calls",level:3},{value:"Trace Network Connections",id:"trace-network-connections",level:3},{value:"Trace File Access",id:"trace-file-access",level:3},{value:"Trace All Pods in a Namespace",id:"trace-all-pods-in-a-namespace",level:3},{value:"Trace with Duration",id:"trace-with-duration",level:3},{value:"Tracing Capabilities",id:"tracing-capabilities",level:2},{value:"System Call Tracing",id:"system-call-tracing",level:3},{value:"Network Tracing",id:"network-tracing",level:3},{value:"Process Tracing",id:"process-tracing",level:3},{value:"Security Analysis Scenarios",id:"security-analysis-scenarios",level:2},{value:"Detect Command Injection",id:"detect-command-injection",level:3},{value:"Identify Suspicious Network Activity",id:"identify-suspicious-network-activity",level:3},{value:"Monitor Secret Access",id:"monitor-secret-access",level:3},{value:"Detect Container Escape Attempts",id:"detect-container-escape-attempts",level:3},{value:"Output Formats",id:"output-formats",level:2},{value:"JSON Output",id:"json-output",level:3},{value:"Filter Output",id:"filter-output",level:3},{value:"Export to File",id:"export-to-file",level:3},{value:"Integration with Other Tools",id:"integration-with-other-tools",level:2},{value:"Send to Falco",id:"send-to-falco",level:3},{value:"Export to Elasticsearch",id:"export-to-elasticsearch",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Limitations",id:"limitations",level:2},{value:"References",id:"references",level:2}];function d(e){const i={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,c.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.header,{children:(0,s.jsx)(i.h1,{id:"kubectl-dig",children:"kubectl-dig"})}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"kubectl-dig"})," is a kubectl plugin that provides deep visibility into Kubernetes cluster activity using eBPF (extended Berkeley Packet Filter). It enables real-time tracing of system calls, network connections, and process execution within containers, making it valuable for security analysis, debugging, and incident investigation."]}),"\n",(0,s.jsx)(i.p,{children:"The tool deploys temporary pods with eBPF tracing capabilities to collect detailed information about workload behavior."}),"\n",(0,s.jsx)(i.hr,{}),"\n",(0,s.jsx)(i.h2,{id:"use-cases",children:"Use Cases"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Investigate suspicious container behavior during security incidents."}),"\n",(0,s.jsx)(i.li,{children:"Debug application issues by tracing system calls."}),"\n",(0,s.jsx)(i.li,{children:"Analyze network connections from pods."}),"\n",(0,s.jsx)(i.li,{children:"Identify unexpected process execution in containers."}),"\n",(0,s.jsx)(i.li,{children:"Monitor file system access patterns."}),"\n"]}),"\n",(0,s.jsx)(i.hr,{}),"\n",(0,s.jsx)(i.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Kubernetes cluster with eBPF support (kernel 4.14+)."}),"\n",(0,s.jsx)(i.li,{children:"kubectl configured with cluster access."}),"\n",(0,s.jsx)(i.li,{children:"Node access permissions to deploy privileged pods."}),"\n"]}),"\n",(0,s.jsx)(i.hr,{}),"\n",(0,s.jsx)(i.h2,{id:"installation",children:"Installation"}),"\n",(0,s.jsx)(i.h3,{id:"using-krew",children:"Using krew"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-bash",children:"kubectl krew install dig\n"})}),"\n",(0,s.jsx)(i.h3,{id:"manual-installation",children:"Manual Installation"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-bash",children:"curl -LO https://github.com/sysdiglabs/kubectl-dig/releases/download/v1.0.0/kubectl-dig_linux_amd64.tar.gz\ntar xzf kubectl-dig_linux_amd64.tar.gz\nchmod +x kubectl-dig\nsudo mv kubectl-dig /usr/local/bin/\n"})}),"\n",(0,s.jsx)(i.hr,{}),"\n",(0,s.jsx)(i.h2,{id:"usage-examples",children:"Usage Examples"}),"\n",(0,s.jsx)(i.h3,{id:"trace-a-pod",children:"Trace a Pod"}),"\n",(0,s.jsx)(i.p,{children:"Start tracing all activity in a specific pod:"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-bash",children:"kubectl dig pod my-app -n production\n"})}),"\n",(0,s.jsx)(i.h3,{id:"trace-system-calls",children:"Trace System Calls"}),"\n",(0,s.jsx)(i.p,{children:"Trace specific system calls:"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-bash",children:"kubectl dig pod my-app -n production --syscalls=execve,open,connect\n"})}),"\n",(0,s.jsx)(i.h3,{id:"trace-network-connections",children:"Trace Network Connections"}),"\n",(0,s.jsx)(i.p,{children:"Monitor network connections from a pod:"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-bash",children:"kubectl dig pod my-app -n production --network\n"})}),"\n",(0,s.jsx)(i.h3,{id:"trace-file-access",children:"Trace File Access"}),"\n",(0,s.jsx)(i.p,{children:"Monitor file system operations:"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-bash",children:"kubectl dig pod my-app -n production --files\n"})}),"\n",(0,s.jsx)(i.h3,{id:"trace-all-pods-in-a-namespace",children:"Trace All Pods in a Namespace"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-bash",children:"kubectl dig namespace production\n"})}),"\n",(0,s.jsx)(i.h3,{id:"trace-with-duration",children:"Trace with Duration"}),"\n",(0,s.jsx)(i.p,{children:"Run tracing for a specific duration:"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-bash",children:"kubectl dig pod my-app -n production --duration 60s\n"})}),"\n",(0,s.jsx)(i.hr,{}),"\n",(0,s.jsx)(i.h2,{id:"tracing-capabilities",children:"Tracing Capabilities"}),"\n",(0,s.jsx)(i.h3,{id:"system-call-tracing",children:"System Call Tracing"}),"\n",(0,s.jsxs)(i.table,{children:[(0,s.jsx)(i.thead,{children:(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.th,{children:"Syscall"}),(0,s.jsx)(i.th,{children:"Security Relevance"})]})}),(0,s.jsxs)(i.tbody,{children:[(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"execve"}),(0,s.jsx)(i.td,{children:"Process execution (command injection detection)"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"open/openat"}),(0,s.jsx)(i.td,{children:"File access (data exfiltration, config access)"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"connect"}),(0,s.jsx)(i.td,{children:"Outbound network connections (C2 communication)"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"socket"}),(0,s.jsx)(i.td,{children:"Network socket creation"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"bind"}),(0,s.jsx)(i.td,{children:"Port binding (backdoor detection)"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"ptrace"}),(0,s.jsx)(i.td,{children:"Process debugging (potential escape attempt)"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"mount"}),(0,s.jsx)(i.td,{children:"Filesystem mounting (container escape)"})]})]})]}),"\n",(0,s.jsx)(i.h3,{id:"network-tracing",children:"Network Tracing"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"TIMESTAMP           SOURCE              DEST                PROTOCOL\n12:34:56.789        10.0.0.5:45678      10.0.0.10:5432      TCP\n12:34:57.012        10.0.0.5:45680      169.254.169.254:80  HTTP\n12:34:58.345        10.0.0.5:45682      192.168.1.1:443     HTTPS\n"})}),"\n",(0,s.jsx)(i.h3,{id:"process-tracing",children:"Process Tracing"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"TIMESTAMP           PID     PPID    CMD                     USER\n12:34:56.789        1234    1       nginx                   root\n12:34:57.012        1235    1234    /bin/sh -c curl ...     nginx\n12:34:58.345        1236    1235    curl http://evil.com    nginx\n"})}),"\n",(0,s.jsx)(i.hr,{}),"\n",(0,s.jsx)(i.h2,{id:"security-analysis-scenarios",children:"Security Analysis Scenarios"}),"\n",(0,s.jsx)(i.h3,{id:"detect-command-injection",children:"Detect Command Injection"}),"\n",(0,s.jsx)(i.p,{children:"Monitor for unexpected shell execution:"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-bash",children:'kubectl dig pod my-app -n production --syscalls=execve | grep -E "(sh|bash|curl|wget|nc)"\n'})}),"\n",(0,s.jsx)(i.h3,{id:"identify-suspicious-network-activity",children:"Identify Suspicious Network Activity"}),"\n",(0,s.jsx)(i.p,{children:"Watch for connections to metadata services or unusual destinations:"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-bash",children:'kubectl dig pod my-app -n production --network | grep -E "(169.254.169.254|:22|:4444)"\n'})}),"\n",(0,s.jsx)(i.h3,{id:"monitor-secret-access",children:"Monitor Secret Access"}),"\n",(0,s.jsx)(i.p,{children:"Track file access to secret mount paths:"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-bash",children:'kubectl dig pod my-app -n production --files | grep "/var/run/secrets"\n'})}),"\n",(0,s.jsx)(i.h3,{id:"detect-container-escape-attempts",children:"Detect Container Escape Attempts"}),"\n",(0,s.jsx)(i.p,{children:"Monitor for escape-related syscalls:"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-bash",children:"kubectl dig pod my-app -n production --syscalls=mount,ptrace,setns\n"})}),"\n",(0,s.jsx)(i.hr,{}),"\n",(0,s.jsx)(i.h2,{id:"output-formats",children:"Output Formats"}),"\n",(0,s.jsx)(i.h3,{id:"json-output",children:"JSON Output"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-bash",children:"kubectl dig pod my-app -n production -o json > trace.json\n"})}),"\n",(0,s.jsx)(i.h3,{id:"filter-output",children:"Filter Output"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-bash",children:"kubectl dig pod my-app -n production --filter='cmd contains \"curl\"'\n"})}),"\n",(0,s.jsx)(i.h3,{id:"export-to-file",children:"Export to File"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-bash",children:"kubectl dig pod my-app -n production --output-file=/tmp/trace.log\n"})}),"\n",(0,s.jsx)(i.hr,{}),"\n",(0,s.jsx)(i.h2,{id:"integration-with-other-tools",children:"Integration with Other Tools"}),"\n",(0,s.jsx)(i.h3,{id:"send-to-falco",children:"Send to Falco"}),"\n",(0,s.jsx)(i.p,{children:"Configure kubectl-dig output to complement Falco alerts:"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-bash",children:"kubectl dig pod my-app -n production --output-format=falco\n"})}),"\n",(0,s.jsx)(i.h3,{id:"export-to-elasticsearch",children:"Export to Elasticsearch"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-bash",children:'kubectl dig pod my-app -n production -o json | \\\n  jq -c \'.\' | \\\n  while read line; do\n    curl -X POST "http://elasticsearch:9200/kubectl-dig/_doc" \\\n      -H "Content-Type: application/json" \\\n      -d "$line"\n  done\n'})}),"\n",(0,s.jsx)(i.hr,{}),"\n",(0,s.jsx)(i.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Use targeted tracing:"})," Focus on specific pods or syscalls to reduce noise and overhead."]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Set time limits:"})," Always use ",(0,s.jsx)(i.code,{children:"--duration"})," to prevent indefinite tracing."]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Correlate with alerts:"})," Use dig to investigate Falco or other security alerts."]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Trace in staging first:"})," Test tracing patterns in non-production environments."]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Export important traces:"})," Save trace data for incident documentation and forensics."]}),"\n"]}),"\n",(0,s.jsx)(i.hr,{}),"\n",(0,s.jsx)(i.h2,{id:"limitations",children:"Limitations"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Requires privileged pods for eBPF access."}),"\n",(0,s.jsx)(i.li,{children:"High-volume applications may generate significant trace data."}),"\n",(0,s.jsx)(i.li,{children:"Kernel version requirements may not be met on all clusters."}),"\n",(0,s.jsx)(i.li,{children:"Tracing adds overhead to monitored workloads."}),"\n"]}),"\n",(0,s.jsx)(i.hr,{}),"\n",(0,s.jsx)(i.h2,{id:"references",children:"References"}),"\n",(0,s.jsx)(i.p,{children:"This article is based on information from the following official sources:"}),"\n",(0,s.jsxs)(i.ol,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.a,{href:"https://github.com/sysdiglabs/kubectl-dig",children:"kubectl-dig GitHub Repository"})," - Sysdig"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.a,{href:"https://ebpf.io/what-is-ebpf/",children:"eBPF Documentation"})," - eBPF.io"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.a,{href:"https://kubernetes.io/docs/tasks/debug/",children:"Kubernetes Debugging"})," - Kubernetes Documentation"]}),"\n"]})]})}function u(e={}){const{wrapper:i}={...(0,c.R)(),...e.components};return i?(0,s.jsx)(i,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453(e,i,n){n.d(i,{R:()=>r,x:()=>l});var t=n(6540);const s={},c=t.createContext(s);function r(e){const i=t.useContext(c);return t.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function l(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),t.createElement(c.Provider,{value:i},e.children)}}}]);