"use strict";(globalThis.webpackChunkk_8_s_security=globalThis.webpackChunkk_8_s_security||[]).push([[6505],{4301(e,n,r){r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>u,frontMatter:()=>o,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"best-practices/cluster-setup-and-hardening/network-security/dns-security","title":"DNS Security in Kubernetes","description":"Protect CoreDNS from spoofing, cache poisoning, DNS tunneling, and unauthorized modifications to enhance Kubernetes cluster security.","source":"@site/docs/best-practices/cluster-setup-and-hardening/network-security/dns-security.md","sourceDirName":"best-practices/cluster-setup-and-hardening/network-security","slug":"/best-practices/cluster-setup-and-hardening/network-security/dns-security","permalink":"/kubernetes-security/best-practices/cluster-setup-and-hardening/network-security/dns-security","draft":false,"unlisted":false,"editUrl":"https://github.com/geek-kb/k8s_security/edit/main/docs/best-practices/cluster-setup-and-hardening/network-security/dns-security.md","tags":[{"inline":true,"label":"best-practice","permalink":"/kubernetes-security/tags/best-practice"},{"inline":true,"label":"network","permalink":"/kubernetes-security/tags/network"},{"inline":true,"label":"dns","permalink":"/kubernetes-security/tags/dns"},{"inline":true,"label":"CoreDNS","permalink":"/kubernetes-security/tags/core-dns"},{"inline":true,"label":"CKS","permalink":"/kubernetes-security/tags/cks"}],"version":"current","lastUpdatedBy":"Itai Ganot","lastUpdatedAt":1771236448000,"sidebarPosition":3,"frontMatter":{"title":"DNS Security in Kubernetes","description":"Protect CoreDNS from spoofing, cache poisoning, DNS tunneling, and unauthorized modifications to enhance Kubernetes cluster security.","sidebar_position":3,"keywords":["kubernetes security best practices","DNS security","CoreDNS","DNS spoofing","cache poisoning","DNS tunneling","DNS security hardening","kubernetes networking","service discovery","DNSSEC","DNS over TLS","CKS"],"tags":["best-practice","network","dns","CoreDNS","CKS"],"related":["/kubernetes-security/best-practices/cluster-setup-and-hardening/network-security/network-policies/","/kubernetes-security/best-practices/cluster-setup-and-hardening/network-security/egress-control/","/kubernetes-security/attack-vectors/traffic-hijacking/"]},"sidebar":"default","previous":{"title":"DDoS Mitigation in Kubernetes","permalink":"/kubernetes-security/best-practices/cluster-setup-and-hardening/network-security/ddos-mitigation"},"next":{"title":"Egress Control in Kubernetes","permalink":"/kubernetes-security/best-practices/cluster-setup-and-hardening/network-security/egress-control"}}');var i=r(4848),t=r(8453);const o={title:"DNS Security in Kubernetes",description:"Protect CoreDNS from spoofing, cache poisoning, DNS tunneling, and unauthorized modifications to enhance Kubernetes cluster security.",sidebar_position:3,keywords:["kubernetes security best practices","DNS security","CoreDNS","DNS spoofing","cache poisoning","DNS tunneling","DNS security hardening","kubernetes networking","service discovery","DNSSEC","DNS over TLS","CKS"],tags:["best-practice","network","dns","CoreDNS","CKS"],related:["/kubernetes-security/best-practices/cluster-setup-and-hardening/network-security/network-policies/","/kubernetes-security/best-practices/cluster-setup-and-hardening/network-security/egress-control/","/kubernetes-security/attack-vectors/traffic-hijacking/"]},l="DNS Security in Kubernetes",c={},a=[{value:"1. Restrict DNS Access with Network Policies",id:"1-restrict-dns-access-with-network-policies",level:2},{value:"Allow Only Internal DNS",id:"allow-only-internal-dns",level:3},{value:"Block External DNS for All Pods",id:"block-external-dns-for-all-pods",level:3},{value:"2. Secure CoreDNS Configuration",id:"2-secure-coredns-configuration",level:2},{value:"Enable DNS Query Logging",id:"enable-dns-query-logging",level:3},{value:"Limit DNS Cache Size",id:"limit-dns-cache-size",level:3},{value:"3. Enable DNS-over-TLS (DoT)",id:"3-enable-dns-over-tls-dot",level:2},{value:"CoreDNS with DNS-over-TLS",id:"coredns-with-dns-over-tls",level:3},{value:"4. Implement DNS Rate Limiting",id:"4-implement-dns-rate-limiting",level:2},{value:"CoreDNS Rate Limiting",id:"coredns-rate-limiting",level:3},{value:"5. Monitor DNS for Security Anomalies",id:"5-monitor-dns-for-security-anomalies",level:2},{value:"Key Metrics to Monitor",id:"key-metrics-to-monitor",level:3},{value:"Alerting Rules",id:"alerting-rules",level:3},{value:"Signs of DNS Tunneling",id:"signs-of-dns-tunneling",level:3},{value:"6. Protect CoreDNS Resources",id:"6-protect-coredns-resources",level:2},{value:"Resource Limits",id:"resource-limits",level:3},{value:"Dedicated Node Pool",id:"dedicated-node-pool",level:3},{value:"Conclusion",id:"conclusion",level:2},{value:"References",id:"references",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"dns-security-in-kubernetes",children:"DNS Security in Kubernetes"})}),"\n",(0,i.jsxs)(n.p,{children:["DNS is a critical component of Kubernetes networking. ",(0,i.jsx)(n.strong,{children:"CoreDNS"})," serves as the default DNS provider, enabling service discovery by resolving service names to cluster IPs. Because every pod relies on DNS for communication, ",(0,i.jsx)(n.strong,{children:"compromising DNS can have cluster-wide impact"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["Securing DNS prevents attacks like ",(0,i.jsx)(n.strong,{children:"spoofing"}),", ",(0,i.jsx)(n.strong,{children:"cache poisoning"}),", ",(0,i.jsx)(n.strong,{children:"DNS tunneling"}),", and ",(0,i.jsx)(n.strong,{children:"data exfiltration through DNS queries"}),"."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"1-restrict-dns-access-with-network-policies",children:"1. Restrict DNS Access with Network Policies"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Required knowledge for the CKS certification."})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Issue:"})," By default, pods can query any DNS server, including external ones. This allows attackers to bypass CoreDNS and use external DNS for tunneling or exfiltration.",(0,i.jsx)("br",{}),"\n",(0,i.jsx)(n.strong,{children:"Fix:"})," Use NetworkPolicies to restrict pods to only use cluster DNS (CoreDNS) and block external DNS access."]}),"\n",(0,i.jsx)(n.h3,{id:"allow-only-internal-dns",children:"Allow Only Internal DNS"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"apiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: restrict-dns-to-coredns\n  namespace: production\nspec:\n  podSelector:\n    matchLabels:\n      app: sensitive-app\n  policyTypes:\n    - Egress\n  egress:\n    - to:\n        - namespaceSelector:\n            matchLabels:\n              kubernetes.io/metadata.name: kube-system\n          podSelector:\n            matchLabels:\n              k8s-app: kube-dns\n      ports:\n        - protocol: UDP\n          port: 53\n        - protocol: TCP\n          port: 53\n    - to:\n        - ipBlock:\n            cidr: 10.0.0.0/8\n"})}),"\n",(0,i.jsx)(n.h3,{id:"block-external-dns-for-all-pods",children:"Block External DNS for All Pods"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"apiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: deny-external-dns\n  namespace: default\nspec:\n  podSelector: {}\n  policyTypes:\n    - Egress\n  egress:\n    - to:\n        - namespaceSelector: {}\n      ports:\n        - protocol: UDP\n          port: 53\n        - protocol: TCP\n          port: 53\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"2-secure-coredns-configuration",children:"2. Secure CoreDNS Configuration"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Issue:"})," Default CoreDNS configuration may lack logging, rate limiting, and other security controls needed to detect and prevent attacks.",(0,i.jsx)("br",{}),"\n",(0,i.jsx)(n.strong,{children:"Fix:"})," Configure CoreDNS with query logging, cache limits, and zone transfer restrictions."]}),"\n",(0,i.jsx)(n.h3,{id:"enable-dns-query-logging",children:"Enable DNS Query Logging"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: coredns\n  namespace: kube-system\ndata:\n  Corefile: |\n    .:53 {\n        errors\n        health {\n           lameduck 5s\n        }\n        ready\n        kubernetes cluster.local in-addr.arpa ip6.arpa {\n           pods insecure\n           fallthrough in-addr.arpa ip6.arpa\n           ttl 30\n        }\n        prometheus :9153\n        forward . /etc/resolv.conf {\n           max_concurrent 1000\n        }\n        cache 30\n        loop\n        reload\n        loadbalance\n        log\n    }\n"})}),"\n",(0,i.jsx)(n.h3,{id:"limit-dns-cache-size",children:"Limit DNS Cache Size"}),"\n",(0,i.jsx)(n.p,{children:"Prevent cache exhaustion attacks:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"cache 30 {\n    success 9984 30\n    denial 9984 5\n}\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"3-enable-dns-over-tls-dot",children:"3. Enable DNS-over-TLS (DoT)"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Issue:"})," DNS queries to upstream servers are sent in plaintext, allowing interception and tampering by attackers with network access.",(0,i.jsx)("br",{}),"\n",(0,i.jsx)(n.strong,{children:"Fix:"})," Configure CoreDNS to use DNS-over-TLS for encrypted upstream queries."]}),"\n",(0,i.jsx)(n.h3,{id:"coredns-with-dns-over-tls",children:"CoreDNS with DNS-over-TLS"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: coredns\n  namespace: kube-system\ndata:\n  Corefile: |\n    .:53 {\n        errors\n        health\n        ready\n        kubernetes cluster.local in-addr.arpa ip6.arpa {\n           pods insecure\n           fallthrough in-addr.arpa ip6.arpa\n        }\n        prometheus :9153\n        forward . tls://1.1.1.1 tls://1.0.0.1 {\n           tls_servername cloudflare-dns.com\n           health_check 5s\n        }\n        cache 30\n        loop\n        reload\n        loadbalance\n    }\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"DoT Providers:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Cloudflare: ",(0,i.jsx)(n.code,{children:"tls://1.1.1.1"})," (tls_servername: cloudflare-dns.com)"]}),"\n",(0,i.jsxs)(n.li,{children:["Google: ",(0,i.jsx)(n.code,{children:"tls://8.8.8.8"})," (tls_servername: dns.google)"]}),"\n",(0,i.jsxs)(n.li,{children:["Quad9: ",(0,i.jsx)(n.code,{children:"tls://9.9.9.9"})," (tls_servername: dns.quad9.net)"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"4-implement-dns-rate-limiting",children:"4. Implement DNS Rate Limiting"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Issue:"})," Without rate limiting, CoreDNS is vulnerable to DNS amplification attacks and resource exhaustion.",(0,i.jsx)("br",{}),"\n",(0,i.jsx)(n.strong,{children:"Fix:"})," Enable response rate limiting (RRL) in CoreDNS to limit the rate of responses to any single client."]}),"\n",(0,i.jsx)(n.h3,{id:"coredns-rate-limiting",children:"CoreDNS Rate Limiting"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: coredns\n  namespace: kube-system\ndata:\n  Corefile: |\n    .:53 {\n        errors\n        health\n        ready\n        kubernetes cluster.local in-addr.arpa ip6.arpa {\n           pods insecure\n           fallthrough in-addr.arpa ip6.arpa\n        }\n        rrl {\n           responses-per-second 10\n           slip 2\n        }\n        cache 30\n        forward . /etc/resolv.conf\n        loop\n        reload\n        loadbalance\n    }\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"5-monitor-dns-for-security-anomalies",children:"5. Monitor DNS for Security Anomalies"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Issue:"})," DNS-based attacks like tunneling can go undetected without proper monitoring and alerting.",(0,i.jsx)("br",{}),"\n",(0,i.jsx)(n.strong,{children:"Fix:"})," Monitor CoreDNS metrics and alert on anomalies like high NXDOMAIN rates or unusual query volumes."]}),"\n",(0,i.jsx)(n.h3,{id:"key-metrics-to-monitor",children:"Key Metrics to Monitor"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"coredns_dns_requests_total"}),": Total DNS queries (watch for spikes)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'coredns_dns_responses_total{rcode="NXDOMAIN"}'}),": Non-existent domain queries (potential tunneling)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'coredns_dns_responses_total{rcode="SERVFAIL"}'}),": Server failures"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"coredns_forward_requests_total"}),": Forwarded queries (external lookups)"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"alerting-rules",children:"Alerting Rules"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'groups:\n  - name: dns-security\n    rules:\n      - alert: HighDNSNXDOMAINRate\n        expr: |\n          sum(rate(coredns_dns_responses_total{rcode="NXDOMAIN"}[5m])) \n          / sum(rate(coredns_dns_responses_total[5m])) > 0.3\n        for: 10m\n        labels:\n          severity: warning\n        annotations:\n          summary: "High NXDOMAIN rate detected - possible DNS tunneling"\n      \n      - alert: UnusualDNSQueryVolume\n        expr: |\n          sum(rate(coredns_dns_requests_total[5m])) > 10000\n        for: 5m\n        labels:\n          severity: warning\n        annotations:\n          summary: "Unusual DNS query volume detected"\n'})}),"\n",(0,i.jsx)(n.h3,{id:"signs-of-dns-tunneling",children:"Signs of DNS Tunneling"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Long subdomain names (encoded data)"}),"\n",(0,i.jsx)(n.li,{children:"High NXDOMAIN rate"}),"\n",(0,i.jsx)(n.li,{children:"Consistent queries to suspicious domains"}),"\n",(0,i.jsx)(n.li,{children:"High volume of TXT record queries"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"6-protect-coredns-resources",children:"6. Protect CoreDNS Resources"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Issue:"})," CoreDNS pods without resource limits can be overwhelmed by excessive queries, causing cluster-wide DNS failures.",(0,i.jsx)("br",{}),"\n",(0,i.jsx)(n.strong,{children:"Fix:"})," Set appropriate resource limits and consider running CoreDNS on dedicated nodes."]}),"\n",(0,i.jsx)(n.h3,{id:"resource-limits",children:"Resource Limits"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"resources:\n  limits:\n    memory: 170Mi\n    cpu: 100m\n  requests:\n    memory: 70Mi\n    cpu: 50m\n"})}),"\n",(0,i.jsx)(n.h3,{id:"dedicated-node-pool",children:"Dedicated Node Pool"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: coredns\n  namespace: kube-system\nspec:\n  template:\n    spec:\n      nodeSelector:\n        node-role.kubernetes.io/dns: "true"\n      tolerations:\n        - key: "node-role.kubernetes.io/dns"\n          operator: "Exists"\n          effect: "NoSchedule"\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,i.jsxs)(n.p,{children:["DNS security is critical for Kubernetes cluster protection. Implement ",(0,i.jsx)(n.strong,{children:"network policies"})," to restrict DNS access, enable ",(0,i.jsx)(n.strong,{children:"query logging"})," for visibility, use ",(0,i.jsx)(n.strong,{children:"DNS-over-TLS"})," for encryption, and ",(0,i.jsx)(n.strong,{children:"monitor for anomalies"})," to detect tunneling and other attacks."]}),"\n",(0,i.jsx)(n.p,{children:"Key takeaways:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Restrict pods to use only cluster DNS (CoreDNS)"}),"\n",(0,i.jsx)(n.li,{children:"Enable DNS query logging for security analysis"}),"\n",(0,i.jsx)(n.li,{children:"Use DNS-over-TLS for encrypted upstream queries"}),"\n",(0,i.jsx)(n.li,{children:"Monitor for DNS tunneling patterns"}),"\n",(0,i.jsx)(n.li,{children:"Implement rate limiting to prevent amplification attacks"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,i.jsx)(n.p,{children:"This article is based on information from the following official sources:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://kubernetes.io/docs/concepts/services-networking/network-policies/",children:"Network Policies"})," - Kubernetes Documentation"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://coredns.io/plugins/forward/",children:"CoreDNS Forward Plugin"})," - CoreDNS Documentation"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://coredns.io/plugins/log/",children:"CoreDNS Log Plugin"})," - CoreDNS Documentation"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/",children:"DNS for Services and Pods"})," - Kubernetes Documentation"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453(e,n,r){r.d(n,{R:()=>o,x:()=>l});var s=r(6540);const i={},t=s.createContext(i);function o(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);